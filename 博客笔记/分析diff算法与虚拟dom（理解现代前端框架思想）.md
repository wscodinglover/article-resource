React å’Œ Vue ä½œä¸ºç›®å‰å›½å†…ä¸»åŠ›çš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œæƒ³å¿…å¤§å®¶åœ¨æ—¥å¸¸çš„å¼€å‘å½“ä¸­ä¹Ÿæ˜¯éå¸¸ç†Ÿæ‚‰äº†ã€‚ä¸å¯å¦è®¤çš„å®ƒä»¬çš„å­˜åœ¨å¤§å¤§åœ°æé«˜äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ä»¥åŠä½¿å¾—æˆ‘ä»¬çš„ä»£ç å¯ç»´æŠ¤æ€§å¾—åˆ°æé«˜ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä»¬çš„ â€œå·§å¦™â€ çš„ä¹‹åï¼Œå¯¹æŠ€æœ¯æœ‰ç€è¿½æ±‚çš„ä½ ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥äº†è§£ä¸€ä¸‹è¿™äº›æ¡†æ¶èƒŒåçš„ä¸€äº›æ€æƒ³å‘¢ï¼Ÿå¦‚æœè¿˜æ²¡æœ‰ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥ï¼  

æœ¬æ–‡å…¨éƒ¨ä»£ç å°çš„å·²ç»ä¸Šä¼  githubğŸ¶

## è™šæ‹Ÿ DOM

ç›´è§‚æ¥è¯´ï¼Œè™šæ‹Ÿ DOM å…¶å®å°±æ˜¯ç”¨æ•°æ®ç»“æ„è¡¨ç¤ºçœŸå®çš„ DOM ç»“æ„ã€‚ä½¿ç”¨å®ƒçš„åŸå› æ˜¯ï¼Œé¢‘ç¹çš„æ“ä½œ DOM ä¼šä½¿å¾—ç½‘ç«™çš„æ€§èƒ½ä¸‹é™ï¼Œä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å¾— DOM çš„æ“ä½œå°½é‡ç²¾ç®€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œè™šæ‹Ÿ DOM çš„æ–¹æ³•ï¼Œå»æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹çš„å·®å¼‚ç„¶åç²¾ç¡®çš„è·å–æœ€å°çš„ï¼Œæœ€ä¸ºå¿…è¦çš„ DOM é›†åˆï¼Œæœ€ç»ˆæŒ‚è½½åˆ°çœŸå®çš„ DOM ä¸Šã€‚å› ä¸ºæ“ä½œæ•°æ®ç»“æ„ï¼Œè¿œæ¯”æˆ‘ä»¬ç›´æ¥ä¿®æ”¹ DOM èŠ‚ç‚¹æ¥çš„å¿«ï¼Œæˆ‘ä»¬çœŸå®çš„ DOM æ“ä½œåœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œå…¶å®åªéœ€è¦åœ¨æœ€åæ¥é‚£ä¹ˆä¸€ä¸‹ï¼Œä¸æ˜¯å—

### å¦‚ä½•è¡¨ç¤º DOM ç»“æ„

![Image](https://mmbiz.qpic.cn/mmbiz_png/5Xv0xlEBe9icXr1fP8s62z1icmQxkfmK6Uc92SOSThcz9biaCpTdtQuk8ibz9VBKgDJiaZJ97eEtkNT1or6ZV4E6Oog/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1) ![Image](https://mmbiz.qpic.cn/mmbiz_png/5Xv0xlEBe9icXr1fP8s62z1icmQxkfmK6UXjWcyiciaMfgMdPN8nypmcrOGbic2TSuvTsLtCEYS4Ro3IPA5rhI9wvJg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

è¿™æ˜¯ä¸€æ®µåˆ—è¡¨çš„ DOM ç»“æ„ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œå…¶ä¸­éœ€è¦åŒ…å«çš„ä¿¡æ¯æœ‰

**1\. æ ‡ç­¾ç±»å‹ ulï¼Œli...**

**2\. æ ‡ç­¾å±æ€§ class,style...**

**3\. å­©å­èŠ‚ç‚¹ ul->li li->text ...**

æ— è®ºå†å¤æ‚çš„ç»“æ„ï¼Œä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰¾åˆ° DOM ç»“æ„çš„å…±æ€§ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè¡¨ç¤ºå‘¢

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

é€šè¿‡è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¯¹è±¡ JS å¯¹è±¡è½»æ˜“åœ°å°±å°†å®ƒè¡¨ç¤ºå‡ºæ¥ï¼Œå‡ ä¸ªå±æ€§ä¹Ÿæ˜¯éå¸¸å¥½ç†è§£

-   tagName å¯¹åº”çœŸå®çš„æ ‡ç­¾ç±»å‹
    
-   attrs è¡¨ç¤ºèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å±æ€§
    
-   child è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹
    

é‚£è¿™æ ·æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç»™è¿™ä¸ªè™šæ‹Ÿ DOM è®¾å®šä¸€ä¸ªç±» like this

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">function</span>&nbsp;newElement(tag,attr,child){&nbsp;//åˆ›å»ºå¯¹è±¡å‡½æ•°<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;new&nbsp;Element(tag,attr,child)<br>}<br>å¤åˆ¶ä»£ç <br></code>
```

**æµ‹è¯•ä¸€ä¸‹**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

ok æ²¡é—®é¢˜æ˜¯ä¸æ˜¯ï¼Œé‚£ç°åœ¨è™šæ‹Ÿ DOM å…¶å®å°±å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œé‚£ä¹ˆæœ‰äº†è™šæ‹Ÿ DOM ä¹‹åæ€ä¹ˆæŒ‚è½½åˆ°çœŸå® DOM ä¸Šå‘¢

### ç”ŸæˆçœŸå® DOM èŠ‚ç‚¹

é¦–å…ˆæˆ‘ä»¬ä¼šéœ€è¦ä¸€ä¸ªæ ¹æ®å¯¹è±¡å±æ€§æ¥è®¾ç½®æ ‡ç­¾å±æ€§çš„æ–¹æ³•

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

ç„¶åæˆ‘ä»¬åœ¨ç±»çš„å†…éƒ¨æ·»åŠ åˆ›å»ºèŠ‚ç‚¹çš„ render æ–¹æ³•

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ render æ–¹æ³•åˆ›å»ºçœŸå®çš„ DOM èŠ‚ç‚¹äº†ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ SetVdToDom æ–¹æ³•å¯¹å±æ€§è¿›è¡Œè®¾ç½®ï¼Œç„¶åå¯¹å­èŠ‚ç‚¹è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œé€’å½’åˆ°æœ€åå‰©ä¸‹çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚

æœ€åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª renderDom æ–¹æ³•å°† dom æ¸²æŸ“åˆ°æµè§ˆå™¨çœ‹çœ‹

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">//vdmock.js&nbsp;éƒ¨åˆ†<br>const&nbsp;VdObj1&nbsp;=&nbsp;newElement(<span data-darkreader-inline-color="">'ul'</span>,{id:&nbsp;<span data-darkreader-inline-color="">'list'</span>},[<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-1'</span>,style:<span data-darkreader-inline-color="">'color:red'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'lavie'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-2'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'virtual&nbsp;dom'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-3'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'React'</span>]),&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-4'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'Vue'</span>])&nbsp;<br>])<br>const&nbsp;RealDom&nbsp;=&nbsp;VdObj1.render()<br>const&nbsp;renderDom&nbsp;=&nbsp;<span data-darkreader-inline-color="">function</span>(element,target){<br>&nbsp;&nbsp;&nbsp;&nbsp;target.appendChild(element)<br>}<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;<span><span data-darkreader-inline-color="">start</span></span>(){<br>&nbsp;&nbsp;&nbsp;renderDom(RealDom,document.body)<br>}<br><br>//&nbsp;index.html<br>&lt;!DOCTYPE&nbsp;html&gt;<br>&lt;html&nbsp;lang=<span data-darkreader-inline-color="">"en"</span>&gt;<br>&lt;head&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=<span data-darkreader-inline-color="">"UTF-8"</span>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;<span data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-color="">"module"</span>&nbsp;src=<span data-darkreader-inline-color="">"./vdmock.js"</span>&nbsp;&nbsp;&gt;&lt;/script&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Document&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;<span data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-color="">"module"</span>&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;start&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./vdmock.js'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start()<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>å¤åˆ¶ä»£ç <br></code>
```

ç»“æœå¦‚ä¸‹ï¼š

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## è™šæ‹Ÿ DOM diff

é€šè¿‡ä¸Šé¢æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ç”Ÿæˆè™šæ‹Ÿ DOM å¹¶ä¸”å°†å®ƒæ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Šé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç”¨æˆ·è¿›è¡Œæ“ä½œä¹‹åï¼Œå¦‚ä½•è®¡ç®—å‡ºå‰åè™šæ‹Ÿ DOM ä¹‹é—´çš„å·®å¼‚å‘¢ï¼Ÿä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹ diff ç®—æ³•

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

æˆ‘ä»¬é€šè¿‡ç»™ diff ä¼ å…¥æ–°æ—§çš„ä¸¤ä¸ªèŠ‚ç‚¹é€šè¿‡å†…éƒ¨çš„ getDiff é€’å½’å¯¹æ¯”èŠ‚ç‚¹å¹¶å­˜å‚¨å˜åŒ–ç„¶åè¿”å›ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ getDiff

### è·å–æœ€å°å·®å¼‚æ•°ç»„

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">const&nbsp;REMOVE&nbsp;=&nbsp;<span data-darkreader-inline-color="">'remove'</span><br>const&nbsp;MODIFY_TEXT&nbsp;=&nbsp;&nbsp;<span data-darkreader-inline-color="">'modify_text'</span><br>const&nbsp;CHANGE_ATTRS&nbsp;=&nbsp;<span data-darkreader-inline-color="">'change_attrs'</span><br>const&nbsp;TAKEPLACE&nbsp;=&nbsp;<span data-darkreader-inline-color="">'replace'</span><br><span data-darkreader-inline-color="">let</span>&nbsp;initIndex&nbsp;=&nbsp;0<br>const&nbsp;getDiff&nbsp;=&nbsp;(oldNode,newNode,index,difference)=&gt;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;diffResult&nbsp;=&nbsp;[]<br>&nbsp;&nbsp;&nbsp;&nbsp;//æ–°èŠ‚ç‚¹ä¸å­˜åœ¨çš„è¯è¯´æ˜èŠ‚ç‚¹å·²ç»è¢«åˆ é™¤<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(!newNode){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffResult.push({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;REMOVE<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;//å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ç›´æ¥æ›¿æ¢å°±è¡Œ<br>&nbsp;&nbsp;&nbsp;&nbsp;}<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>(typeof&nbsp;newNode&nbsp;===&nbsp;<span data-darkreader-inline-color="">'string'</span>&nbsp;&amp;&amp;&nbsp;typeof&nbsp;oldNode&nbsp;===&nbsp;<span data-darkreader-inline-color="">'string'</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(oldNode&nbsp;!==&nbsp;newNode){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffResult.push({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;newNode,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;MODIFY_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;//å¦‚æœèŠ‚ç‚¹ç±»å‹ç›¸åŒåˆ™åˆ™ç»§ç»­æ¯”è¾ƒå±æ€§æ˜¯å¦ç›¸åŒ<br>&nbsp;&nbsp;&nbsp;&nbsp;}<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>(oldNode.tagName&nbsp;===&nbsp;newNode.tagName){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;storeAttrs&nbsp;=&nbsp;{}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>(<span data-darkreader-inline-color="">let</span>&nbsp;&nbsp;key&nbsp;<span data-darkreader-inline-color="">in</span>&nbsp;oldNode.attrs){&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(oldNode.attrs[key]&nbsp;!==&nbsp;newNode.attrs[key]){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storeAttrs[key]&nbsp;=&nbsp;newNode.attrs[key]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;key&nbsp;<span data-darkreader-inline-color="">in</span>&nbsp;newNode.attrs){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(!oldNode.attrs.hasOwnProperty(key)){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storeAttrs[key]&nbsp;=&nbsp;newNode[key]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åˆ¤æ–­æ˜¯å¦æœ‰ä¸åŒ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(Object.keys(storeAttrs).length&gt;0){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffResult.push({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;storeAttrs,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;CHANGE_ATTRS<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;//éå†å­èŠ‚ç‚¹<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldNode.child.forEach((child,index)=&gt;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ·±åº¦éå†æ‰€ä»¥è¦ä¿ç•™index<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDiff(child,newNode.child[index],++initIndex,difference)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//å¦‚æœç±»å‹ä¸ç›¸åŒï¼Œé‚£ä¹ˆæ— éœ€å¯¹æ¯”ç›´æ¥æ›¿æ¢æ‰å°±è¡Œ<br>&nbsp;&nbsp;&nbsp;&nbsp;}<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>(oldNode.tagName&nbsp;!==&nbsp;newNode.tagName){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffResult.push({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;TAKEPLACE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newNode<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;//æœ€åå°†ç»“æœè¿”å›<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(!oldNode){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffResult.push({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;TAKEPLACE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newNode<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(diffResult.length){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;difference[index]&nbsp;=&nbsp;diffResult<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br><br>å¤åˆ¶ä»£ç <br></code>
```

æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

### æ›´æ–° dom

ç°åœ¨æˆ‘ä»¬å·²ç»ç”Ÿæˆäº†ä¸¤ä¸ªè™šæ‹Ÿ DOM, å¹¶ä¸”å°†ä¸¤ä¸ª DOM ä¹‹é—´çš„å·®å¼‚ç”¨å¯¹è±¡çš„æ–¹å¼ä¿å­˜äº†ä¸‹æ¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦é€šè¿‡è¿™äº›æ¥å°†å·®å¼‚æ›´æ–°åˆ°çœŸå®çš„ DOM ä¸Šé¢å»ï¼ï¼ï¼

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**pace** å‡½æ•°ä¼šè‡ªèº«è¿›è¡Œé€’å½’ï¼Œå¯¹å½“å‰èŠ‚ç‚¹çš„å·®å¼‚ç”¨ dofix è¿›è¡Œæ›´æ–°

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">const&nbsp;doFix&nbsp;=&nbsp;(node,difference)&nbsp;=&gt;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;difference.forEach(item=&gt;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(item.type){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-color="">'change_attrs'</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;attrs&nbsp;=&nbsp;item.value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>(&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;key&nbsp;<span data-darkreader-inline-color="">in</span>&nbsp;attrs&nbsp;){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(node.nodeType&nbsp;!==&nbsp;1)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;value&nbsp;=&nbsp;attrs[key]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(value){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetVdToDom(node,key,value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span data-darkreader-inline-color="">else</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.removeAttribute(key)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-color="">'modify_text'</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.textContent&nbsp;=&nbsp;item.value<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-color="">'replace'</span>:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;newNode&nbsp;=&nbsp;(item.newNode&nbsp;instanceof&nbsp;Element)&nbsp;?&nbsp;item.newNode.render(item.newNode)&nbsp;:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.createTextNode(item.newNode)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.parentNode.replaceChild(newNode,node)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-color="">'remove'</span>&nbsp;:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.parentNode.removeChild(node)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>å¤åˆ¶ä»£ç <br></code>
```

ä¸‡äº‹å…·å¤‡ï¼Œé‚£æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">const&nbsp;VdObj1&nbsp;=&nbsp;newElement(<span data-darkreader-inline-color="">'ul'</span>,{id:&nbsp;<span data-darkreader-inline-color="">'list'</span>},[<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-1'</span>,style:<span data-darkreader-inline-color="">'color:red'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'lavie'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-2'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'virtual&nbsp;dom'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-3'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'React'</span>]),&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-4'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'Vue'</span>])&nbsp;,<br>])<br>const&nbsp;VdObj&nbsp;=&nbsp;newElement(<span data-darkreader-inline-color="">'ol'</span>,{id:&nbsp;<span data-darkreader-inline-color="">'list'</span>},[<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'h2'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-1'</span>,style:<span data-darkreader-inline-color="">'color:green'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'lavieee'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-2'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'virtual&nbsp;dom'</span>]),<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-3'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'React'</span>]),&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-4'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'Vue'</span>])&nbsp;,<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-5'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'Dva'</span>])&nbsp;,<br>&nbsp;&nbsp;&nbsp;&nbsp;newElement(<span data-darkreader-inline-color="">'li'</span>,{class:&nbsp;<span data-darkreader-inline-color="">'list-5'</span>&nbsp;},&nbsp;[<span data-darkreader-inline-color="">'Dva'</span>])&nbsp;<br>&nbsp;<br>])<br>const&nbsp;RealDom&nbsp;=&nbsp;VdObj1.render()<br>const&nbsp;renderDom&nbsp;=&nbsp;<span data-darkreader-inline-color="">function</span>(element,target){<br>&nbsp;&nbsp;&nbsp;&nbsp;target.appendChild(element)<br>}<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;<span><span data-darkreader-inline-color="">start</span></span>(){<br>&nbsp;&nbsp;&nbsp;renderDom(RealDom,document.body)<br>&nbsp;&nbsp;&nbsp;const&nbsp;diffs&nbsp;=&nbsp;diff(VdObj1,VdObj)<br>&nbsp;&nbsp;&nbsp;fixPlace(RealDom,diffs)<br>}<br>å¤åˆ¶ä»£ç <br></code>
```

**before**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**diff after**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

å˜»å˜»å®Œç¾

é€šè¿‡è¿™å‡ ä¸ªä¾‹å­ä¸‹æ¥ï¼Œå…¶å®è™šæ‹Ÿ dom çš„æ€æƒ³å°±å·²ç»å¯ä»¥å®ç°äº†ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ¡†æ¶çš„è¿‡ç¨‹ä¸­å¦‚æœå¯ä»¥æ¢³ç†æ¸…æ¥šå…¶ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸€å®šä¼šèµ°çš„æ›´åŠ è¸å®ã€‚