大厂技术  高级前端  Node进阶

点击上方 程序员成长指北，关注公众号

回复1，加入高级Node交流群

> 作者：背对疾风
> 
> 原文：https://juejin.cn/post/7181712900094951483

我以前很喜欢封装组件，什么东西不喜欢别人的，总喜欢自己搞搞，这让人很有成就感，虽然是重复造轮子，但是能从无聊的crud业务中暂时解脱出来，对我来说也算是一种休息，相信有很多人跟我一样有这个习惯。 

这种习惯在独立开发时无所谓，毕竟没人会关心你咋实现的，但是在跟人合作时就给别人造成了很大的困扰了，毕竟每个人封装的东西都是根据自己习惯来的，别人看着多少会有点不顺眼，而且自己封装的组件大概率也是没有写文档和注释的，所以项目其他成员的使用率也不会太高，所以今天，我试着解决这个问题。另外，我还在一些群里看到有人抱怨vue3不如vue2好用，主要是适应不了setup写法，希望这篇博客能改变你的看法。

## 怎么用hook改造我的组件

关于hook是什么之类的介绍，我这就不赘述了，请看这篇文章浅谈：为啥vue和react都选择了Hooks🏂？<sup data-darkreader-inline-color="">[1]</sup>。前言中说到重复造轮子的组件，除开一些毫无必要的重复以外，有一些功能组件确实需要封装一下，比如说，一些需要请求后端字典到前端展示的下来选择框，点击之后要展示loading状态的按钮，带有查询条件的表单，这些非常常用的业务场景，我们就可以封装成组件，但是封装成组件就会遇到前面说的问题，每个人的使用习惯和封装习惯不一样，很难让每个人都满意，这种场景，就可以让hook来解决。

#### 普通实现

就拿字典选择下拉框来说，如果不做封装，我们是这样写的 （这里拿ant-design-vue组件库来做示例）

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">name</span>=<span data-darkreader-inline-color="">"DDemo"</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;onMounted,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span>;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;&nbsp;&nbsp;模拟调用接口</span><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">getRemoteData</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;any[]&gt;<span>(<span>(resolve</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve([<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'苹果'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'香蕉'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'橘子'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">3000</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;optionsArr&nbsp;=&nbsp;ref&lt;any[]&gt;([]);<br><br>&nbsp;&nbsp;onMounted(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;getRemoteData().then(<span>(<span>data</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsArr.value&nbsp;=&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;});<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">a-select</span>&nbsp;<span data-darkreader-inline-color="">:options</span>=<span data-darkreader-inline-color="">"optionsArr"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">style</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"less"</span>&nbsp;<span data-darkreader-inline-color="">scoped</span>&gt;</span><span>&lt;/<span data-darkreader-inline-color="">style</span>&gt;</span><br></code>
```

看起来很简单是吧，忽略我们模拟调用接口的代码，我们用在ts/js部分的代码才只有6行而已，看起来根本不需要什么封装。

但是这只是一个`最简单`的逻辑，不考虑接口请求超时和错误的情况，甚至都没考虑下拉框的`loading`表现。如果我们把所有的`意外情况`都考虑到的话，代码就会变得很臃肿了。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">name</span>=<span data-darkreader-inline-color="">"DDemo"</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;onMounted,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span>;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;&nbsp;&nbsp;模拟调用接口</span><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">getRemoteData</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;any[]&gt;<span>(<span>(resolve,&nbsp;reject</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;模拟接口调用有概率出错</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">Math</span>.random()&nbsp;&gt;&nbsp;<span data-darkreader-inline-color="">0.5</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve([<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'苹果'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'香蕉'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'橘子'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Error</span>(<span data-darkreader-inline-color="">'不小心出错了！'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">3000</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;optLoading&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">false</span>);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;optionsArr&nbsp;=&nbsp;ref&lt;any[]&gt;([]);<br><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">initSelect</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;optLoading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;getRemoteData()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span>(<span>data</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsArr.value&nbsp;=&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.catch(<span>(<span>e</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求出线错误时将错误信息显示到select中，给用户一个友好的提示</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsArr.value&nbsp;=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">-1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">-1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">label</span>:&nbsp;e.message,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">disabled</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.finally(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optLoading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;onMounted(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;initSelect();<br>&nbsp;&nbsp;});<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">a-select</span>&nbsp;<span data-darkreader-inline-color="">:loading</span>=<span data-darkreader-inline-color="">"optLoading"</span>&nbsp;<span data-darkreader-inline-color="">:options</span>=<span data-darkreader-inline-color="">"optionsArr"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

这一次，代码直接来到了`22`行，虽说用户体验确实好了不少，但是这也忒费事了，而且这还只是一个下拉框，页面里有好几个下拉框也是很常见的，如此这般，可能什么逻辑都没写，页面代码就要上百行了。

这个时候，就需要我们来封装一下了，我们有两种选择：

1.  把字典下拉框封装成一个`组件`；
    
2.  把请求、加载中、错误这些处理逻辑封装到`hook`里；
    

第一种大家都知道，就不多说了，直接说第二种

##### 封装下拉框hook

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;onMounted,&nbsp;reactive,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span>;<br><span data-darkreader-inline-color="">//&nbsp;定义下拉框接收的数据格式</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">interface</span>&nbsp;SelectOption&nbsp;{<br>&nbsp;&nbsp;value:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;label:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;disabled?:&nbsp;<span data-darkreader-inline-color="">boolean</span>;<br>&nbsp;&nbsp;key?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>}<br><span data-darkreader-inline-color="">//&nbsp;定义入参格式</span><br><span data-darkreader-inline-color="">interface</span>&nbsp;FetchSelectProps&nbsp;{<br>&nbsp;&nbsp;apiFun:&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;<span data-darkreader-inline-color="">any</span>[]&gt;;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useFetchSelect</span>(<span>props:&nbsp;FetchSelectProps</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;apiFun&nbsp;}&nbsp;=&nbsp;props;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;options&nbsp;=&nbsp;ref&lt;SelectOption[]&gt;([]);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;loading&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">false</span>);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/*&nbsp;调用接口请求数据&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;loadData&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;loading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;options.value&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;apiFun().then(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>(<span>data</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.value&nbsp;=&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>(<span>err</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;未知错误，可能是代码抛出的错误，或是网络错误</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.value&nbsp;=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span data-darkreader-inline-color="">'-1'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:&nbsp;err.message,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disabled:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;接着抛出错误</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;&nbsp;&nbsp;onMounted&nbsp;中调用接口</span><br>&nbsp;&nbsp;onMounted(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;loadData();<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;reactive({<br>&nbsp;&nbsp;&nbsp;&nbsp;options,<br>&nbsp;&nbsp;&nbsp;&nbsp;loading,<br>&nbsp;&nbsp;});<br>}<br></code>
```

然后在组件中调用

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">name</span>=<span data-darkreader-inline-color="">"DDemo"</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useFetchSelect&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./hook'</span>;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;&nbsp;&nbsp;模拟调用接口</span><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">getRemoteData</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;any[]&gt;<span>(<span>(resolve,&nbsp;reject</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;模拟接口调用有概率出错</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">Math</span>.random()&nbsp;&gt;&nbsp;<span data-darkreader-inline-color="">0.5</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve([<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'苹果'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'香蕉'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-color="">'橘子'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Error</span>(<span data-darkreader-inline-color="">'不小心出错了！'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">3000</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;将之前用的&nbsp;options,loading，和调用接口的逻辑都抽离到hook中</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;selectBind&nbsp;=&nbsp;useFetchSelect({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">apiFun</span>:&nbsp;getRemoteData,<br>&nbsp;&nbsp;});<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;将hook返回的接口，通过&nbsp;v-bind&nbsp;绑定给组件&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">a-select</span>&nbsp;<span data-darkreader-inline-color="">v-bind</span>=<span data-darkreader-inline-color="">"selectBind"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

这样一来，代码行数直接又从`20`行降到`3`行，甚至比刚开始最简单的那个还要少两行，但是功能却一点不少，用户体验也是比较完善的。

如果你觉着上面这个例子不能打动你的话，可以看看下面这个

##### Loading状态hook

点击按钮，调用接口是另一个我们经常遇到的场景，为了更好的用户体验，提示用户操作已经响应，同时防止用户多次点击，我们要在调用接口的同时将按钮置为`loading`状态，虽说只有一个loading状态，但是写多了也觉着麻烦。

为此我们可以封装一个非常简单的hook：

hook.ts

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Ref,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span>;<br><br><span data-darkreader-inline-color="">type</span>&nbsp;TApiFun&lt;TData,&nbsp;TParams&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">Array</span>&lt;<span data-darkreader-inline-color="">any</span>&gt;&gt;&nbsp;=&nbsp;<span>(<span>...params:&nbsp;TParams</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;TData&gt;;<br><br><span data-darkreader-inline-color="">interface</span>&nbsp;AutoRequestOptions&nbsp;{<br>&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;定义一下初始状态</span><br>&nbsp;&nbsp;loading?:&nbsp;<span data-darkreader-inline-color="">boolean</span>;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;接口调用成功时的回调</span><br>&nbsp;&nbsp;onSuccess?:&nbsp;<span>(<span>data:&nbsp;<span data-darkreader-inline-color="">any</span></span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">void</span>;<br>}<br><br><span data-darkreader-inline-color="">type</span>&nbsp;AutoRequestResult&lt;TData,&nbsp;TParams&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">Array</span>&lt;<span data-darkreader-inline-color="">any</span>&gt;&gt;&nbsp;=&nbsp;[Ref&lt;<span data-darkreader-inline-color="">boolean</span>&gt;,&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;];<br><br><span data-darkreader-inline-color="">/*&nbsp;控制loading状态的自动切换hook&nbsp;*/</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useAutoRequest</span>&lt;<span data-darkreader-inline-color="">TData</span>,&nbsp;<span data-darkreader-inline-color="">TParams</span>&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">any</span>[]&nbsp;=&nbsp;<span data-darkreader-inline-color="">any</span>[]&gt;(<span>fun:&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;,&nbsp;options?:&nbsp;AutoRequestOptions</span>):&nbsp;<span data-darkreader-inline-color="">AutoRequestResult</span>&lt;<span data-darkreader-inline-color="">TData</span>,&nbsp;<span data-darkreader-inline-color="">TParams</span>&gt;&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;loading&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>,&nbsp;onSuccess&nbsp;}&nbsp;=&nbsp;options&nbsp;||&nbsp;{&nbsp;loading:&nbsp;<span data-darkreader-inline-color="">false</span>&nbsp;};<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;requestLoading&nbsp;=&nbsp;ref(loading);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;run:&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;&nbsp;=&nbsp;<span>(<span>...params</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;requestLoading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;fun(...params)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span>(<span>res</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onSuccess&nbsp;&amp;&amp;&nbsp;onSuccess(res);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;res;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.finally(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestLoading.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;[requestLoading,&nbsp;run];<br>}<br></code>
```

这次把模拟接口的方法单独抽出一个文件

api/index.ts

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">submitApi</span>(<span>text:&nbsp;<span data-darkreader-inline-color="">string</span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span>(<span>resolve,&nbsp;reject</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;模拟接口调用有概率出错</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">Math</span>.random()&nbsp;&gt;&nbsp;<span data-darkreader-inline-color="">0.5</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status:&nbsp;<span data-darkreader-inline-color="">"ok"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text:&nbsp;text,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Error</span>(<span data-darkreader-inline-color="">"不小心出错了！"</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">3000</span>);<br>&nbsp;&nbsp;});<br>}<br></code>
```

使用：

index.vue

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&nbsp;name=<span data-darkreader-inline-color="">"Index"</span>&nbsp;lang=<span data-darkreader-inline-color="">"ts"</span>&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAutoRequest&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./hook"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Button&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"ant-design-vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;submitApi&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/api"</span>;<br><br><span data-darkreader-inline-color="">const</span>&nbsp;[loading,&nbsp;submit]&nbsp;=&nbsp;useAutoRequest(submitApi);<br><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">onSubmit</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;submit(<span data-darkreader-inline-color="">"aaa"</span>).then(<span>(<span>res</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">"res"</span>,&nbsp;res);<br>&nbsp;&nbsp;});<br>}<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="col"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;:loading="loading"&nbsp;@click="onSubmit"&gt;提交&lt;/</span>Button&gt;<br>&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br>&lt;/</span>template&gt;<br></code>
```

这样封装一下，我们使用时就不再需要手动切换`loading`的状态了。

这个hook还有另一种玩法：

hook2.ts

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;<span data-darkreader-inline-color="">type</span>&nbsp;{&nbsp;Ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><br><span data-darkreader-inline-color="">type</span>&nbsp;AutoLoadingResult&nbsp;=&nbsp;[<br>&nbsp;&nbsp;Ref&lt;<span data-darkreader-inline-color="">boolean</span>&gt;,<br>&nbsp;&nbsp;&lt;T&gt;<span>(<span>requestPromise:&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;T&gt;</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;T&gt;<br>];<br><br><span data-darkreader-inline-color="">/*&nbsp;在给run方法传入一个promise，会在promise执行前或执行后将loading状态设为true，在执行完成后设为false&nbsp;*/</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useAutoLoading</span>(<span>defaultLoading&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span></span>):&nbsp;<span data-darkreader-inline-color="">AutoLoadingResult</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;ld&nbsp;=&nbsp;ref(defaultLoading);<br><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">run</span>&lt;<span data-darkreader-inline-color="">T</span>&gt;(<span>requestPromise:&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;T&gt;</span>):&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;<span data-darkreader-inline-color="">T</span>&gt;&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;ld.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;requestPromise.finally(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ld.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;[ld,&nbsp;run];<br>}<br></code>
```

使用：

index.vue

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&nbsp;name=<span data-darkreader-inline-color="">"Index"</span>&nbsp;lang=<span data-darkreader-inline-color="">"ts"</span>&gt;<br><span data-darkreader-inline-color="">//&nbsp;import&nbsp;{&nbsp;useAutoRequest&nbsp;}&nbsp;from&nbsp;"./hook";</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAutoLoading&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./hook2"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Button&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"ant-design-vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;submitApi,&nbsp;cancelApi&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/api"</span>;<br><br><span data-darkreader-inline-color="">//&nbsp;const&nbsp;[loading,&nbsp;submit]&nbsp;=&nbsp;useAutoRequest(submitApi);</span><br><br><span data-darkreader-inline-color="">const</span>&nbsp;[commonLoading,&nbsp;fetch]&nbsp;=&nbsp;useAutoLoading();<br><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">onSubmit</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;fetch(submitApi(<span data-darkreader-inline-color="">"submit"</span>)).then(<span>(<span>res</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">"res"</span>,&nbsp;res);<br>&nbsp;&nbsp;});<br>}<br><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">onCancel</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;fetch(cancelApi(<span data-darkreader-inline-color="">"cancel"</span>)).then(<span>(<span>res</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">"res"</span>,&nbsp;res);<br>&nbsp;&nbsp;});<br>}<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="col"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;type="primary"&nbsp;:loading="commonLoading"&nbsp;@click="onSubmit"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;提交<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span>Button&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;:loading=<span data-darkreader-inline-color="">"commonLoading"</span>&nbsp;<span data-darkreader-inline-color="">@click</span>=<span data-darkreader-inline-color="">"onCancel"</span>&gt;取消&lt;<span data-darkreader-inline-color="">/Button&gt;<br>&nbsp;&nbsp;&lt;/</span>div&gt;<br>&lt;<span data-darkreader-inline-color="">/template&gt;<br></span></code>
```

这里也是用到了`promise`链式调用的特性，在接口调用之后马上将`loading`置为true，在接口调用完成后置为false。而`useAutoRequest`则是在接口调用之前就将`loading`置为true。

`useAutoRequest`调用时代码更简洁，`useAutoLoading`的使用则更灵活，可以同时服务给多个接口使用，比较适合`提交`、`取消`这种互斥的场景。

## 解放组件

如果你翻看过我的这篇博客一个省心省力的骨架屏实现方案<sup data-darkreader-inline-color="">[2]</sup>，那么肯定知道在骨架屏组件中，我是用了传入的`res`对象的`code`属性来判断当前显示的视图状态。长话短说就是， `res`是接口返回给前端的数据，如

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"code"</span>:<span data-darkreader-inline-color="">0</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"msg"</span>:'查询成功',<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"data"</span>:{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"username"</span>:<span data-darkreader-inline-color="">"小王"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"age"</span>:<span data-darkreader-inline-color="">20</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code>
```

我们假定当`code`为`0`时代表成功，`不为0`表示失败，为`-100`时表示正在加载，当然接口并不会也不需要返回`-100`，`-100`是我们本地捏造出来的，只是为了让骨架屏组件显示对应的加载状态。在页面中使用时，我们需要先声明一个`code`为`-100`的`res`对象绑定给骨架屏组件，然后在`onMounted`中调用查询接口，调用成功后更新`res`对象。

如果像上面这样使用`res`对象来给骨架屏组件设置状态的话，就感觉非常的麻烦，有时候我们只是要设置一个初始时的加载状态，但是要搞好几行没用的代码，但是如果我们把`res`拆解成一个个参数单独传递的话，父组件需要维护的变量就会非常多了，这时我们就可以封装hook来解决这个问题，把拆解出来的参数都扔到hook里面保存。

上代码（这部分代码比较长，想要详细了解的话可以去看原文章）

#### 骨架屏组件

SkeletonView/index.vue

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&nbsp;lang=<span data-darkreader-inline-color="">"ts"</span>&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;defineProps,&nbsp;computed&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;LoadingOutlined&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@ant-design/icons-vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;isArray&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/utils/is"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Button&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"ant-design-vue"</span>;<br><br><span data-darkreader-inline-color="">/*&nbsp;status:'loading','error','success','empty'&nbsp;*/</span><br><span data-darkreader-inline-color="">type</span>&nbsp;ViewStatus&nbsp;=&nbsp;<span data-darkreader-inline-color="">"loading"</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">"error"</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">"success"</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">"empty"</span>;<br><br><span data-darkreader-inline-color="">interface</span>&nbsp;SkeletonProps&lt;T&nbsp;=&nbsp;any&gt;&nbsp;{<br>&nbsp;&nbsp;status:&nbsp;ViewStatus;<br>&nbsp;&nbsp;result:&nbsp;T;<br>&nbsp;&nbsp;placeholderResult:&nbsp;T;<br>&nbsp;&nbsp;emptyMsg?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;errorMsg?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;isEmpty?:&nbsp;<span>(<span>result:&nbsp;T</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">boolean</span>;<br>}<br><br><span data-darkreader-inline-color="">const</span>&nbsp;props&nbsp;=&nbsp;withDefaults(defineProps&lt;SkeletonProps&gt;(),&nbsp;{<br>&nbsp;&nbsp;status:&nbsp;<span data-darkreader-inline-color="">"loading"</span>,<br>&nbsp;&nbsp;emptyMsg:&nbsp;<span data-darkreader-inline-color="">"暂无数据"</span>,<br>&nbsp;&nbsp;errorMsg:&nbsp;<span data-darkreader-inline-color="">"未知错误"</span>,<br>});<br><br><span data-darkreader-inline-color="">const</span>&nbsp;emits&nbsp;=&nbsp;defineEmits([<span data-darkreader-inline-color="">"retry"</span>]);<br><br><span data-darkreader-inline-color="">const</span>&nbsp;retryClick&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;emits(<span data-darkreader-inline-color="">"retry"</span>);<br>};<br><br><span data-darkreader-inline-color="">const</span>&nbsp;viewStatus&nbsp;=&nbsp;computed(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;status&nbsp;=&nbsp;props.status;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(status&nbsp;===&nbsp;<span data-darkreader-inline-color="">"success"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;isEmp&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;result&nbsp;=&nbsp;props.result;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(props.isEmpty)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isEmp&nbsp;=&nbsp;props.isEmpty(props.result);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isArray(result))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isEmp&nbsp;=&nbsp;result.length&nbsp;===&nbsp;<span data-darkreader-inline-color="">0</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!result)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isEmp&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isEmp&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isEmp)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">"empty"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">"success"</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;status;<br>});<br><br><span data-darkreader-inline-color="">const</span>&nbsp;placeholderData&nbsp;=&nbsp;computed(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(props.result)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;props.result;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;props.placeholderResult;<br>});<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;v-if="viewStatus&nbsp;===&nbsp;'empty'"&nbsp;key="empty"&nbsp;class="empty_view&nbsp;flex-col"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;{{&nbsp;emptyMsg&nbsp;}}&lt;/</span>span&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"mt4&nbsp;max-w-160px"</span>&nbsp;<span data-darkreader-inline-color="">@click</span>=<span data-darkreader-inline-color="">"retryClick"</span>&gt;重试&lt;<span data-darkreader-inline-color="">/Button&gt;<br>&nbsp;&nbsp;&lt;/</span>div&gt;<br><br>&nbsp;&nbsp;&lt;div<br>&nbsp;&nbsp;&nbsp;&nbsp;key=<span data-darkreader-inline-color="">"error"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;v-<span data-darkreader-inline-color="">else</span>-<span data-darkreader-inline-color="">if</span>=<span data-darkreader-inline-color="">"viewStatus&nbsp;===&nbsp;'error'"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"empty_view&nbsp;flex-col"</span><br>&nbsp;&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;{{&nbsp;errorMsg&nbsp;}}&lt;<span data-darkreader-inline-color="">/span&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;Button&nbsp;class="mt4&nbsp;max-w-160px"&nbsp;@click="retryClick"&gt;重试&lt;/</span>Button&gt;<br>&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br><br>&nbsp;&nbsp;&lt;div<br>&nbsp;&nbsp;&nbsp;&nbsp;v-else<br>&nbsp;&nbsp;&nbsp;&nbsp;key="loadingOrContent"<br>&nbsp;&nbsp;&nbsp;&nbsp;:class="[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholderData&nbsp;&amp;&amp;&nbsp;viewStatus&nbsp;===&nbsp;'loading'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;'skeleton-view-empty-view'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;'skeleton-view-default-view',<br>&nbsp;&nbsp;&nbsp;&nbsp;]"<br>&nbsp;&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;div<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v-if="!placeholderData&nbsp;&amp;&amp;&nbsp;viewStatus&nbsp;===&nbsp;'loading'"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="loading-center"<br>&nbsp;&nbsp;&nbsp;&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LoadingOutlined&nbsp;style="font-size:&nbsp;40px;&nbsp;color:&nbsp;#2a6de5"&nbsp;/</span>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;slot<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v-else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:result="placeholderData"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:status="viewStatus"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:success="viewStatus&nbsp;===&nbsp;'success'"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:mask="viewStatus&nbsp;===&nbsp;'loading'&nbsp;?&nbsp;'skeleton-mask'&nbsp;:&nbsp;''"<br>&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;/</span>slot&gt;<br>&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br>&lt;/</span>template&gt;<br><br>&lt;style&gt;<br>.clam-box&nbsp;{<br>&nbsp;&nbsp;width:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;height:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>}<br>.empty_view&nbsp;{<br>&nbsp;&nbsp;padding-top:&nbsp;<span data-darkreader-inline-color="">50</span>px;<br>&nbsp;&nbsp;padding-bottom:&nbsp;<span data-darkreader-inline-color="">50</span>px;<br>&nbsp;&nbsp;align-items:&nbsp;center;<br>}<br>.empty_img&nbsp;{<br>&nbsp;&nbsp;width:&nbsp;<span data-darkreader-inline-color="">310</span>px;<br>&nbsp;&nbsp;height:&nbsp;<span data-darkreader-inline-color="">218</span>px;<br>}<br>.trip_text&nbsp;{<br>&nbsp;&nbsp;font-size:&nbsp;<span data-darkreader-inline-color="">20</span>px;<br>&nbsp;&nbsp;color:&nbsp;#<span data-darkreader-inline-color="">999999</span>;<br>}<br><br>.mt4&nbsp;{<br>&nbsp;&nbsp;margin-top:&nbsp;<span data-darkreader-inline-color="">4</span>px;<br>}<br><br>.flex-col&nbsp;{<br>&nbsp;&nbsp;display:&nbsp;flex;<br>&nbsp;&nbsp;flex-direction:&nbsp;column;<br>}<br><br>.loading-center&nbsp;{<br>&nbsp;&nbsp;padding:&nbsp;<span data-darkreader-inline-color="">20</span>px;<br>&nbsp;&nbsp;display:&nbsp;flex;<br>&nbsp;&nbsp;justify-content:&nbsp;center;<br>&nbsp;&nbsp;align-items:&nbsp;center;<br>}<br><br>.skeleton-view-<span data-darkreader-inline-color="">default</span>-view&nbsp;span,<br>.skeleton-view-<span data-darkreader-inline-color="">default</span>-view&nbsp;a,<br>.skeleton-view-<span data-darkreader-inline-color="">default</span>-view&nbsp;img,<br>.skeleton-view-<span data-darkreader-inline-color="">default</span>-view&nbsp;td,<br>.skeleton-view-<span data-darkreader-inline-color="">default</span>-view&nbsp;button&nbsp;{<br>&nbsp;&nbsp;transition-duration:&nbsp;<span data-darkreader-inline-color="">0.7</span>s;<br>&nbsp;&nbsp;transition-timing-<span><span data-darkreader-inline-color="">function</span>:&nbsp;<span data-darkreader-inline-color="">ease</span></span>;<br>&nbsp;&nbsp;transition-property:&nbsp;background,&nbsp;width;<br>}<br><br>.skeleton-view-empty-view&nbsp;{<br>&nbsp;&nbsp;position:&nbsp;relative;<br>&nbsp;&nbsp;pointer-events:&nbsp;none;<br>}<br><br>.skeleton-view-empty-view::before&nbsp;{<br>&nbsp;&nbsp;content:&nbsp;<span data-darkreader-inline-color="">"&nbsp;"</span>;<br>&nbsp;&nbsp;position:&nbsp;absolute;<br>&nbsp;&nbsp;width:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;height:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;top:&nbsp;<span data-darkreader-inline-color="">0</span>;<br>&nbsp;&nbsp;left:&nbsp;<span data-darkreader-inline-color="">0</span>;<br>&nbsp;&nbsp;background:&nbsp;linear-gradient(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">110</span>deg,<br>&nbsp;&nbsp;&nbsp;&nbsp;rgba(<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">0.1</span>)&nbsp;<span data-darkreader-inline-color="">40</span>%,<br>&nbsp;&nbsp;&nbsp;&nbsp;rgba(<span data-darkreader-inline-color="">180</span>,&nbsp;<span data-darkreader-inline-color="">199</span>,&nbsp;<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">0.3</span>)&nbsp;<span data-darkreader-inline-color="">50</span>%,<br>&nbsp;&nbsp;&nbsp;&nbsp;rgba(<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">255</span>,&nbsp;<span data-darkreader-inline-color="">0.1</span>)&nbsp;<span data-darkreader-inline-color="">60</span>%<br>&nbsp;&nbsp;);<br>&nbsp;&nbsp;background-size:&nbsp;<span data-darkreader-inline-color="">200</span>%&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;background-position-x:&nbsp;<span data-darkreader-inline-color="">180</span>%;<br>&nbsp;&nbsp;animation:&nbsp;loading&nbsp;<span data-darkreader-inline-color="">1</span>s&nbsp;ease-<span data-darkreader-inline-color="">in</span>-out&nbsp;infinite;<br>&nbsp;&nbsp;z-index:&nbsp;<span data-darkreader-inline-color="">1</span>;<br>}<br><br><span data-darkreader-inline-color="">@keyframes</span>&nbsp;loading&nbsp;{<br>&nbsp;&nbsp;to&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;background-position-x:&nbsp;<span data-darkreader-inline-color="">-20</span>%;<br>&nbsp;&nbsp;}<br>}<br><br>.skeleton-view-empty-view&nbsp;.skeleton-mask&nbsp;{<br>&nbsp;&nbsp;position:&nbsp;relative;<br>}<br>.skeleton-view-empty-view&nbsp;.skeleton-mask::before&nbsp;{<br>&nbsp;&nbsp;content:&nbsp;<span data-darkreader-inline-color="">"&nbsp;"</span>;<br>&nbsp;&nbsp;background-color:&nbsp;#f5f5f5;<br>&nbsp;&nbsp;position:&nbsp;absolute;<br>&nbsp;&nbsp;width:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;height:&nbsp;<span data-darkreader-inline-color="">100</span>%;<br>&nbsp;&nbsp;border:&nbsp;<span data-darkreader-inline-color="">1</span>px&nbsp;solid&nbsp;#f5f5f5;<br>&nbsp;&nbsp;top:&nbsp;<span data-darkreader-inline-color="">-1</span>px;<br>&nbsp;&nbsp;left:&nbsp;<span data-darkreader-inline-color="">-1</span>px;<br>&nbsp;&nbsp;z-index:&nbsp;<span data-darkreader-inline-color="">1</span>;<br>}<br><br>.skeleton-view-empty-view&nbsp;button,<br>.skeleton-view-empty-view&nbsp;span,<br>.skeleton-view-empty-view&nbsp;input,<br>.skeleton-view-empty-view&nbsp;td,<br>.skeleton-view-empty-view&nbsp;a&nbsp;{<br>&nbsp;&nbsp;color:&nbsp;rgba(<span data-darkreader-inline-color="">0</span>,&nbsp;<span data-darkreader-inline-color="">0</span>,&nbsp;<span data-darkreader-inline-color="">0</span>,&nbsp;<span data-darkreader-inline-color="">0</span>)&nbsp;!important;<br>&nbsp;&nbsp;border:&nbsp;none;<br>&nbsp;&nbsp;background:&nbsp;#f5f5f5&nbsp;!important;<br>}<br><span data-darkreader-inline-color="">/*&nbsp;[src=""],img:not([src])*/</span><br>.skeleton-view-empty-view&nbsp;img&nbsp;{<br>&nbsp;&nbsp;content:&nbsp;url(./no_url.png);<br>&nbsp;&nbsp;border-radius:&nbsp;<span data-darkreader-inline-color="">2</span>px;<br>&nbsp;&nbsp;background:&nbsp;#f5f5f5&nbsp;!important;<br>}<br>&lt;<span data-darkreader-inline-color="">/style&gt;<br></span></code>
```

这里样式中用到的`no_url.png`只是一张空白透明图片，防止加载时图片显示裂图。

hook代码 useAutoSkeletonView.ts

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;computed,&nbsp;onMounted,&nbsp;reactive,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;<span data-darkreader-inline-color="">type</span>&nbsp;{&nbsp;UnwrapRef&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><br><span data-darkreader-inline-color="">type</span>&nbsp;TApiFun&lt;TData,&nbsp;TParams&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">Array</span>&lt;<span data-darkreader-inline-color="">any</span>&gt;&gt;&nbsp;=&nbsp;(<br>&nbsp;&nbsp;...params:&nbsp;TParams<br>)&nbsp;=&gt;&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;TData&gt;;<br><br><span data-darkreader-inline-color="">/*&nbsp;定义可自定义的默认状态&nbsp;*/</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">type</span>&nbsp;SkeletonStatus&nbsp;=&nbsp;<span data-darkreader-inline-color="">"loading"</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">"success"</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">interface</span>&nbsp;IUseAutoSkeletonViewProps&lt;TData,&nbsp;TParams&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;any[]&gt;&nbsp;{<br>&nbsp;&nbsp;apiFun:&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;;<span data-darkreader-inline-color="">//&nbsp;调用接口api</span><br>&nbsp;&nbsp;placeholderResult?:&nbsp;TData;&nbsp;<span data-darkreader-inline-color="">//&nbsp;骨架屏用到的占位数据</span><br>&nbsp;&nbsp;queryInMount?:&nbsp;<span data-darkreader-inline-color="">boolean</span>;&nbsp;<span data-darkreader-inline-color="">//&nbsp;在父组件挂载时自动调用接口，默认true</span><br>&nbsp;&nbsp;initQueryParams?:&nbsp;TParams;&nbsp;<span data-darkreader-inline-color="">//&nbsp;调用接口用到的参数</span><br>&nbsp;&nbsp;transformDataFun?:&nbsp;<span>(<span>data:&nbsp;TData</span>)&nbsp;=&gt;</span>&nbsp;TData;&nbsp;<span data-darkreader-inline-color="">//&nbsp;接口请求完成后，转换数据</span><br>&nbsp;&nbsp;updateParamsOnFetch?:&nbsp;<span data-darkreader-inline-color="">boolean</span>;&nbsp;<span data-darkreader-inline-color="">//&nbsp;手动调用接口后，更新请求参数</span><br>&nbsp;&nbsp;defaultStatus?:&nbsp;SkeletonStatus;&nbsp;<span data-darkreader-inline-color="">//&nbsp;默认骨架屏组件状态</span><br>&nbsp;&nbsp;onSuccess?:&nbsp;<span>(<span>data:&nbsp;<span data-darkreader-inline-color="">any</span></span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">void</span>;&nbsp;<span data-darkreader-inline-color="">//&nbsp;接口调用成功的回调</span><br>&nbsp;&nbsp;isEmpty?:&nbsp;<span>(<span>data:&nbsp;TData</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">boolean</span>;&nbsp;<span data-darkreader-inline-color="">//&nbsp;重写骨架屏判空逻辑</span><br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">type</span>&nbsp;IAutoSkeletonViewResult&lt;TData,&nbsp;TParams&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">any</span>[]&gt;&nbsp;=&nbsp;UnwrapRef&lt;{<br>&nbsp;&nbsp;execute:&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;;<br>&nbsp;&nbsp;result:&nbsp;TData&nbsp;|&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;retry:&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;TData&gt;;<br>&nbsp;&nbsp;loading:&nbsp;<span data-darkreader-inline-color="">boolean</span>;<br>&nbsp;&nbsp;status:&nbsp;SkeletonStatus&nbsp;|&nbsp;<span data-darkreader-inline-color="">"error"</span>;<br>&nbsp;&nbsp;getField:&nbsp;<span>(<span>key:&nbsp;<span data-darkreader-inline-color="">string</span></span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">any</span>;<br>&nbsp;&nbsp;bindProps:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;result:&nbsp;TData&nbsp;|&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;status:&nbsp;SkeletonStatus&nbsp;|&nbsp;<span data-darkreader-inline-color="">"error"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;errorMsg:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;placeholderResult?:&nbsp;TData;<br>&nbsp;&nbsp;&nbsp;&nbsp;isEmpty?:&nbsp;<span>(<span>data:&nbsp;TData</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">boolean</span>;<br>&nbsp;&nbsp;};<br>&nbsp;&nbsp;bindEvents:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;retry:&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;TData&gt;;<br>&nbsp;&nbsp;};<br>}&gt;;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useAutoSkeletonView</span>&lt;<span data-darkreader-inline-color="">TData</span>&nbsp;=&nbsp;<span data-darkreader-inline-color="">any</span>,&nbsp;<span data-darkreader-inline-color="">TParams</span>&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">any</span>[]&nbsp;=&nbsp;<span data-darkreader-inline-color="">any</span>[]&gt;(<span><br>&nbsp;&nbsp;prop:&nbsp;IUseAutoSkeletonViewProps&lt;TData,&nbsp;TParams&gt;<br></span>):&nbsp;<span data-darkreader-inline-color="">IAutoSkeletonViewResult</span>&lt;<span data-darkreader-inline-color="">TData</span>,&nbsp;<span data-darkreader-inline-color="">TParams</span>&gt;&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;apiFun,<br>&nbsp;&nbsp;&nbsp;&nbsp;defaultStatus&nbsp;=&nbsp;<span data-darkreader-inline-color="">"loading"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;placeholderResult,<br>&nbsp;&nbsp;&nbsp;&nbsp;isEmpty,<br>&nbsp;&nbsp;&nbsp;&nbsp;initQueryParams&nbsp;=&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;transformDataFun,<br>&nbsp;&nbsp;&nbsp;&nbsp;onSuccess,<br>&nbsp;&nbsp;&nbsp;&nbsp;updateParamsOnFetch&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;queryInMount&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;}&nbsp;=&nbsp;prop;<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;status&nbsp;=&nbsp;ref&lt;SkeletonStatus&nbsp;|&nbsp;<span data-darkreader-inline-color="">"error"</span>&gt;(defaultStatus);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;result&nbsp;=&nbsp;ref&lt;TData&nbsp;|&nbsp;<span data-darkreader-inline-color="">null</span>&gt;(<span data-darkreader-inline-color="">null</span>);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;placeholder&nbsp;=&nbsp;ref&lt;TData&nbsp;|&nbsp;<span data-darkreader-inline-color="">undefined</span>&gt;(placeholderResult);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;errorMsg&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">""</span>);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;lastFetchParams&nbsp;=&nbsp;ref&lt;TParams&gt;(initQueryParams&nbsp;<span data-darkreader-inline-color="">as</span>&nbsp;TParams);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;executeApiFun:&nbsp;TApiFun&lt;TData,&nbsp;TParams&gt;&nbsp;=&nbsp;<span>(<span>...params:&nbsp;TParams</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(updateParamsOnFetch)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastFetchParams.value&nbsp;=&nbsp;params;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;status.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">"loading"</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;apiFun(...params)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span>(<span>res</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;data:&nbsp;<span data-darkreader-inline-color="">any</span>&nbsp;=&nbsp;res;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(transformDataFun)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;transformDataFun(res);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholder.value&nbsp;=&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.value&nbsp;=&nbsp;data;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">"success"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onSuccess&nbsp;&amp;&amp;&nbsp;onSuccess(data);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;res;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.catch(<span>(<span>e</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.error(<span data-darkreader-inline-color="">"--useAutoSkeletonView--"</span>,&nbsp;e);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status.value&nbsp;=&nbsp;<span data-darkreader-inline-color="">"error"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errorMsg.value&nbsp;=&nbsp;e.message;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">throw</span>&nbsp;e;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">retry</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;executeApiFun(...(lastFetchParams.value&nbsp;<span data-darkreader-inline-color="">as</span>&nbsp;TParams));<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;onMounted(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(queryInMount&nbsp;&amp;&amp;&nbsp;defaultStatus&nbsp;===&nbsp;<span data-darkreader-inline-color="">"loading"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executeApiFun(...(initQueryParams&nbsp;<span data-darkreader-inline-color="">as</span>&nbsp;TParams));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;loading&nbsp;=&nbsp;computed(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;status.value&nbsp;===&nbsp;<span data-darkreader-inline-color="">"loading"</span>;<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">getField</span>(<span>key:&nbsp;<span data-darkreader-inline-color="">string</span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(status.value&nbsp;!==&nbsp;<span data-darkreader-inline-color="">"success"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(result.value)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;@ts-ignore</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;result.value[key];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;reactive({<br>&nbsp;&nbsp;&nbsp;&nbsp;execute:&nbsp;executeApiFun,<br>&nbsp;&nbsp;&nbsp;&nbsp;result:&nbsp;result,<br>&nbsp;&nbsp;&nbsp;&nbsp;retry,<br>&nbsp;&nbsp;&nbsp;&nbsp;loading,<br>&nbsp;&nbsp;&nbsp;&nbsp;status,<br>&nbsp;&nbsp;&nbsp;&nbsp;getField,<br>&nbsp;&nbsp;&nbsp;&nbsp;bindProps:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result:&nbsp;result,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errorMsg,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholderResult:&nbsp;placeholder,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isEmpty,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;bindEvents:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retry:&nbsp;retry,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;});<br>}<br></code>
```

使用 index.vue

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&nbsp;name=<span data-darkreader-inline-color="">"SkeletonView"</span>&nbsp;lang=<span data-darkreader-inline-color="">"ts"</span>&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;SkeletonView&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/components/SkeletonView/index.vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAutoSkeletonView&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./useAutoSkeletonView"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;listApi&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/api"</span>;<br><br><span data-darkreader-inline-color="">const</span>&nbsp;view&nbsp;=&nbsp;useAutoSkeletonView({<br>&nbsp;&nbsp;apiFun:&nbsp;listApi,<br>});<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="col"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;SkeletonView<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v-slot="{&nbsp;result&nbsp;}"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v-bind="view.bindProps"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v-on="view.bindEvents"<br>&nbsp;&nbsp;&nbsp;&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;{{&nbsp;result&nbsp;}}&lt;/</span>span&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/SkeletonView&gt;<br>&nbsp;&nbsp;&lt;/</span>div&gt;<br>&lt;<span data-darkreader-inline-color="">/template&gt;<br></span></code>
```

这里的`SkeletonView`不光用`v-bind`绑定了`hook`抛出的属性，还用`v-on`绑定的事件，目的就是监听请求报错时出现的“重试”按钮的点击事件。

## 使用优化

经常写`react`的朋友可能早就看出来了，这不是跟react中的一部分hook用法如出一辙吗？没错，很多人写react就这么写，而且react中绑定hook跟组件更简单，只需要...就可以了，比如：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">function Demo(){<br>    const select = useSelect({<br>        apiFun:getDict<br>    })<br>    // 这里可以直接用...将useSelect返回的属性与方法全部绑定给Select组件<br>    return &lt;Select {...select}&gt;;<br>}<br></code>
```

比起`vue`的`v-bind`和`v-on`算是简便了不少。那么，有没有一种办法也能做到差不多的效果呢？就比如能做到`v-xxx="select"`。

博主首先想到的就是vue的自定义指令了，文档在这里<sup data-darkreader-inline-color="">[3]</sup>，但是折腾了半天发现行不通，因为自定义指令主要还是针对dom来的。vue官网原话：

> 总的来说，**不**推荐在组件上使用自定义指令。

那么就只能考虑打包插件了，只要我们在`vue`解析`template`之前把`v-xxx="select"`翻译成`v-bind="select.bindProps" v-on="select.bindEvents"` 就好了，听起来并不难，只要我们开发的时候规定绑定组件的hook返回格式必须有`bindProps`和`bindEvents`就好了。

思路有了，直接开干，现在`vue`官网的默认创建方式也改成vite，我们就直接写vite的插件（不想看可以跳到最后用现成的）：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;component-enhance-hook</span><br><span data-darkreader-inline-color="">import</span>&nbsp;<span data-darkreader-inline-color="">type</span>&nbsp;{&nbsp;PluginOption&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vite"</span>;<br><br><span data-darkreader-inline-color="">//&nbsp;可以自定义hook绑定的前缀、绑定的属性值合集对应的键和事件合集对应的键</span><br><span data-darkreader-inline-color="">type</span>&nbsp;HookBindPluginOptions&nbsp;=&nbsp;{<br>&nbsp;&nbsp;prefix?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;bindKey?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>&nbsp;&nbsp;eventKey?:&nbsp;<span data-darkreader-inline-color="">string</span>;<br>};<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;viteHookBind&nbsp;=&nbsp;(options?:&nbsp;HookBindPluginOptions):&nbsp;<span><span>PluginOption</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;prefix,&nbsp;bindKey,&nbsp;eventKey&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">Object</span>.assign(<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix:&nbsp;<span data-darkreader-inline-color="">"v-ehb"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bindKey:&nbsp;<span data-darkreader-inline-color="">"bindProps"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventKey:&nbsp;<span data-darkreader-inline-color="">"bindEvents"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;options<br>&nbsp;&nbsp;);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">"vite-plugin-vue-component-enhance-hook-bind"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;enforce:&nbsp;<span data-darkreader-inline-color="">"pre"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;transform:&nbsp;<span>(<span>code,&nbsp;id</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;last&nbsp;=&nbsp;id.substring(id.length&nbsp;-&nbsp;<span data-darkreader-inline-color="">4</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(last&nbsp;===&nbsp;<span data-darkreader-inline-color="">".vue"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理之前先判断一下</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(code.indexOf(prefix)&nbsp;===&nbsp;<span data-darkreader-inline-color="">-1</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;code;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;获取&nbsp;template&nbsp;开头</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;templateStrStart&nbsp;=&nbsp;code.indexOf(<span data-darkreader-inline-color="">"&lt;template&gt;"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;获取&nbsp;template&nbsp;结尾</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;templateStrEnd&nbsp;=&nbsp;code.lastIndexOf(<span data-darkreader-inline-color="">"&lt;/template&gt;"</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;templateStr&nbsp;=&nbsp;code.substring(templateStrStart,&nbsp;templateStrEnd&nbsp;+&nbsp;<span data-darkreader-inline-color="">11</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;startIndex;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;循环转换&nbsp;template&nbsp;中的hook绑定指令</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">while</span>&nbsp;((startIndex&nbsp;=&nbsp;templateStr.indexOf(prefix))&nbsp;&gt;&nbsp;<span data-darkreader-inline-color="">-1</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;endIndex&nbsp;=&nbsp;templateStr.indexOf(<span data-darkreader-inline-color="">`"`</span>,&nbsp;startIndex&nbsp;+&nbsp;<span data-darkreader-inline-color="">7</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;str&nbsp;=&nbsp;templateStr.substring(startIndex,&nbsp;endIndex&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;obj&nbsp;=&nbsp;str.split(<span data-darkreader-inline-color="">`"`</span>)[<span data-darkreader-inline-color="">1</span>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;newStr&nbsp;=&nbsp;templateStr.replace(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">`v-bind="<span data-darkreader-inline-color="">${obj}</span>.<span data-darkreader-inline-color="">${bindKey}</span>"&nbsp;v-on="<span data-darkreader-inline-color="">${obj}</span>.<span data-darkreader-inline-color="">${eventKey}</span>"`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateStr&nbsp;=&nbsp;newStr;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;拼接并返回</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code.substring(<span data-darkreader-inline-color="">0</span>,&nbsp;templateStrStart)&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateStr&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code.substring(templateStrEnd&nbsp;+&nbsp;<span data-darkreader-inline-color="">11</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;code;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;};<br>};<br></code>
```

应用插件

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;fileURLToPath,&nbsp;URL&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"node:url"</span>;<br><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;defineConfig&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vite"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;vue&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@vitejs/plugin-vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;vueJsx&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@vitejs/plugin-vue-jsx"</span>;<br><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;viteHookBind&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./vBindPlugin"</span>;<br><br><span data-darkreader-inline-color="">//&nbsp;https://vitejs.dev/config/</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;defineConfig({<br>&nbsp;&nbsp;plugins:&nbsp;[vue(),&nbsp;vueJsx(),&nbsp;viteHookBind()],<br>&nbsp;&nbsp;resolve:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;alias:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"@"</span>:&nbsp;fileURLToPath(<span data-darkreader-inline-color="">new</span>&nbsp;URL(<span data-darkreader-inline-color="">"./src"</span>,&nbsp;<span data-darkreader-inline-color="">import</span>.meta.url)),<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;},<br>});<br></code>
```

修改一下vue中的用法

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&nbsp;name=<span data-darkreader-inline-color="">"SkeletonView"</span>&nbsp;lang=<span data-darkreader-inline-color="">"ts"</span>&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;SkeletonView&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/components/SkeletonView/index.vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAutoSkeletonView&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./useAutoSkeletonView"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;listApi&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"@/api"</span>;<br><br><span data-darkreader-inline-color="">const</span>&nbsp;view&nbsp;=&nbsp;useAutoSkeletonView({<br>&nbsp;&nbsp;queryInMount:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;apiFun:&nbsp;listApi,<br>&nbsp;&nbsp;placeholderResult:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">"苹果"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">"香蕉"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span data-darkreader-inline-color="">2</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">"橘子"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span data-darkreader-inline-color="">3</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;],<br>});<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="col"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;SkeletonView&nbsp;v-slot="{&nbsp;result&nbsp;}"&nbsp;v-ehb="view"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;{{&nbsp;result&nbsp;}}&lt;/</span>span&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/SkeletonView&gt;<br>&nbsp;&nbsp;&lt;/</span>div&gt;<br>&lt;<span data-darkreader-inline-color="">/template&gt;<br></span></code>
```

OK! 完成了！

### 使用npm安装

不过我也提前打包编译好了发布在了npm上，需要的话可以直接使用这个

`npm i vite-plugin-vue-hook-enhance -D`

改一下引入方式就可以了

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;viteHookBind&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vite-plugin-vue-hook-enhance"</span>;<br></code>
```

### 参考资料

\[1\]

https://juejin.cn/post/7066951709678895141: https://juejin.cn/post/7066951709678895141

\[2\]

https://juejin.cn/post/6945748911147450405: https://juejin.cn/post/6945748911147450405

\[3\]

https://cn.vuejs.org/guide/reusability/custom-directives.html: https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Freusability%2Fcustom-directives.html

Node 社群  

```
<section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-tools="135编辑器" data-id="89226"><section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section><section mpa-from-tpl="t" data-style="margin-left: 10px; outline: 0px; border-top: 4px solid rgb(68, 68, 68); display: inline-block; width: 50px;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section></section><p data-style="outline: 0px; color: rgb(34, 34, 34); letter-spacing: 0.544px; white-space: normal; font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;" data-darkmode-color="rgb(196, 196, 196)" data-darkmode-original-color="rgb(34, 34, 34)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-style="outline: 0px; color: rgb(63, 63, 63); font-variant-ligatures: common-ligatures; letter-spacing: 0.544px; text-align: left; font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51);" data-darkmode-color="rgb(167, 167, 167)" data-darkmode-original-color="rgb(63, 63, 63)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color="">我组建了一个氛围特别好的 Node.js 社群，里面有很多 Node.js小伙伴，如果你对Node.js学习感兴趣的话（后续有计划也可以），我们可以一起进行Node.js相关的交流、学习、共建。下方加 考拉 好友回复「Node」即可。</span></p><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><img data-cropselx1="0" data-cropselx2="147" data-cropsely1="0" data-cropsely2="178" data-fileid="100016913" data-galleryid="" data-ratio="1.29073482428115" data-s="300,640" data-type="jpeg" data-w="626" data-src="https://mmbiz.qpic.cn/mmbiz_png/YBFV3Da0NwtUt8z7MwaX6yicG6weUJYZ4kDUq34gs35gHuAVHnxrwxSQgclB6MXAyUIogJvUrFgZA7CuuFjNeLA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-original-style="outline: 0px;border-style: none;background-color: rgb(36, 36, 36);color: rgb(18, 18, 18);font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;display: initial;visibility: visible !important;width: 236.945px !important;" data-index="2" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="236.945px" data-darkreader-inline-outline="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="" crossorigin="anonymous" alt="Image"></p><pre data-style="margin-bottom: 1rem; outline: 0px; color: rgb(0, 0, 0); font-size: 16px; letter-spacing: 0.544px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; overflow: auto; font-weight: 700; background-color: rgb(255, 255, 255); text-align: center;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><span data-darkmode-color="rgb(255, 255, 255)" data-darkmode-original-color="rgb(255, 255, 255)" data-darkmode-bgcolor="rgb(19, 92, 224)" data-darkmode-original-bgcolor="rgb(19, 92, 224)" data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;&nbsp;</span><span data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><span data-darkmode-color="rgb(255, 255, 255)" data-darkmode-original-color="rgb(255, 255, 255)" data-darkmode-bgcolor="rgb(19, 92, 224)" data-darkmode-original-bgcolor="rgb(19, 92, 224)" data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;“分享、点赞</span><span data-darkmode-color="rgb(255, 255, 255)" data-darkmode-original-color="rgb(255, 255, 255)" data-darkmode-bgcolor="rgb(19, 92, 224)" data-darkmode-original-bgcolor="rgb(19, 92, 224)" data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">、</span><span data-darkmode-color="rgb(255, 255, 255)" data-darkmode-original-color="rgb(255, 255, 255)" data-darkmode-bgcolor="rgb(19, 92, 224)" data-darkmode-original-bgcolor="rgb(19, 92, 224)" data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">在看” 支持一下</span></span></p></pre>
```