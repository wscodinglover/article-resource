```
<section><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="0" data-is_biz_ban="0" data-origin_num="50" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><p data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(136, 136, 136)" data-darkmode-original-color="rgb(136, 136, 136)" data-darkmode-bgcolor-16021670869911="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16021670869911="rgb(255, 255, 255)" data-darkmode-color-16021670869911="rgb(136, 136, 136)" data-darkmode-original-color-16021670869911="rgb(136, 136, 136)" data-darkmode-bgcolor-16030289161394="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030289161394="rgb(255, 255, 255)" data-darkmode-color-16030289161394="rgb(136, 136, 136)" data-darkmode-original-color-16030289161394="rgb(136, 136, 136)" data-darkmode-bgcolor-16030315732716="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030315732716="rgb(255, 255, 255)" data-darkmode-color-16030315732716="rgb(136, 136, 136)" data-darkmode-original-color-16030315732716="rgb(136, 136, 136)" data-darkreader-inline-outline="" data-darkreader-inline-color="">点击上方&nbsp;</span><span data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(136, 136, 136)" data-darkmode-original-color="rgb(136, 136, 136)" data-darkmode-bgcolor-16021670869911="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16021670869911="rgb(255, 255, 255)" data-darkmode-color-16021670869911="rgb(136, 136, 136)" data-darkmode-original-color-16021670869911="rgb(136, 136, 136)" data-darkmode-bgcolor-16030289161394="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030289161394="rgb(255, 255, 255)" data-darkmode-color-16030289161394="rgb(136, 136, 136)" data-darkmode-original-color-16030289161394="rgb(136, 136, 136)" data-darkmode-bgcolor-16030315732716="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030315732716="rgb(255, 255, 255)" data-darkmode-color-16030315732716="rgb(136, 136, 136)" data-darkmode-original-color-16030315732716="rgb(136, 136, 136)" data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span></span><span data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(136, 136, 136)" data-darkmode-original-color="rgb(136, 136, 136)" data-darkmode-bgcolor-16021670869911="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16021670869911="rgb(255, 255, 255)" data-darkmode-color-16021670869911="rgb(136, 136, 136)" data-darkmode-original-color-16021670869911="rgb(136, 136, 136)" data-darkmode-bgcolor-16030289161394="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030289161394="rgb(255, 255, 255)" data-darkmode-color-16030289161394="rgb(136, 136, 136)" data-darkmode-original-color-16030289161394="rgb(136, 136, 136)" data-darkmode-bgcolor-16030315732716="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16030315732716="rgb(255, 255, 255)" data-darkmode-color-16030315732716="rgb(136, 136, 136)" data-darkmode-original-color-16030315732716="rgb(136, 136, 136)" data-darkreader-inline-outline="" data-darkreader-inline-color="">，关注公众号</span><span data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><p data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">回复</span><span data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">加群</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，加入技术交流群交流群</span></p>
```

**答案：**

-   react16 之前 stack架构，递归遍历组件树成本很高，会造成主线程被持续占⽤，结果就是主线程上的布局、动画等周期性任务就⽆法⽴即得到处理，造成视觉上的卡顿，影响⽤户体验。
    
-   Fiber架构把任务分解，避免主线程的持续占用造成卡顿问题。
    
-   增量渲染，把渲染任务拆分成多块。
    
-   更新时候能够暂停，终止，复用渲染任务。
    
-   给不同类型的更新赋予优先级。
    

**详细说明：**

-   使用 Fiber 节点, 来代替虚拟 DOM 原来的结构。
    

```
<span><span>// 链表结构</span></span>
```

-   通过 ReactDOM.render() 和 setState 把待更新的任务会先放入队列中, 然后通过 requestIdleCallback 请求浏览器调度。
    

```
<span><span>// 更新节点 放入数组中</span></span>
```

-   现在浏览器有空闲或者超时了就会调用 performWork 来执行任务：
    

```
<span><span>// performWork 会拿到一个Deadline，表示剩余时间</span></span>
```

-   这里的 nextUnitOfWork 下一个工作单元是 Fiber 结构，所以终止了之后也能恢复继续执行。
    

```
<span><span>// 保存当前的处理现场</span></span>
```

-   渲染阶段, 协调阶段完成后生成了 WorkInProgress Tree，在有修改的 Fiber 节点中都有一个标签，在 Renderer 阶段循环 WorkInProgress Tree 进行修改节点然后渲染到页面上。
    

```
<span><span>// 任务都执行完后 进入commit 修改真实Tree</span></span>
```

```
<section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(58, 58, 58); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: left; white-space: normal; letter-spacing: 2px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; widows: 1; word-spacing: 2px; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-darkreader-inline-outline="">欢迎关注「</span><span mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span><span mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-darkreader-inline-outline="">」</span></span></section><section data-style="margin-bottom: 0px; outline: 0px; background-color: rgb(255, 255, 255); font-size: 16px; text-align: left; white-space: normal; letter-spacing: 0.544px; color: rgb(102, 102, 102); font-family: Lato, &quot;Helvetica Neue&quot;, Helvetica, sans-serif; font-variant-ligatures: common-ligatures;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="2" data-is_biz_ban="0" has-insert-preloading="1" data-index="1" data-origin_num="50" data-isban="0" data-weui-theme="light" data-biz_account_status="0"></mp-common-profile></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(58, 58, 58); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: left; white-space: normal; letter-spacing: 2px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; widows: 1; word-spacing: 2px; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-darkreader-inline-outline="">号内回复</span></span></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(58, 58, 58); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: left; white-space: normal; letter-spacing: 0.544px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;"<span data-darkreader-inline-outline="">精选</span>" ，将为您推送 历史精选文章"<span data-darkreader-inline-outline="">react"</span>&nbsp;，将为您推送 React.js 相关的学习资料&nbsp;"<span data-darkreader-inline-outline="">学习指南</span>" ，将为您推送 React-Native学习指南&nbsp;"<span data-darkreader-inline-outline="">vue</span>" ，将为您推送vue.js 相关文章&nbsp;"<span data-darkreader-inline-outline="">小程序</span>" ，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">微信小商店</span>"，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">加群</span>" ，添加群主好友拉你进群</section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(58, 58, 58); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: left; white-space: normal; letter-spacing: 0.544px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">加我私人微信，拉你进 React进阶、面试交流群，互相监督学习进步等！</section><p data-style="margin-bottom: 0em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; white-space: normal; letter-spacing: 0.544px; font-variant-ligatures: common-ligatures; text-align: center;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><img data-galleryid="" data-ratio="1.261480787253983" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/e93fo6YQKNlJReqfJKqeft8SuT9o4DliaoUIJqmbtBw72F7nYumlpJ5dxIvLfbNv5W0Nf1ZtIltr9bFsL4qd6fg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="1067" data-darkreader-inline-outline="" data-original-style="outline: 0px; border-style: none; border-radius: 3px; display: initial; visibility: visible !important; width: 344px !important; --darkreader-inline-outline: initial;" data-index="2" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="344px" crossorigin="anonymous" alt="Image"><span data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><section data-brushtype="text" mp-original-font-size="16" mp-original-line-height="25.600000381469727" data-darkreader-inline-outline="" data-style="margin-bottom: 0em; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(89, 89, 89); font-size: 16px; white-space: normal; letter-spacing: 2px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; widows: 1; word-spacing: 2px; font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light; border-width: 0px; border-style: none; border-color: initial; text-align: right; line-height: 25.6px;" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><span mp-original-font-size="14" mp-original-line-height="22.399999618530273" data-darkreader-inline-outline="" data-darkreader-inline-color="">“在看和转发”</span><span mp-original-font-size="14" mp-original-line-height="22.399999618530273" data-darkreader-inline-outline="" data-darkreader-inline-color="">就是最大的支持</span></section>
```