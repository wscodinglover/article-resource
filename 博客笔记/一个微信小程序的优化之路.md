![Image](https://mmbiz.qpic.cn/mmbiz_jpg/qMicvibdvl7p0KEd3bHYcm99nBiclZbia548oyvliaq8PrrmrcyuT3QS3urMcfaXDPEumnHP9KYcMV3Fad5Pepzic81Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

Â ![Image](https://mmbiz.qpic.cn/mmbiz_gif/qMicvibdvl7p0shmw7MKGyutc63KZyibndlEzXkYJiaS1fUicrkRRKdOhPHMOic2dB36fnECUbaN0h6EJNcYU0HuY49g/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)Â 

æœ¬æ–‡å­—æ•°ï¼š**24677**å­—

é¢„è®¡é˜…è¯»æ—¶é—´ï¼š**60**åˆ†é’Ÿ

## ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºçš„æ¸è¿›å¼ä¼˜åŒ–ä¹‹è·¯

> â
> 
> æ¥ä¸ªå¤§çš„ï¼

## å‰è¨€

å…¥èŒæœç‹åæˆ‘å¼€å±•çš„ç¬¬ä¸€ä¸ªé¡¹ç›®å°±æ˜¯å¾®ä¿¡å°ç¨‹åºã€‚è°ˆèµ·å°ç¨‹åºå¼€å‘ï¼Œç”Ÿæ€å°é—­ã€å‘å¤šè·¯æ»‘ã€å¼€å‘å·¥å…·éš¾ç”¨ç­‰æ§½ç‚¹æ˜¯ä¸€å®šä¸èƒ½è¢«å¿½è§†çš„ï¼Œå› æ­¤å¸‚é¢ä¸Šä¹Ÿæ¶Œç°äº†ä¸€å¤§æ‰¹è¯¸å¦‚ mpvueã€taro è¿™æ ·çš„æŠ½è±¡ç¨‹åº¦æ›´é«˜çš„å°ç¨‹åºå¼€å‘æ¡†æ¶ã€‚æˆ‘è´Ÿè´£çš„è¿™ä¸ªå°ç¨‹åºé¡¹ç›®å¹¶æ²¡æœ‰é‡‡ç”¨è¿™äº›ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œè€Œæ˜¯é€‰æ‹©åœ¨åŸç”ŸæŠ€æœ¯æ ˆçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€ç³»åˆ—çš„ä¼˜åŒ–å’Œå®šåˆ¶ã€‚

å»å¹´ 8 æœˆä»½ (2021.08)ï¼Œå°ç¨‹åºçš„ç‰ˆæœ¬å·²ç»æ¥åˆ°äº† 4.0.0ã€‚ç»å†äº†é•¿è¾¾ä¸€å¹´çš„æ¸è¿›å¼ä¼˜åŒ–ï¼Œè¿™ä¸ªå°ç¨‹åºé¡¹ç›®çš„å¼€å‘ä½“éªŒä¹Ÿå‹‰å¼ºè¾¾åˆ°äº†â€œå¥½ç”¨â€çš„æ°´å¹³ï¼Œäºæ˜¯æˆ‘å†™ä¸‹äº†æœ¬æ–‡å¹¶åœ¨ç»„å†…åšäº†æŠ€æœ¯åˆ†äº«ã€‚æŠ€æœ¯åˆ†äº«åæˆ‘å°±æƒ³æ‰¾æ—¶é—´æŠŠæ–‡ç« è„±æ•å¹¶å…¬å¼€ï¼Œç»“æœæ‹–å»¶ç—‡å‘ä½œä¸€ç›´é¸½ğŸ•Šï¸åˆ°äº† 2022 å¹´ã€‚ã€‚ã€‚ä»Šå¤©ç»ˆäºç‹ ä¸‹å¿ƒæ¥é‡æ–°æ¢³ç†äº†è¿™ç¯‡ä¸‡å­—é•¿æ–‡ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°éœ€è¦å¼€å‘å°ç¨‹åºçš„ä½ ã€‚

(åŠ  â­ï¸ è¡¨ç¤ºä¸ªäººè®¤ä¸ºæ”¶ç›Šæ¯”è¾ƒå¤§çš„ä¼˜åŒ–)

## æˆ‘ä¿¡å¥‰çš„å‡ æ¡ä»£ç å“²å­¦

> â
> 
> -   è°¨è®°ä»£ç æ˜¯ç»™äººçœ‹çš„ï¼Œå®ƒä»¬åªæ˜¯æ°å¥½èƒ½è·‘è€Œå·²
>     
> -   å¥å£®çš„ç»“æ„è¿œæ¯”ç²¾å·§çš„è®¾è®¡æ¥å¾—é‡è¦ã€‚æ¢å¥è¯è¯´ï¼Œç»“æ„æ˜¯ç¬¬ä¸€ä½çš„ï¼ŒåŠŸèƒ½æ˜¯ç¬¬äºŒä½çš„ã€‚â€”â€”ã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹
>     
> -   ä¿æŒé¡¹ç›®çš„ç®€å•æ€§ã€‚è®¾è®¡è¾¾åˆ°å®Œç¾çš„æ—¶å€™ï¼Œä¸æ˜¯æ— æ³•å†å¢åŠ ä¸œè¥¿äº†ï¼Œè€Œæ˜¯æ— æ³•å†å‡å°‘ä¸œè¥¿äº†ã€‚â€”â€”ã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹
>     

## å¼€å‘ä¹‹å‰

æˆ‘å·²ç»ä¸æ¥è§¦å°ç¨‹åºå¾ˆä¹…äº†ï¼Œä½†æ—¢ç„¶è¦ä»å¤´åšä¸€ä¸ªè¿˜ç®—å¤æ‚çš„å°ç¨‹åºï¼Œé‚£å°±è¦å…ˆç»™è‡ªå·±çº¦æ³•ä¸‰ç« ã€‚

### ä½¿ç”¨åŸç”ŸæŠ€æœ¯æ ˆï¼Œæ‹’ç»ç¬¬ä¸‰æ–¹æ¡†æ¶

å°ç¨‹åºæ›´æ–°èŠ‚å¥å¾ˆå¿«ï¼Œè€Œä¸”ä¸ä¹å„ç§ Breaking Changesï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹æ¡†æ¶ä¸èƒ½å®Œç¾ Follow è¿™äº›æ›´æ–°ï¼Œä»¥è‡³äºä¸€äº›æ—©å¹´é—´å¤§ç«çš„æ¡†æ¶åˆ°ç°åœ¨éƒ½ä¸å†ç»´æŠ¤ã€‚è€Œä¸”å°ç¨‹åºæŠ€æœ¯ç»å†å‡ å¹´çš„æ›´æ–°ï¼Œå·²ç»æ¯”åˆšæ¨å‡ºçš„æ—¶å€™å¼ºå¤§å¾ˆå¤šäº†ï¼Œå¦‚æœæ²¡æœ‰å¼ºçƒˆçš„è·¨å¹³å°éœ€æ±‚ï¼Œä½¿ç”¨åŸç”ŸæŠ€æœ¯æ ˆæˆ–è®¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

### å…¨é¢æ‹¥æŠ± ES6+ è¯­æ³•ï¼›Promisify æ‰€æœ‰çš„ wx API

> â
> 
> æ³¨æ„ï¼šä»åŸºç¡€åº“ 2.10.2 å¼€å§‹ï¼Œå¤§éƒ¨åˆ† API å°±å·²ç»åŸç”Ÿæ”¯æŒè¿”å› Promiseï¼Œä¸å†éœ€è¦ wxp åº“ã€‚è¯¦è§æ–‡æ¡£ï¼šå¼‚æ­¥ API è¿”å› Promise<sup data-darkreader-inline-color="">[1]</sup>ã€‚

å°ç¨‹åºå¼€å‘è€…å·¥å…·å·²ç»æ”¯æŒç»å¤§éƒ¨åˆ†æˆ‘ä»¬æ—¥å¸¸èƒ½ä½¿ç”¨åˆ°çš„ ES6+ è¯­æ³•äº†ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒäº†ç›®å‰å¤„ç†å›è°ƒæœ€å¸¸ç”¨çš„ async await è¯­æ³•ã€‚ä½†å®˜æ–¹çš„ `wx.showLoading` ç­‰ API éƒ½è¿˜æ˜¯åªèƒ½ä½¿ç”¨å›è°ƒï¼Œå› æ­¤å¼€å‘ä¸šåŠ¡å‰çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è®©æ‰€æœ‰çš„å¾®ä¿¡ API æ”¯æŒ Promise å½¢å¼è°ƒç”¨ã€‚

æœ€åæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº†å¾®ä¿¡å®˜æ–¹æä¾›çš„ wxp åº“ï¼šAPI Promise åŒ–<sup data-darkreader-inline-color="">[2]</sup>ã€‚

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;utils/wxp.js</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;promisifyAll,&nbsp;promisify&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'miniprogram-api-promise'</span>;<br><br><span data-darkreader-inline-color="">const</span>&nbsp;wxp&nbsp;=&nbsp;{};<br>promisifyAll(wx,&nbsp;wxp);<br>promisify(wx.getUserProfile);<br><br><span data-darkreader-inline-color="">export</span>&nbsp;{&nbsp;wxp&nbsp;};<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;wxp;<br><br><span data-darkreader-inline-color="">//&nbsp;page.js</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;wxp&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../../utils/wxp'</span>;<br><br><span data-darkreader-inline-color="">await</span>&nbsp;wxp.showModal({&nbsp;<span data-darkreader-inline-color="">showCancel</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'æç¤º'</span>,&nbsp;<span data-darkreader-inline-color="">content</span>:&nbsp;errMsg&nbsp;});<br></code>
```

### æ‹¥æŠ±æ¨¡å—åŒ–

é¡¹ç›®ä¸­çš„å…¬å…±å†…å®¹ï¼Œæ¯”å¦‚é…ç½®ã€å·¥å…·å‡½æ•°ç­‰ï¼Œå…¨éƒ¨æŒ‰ç…§æ¨¡å—æ‹†åˆ†ï¼Œå¹¶å€Ÿç”± ES6 ä¸­çš„æ¨¡å—ç³»ç»Ÿå®ç°å¤ç”¨ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘å¡è¿› app.js ä¸­ã€‚æ€»ä¹‹ï¼Œè¿˜æ˜¯é«˜å†…èšä½è€¦åˆï¼Œä¿è¯å…¨å±€æ¨¡å—æ˜¯â€œè–„â€çš„ã€‚

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;utils&nbsp;ç›®å½•æ”¶å½•äº†å„ç§è¾…åŠ©å·¥å…·</span><br>â”œâ”€â”€&nbsp;utils<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;Auth.js<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;event-bus.js<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;helpers.js<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;http.js<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;logger.js<br>â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;md5.js<br>â”‚&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;wxp.js<br><br><span data-darkreader-inline-color="">//&nbsp;page.js</span><br><span data-darkreader-inline-color="">//&nbsp;âœ…</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;logger&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../../utils/logger'</span>;<br>logger.log(<span data-darkreader-inline-color="">'...'</span>);<br><br><span data-darkreader-inline-color="">//&nbsp;âŒ</span><br><span data-darkreader-inline-color="">const</span>&nbsp;app&nbsp;=&nbsp;getApp();<br>app.logger.log(<span data-darkreader-inline-color="">'...'</span>);<br></code>
```

### ç¡®å®šå°ç¨‹åºç‰ˆæœ¬æ ¼å¼

ä¸¥æ ¼éµå®ˆ SemVer è§„èŒƒ<sup data-darkreader-inline-color="">[3]</sup>ã€‚

-   ç®€ä»‹
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ<br>æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ<br>ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚<br></code>
```

### ç¼–å†™ CHANGELOG

åœ¨é¡¹ç›®ä¸­æ·»åŠ  `CHANGELOG.md`ï¼Œè®°å½•æ¯ä¸ªç‰ˆæœ¬çš„æ›´æ–°å†…å®¹ã€‚

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">##&nbsp;3.3.0&nbsp;(2021.08.16)</span><br><span data-darkreader-inline-color=""><br>-&nbsp;</span>A&nbsp;æ–°å¢&nbsp;ç§¯åˆ†å•†åŸæ¨¡å—<br><span data-darkreader-inline-color="">-&nbsp;</span>I&nbsp;ä¼˜åŒ–&nbsp;åˆ†äº«åˆ°æœ‹å‹åœˆåŠŸèƒ½<br><span data-darkreader-inline-color="">-&nbsp;</span>I&nbsp;ä¼˜åŒ–&nbsp;å°ç¨‹åºä½“ç§¯ï¼Œæå‡å°ç¨‹åºæ‰“å¼€é€Ÿåº¦ï¼Œä¸»åŒ…ä½“ç§¯ç¼©å°&nbsp;42%&nbsp;(950KB&nbsp;å‡å°åˆ°&nbsp;549KB)<br><span data-darkreader-inline-color="">-&nbsp;</span>I&nbsp;å‡çº§&nbsp;å¯Œæ–‡æœ¬è§£æå™¨ç‰ˆæœ¬<br><span data-darkreader-inline-color="">-&nbsp;</span>F&nbsp;ä¿®å¤&nbsp;é¦–é¡µå¼¹çª—çš„å¼‚å¸¸æ ·å¼<br></code>
```

## ä½¿ç”¨ Prettier + .editorconfig è¿›è¡Œä»£ç æ ¼å¼åŒ–

ä»£ç æ ¼å¼åŒ–æ˜¯å›¢é˜Ÿåä½œå¼€å‘çš„åŸºçŸ³ä¹‹ä¸€ï¼ŒEditorconfig<sup data-darkreader-inline-color="">[4]</sup> å¯ä»¥æ¶ˆé™¤ä¸åŒå¼€å‘æˆå‘˜å› ä¸ºä»£ç ç¼–è¾‘å™¨å¸¦æ¥çš„é£æ ¼å·®å¼‚ï¼›è€Œ Prettier<sup data-darkreader-inline-color="">[5]</sup> æ˜¯ç›®å‰æœ€æµè¡Œçš„å‰ç«¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€äº›è§„åˆ™ä½¿å…¶é€‚ç”¨äºæˆ‘ä»¬çš„å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ã€‚

-   `.editorconfig`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">root&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span><br><br>[*]<br>charset&nbsp;=&nbsp;utf-8<br>end_of_line&nbsp;=&nbsp;lf<br>indent_style&nbsp;=&nbsp;space<br>indent_size&nbsp;=&nbsp;2<br>tab_width&nbsp;=&nbsp;2<br>trim_trailing_whitespace&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span><br>insert_final_newline&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span><br><br>[*.md]<br>trim_trailing_whitespace&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span><br></code>
```

-   `.prettierrc.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">module</span>.exports&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">singleQuote</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">printWidth</span>:&nbsp;<span data-darkreader-inline-color="">100</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">trailingComma</span>:&nbsp;<span data-darkreader-inline-color="">'none'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">arrowParens</span>:&nbsp;<span data-darkreader-inline-color="">'avoid'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">overrides</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">files</span>:&nbsp;<span data-darkreader-inline-color="">'*.wxml'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">options</span>:&nbsp;{&nbsp;<span data-darkreader-inline-color="">parser</span>:&nbsp;<span data-darkreader-inline-color="">'html'</span>&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">files</span>:&nbsp;<span data-darkreader-inline-color="">'*.wxss'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">options</span>:&nbsp;{&nbsp;<span data-darkreader-inline-color="">parser</span>:&nbsp;<span data-darkreader-inline-color="">'css'</span>&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">files</span>:&nbsp;<span data-darkreader-inline-color="">'*.wxs'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">options</span>:&nbsp;{&nbsp;<span data-darkreader-inline-color="">parser</span>:&nbsp;<span data-darkreader-inline-color="">'babel'</span>,&nbsp;<span data-darkreader-inline-color="">quoteProps</span>:&nbsp;<span data-darkreader-inline-color="">'preserve'</span>&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;]<br>};<br></code>
```

-   `package.json`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">"scripts"</span>:&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"lint:prettier"</span>:&nbsp;<span data-darkreader-inline-color="">"prettier&nbsp;--loglevel&nbsp;warn&nbsp;--write&nbsp;\"src/**/*.{wxml,wxss,scss,wxs,json,md}\""</span>,<br>},<br></code>
```

## â­ï¸ æ‹†åˆ†è¯·æ±‚å±‚å’Œæ¥å£å±‚ï¼Œå®ç°æ¥å£ç®¡ç†å’Œå¤ç”¨

å¯¹ `wx.request` è¿›è¡Œå°è£…ï¼Œæ”¯æŒï¼š

1.  æ˜¯å¦è‡ªåŠ¨å¼€å¯é¡µé¢ Loading
    
2.  æ˜¯å¦è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯æç¤º
    
3.  è‡ªå®šä¹‰é”™è¯¯æç¤ºå†…å®¹
    
4.  æ˜¯å¦è‡ªåŠ¨æºå¸¦ Token
    
5.  æ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨
    

-   `utils/http.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Auth&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./Auth'</span>;<br><br><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;@param&nbsp;{Boolean}&nbsp;withToken&nbsp;æ˜¯å¦åœ¨å‘é€è¯·æ±‚æ—¶é™„å¸¦&nbsp;auth&nbsp;token<br>&nbsp;*&nbsp;@param&nbsp;{Boolean}&nbsp;showLoading&nbsp;æ˜¯å¦åœ¨å‘é€è¯·æ±‚æ—¶æ˜¾ç¤º&nbsp;loading<br>&nbsp;*&nbsp;@param&nbsp;{Boolean}&nbsp;showError&nbsp;æ˜¯å¦åœ¨è¯·æ±‚å¤±è´¥æ—¶æ˜¾ç¤ºå¼‚å¸¸æç¤º(ä»…é’ˆå¯¹&nbsp;success&nbsp;æ–¹æ³•)<br>&nbsp;*&nbsp;@param&nbsp;{String}&nbsp;errorMsg&nbsp;é»˜è®¤çš„é”™è¯¯æç¤º(ä»…é’ˆå¯¹&nbsp;success&nbsp;æ–¹æ³•)<br>&nbsp;*&nbsp;@param&nbsp;{Function}&nbsp;successInterceptor&nbsp;è¯·æ±‚æˆåŠŸæ—¶çš„æ‹¦æˆªå™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰åç»­é€»è¾‘<br>&nbsp;*&nbsp;@param&nbsp;{Function}&nbsp;failInterceptor&nbsp;è¯·æ±‚å¤±è´¥æ—¶çš„æ‹¦æˆªå™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰åç»­é€»è¾‘<br>&nbsp;*<br>&nbsp;*&nbsp;@NOTICE:&nbsp;å¾®ä¿¡å°ç¨‹åºçš„&nbsp;fail&nbsp;åªåœ¨è¯·æ±‚å‘é€å¤±è´¥æ—¶è§¦å‘ï¼Œå› æ­¤å¯¹äºçŠ¶æ€ç çš„åˆ¤æ–­éœ€è¦æ”¾åœ¨&nbsp;success&nbsp;æ–¹æ³•é‡Œå¤„ç†<br>&nbsp;*/</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;({<br>&nbsp;&nbsp;withToken&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;showLoading&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;loadingMsg&nbsp;=&nbsp;<span data-darkreader-inline-color="">'åŠ è½½ä¸­...'</span>,<br>&nbsp;&nbsp;showError&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;errorMsg&nbsp;=&nbsp;<span data-darkreader-inline-color="">'è¯·æ±‚é”™è¯¯ï¼Œè¯·ç¨å€™å†è¯•'</span>,<br>&nbsp;&nbsp;...options<br>})&nbsp;=&gt;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span data-darkreader-inline-color="">async</span>&nbsp;(resolve,&nbsp;reject)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(showLoading)&nbsp;wx.showLoading({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;loadingMsg,&nbsp;<span data-darkreader-inline-color="">mask</span>:&nbsp;<span data-darkreader-inline-color="">true</span>&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;header&nbsp;=&nbsp;options.header&nbsp;||&nbsp;{&nbsp;<span data-darkreader-inline-color="">'Content-Type'</span>:&nbsp;<span data-darkreader-inline-color="">'application/json'</span>&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(withToken&nbsp;&amp;&amp;&nbsp;Auth.isLogged())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(Auth.shouldRefreshToken())&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;Auth.refreshToken();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header[<span data-darkreader-inline-color="">'X-SA-AUTH'</span>]&nbsp;=&nbsp;Auth.getToken();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;wx.request({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...options,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">header</span>:&nbsp;<span data-darkreader-inline-color="">Object</span>.assign(header,&nbsp;options[<span data-darkreader-inline-color="">'header'</span>]&nbsp;||&nbsp;{}),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">success</span>:&nbsp;<span><span>res</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(showLoading)&nbsp;wx.hideLoading();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(options.successInterceptor)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.successInterceptor(res,&nbsp;resolve,&nbsp;reject);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;statusCode&nbsp;=&nbsp;+res.statusCode;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(statusCode&nbsp;===&nbsp;<span data-darkreader-inline-color="">200</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(res);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(showError)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;finalMsg;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;404</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(statusCode&nbsp;===&nbsp;<span data-darkreader-inline-color="">404</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalMsg&nbsp;=&nbsp;<span data-darkreader-inline-color="">'èµ„æºä¸å­˜åœ¨'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;500</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(statusCode&nbsp;===&nbsp;<span data-darkreader-inline-color="">500</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalMsg&nbsp;=&nbsp;<span data-darkreader-inline-color="">'æœåŠ¡å™¨å¼€å°å·®äº†ï¼Œè¯·ç¨å€™é‡è¯•'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;429</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(statusCode&nbsp;===&nbsp;<span data-darkreader-inline-color="">429</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalMsg&nbsp;=&nbsp;<span data-darkreader-inline-color="">'æ‚¨è¯·æ±‚çš„å¤ªé¢‘ç¹äº†ï¼Œè¯·ç¨å€™é‡è¯•'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æƒé™ç›¸å…³</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.data&nbsp;&amp;&amp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.data.code&nbsp;&amp;&amp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'invalid_auth_token'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'auth_token_expired'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'missing_auth_token'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'user_login_status_error'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].includes(res.data.code)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auth.clearToken();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;msgRelation&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">invalid_auth_token</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡è¯•'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">auth_token_expired</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡è¯•'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">missing_auth_token</span>:&nbsp;<span data-darkreader-inline-color="">'æœªèƒ½è·å–åˆ°æ‚¨çš„ç™»å½•å‡­è¯ï¼Œè¯·é‡è¯•'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">user_login_status_error</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡è¯•'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalMsg&nbsp;=&nbsp;res.data.code&nbsp;?&nbsp;msgRelation[res.data.code]&nbsp;:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡è¯•'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;å…¶ä»–æƒ…å†µ</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalMsg&nbsp;=&nbsp;errorMsg;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;finalMsg,&nbsp;<span data-darkreader-inline-color="">icon</span>:&nbsp;<span data-darkreader-inline-color="">'none'</span>,&nbsp;<span data-darkreader-inline-color="">duration</span>:&nbsp;<span data-darkreader-inline-color="">1500</span>&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(res);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">fail</span>:&nbsp;<span><span>err</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(showLoading)&nbsp;wx.hideLoading();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(options.failInterceptor)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.failInterceptor(err,&nbsp;resolve,&nbsp;reject);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'è¯·æ±‚å‘é€å¤±è´¥ï¼Œè¯·ç¨å€™é‡è¯•'</span>,&nbsp;<span data-darkreader-inline-color="">icon</span>:&nbsp;<span data-darkreader-inline-color="">'none'</span>,&nbsp;<span data-darkreader-inline-color="">duration</span>:&nbsp;<span data-darkreader-inline-color="">1500</span>&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;});<br></code>
```

è€Œæ‰€æœ‰çš„æ¥å£è¯·æ±‚éƒ½å°è£…æˆå¼‚æ­¥æ–¹æ³•æ”¾ç½®åœ¨ api æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚

-   `api/goods.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;http&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../utils/http'</span>;<br><span data-darkreader-inline-color="">//&nbsp;buildUrl&nbsp;æ˜¯ä¸€ä¸ªè‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ ¹æ®å°ç¨‹åºè¿è¡Œç¯å¢ƒè‡ªåŠ¨è®¡ç®—æµ‹è¯•ç¯å¢ƒ&nbsp;or&nbsp;æ­£å¼ç¯å¢ƒçš„æ–¹æ³•</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;buildUrl&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../utils/helpers'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;reqFetchGoods&nbsp;=&nbsp;<span>(<span>data,&nbsp;showLoading&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span></span>)&nbsp;=&gt;</span><br>&nbsp;&nbsp;http({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">url</span>:&nbsp;buildUrl(<span data-darkreader-inline-color="">`/goods`</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">method</span>:&nbsp;<span data-darkreader-inline-color="">'GET'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;data,<br>&nbsp;&nbsp;&nbsp;&nbsp;showLoading<br>&nbsp;&nbsp;});<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;reqShowGoods&nbsp;=&nbsp;<span>(<span>goodsId,&nbsp;showLoading&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span></span>)&nbsp;=&gt;</span><br>&nbsp;&nbsp;http({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">url</span>:&nbsp;buildUrl(<span data-darkreader-inline-color="">`/goods/<span data-darkreader-inline-color="">${goodsId}</span>`</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">method</span>:&nbsp;<span data-darkreader-inline-color="">'GET'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;showLoading<br>&nbsp;&nbsp;});<br></code>
```

## â­ï¸ app.js å’Œ page.js é—´çš„æ•°æ®äº¤äº’

è¿›å…¥å°ç¨‹åºåï¼Œapp.js å’Œ page.js ä¼šåŒæ—¶æ‰§è¡Œï¼Œè¿™å°±å¯¼è‡´å‡å¦‚ page.js ä¸­éœ€è¦æ‹¿åˆ°ä¸€äº› app.js ä¸­çš„æ•°æ®æ—¶ï¼Œå¿…é¡»ç»™å…¨å±€çš„ `app` å¯¹è±¡æ·»åŠ ä¸€ä¸ªå›è°ƒï¼Œå¹¶ä¸”åœ¨ app.js ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå›è°ƒã€‚å°ç¨‹åºå¼€å‘è€…å·¥å…·ç»™å‡ºçš„ Demo é¡¹ç›®ä¸­å°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨è¿™ç§é€»è¾‘æ¥åœ¨é¡µé¢ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚**ä½†æ˜¯è¿™ç§æ–¹å¼éå¸¸ç¹çï¼Œä¼šå¯¼è‡´ page.js å’Œ app.js ä¸­å›è°ƒæ»¡å¤©é£ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚**

è€Œæˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼Œåœ¨ app.js ä¸­å®šä¹‰ç»Ÿä¸€çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚ä¸“é—¨ç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯çš„ `getUserInfo(cb)` å‡½æ•°ï¼Œå‚æ•° cb æ˜¯é¡µé¢ä¼ å…¥çš„å›è°ƒå‡½æ•°ã€‚åœ¨ app.js ä¸­åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å·²åˆå§‹åŒ–å®Œæ¯•ï¼Œå¦‚æœå·²å®Œæ¯•åˆ™ç›´æ¥æ‰§è¡Œé¡µé¢å›è°ƒï¼›åä¹‹åˆ™å…ˆå°† cb æš‚å­˜ï¼Œç­‰å¾…ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–å®Œæ¯•åç»Ÿä¸€æ‰§è¡Œå›è°ƒã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å¯¹äºä»»ä½•éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯çš„éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡ `app.getUserInfo` è¿™ä¸€ä¸ªå…¥å£è§£å†³ã€‚

-   `app.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">App({<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">globalData</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">isUserInfoInited</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userInfoListeners</span>:&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">isLogged</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userInfo</span>:&nbsp;<span data-darkreader-inline-color="">null</span><br>&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;onLaunch(options)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.initAppInfo(options);<br>&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;initUserInfo(reLogin&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ä»æœªèµ°è¿‡ç™»å½•é€»è¾‘ï¼Œæˆ–å¼ºåˆ¶è¦æ±‚é‡æ–°ç™»å½•</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!Auth.isLoginActionCompleted()&nbsp;||&nbsp;reLogin)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;Auth.login&nbsp;ç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯å¹¶ä¿å­˜åœ¨æœ¬åœ°</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;Auth.login();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.isLogged&nbsp;=&nbsp;Auth.isLogged();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfo&nbsp;=&nbsp;Auth.getUserInfo();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æ‰§è¡Œ&nbsp;getUserInfo&nbsp;æ–¹æ³•ä¸­æš‚å­˜çš„å›è°ƒå‡½æ•°</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.isUserInfoInited&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfoListeners.forEach(<span><span>listener</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listener(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;IAppUserInfo({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">isLogged</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.isLogged,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userInfo</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfo<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfoListeners&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;getUserInfo(cb)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">this</span>.globalData.isUserInfoInited)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;IAppUserInfo({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">isLogged</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.isLogged,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userInfo</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfo<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.globalData.userInfoListeners.push(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;getUserInfoAsync()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span><span>resolve</span>&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-color="">this</span>.getUserInfo(resolve));<br>&nbsp;&nbsp;}<br>});<br></code>
```

-   `page.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">async</span>&nbsp;onLoad(options)&nbsp;{<br>&nbsp;&nbsp;app.getUserInfo(<span>(<span>{&nbsp;userInfo&nbsp;}</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æ­¤æ—¶&nbsp;userInfo&nbsp;ä¸€å®šæœ‰å€¼</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.setData({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userNickname</span>:&nbsp;userInfo.nickname,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">avatar</span>:&nbsp;userInfo.avatar<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;});<br>},<br></code>
```

> â
> 
> é™¤äº†åœ¨é¡µé¢å†…å¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯è¿™ç§éœ€æ±‚ï¼Œä½ è¿˜å¯ä»¥ç”¨ç±»ä¼¼çš„æ€è·¯æŠŠä¸€äº›å˜åŠ¨ä¸é¢‘ç¹çš„è®¡ç®—æ”¾åˆ° app.js é‡Œï¼Œæ¯”å¦‚è‡ªå®šä¹‰å¯¼èˆªæ çš„é«˜åº¦ã€ä¸€äº›ç”¨æˆ·æ‰‹æœºç›¸å…³çš„ç³»ç»Ÿä¿¡æ¯ç­‰ï¼Œå¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ã€‚

## é€‰ç”¨ Vant Weapp æ›¿æ¢ WeUIï¼Œå¹¶ç¼–å†™è„šæœ¬è¿›è¡Œç»´æŠ¤

åœ¨é¡¹ç›®å¼€å‘åˆæœŸï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å®˜æ–¹æ‰©å±• WeUI ç»„ä»¶åº“ (ä¸»è¦æ˜¯ä½¿ç”¨äº† Icon å›¾æ ‡ç»„ä»¶)ã€‚å…¶ä¼˜ç‚¹æ˜¯å¾®ä¿¡å†…ç½®ï¼Œå°ç¨‹åºå¼•å…¥æ—¶ä¸ä¼šé¢å¤–å¢åŠ å°ç¨‹åºä½“ç§¯ã€‚ä½†åæ¥å‘ç° WeUI ç»„ä»¶åº“ä»ä¸èƒ½æ»¡è¶³å¼€å‘éœ€æ±‚ï¼Œè°ƒç ”åå†³å®šå¼•å…¥ Vant Weapp<sup data-darkreader-inline-color="">[6]</sup> ç»„ä»¶åº“æ›¿ä»£ WeUIã€‚

æˆ‘ä»¬çš„é¡¹ç›®åªéœ€è¦ç”¨åˆ°å…¶ä¸­ä¸€éƒ¨åˆ†ç»„ä»¶ï¼Œæ¯”å¦‚å›¾æ ‡ç»„ä»¶ Iconï¼Œè¯„åˆ†ç»„ä»¶ Rate ç­‰ï¼Œå› æ­¤æˆ‘ä»¬æœ€å¥½è¿›è¡ŒæŒ‰éœ€å¼•å…¥ã€‚å®ç°æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ Vant Weapp ç¼–è¯‘å¥½çš„ dist ç›®å½•ä¸­éœ€è¦ç”¨åˆ°çš„å„ä¸ªç»„ä»¶æ–‡ä»¶å¤¹ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®ä¸­å³å¯ã€‚å› æ­¤åœ¨é¡¹ç›®ä¸­æ–°å»ºäº† `vendor/vant` æ–‡ä»¶å¤¹å­˜æ”¾éœ€è¦ç”¨åˆ°çš„ Vant ç»„ä»¶ã€‚

è™½ç„¶å¬èµ·æ¥ç®€å•ï¼Œä½†å®é™…å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

-   å¦‚æœè¦æŒ‰ç…§æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨ npm å®‰è£… Vant Weappï¼Œå¦åˆ™ç¼–è¯‘åå°ç¨‹åºä¼šæœ‰å…¨é‡ç»„ä»¶ï¼Œä½“ç§¯è¿‡å¤§
    
-   ä½¿ç”¨çš„ Vant Weapp å¿…é¡»ç‰ˆæœ¬ç»Ÿä¸€ï¼Œä¸èƒ½å‡ ä¸ªæœˆåæ·»åŠ æ–°çš„ç»„ä»¶ï¼Œå’Œä¹‹å‰æ·»åŠ çš„ç»„ä»¶ç‰ˆæœ¬ä¸ä¸€è‡´
    

æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯å°† Vant Weapp çš„æ„å»ºäº§ç‰© dist ç›®å½•çº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”ç¼–å†™è„šæœ¬å®ç°ä¸€é”®æ›´æ–°å’Œå‘å¸ƒã€‚æˆ‘å¹¶ä¸æ“…é•¿ Shell è„šæœ¬ï¼Œå› æ­¤å¼•å…¥äº† shelljs<sup data-darkreader-inline-color="">[7]</sup>, chalk<sup data-darkreader-inline-color="">[8]</sup>, commander.js<sup data-darkreader-inline-color="">[9]</sup> è¿™ä¸‰ä¸ªåº“è¾…åŠ©æˆ‘ä½¿ç”¨ JS ä»£ç ç¼–å†™è„šæœ¬ã€‚

-   `cli/vant-upgrade.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;shell&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'shelljs'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;chalk&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'chalk'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;path&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'path'</span>);<br><br>shell.cd(path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'../'</span>));<br><br><span data-darkreader-inline-color="">//&nbsp;å…‹éš†æœ€æ–°ç‰ˆæœ¬çš„&nbsp;vant&nbsp;é¡¹ç›®æºç </span><br><span data-darkreader-inline-color="">console</span>.log(chalk.blue(<span data-darkreader-inline-color="">`Downloading...`</span>));<br>shell.exec(<span data-darkreader-inline-color="">`git&nbsp;clone&nbsp;https://github.com/youzan/vant-weapp.git&nbsp;vant-source&nbsp;--depth=1`</span>);<br><span data-darkreader-inline-color="">console</span>.log(chalk.green(<span data-darkreader-inline-color="">`Downloaded!`</span>));<br><br><span data-darkreader-inline-color="">//&nbsp;ç”Ÿæˆæ–°çš„&nbsp;vant&nbsp;é¡¹ç›®æ–‡ä»¶å¤¹</span><br><span data-darkreader-inline-color="">console</span>.log(chalk.blue(<span data-darkreader-inline-color="">`Migrating...`</span>));<br>shell.rm(<span data-darkreader-inline-color="">'-rf'</span>,&nbsp;<span data-darkreader-inline-color="">'vant'</span>);<br>shell.mv(<span data-darkreader-inline-color="">'vant-source/dist'</span>,&nbsp;<span data-darkreader-inline-color="">'vant'</span>);<br>shell.mv(<span data-darkreader-inline-color="">'vant-source/package.json'</span>,&nbsp;<span data-darkreader-inline-color="">'vant/package.json'</span>);<br>shell.rm(<span data-darkreader-inline-color="">'-rf'</span>,&nbsp;<span data-darkreader-inline-color="">'vant-source'</span>);<br><span data-darkreader-inline-color="">console</span>.log(chalk.green(<span data-darkreader-inline-color="">`Migrated!`</span>));<br><br><span data-darkreader-inline-color="">console</span>.log(chalk.green(<span data-darkreader-inline-color="">`Upgrade&nbsp;Success!&nbsp;Please&nbsp;republish&nbsp;the&nbsp;components&nbsp;you&nbsp;need.`</span>));<br></code>
```

-   `cli/vant-publish.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;shell&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'shelljs'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;chalk&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'chalk'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;Command&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'commander'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;path&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'path'</span>);<br><br><span data-darkreader-inline-color="">const</span>&nbsp;program&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;Command();<br>program<br>&nbsp;&nbsp;.requiredOption(<span data-darkreader-inline-color="">'-n&nbsp;--folder-names&nbsp;&lt;names...&gt;'</span>,&nbsp;<span data-darkreader-inline-color="">'Component&nbsp;folders&nbsp;you&nbsp;need.'</span>)<br>&nbsp;&nbsp;.parse(process.argv);<br><span data-darkreader-inline-color="">const</span>&nbsp;options&nbsp;=&nbsp;program.opts();<br><span data-darkreader-inline-color="">const</span>&nbsp;folderNames&nbsp;=&nbsp;options.folderNames;<br><br>folderNames.forEach(<span><span>name</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;shell.rm(<span data-darkreader-inline-color="">'-rf'</span>,&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">`../src/vendor/vant/<span data-darkreader-inline-color="">${name}</span>`</span>));<br>&nbsp;&nbsp;shell.cp(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'-R'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">`../vant/<span data-darkreader-inline-color="">${name}</span>`</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">`../src/vendor/vant/<span data-darkreader-inline-color="">${name}</span>`</span>)<br>&nbsp;&nbsp;);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(chalk.blue(<span data-darkreader-inline-color="">`Component&nbsp;<span data-darkreader-inline-color="">${name}</span>&nbsp;has&nbsp;been&nbsp;published.`</span>));<br>});<br><br><span data-darkreader-inline-color="">console</span>.log(chalk.green(<span data-darkreader-inline-color="">`All&nbsp;components&nbsp;have&nbsp;been&nbsp;published!`</span>));<br></code>
```

-   `package.json`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">"scripts"</span>:&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"vant:upgrade"</span>:&nbsp;<span data-darkreader-inline-color="">"node&nbsp;cli/vant-upgrade.js"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"vant:publish"</span>:&nbsp;<span data-darkreader-inline-color="">"node&nbsp;cli/vant-publish.js"</span>,<br>},<br></code>
```

## â­ï¸ å¼•å…¥ ESLint å®ç° JS ä»£ç æ£€æŸ¥

å°ç¨‹åºåœ¨å®Œæˆä¸€æœŸéœ€æ±‚åå·¥ç¨‹å°±å·²ç»å¾ˆå¤§äº†ï¼Œä¸ºäº†ç»§ç»­æé«˜é¡¹ç›®ç¨³å®šæ€§ï¼Œæˆ‘å†³å®šå¼•å…¥ ESLint å®ç°ä»£ç æ£€æŸ¥ã€‚æœ‰å‡ ä¸ªé‡ç‚¹ï¼š

-   è¦æŠŠä¸éœ€è¦æ£€æŸ¥çš„ç¬¬ä¸‰æ–¹åº“ç­‰æ·»åŠ è‡³ `.eslintignore` è¿›è¡Œå¿½ç•¥ï¼Œæ¯”å¦‚ Vant ç»„ä»¶åº“
    
-   å¯ä»¥é€šè¿‡æ·»åŠ  `eslint-config-prettier` å’Œ `eslint-plugin-prettier` æ’ä»¶ï¼Œå°† Prettier å’Œ ESLint ç»“åˆèµ·æ¥ä½¿ç”¨
    
-   `.eslintrc.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">module</span>.exports&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">env</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">browser</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">node</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">es6</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">commonjs</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">extends</span>:&nbsp;[<span data-darkreader-inline-color="">'eslint:recommended'</span>,&nbsp;<span data-darkreader-inline-color="">'plugin:prettier/recommended'</span>],<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">parser</span>:&nbsp;<span data-darkreader-inline-color="">'@babel/eslint-parser'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">parserOptions</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">ecmaVersion</span>:&nbsp;<span data-darkreader-inline-color="">6</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">sourceType</span>:&nbsp;<span data-darkreader-inline-color="">'module'</span>,<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">globals</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">App</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">Page</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">Component</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">Behavior</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">wx</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">getApp</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">getCurrentPages</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">rules</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'no-unused-vars'</span>:&nbsp;<span data-darkreader-inline-color="">'warn'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'prettier/prettier'</span>:&nbsp;<span data-darkreader-inline-color="">'warn'</span>,<br>&nbsp;&nbsp;},<br>};<br></code>
```

## å¼•å…¥å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ä¹Ÿæ˜¯æé«˜ä»£ç è´¨é‡çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä¹Ÿå°è¯•åœ¨é¡¹ç›®ä¸­å¼•å…¥å®˜æ–¹çš„å•å…ƒæµ‹è¯•åŠŸèƒ½ã€‚è¯¦æƒ…æ–‡æ¡£ï¼šå•å…ƒæµ‹è¯•<sup data-darkreader-inline-color="">[10]</sup>ã€‚

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;simulate&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'miniprogram-simulate'</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;randomStr&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../utils'</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;CompSpec&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../CompSpec'</span>;<br><br><span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;compId,&nbsp;specDesc&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;CompSpec(<span data-darkreader-inline-color="">'components/no-data/no-data'</span>);<br><br>describe(specDesc,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;test(<span data-darkreader-inline-color="">'Has&nbsp;default&nbsp;text'</span>,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;comp&nbsp;=&nbsp;simulate.render(compId);<br>&nbsp;&nbsp;&nbsp;&nbsp;expect(comp.querySelector(<span data-darkreader-inline-color="">'.text'</span>).dom.innerHTML).toBe(<span data-darkreader-inline-color="">'ç›®å‰è¿˜æ²¡æœ‰æ•°æ®'</span>);<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;test(<span data-darkreader-inline-color="">'Show&nbsp;correct&nbsp;text'</span>,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;putText&nbsp;=&nbsp;randomStr();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;comp&nbsp;=&nbsp;simulate.render(compId,&nbsp;{&nbsp;<span data-darkreader-inline-color="">text</span>:&nbsp;putText&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;expect(comp.querySelector(<span data-darkreader-inline-color="">'.text'</span>).dom.innerHTML).toEqual(putText);<br>&nbsp;&nbsp;});<br>});<br></code>
```

## â­ï¸ è®¾ç½®ç‹¬ç«‹çš„è·³è½¬ä¸­é—´é¡µ

å°ç¨‹åºä¸­æœ‰å¾ˆå¤šå¯ä»¥è¿›è¡Œåˆ†äº«çš„é¡µé¢ï¼Œå¦‚åŠ©åŠ›é¡µã€æ´»åŠ¨é¡µç­‰ï¼›ä»¥åŠä¸€å¤§æ‰¹æ¶ˆæ¯æ¨é€åç”¨æˆ·å¯ä»¥ç‚¹å‡»æ¶ˆæ¯å¡ç‰‡æ‰“å¼€çš„é¡µé¢ï¼Œè¿™äº›é¡µé¢éœ€è¦åç«¯ä»£ç é…ç½®å¯¹åº”çš„é¡µé¢è·¯å¾„ï¼Œè€Œæ¯å½“å°ç¨‹åºç«¯æ–‡ä»¶å¤¹ç»“æ„å˜åŒ–æ—¶ï¼Œåç«¯ä»£ç ä¹Ÿéœ€è¦è·Ÿç€æ”¹å˜ï¼Œéå¸¸éº»çƒ¦ã€‚

éšç€è¿™äº›å…¥å£è¶Šæ¥è¶Šå¤šï¼Œè·³è½¬çš„ç»´æŠ¤æ„ˆå‘å¤æ‚ï¼Œå› æ­¤æˆ‘å†³å®šå¼•å…¥ä¸€ä¸ªä¸“é—¨çš„ä¸­é—´é¡µé¢ (`/pages/portal/portal`) å¤„ç†å…¨éƒ¨è·³è½¬è¡Œä¸ºã€‚

ä¸ç®¡æ˜¯å‰ç«¯ç”Ÿäº§çš„åˆ†äº«é“¾æ¥ï¼Œè¿˜æ˜¯åç«¯ä»£ç é…ç½®çš„ç›®æ ‡è·¯å¾„ï¼Œæ°¸è¿œéƒ½æŒ‡å‘ Portal é¡µã€‚å°ç¨‹åºè¿›å…¥ Portalé¡µåï¼Œé¡µé¢å†æ ¹æ®å‚æ•° pk (æ„ä¸º PageKey) åœ¨å°ç¨‹åºç«¯è¿›è¡Œä¸€æ¬¡é‡å®šå‘ã€‚

-   `/pages/portal/portal.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;urlParamsToObj&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../../utils/helpers'</span>;<br><br>Component({<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">methods</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;onLoad(pageOptions)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;optionsObj&nbsp;=&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;adapters&nbsp;=&nbsp;<span data-darkreader-inline-color="">null</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;launchOptions&nbsp;=&nbsp;wx.getLaunchOptionsSync();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;å°ç¨‹åºæ˜¯æ‰«ç è¿›å…¥</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(launchOptions.scene&nbsp;===&nbsp;<span data-darkreader-inline-color="">1047</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsObj&nbsp;=&nbsp;urlParamsToObj(<span data-darkreader-inline-color="">decodeURIComponent</span>(pageOptions.scene));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapters&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">// 1001 =&gt;&nbsp;å°ç¨‹åºæ‰«ç æ‰“å¼€æ´»åŠ¨è¯¦æƒ…é¡µã€‚ä¾‹ï¼šscene=encodeURIComponent('?pk=1001&amp;goodsId=${number}')</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">1001</span>:&nbsp;<span data-darkreader-inline-color="">this</span>._adaptToActivityDetailByQrcode<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;éæ‰«ç è¿›å…¥</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsObj&nbsp;=&nbsp;pageOptions;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapters&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">// 1002 =&gt;&nbsp;å‰å¾€é¡µé¢ Aã€‚ä¾‹ï¼š?pk=1002&amp;goodsId=${number}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">1002</span>:&nbsp;<span data-darkreader-inline-color="">this</span>._adaptToPageA,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">// 1003 =&gt;&nbsp;å‰å¾€é¡µé¢ Bã€‚ä¾‹ï¼š?pk=1003&amp;userId=${number}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">1003</span>:&nbsp;<span data-darkreader-inline-color="">this</span>._adaptToPageB,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;pk,&nbsp;...options&nbsp;}&nbsp;=&nbsp;optionsObj;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapters[pk]&nbsp;?&nbsp;adapters[pk](options&nbsp;<span data-darkreader-inline-color="">"pk]&nbsp;?&nbsp;adapters[pk"</span>)&nbsp;:&nbsp;reLaunch(<span data-darkreader-inline-color="">'Index'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;_adaptToActivityDetailByQrcode(options)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reLaunch(<span data-darkreader-inline-color="">'ActivityDetail'</span>,&nbsp;<span data-darkreader-inline-color="">`?goodsId=<span data-darkreader-inline-color="">${options.goodsId}</span>&amp;pageFrom=PORTAL`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;_adaptToPageA(options)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reLaunch(<span data-darkreader-inline-color="">'A'</span>,&nbsp;<span data-darkreader-inline-color="">`?goodsId=<span data-darkreader-inline-color="">${options.goodsId}</span>&amp;pageFrom=PORTAL`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;_adaptToPageB(options)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reLaunch(<span data-darkreader-inline-color="">'B'</span>,&nbsp;<span data-darkreader-inline-color="">`?userId=<span data-darkreader-inline-color="">${options.userId}</span>&amp;pageFrom=PORTAL`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>});<br></code>
```

## â­ï¸â­ï¸ å°ç¨‹åºä¸€é”®ä¸Šä¼  & ç‰ˆæœ¬ç®¡ç†

åœ¨å°ç¨‹åºç¨³æ­¥è¿­ä»£åŠå¹´ä¹‹é™…ï¼Œæˆ‘å®åœ¨æ˜¯å—å¤Ÿäº†æ¯æ¬¡éƒ½è¦ä»å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»ä¸Šä¼ æŒ‰é’®ã€å¡«å†™ç‰ˆæœ¬å·ã€å‘å¸ƒçš„æ“ä½œã€‚å¥½åœ¨å¾®ä¿¡æä¾›äº†å®˜æ–¹çš„ CI å·¥å…·<sup data-darkreader-inline-color="">[11]</sup>ï¼Œå› æ­¤æˆ‘å†³å®šç¼–å†™ä¸€ä¸ªè„šæœ¬å®ç°å°ç¨‹åºçš„ä¸€é”®ä¸Šä¼ åŠŸèƒ½ï¼Œå¹¶ä¸”è¿™ä¸ªè„šæœ¬æœ€å¥½èƒ½å¤Ÿä¸€é”®ç»´æŠ¤å°ç¨‹åºç‰ˆæœ¬ã€‚

æ€è·¯å°±æ˜¯å°ç¨‹åºé¡¹ç›®å†…æ”¾ç½®ä¸€ä¸ª env.js æ–‡ä»¶ï¼Œå®ƒä¸“é—¨å‘å¤–æŠ›å‡ºé¡¹ç›®çš„è¿è¡Œç¯å¢ƒå’Œç‰ˆæœ¬å·ä¿¡æ¯è¿™ä¸¤ä¸ªå˜é‡ï¼Œæ‰€æœ‰çš„æ¥å£ã€é…ç½®ç­‰éœ€è¦åŒºåˆ†ç¯å¢ƒçš„æ—¶å€™ï¼Œéƒ½å¯¼å…¥ env.js ä¸­çš„å˜é‡è¿›è¡ŒåŒºåˆ†ã€‚è€Œ env.js åˆ™ç”±ä¸Šä¼ è„šæœ¬è‡ªåŠ¨ç”Ÿæˆå¹¶ç»´æŠ¤ã€‚

è„šæœ¬å¹¶ä¸å¤æ‚ï¼Œä¹Ÿåªéœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š`-e` å’Œ `-s`ã€‚-e è¡¨ç¤ºå°†è¦ä¸Šä¼ çš„å°ç¨‹åºçš„ç¯å¢ƒï¼Œæ”¯æŒ dev, staging å’Œ prod ä¸‰ç§ï¼Œåˆ†åˆ«å¯¹åº”å¼€å‘ã€é¢„å‘å¸ƒå’Œæ­£å¼ï¼›-s åˆ™å¯ä»¥ç»™ä¸‰ä½çš„æ­£å¼ç‰ˆæœ¬å·åé¢æ·»åŠ ä¸€ä¸ªå­ç‰ˆæœ¬å·ï¼Œä¸»è¦ç”¨äºåœ¨å›¢é˜Ÿå†…éƒ¨æ²Ÿé€šã€æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚æµ‹è¯•åŒäº‹å¯ä»¥è®°å½• V4.3.0.1 å‘ç°çš„é—®é¢˜ï¼Œè€Œå¼€å‘äººå‘˜ä¿®å¤ååˆ™å¯ä»¥å‘å¸ƒä¸€ä¸ª V4.3.0.2 çš„æ–°ç‰ˆæœ¬ä»¥ä¾›å›æµ‹ã€‚æ­£å¼ä¸Šçº¿æ—¶åˆ™ä½¿ç”¨ V4.3.0 è¿™ä¸ªä¸‰ä½ç‰ˆæœ¬å·ã€‚

-   `cli/upload.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;shell&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'shelljs'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;chalk&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'chalk'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;Command&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'commander'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;ci&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'miniprogram-ci'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;appid&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'../project.config.json'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;<span data-darkreader-inline-color="">version</span>:&nbsp;mainVersion&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'../package.json'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;path&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'path'</span>);<br><br><span data-darkreader-inline-color="">const</span>&nbsp;program&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;Command();<br>program<br>&nbsp;&nbsp;.option(<span data-darkreader-inline-color="">'-e,&nbsp;--env&nbsp;&lt;type&gt;'</span>,&nbsp;<span data-darkreader-inline-color="">'The&nbsp;environment&nbsp;you&nbsp;want&nbsp;run'</span>,&nbsp;<span data-darkreader-inline-color="">'dev'</span>)<br>&nbsp;&nbsp;.option(<span data-darkreader-inline-color="">'-s,&nbsp;--sub-version&nbsp;&lt;number&gt;'</span>,&nbsp;<span data-darkreader-inline-color="">'Sub&nbsp;version'</span>,&nbsp;<span data-darkreader-inline-color="">'1'</span>)<br>&nbsp;&nbsp;.parse(process.argv);<br><span data-darkreader-inline-color="">const</span>&nbsp;options&nbsp;=&nbsp;program.opts();<br><span data-darkreader-inline-color="">const</span>&nbsp;env&nbsp;=&nbsp;options.env.toUpperCase();<br><span data-darkreader-inline-color="">const</span>&nbsp;subVersion&nbsp;=&nbsp;options.subVersion;<br><br><span data-darkreader-inline-color="">if</span>&nbsp;(![<span data-darkreader-inline-color="">'DEV'</span>,&nbsp;<span data-darkreader-inline-color="">'STAGING'</span>,&nbsp;<span data-darkreader-inline-color="">'PROD'</span>].includes(env))&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.error(<br>&nbsp;&nbsp;&nbsp;&nbsp;chalk.red(<span data-darkreader-inline-color="">`Required&nbsp;option&nbsp;'-e,&nbsp;--env'&nbsp;must&nbsp;be&nbsp;one&nbsp;of&nbsp;'dev',&nbsp;'staging'&nbsp;or&nbsp;'prod'.`</span>)<br>&nbsp;&nbsp;);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>;<br>}<br><span data-darkreader-inline-color="">const</span>&nbsp;fullVersion&nbsp;=<br>&nbsp;&nbsp;env&nbsp;===&nbsp;<span data-darkreader-inline-color="">'PROD'</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${env}</span>-<span data-darkreader-inline-color="">${mainVersion}</span>`</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${env}</span>-<span data-darkreader-inline-color="">${mainVersion}</span>-<span data-darkreader-inline-color="">${subVersion}</span>`</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;envFileCtx&nbsp;=&nbsp;<span data-darkreader-inline-color="">`export&nbsp;const&nbsp;ENV&nbsp;=&nbsp;'<span data-darkreader-inline-color="">${env}</span>';<br>export&nbsp;const&nbsp;VERSION&nbsp;=&nbsp;'<span data-darkreader-inline-color="">${fullVersion}</span>';<br>`</span>;<br><br><span data-darkreader-inline-color="">//&nbsp;é‡æ–°ç¼–è¯‘å°ç¨‹åº</span><br>shell.exec(<span data-darkreader-inline-color="">'cross-env&nbsp;NODE_ENV=production&nbsp;npx&nbsp;gulp&nbsp;build'</span>);<br><span data-darkreader-inline-color="">//&nbsp;éœ€è¦åŒæ—¶å†™å…¥&nbsp;src&nbsp;å’Œ&nbsp;dist&nbsp;ä¸¤ä¸ªç›®å½•</span><br>shell.ShellString(envFileCtx).to(path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'../src/config/env.js'</span>));<br>shell.ShellString(envFileCtx).to(path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'../dist/config/env.js'</span>));<br><br><span data-darkreader-inline-color="">console</span>.log(chalk.blue(<span data-darkreader-inline-color="">`Ready&nbsp;to&nbsp;upload...`</span>));<br><br><span data-darkreader-inline-color="">const</span>&nbsp;project&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;ci.Project({<br>&nbsp;&nbsp;appid,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">'miniProgram'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">projectPath</span>:&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'../dist'</span>),<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">privateKeyPath</span>:&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'../upload.private.key'</span>),<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">ignores</span>:&nbsp;[<span data-darkreader-inline-color="">'**/*.d.ts'</span>,&nbsp;<span data-darkreader-inline-color="">'**/*.md'</span>],<br>});<br><br><span>(<span><span data-darkreader-inline-color="">async</span>&nbsp;(</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;ci.upload({<br>&nbsp;&nbsp;&nbsp;&nbsp;project,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">version</span>:&nbsp;fullVersion,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">desc</span>:&nbsp;<span data-darkreader-inline-color="">`Uploaded&nbsp;at&nbsp;<span data-darkreader-inline-color="">${<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Date</span>().toLocaleString()}</span>`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">setting</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">es6</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">es7</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">minify</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">autoPrefixWXSS</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;onProgressUpdate()&nbsp;{},<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(chalk.green(<span data-darkreader-inline-color="">`Upload&nbsp;Success!&nbsp;New&nbsp;Version:&nbsp;"<span data-darkreader-inline-color="">${fullVersion}</span>".`</span>));<br><br>&nbsp;&nbsp;process.exit();<br>})();<br></code>
```

-   ä»£ç ä¸­ä½¿ç”¨
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;config/env.js</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ENV&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./env'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;BASE_URL_API&nbsp;=&nbsp;ENV&nbsp;===&nbsp;<span data-darkreader-inline-color="">'DEV'</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">'http://prod.com'</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">'https://dev.com'</span>;<br></code>
```

> â
> 
> å…³äºè„šæœ¬ä¸­çš„ `npx gulp build` ç­‰å‘½ä»¤è¯·ç»“åˆä¸‹æ–‡çš„ _**å¼•å…¥ Gulp å·¥ä½œæµ**_ ä¸€èŠ‚ã€‚

## è®¾ç½®å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜ä¸“ç”¨çš„è¾…åŠ©é¡µé¢

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›åŠŸèƒ½å¯èƒ½æ˜¯å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜å¸¸ç”¨çš„ï¼Œæ¯”å¦‚æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯ã€ä¸€é”®æ¸…ç©ºç¼“å­˜ã€è·å–æ–°çš„ login code ç­‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¼€å‘ä¸€ä¸ªä¸“ç”¨çš„é¡µé¢å­˜æ”¾è¿™äº›åŠŸèƒ½ï¼Œè€Œå…¥å£åˆ™ä¾æ®å°ç¨‹åºè¿è¡Œç¯å¢ƒå†³å®šæ˜¯å¦éšè—ã€‚

æˆ‘åœ¨å°ç¨‹åºé¦–é¡µçš„å·¦ä¸‹è§’æ·»åŠ äº†ä¸€ä¸ªå°è§’æ ‡ï¼Œç”¨äºæ ‡è®°å½“å‰å°ç¨‹åºçš„ç‰ˆæœ¬å·å’Œç¯å¢ƒã€‚è§’æ ‡å…·æœ‰é²œæ˜çš„èƒŒæ™¯è‰²ï¼Œå¼€å‘ç¯å¢ƒæ˜¯ç»¿è‰²ï¼Œé¢„å‘å¸ƒç¯å¢ƒæ˜¯çº¢è‰²ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™è¿›è¡Œéšè—ã€‚ç‚¹å‡»è§’æ ‡åˆ™å¯ä»¥è¿›å…¥å¼€å‘å’Œæµ‹è¯•äººå‘˜ä¸“ç”¨çš„ Helper é¡µé¢ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## â­ï¸ å®ç°å°ç¨‹åºä¸­çš„è·¯ç”±ç³»ç»Ÿ

å°ç¨‹åºçš„è·¯ç”±é«˜åº¦ä¾èµ–æ–‡ä»¶å¤¹ç»“æ„ï¼Œæ¯å½“é¡¹ç›®æ–‡ä»¶æ›´æ¢è·¯å¾„ï¼Œå°±éœ€è¦å…¨å±€æŸ¥æ‰¾å¹¶æ›¿æ¢é¡µé¢è·¯å¾„ï¼›å¹¶ä¸” `wx.navigateTo` ç­‰ API æœ¬èº«åªèƒ½æ¥å—å­—ç¬¦ä¸²å½¢å¼çš„è·¯ç”±å‚æ•°ï¼Œå› æ­¤å¸¸å¸¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‹¼æ¥è·¯ç”±å‚æ•°ã€‚ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä» Vue Router ä¸­å¾—åˆ°çµæ„Ÿï¼Œå°è£…äº†ä¸€å¥—ç®€æ˜“çš„è·¯ç”±ç³»ç»Ÿã€‚

æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç»™æ‰€æœ‰çš„é¡µé¢å–ä¸ªåå­—ï¼Œæ”¾è¿›ä¸€ä¸ªè·¯ç”±å¯¹è±¡ä¸­ï¼Œæ ¼å¼ä¸º `{ routeName: 'routePath' }`ã€‚è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œåªéœ€è¦è°ƒç”¨ `Routes[routeName]` å³å¯è·å–çœŸå®è·¯å¾„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ„ç»„ç»‡å°ç¨‹åºæ–‡ä»¶å¤¹ç»“æ„ï¼Œè€Œä¸ä¼šå½±å“é€»è¾‘ä»£ç äº†ã€‚

è‡³äºæ‹¼æ¥å‚æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œæ¥å—å¯¹è±¡ç±»å‹çš„å‚æ•°ï¼Œå¹¶ç»„è£…æˆå­—ç¬¦ä¸²å³å¯ã€‚è€Œå°ç¨‹åºæä¾›çš„å¤šä¸ªè·¯ç”±å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªé«˜é˜¶å‡½æ•°å³å¯ç”Ÿæˆï¼Œä¸éœ€è¦æ¯ä¸ªéƒ½å•ç‹¬å°è£…ä¸€éã€‚

-   `router/routes.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;Routes&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Index</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/index/index'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Activities</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/tabs/activities/activities'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Mine</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/tabs/mine/mine'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Portal</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/portal/portal'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Login</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/login/login'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Helper</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/helper/helper'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Address</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/profiles/address/address'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">Setting</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/profiles/setting/setting'</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;å°¤å…¶é€‚ç”¨äºè¿™ç§é•¿è·¯å¾„ï¼</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">ArticleDetail</span>:&nbsp;<span data-darkreader-inline-color="">'/subpackages/rickTextRender/pages/articleDetail/articleDetail'</span>,<br>};<br></code>
```

-   `router/router.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;Routes&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./routes'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;getRouteUrl&nbsp;=&nbsp;<span>(<span>routeName</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;targetRoute&nbsp;=&nbsp;Routes[routeName];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!targetRoute)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.error(<span data-darkreader-inline-color="">`The&nbsp;RouteName&nbsp;must&nbsp;be&nbsp;one&nbsp;of:&nbsp;<span data-darkreader-inline-color="">${<span data-darkreader-inline-color="">Object</span>.keys(Routes).join(<span data-darkreader-inline-color="">',&nbsp;'</span>)}</span>`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;targetRoute;<br>};<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;buildParams&nbsp;=&nbsp;<span>(<span>params</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;fullParamStr;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!params)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;fullParamStr&nbsp;=&nbsp;<span data-darkreader-inline-color="">''</span>;<br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">typeof</span>&nbsp;params&nbsp;===&nbsp;<span data-darkreader-inline-color="">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;fullParamStr&nbsp;=&nbsp;params;<br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;fullParamStr&nbsp;=&nbsp;<span data-darkreader-inline-color="">Object</span>.keys(params)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.map(<span>(<span>key,&nbsp;index</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;prefix&nbsp;=&nbsp;index&nbsp;===&nbsp;<span data-darkreader-inline-color="">0</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">`?`</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">`&amp;`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${prefix}</span><span data-darkreader-inline-color="">${key}</span>=<span data-darkreader-inline-color="">${params[key]}</span>`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.join(<span data-darkreader-inline-color="">''</span>);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;fullParamStr;<br>};<br><br><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;é«˜é˜¶å‡½æ•°æ„å»ºè·¯ç”±è·³è½¬æ¨¡å—<br>&nbsp;&nbsp;*&nbsp;@param&nbsp;{Function}&nbsp;method<br>&nbsp;&nbsp;*/</span><br><span data-darkreader-inline-color="">const</span>&nbsp;generateRoute&nbsp;=&nbsp;<span>(<span>method</span>)&nbsp;=&gt;</span>&nbsp;<span>(<span>routeName,&nbsp;params,&nbsp;events</span>)&nbsp;=&gt;</span><br>&nbsp;&nbsp;method({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">url</span>:&nbsp;getRouteUrl(routeName)&nbsp;+&nbsp;buildParams(params),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">events</span>:&nbsp;events&nbsp;??&nbsp;<span data-darkreader-inline-color="">null</span>,<br>&nbsp;&nbsp;});<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;switchTab&nbsp;=&nbsp;generateRoute(wx.switchTab);<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;reLaunch&nbsp;=&nbsp;generateRoute(wx.reLaunch);<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;navigateTo&nbsp;=&nbsp;generateRoute(wx.navigateTo);<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;redirectTo&nbsp;=&nbsp;generateRoute(wx.redirectTo);<br></code>
```

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²å‚æ•°</span><br>navigateTo(<span data-darkreader-inline-color="">'ActivityDetail'</span>,&nbsp;<span data-darkreader-inline-color="">`?goodsId=<span data-darkreader-inline-color="">${goodsId}</span>`</span>);<br><br><span data-darkreader-inline-color="">//&nbsp;å¯¹è±¡å½¢å¼ä¼ å‚</span><br>navigateTo(<span data-darkreader-inline-color="">'CommentDetail'</span>,&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">client</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.commentClient,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">topicId</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.data.reportId,<br>&nbsp;&nbsp;commentId<br>});<br><br><span data-darkreader-inline-color="">//&nbsp;æ”¯æŒ&nbsp;EventChannel</span><br>navigateTo(<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">'Address'</span>,<br>&nbsp;&nbsp;{&nbsp;<span data-darkreader-inline-color="">pageFrom</span>:&nbsp;<span data-darkreader-inline-color="">'POINT_MALL_SUBMIT'</span>&nbsp;},<br>&nbsp;&nbsp;{&nbsp;<span data-darkreader-inline-color="">addressSubmitted</span>:&nbsp;<span data-darkreader-inline-color="">this</span>.initAddressForm.bind(<span data-darkreader-inline-color="">this</span>)&nbsp;}<br>);<br></code>
```

## æŒ‰ç…§å°±è¿‘åŸåˆ™ç»„ç»‡é¡¹ç›®

åœ¨é¡¹ç›®åˆæœŸï¼Œæˆ‘æ˜¯å‡ ä¹å¯¹ç…§ Vue CLI é¡¹ç›®ç»„ç»‡ä»£ç ï¼Œæ¯”å¦‚æŠŠç»„ä»¶éƒ½æ”¾åœ¨ components æ–‡ä»¶å¤¹ä¸‹ï¼ŒæŠŠå›¾ç‰‡å’Œå›¾æ ‡æ”¾åœ¨ assets æ–‡ä»¶å¤¹ä¸‹ï¼Œä½†éšç€é¡¹ç›®ä¸­çš„ç»„ä»¶å’Œæ–‡ä»¶è¶Šæ¥è¶Šå¤šï¼Œcomponents å’Œ assets ç›®å½•ä¸‹å‡ºç°äº†å¤§é‡åªç”¨åˆ°ä¸€æ¬¡çš„ç»„ä»¶å’Œå›¾ç‰‡ã€‚

ç”±äºå°ç¨‹åºä¸¥æ ¼é™åˆ¶æ¯ä¸ªåŒ…æœ€å¤§åªæœ‰ 2Mï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ æ³¨é‡é¡¹ç›®ä½“ç§¯ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æ˜¯å¦å¤ç”¨æŠŠç»„ä»¶å’Œé™æ€èµ„æºè¿›è¡Œé‡æ–°ç»„ç»‡ï¼Œåªåœ¨é¡µé¢ä¸­ä½¿ç”¨ä¸€æ¬¡çš„ç»„ä»¶æˆ–èµ„æºæ”¾ç½®åœ¨é¡µé¢åŒçº§ä¸‹ï¼Œè€ŒçœŸæ­£è¢«å¤šæ¬¡å¤ç”¨çš„ç»„ä»¶å’Œèµ„æºæ‰æ”¾ç½®åœ¨ compoents å’Œ assets ä¸­ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æŸä¸ªé¡µé¢åºŸå¼ƒæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»é™¤è¿™ä¸ªé¡µé¢æ–‡ä»¶å¤¹ï¼Œå½“å‰é¡µé¢ç‹¬äº«çš„ç»„ä»¶å’Œèµ„æºå°†è¢«ä¸€èµ·ç§»é™¤ã€‚

## æƒé™æ¨¡å—

æˆ‘æŠŠå°ç¨‹åºé¡¹ç›®ä¸­æ‰€æœ‰æˆæƒå’Œæƒé™ç›¸å…³é€»è¾‘å…¨éƒ¨æ”¾ç½®åœ¨ `utils/Auth.js` ä¸­ã€‚

### å¾®ä¿¡æˆæƒç»Ÿä¸€ç®¡ç†

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šå’Œå¾®ä¿¡æˆæƒæ‰“äº¤é“ã€‚ç”¨æˆ·æˆæƒæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿåœ¨æ•´ä¸ªå°ç¨‹åºå‘¨æœŸä¸­ï¼Œæœ‰äº›æƒé™åªè¦ç”¨æˆ·æ‹’ç»è¿‡ä¸€æ¬¡å°±æ— æ³•å†æ¬¡å‘èµ·ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·æ‹’ç»æˆæƒåå°½é‡ç»™å‡ºæç¤ºï¼Œå°è¯•å¼•å¯¼ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€æˆæƒã€‚

-   `utils/Auth.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;åˆ¤æ–­å¾®ä¿¡çš„æŸä¸ªæƒé™æ˜¯å¦æˆæƒé€šè¿‡ï¼Œä¼šè‡ªåŠ¨è°ƒèµ·æˆæƒå¼¹çª—ä»¥åŠæ˜¾ç¤ºæ‹’ç»å¼•å¯¼<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@param&nbsp;<span data-darkreader-inline-color="">{String}</span>&nbsp;</span>scope&nbsp;&lt;https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/AuthSetting.html&gt;<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@param&nbsp;<span data-darkreader-inline-color="">{Boolean}</span>&nbsp;</span>withRejectGuide&nbsp;æ˜¯å¦æ˜¾ç¤ºæ‹’ç»åçš„å†æ¬¡æˆæƒå¼•å¯¼<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@returns&nbsp;<span data-darkreader-inline-color="">{Boolean}</span>&nbsp;</span>æ˜¯å¦æˆæƒé€šè¿‡<br>&nbsp;&nbsp;*/</span><br><span data-darkreader-inline-color="">static</span>&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;isWxAuthed(scope,&nbsp;withRejectGuide&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;authSetting&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;wxp.getSetting();<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;authResult;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ä»æœªæˆæƒ</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!<span data-darkreader-inline-color="">Object</span>.keys(authSetting).includes(scope))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;å¯¹äº scope.userInfoï¼Œå¦‚æœè¿˜æ²¡æœ‰æˆæƒï¼Œåˆ™ç›´æ¥è¿”å›æˆæƒå¤±è´¥ã€‚</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(scope&nbsp;===&nbsp;<span data-darkreader-inline-color="">'scope.userInfo'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authResult&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;wxp.authorize({&nbsp;scope&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authResult&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">catch</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authResult&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æˆæƒé€šè¿‡</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(authSetting[scope])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;authResult&nbsp;=&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æˆæƒæ‹’ç»</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;authResult&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(scope&nbsp;!==&nbsp;<span data-darkreader-inline-color="">'scope.userInfo'</span>&nbsp;&amp;&amp;&nbsp;!authResult&nbsp;&amp;&amp;&nbsp;withRejectGuide)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;wxp.showModal({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'æ— æ­¤æƒé™'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">content</span>:&nbsp;<span data-darkreader-inline-color="">'è¯·ç‚¹å‡»å³ä¸Šè§’çš„èœå•ï¼Œç‚¹å‡»è®¾ç½®æŒ‰é’®ï¼Œå³å¯é‡æ–°å¼€å¯æ­¤æƒé™'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;authResult;<br>}<br></code>
```

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">async</span>&nbsp;onSaveQrcode()&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;isAuthed&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;Auth.isWxAuthed(<span data-darkreader-inline-color="">'scope.writePhotosAlbum'</span>);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isAuthed)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;wx.saveImageToPhotosAlbum({&nbsp;<span data-darkreader-inline-color="">filePath</span>:&nbsp;<span data-darkreader-inline-color="">'/pages/static/pickGroup/qrcode.jpg'</span>&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'ä¿å­˜æˆåŠŸ'</span>&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">catch</span>&nbsp;(e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'ä¿å­˜å¤±è´¥'</span>,&nbsp;<span data-darkreader-inline-color="">icon</span>:&nbsp;<span data-darkreader-inline-color="">'none'</span>&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code>
```

### â­ï¸â­ï¸ ç”¨æˆ·ç™»å½•æ‹¦æˆª

éšç€å°ç¨‹åºé¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘ç”¨æˆ·ç™»å½•æ“ä½œçš„å„ç§æ—¶æœºã€‚é¡¹ç›®æ—©æœŸï¼Œç”¨æˆ·ç™»å½•æ“ä½œåˆ†å¸ƒåœ¨å„ç§åœ°æ–¹ï¼Œæ¯”å¦‚æ´»åŠ¨é¡µçš„æŸä¸ªæŒ‰é’®å¯èƒ½ä¼šè§¦å‘ç™»å½•ã€â€œæˆ‘çš„â€ é¡µé¢çš„å¤´åƒä¹Ÿä¼šè§¦å‘ç™»å½•ï¼Œè€Œç‚¹å‡»ä»»æ„ä¸€ä¸ªèœå•ä¹Ÿæœ‰å¯èƒ½è§¦å‘ç™»å½•ã€‚è¿™ç§åˆ†æ•£çš„æ“ä½œç»™é¡¹ç›®ç»´æŠ¤å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ã€‚

åç»­æˆ‘ä»¬å†³å®šå°†ç”¨æˆ·çš„ç™»å½•æ“ä½œæ”¶æ•›åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ç™»å½•é¡µé¢ï¼Œåªè¦éœ€è¦ç”¨æˆ·è¿›è¡Œç™»å½•ï¼Œå°±å…¨éƒ¨é‡å®šå‘åˆ°ç™»å½•é¡µè¿›è¡Œç™»å½•ã€‚å¹¶ä¸”ç”±äºæˆ‘ä»¬ä¼šåœ¨ç”¨æˆ·ç™»å½•åè®°å½•ç”¨æˆ·çš„ openidï¼Œå› æ­¤ç”¨æˆ·é‡æ–°è¿›å…¥å°ç¨‹åºåï¼ˆåŒ…æ‹¬åˆ é™¤å°ç¨‹åºå†è¿›å»ï¼‰ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ openid è·å–ç”¨æˆ·ä¿¡æ¯å®ç°å°ç¨‹åºç«¯çš„ç™»å½•ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åœ¨æ•´ä¸ªä½¿ç”¨å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œæ‰€ä»¥æ­¤å¤„çš„ç™»å½•å…¶å®æ›´åƒæ˜¯â€œæ³¨å†Œâ€æ“ä½œã€‚**

> â
> 
> ä» 2021 å¹´ 2 æœˆ 23 æ—¥èµ·ï¼Œå°ç¨‹åºå¯ä»¥é€šè¿‡ wx.login æ¥å£ç›´æ¥è·å–ç”¨æˆ·çš„ unionIdï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­åº”å½“ä½¿ç”¨ unionId ä½œä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†è€Œé openidã€‚

_**å…·ä½“å®ç°æ€è·¯ï¼š**_

1.  åœ¨ app.js ä¸­åˆå§‹åŒ–ç”¨æˆ·ç™»å½•çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ° localStorage ä¸­ã€‚æ¯”å¦‚æœªç™»å½•å°±ä¿å­˜ `is_logged` å€¼ä¸º false
    
2.  **å°è£… `requireLogged` æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœç”¨æˆ·å·²ç™»å½•åˆ™ç›´æ¥æ‰§è¡Œå›è°ƒï¼Œæ²¡æœ‰åˆ™è·³è½¬åˆ°ç™»å½•é¡µã€‚**ä¹Ÿå°±æ˜¯ç”¨ `requireLogged` æ–¹æ³•åŒ…è£¹ç™»å½•åæ‰§è¡Œçš„é€»è¾‘ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ç»“åˆ `wx.navigateTo` å’Œ EventChannel<sup data-darkreader-inline-color="">[12]</sup> å…±åŒå®ç°ï¼Œæ³¨æ„ navigateTo çš„ç¬¬ä¸‰ä¸ªå‚æ•°å³æ˜¯ç›‘å¬ç™»å½•å®Œæ¯•äº‹ä»¶
    

> â
> 
> è¿™ç§æ–¹æ¡ˆæœ‰ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯¹äºå¼€å‘äººå‘˜æ¥è¯´å‡ ä¹æ— æ„Ÿï¼Œåªéœ€è¦æŠŠåŸæ¥çš„é€»è¾‘ç”¨å‡½æ•°åŒ…è£¹ä¸€ä¸‹å¤åˆ¶åˆ° requireLogged ä¸­é—´å³å¯ã€‚

-   `utils/Auth.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;è¦æ±‚ç”¨æˆ·æ³¨å†Œåæ‰§è¡Œã€‚ç»“åˆ eventChannel å®ç°æ³¨å†Œåç«‹å³æ‰§è¡Œ<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@param&nbsp;<span data-darkreader-inline-color="">{Function}</span>&nbsp;</span>cb&nbsp;éœ€è¦æ³¨å†Œåæ‰§è¡Œçš„å›è°ƒå‡½æ•°<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@param&nbsp;<span data-darkreader-inline-color="">{boolean}</span>&nbsp;</span>immediateDoCb&nbsp;æ³¨å†Œåæ˜¯å¦ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°<br>&nbsp;&nbsp;*&nbsp;<span data-darkreader-inline-color="">@param&nbsp;<span data-darkreader-inline-color="">{boolean}</span>&nbsp;</span>forceDoLogin&nbsp;æ— è§†æ˜¯å¦å·²æ³¨å†Œï¼Œå¼ºåˆ¶è¿›å…¥æ³¨å†Œé¡µé¢<br>&nbsp;&nbsp;*/</span><br><span data-darkreader-inline-color="">static</span>&nbsp;requireLogged(cb,&nbsp;immediateDoCb&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>,&nbsp;forceDoLogin&nbsp;=&nbsp;<span data-darkreader-inline-color="">false</span>)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(Auth.isLogged()&nbsp;&amp;&amp;&nbsp;!forceDoLogin)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;&amp;&amp;&nbsp;cb();<br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;navigateTo(<span data-darkreader-inline-color="">'Login'</span>,&nbsp;<span data-darkreader-inline-color="">null</span>,&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">logged</span>:&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;immediateDoCb&nbsp;&amp;&amp;&nbsp;cb&nbsp;&amp;&amp;&nbsp;cb();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>}<br></code>
```

3.  åœ¨ Login é¡µé¢å®ç°ç™»å½•é€»è¾‘ï¼Œå½“ç™»å½•æˆåŠŸåï¼š
    
    **æ³¨æ„ï¼šæ­¤å¤„çš„ await ä¸èƒ½çœç•¥ï¼è¿™æ˜¯ç”±äºå‡å¦‚ callback é‡Œé¢çš„æ“ä½œæ˜¯ä¸€ä¸ªé¡µé¢è·³è½¬ï¼Œä¸æ·»åŠ  await åˆ™å¯èƒ½å¼•èµ·é¡µé¢æ ˆæ··ä¹±è€ŒæŠ¥é”™**
    

1.  è¯·æ±‚åå°æ¥å£ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯
    
2.  é‡æ–°æ‰§è¡Œ app.js ä¸­çš„ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–æ–¹æ³•
    
3.  æ‰§è¡Œ `await wx.navigateBack()` è¿”å›ä¸Šä¸€çº§é¡µé¢ã€‚
    

-   `login.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;ç‚¹å‡»ç™»å½•é¡µçš„ç™»å½•æŒ‰é’®è§¦å‘</span><br><span data-darkreader-inline-color="">async</span>&nbsp;onLogin()&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;eventChannel&nbsp;=&nbsp;<span data-darkreader-inline-color="">this</span>.getOpenerEventChannel();<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;res&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;Auth.getUserProfileCtx();<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;Auth.updateUserProfile&nbsp;ä¸»è¦ç”¨æ¥è¯·æ±‚åç«¯çš„æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;Auth.updateUserProfile({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userInfo</span>:&nbsp;res.userInfo,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">loadingMsg</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•ä¸­...'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">retryMsgContent</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•'</span>,<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;app.initUserInfo();<br><br>&nbsp;&nbsp;wx.showToast({&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'ç™»å½•æˆåŠŸ'</span>,&nbsp;<span data-darkreader-inline-color="">duration</span>:&nbsp;<span data-darkreader-inline-color="">500</span>&nbsp;});<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;asyncTimeout(<span data-darkreader-inline-color="">500</span>);<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;æ³¨æ„ï¼Œæ­¤å¤„&nbsp;await&nbsp;ä¸èƒ½å»æ‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å›è°ƒäº‹ä»¶å› ä¸ºé¡µé¢æ ˆé”™ä¹±è€Œå¼‚å¸¸</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;wx.navigateBack();<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ç™»å½•åé‡æ–°æäº¤å·²ç™»å½•äº‹ä»¶</span><br>&nbsp;&nbsp;eventChannel.emit(<span data-darkreader-inline-color="">'logged'</span>);<br>},<br></code>
```

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;ä¸€ä¸ªç”¨æˆ·ç‚¹èµæ“ä½œã€‚æœªç™»å½•æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼Œå·²ç™»å½•åˆ™ç›´æ¥è§¦å‘ç‚¹èµ</span><br>Auth.requireLogged(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.triggerEvent(<span data-darkreader-inline-color="">'click-like'</span>);<br>},<br><span data-darkreader-inline-color="">//&nbsp;å®Œæˆç™»å½•åç›´æ¥å†æ¬¡è§¦å‘ç‚¹èµæ“ä½œ</span><br><span data-darkreader-inline-color="">true</span>);<br></code>
```

## â­ï¸â­ï¸ å¼•å…¥ Gulp å·¥ä½œæµ

åœ¨å°ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ ·å¼ç¼–å†™å¤§æ¦‚æ˜¯æ°¸è¿œçš„ç—›ç‚¹ä¹‹ä¸€ã€‚åœ¨é¢å¯¹è¶Šå‘å¤æ‚çš„æ ·å¼éœ€æ±‚æ—¶ï¼Œå°ç¨‹åºçš„ wxss å¾ˆéš¾æ»¡è¶³æˆ‘çš„è¦æ±‚ã€‚å› æ­¤æˆ‘å°è¯•åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ Scss è¯­æ³•ç¼–å†™æ ·å¼ï¼Œåœ¨ä¸€ç³»åˆ—å¯¹æ¯”åï¼Œæˆ‘è¿˜æ˜¯é€‰æ‹©äº†æµç•…ç®€å•çš„ Gulpã€‚å½“ç„¶ï¼Œæ—¢ç„¶å¼•å…¥äº† Gulpï¼Œæˆ‘ä»¬å°±å¯ä»¥åšæ›´å¤šèŠ±å“¨çš„æ“ä½œäº†ï¼Œæ¯”å¦‚ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹å¯¹ js å’Œ wxss è¿›è¡Œä»£ç å‹ç¼©ã€æŠŠéƒ¨åˆ†é«˜é˜¶ ES è¯­æ³•è½¬è¯‘ä¸ºä½é˜¶è¯­æ³•ã€ä½¿ç”¨ yaml ä»£æ›¿ json ç¼–å†™é…ç½®ç­‰ã€‚

æˆ‘ä»¬çš„å°ç¨‹åºä¸­æ²¡æœ‰ä½¿ç”¨å¤ªå¤æ‚çš„ Gulp é…ç½®ï¼Œåªæ˜¯ç€é‡æ”¯æŒäº† Scss ä»£ç ç¼–å†™ã€æ ·å¼å’Œ JS ä»£ç å‹ç¼©ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€Œæ„å»ºåçš„äº§ç‰©åˆ™è¾“å‡ºåˆ° dist ç›®å½•ä¸‹ã€‚å¼•å…¥ Gulp åï¼Œå°ç¨‹åºçš„æ”¹åŠ¨å¹¶ä¸å¤§ï¼Œä¸»è¦æ˜¯ï¼š

-   åœ¨ project.config.json ä¸­æŠŠå°ç¨‹åºçš„æ ¹ç›®å½•æ”¹ä¸º distï¼š`"miniprogramRoot": "dist/",`
    
-   ç”±äº Scss æ˜¯ CSS çš„è¶…é›†ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®‰å…¨çš„ç›´æ¥å¯¹è€çš„æ ·å¼æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œæ‰€ä»¥ç›´æ¥è·‘ä¸€ä¸ªè„šæœ¬æŠŠé¡¹ç›®ä¸­çš„ .wxss æ‰¹é‡é‡å‘½åä¸º .scss å°±å®Œäº‹äº†
    
-   æŠŠå¤–éƒ¨æ ·å¼è¡¨ï¼Œå¦‚ vant ä¸­çš„ `common/index.wxss` é‡å‘½åä¸º `common/index.scss`
    

æœ€ç»ˆçš„ç¤ºä¾‹ä»£ç ï¼š

-   `gulpfile.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;path&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'path'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;del&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'del'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;gulp&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp'</span>);<br><span data-darkreader-inline-color="">// Windows å¹³å°ä¸‹ gulp.watch ä¸ç”Ÿæ•ˆï¼Œéœ€è¦ç”¨æ­¤æ’ä»¶æ›¿ä»£ã€‚å¹¶ä¸”æ­¤æ’ä»¶æ€§èƒ½æ›´ä½³</span><br><span data-darkreader-inline-color="">const</span>&nbsp;gulpWatch&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-watch'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;sass&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-dart-sass'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;rename&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-rename'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;terser&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-terser'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;uglifycss&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-uglifycss'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;gulpIf&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'gulp-if'</span>);<br><br><span data-darkreader-inline-color="">const</span>&nbsp;isProd&nbsp;=&nbsp;process.env.NODE_ENV&nbsp;===&nbsp;<span data-darkreader-inline-color="">'production'</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;SRC&nbsp;=&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'./src'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;DIST&nbsp;=&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'./dist'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;PANTONE&nbsp;=&nbsp;path.resolve(__dirname,&nbsp;<span data-darkreader-inline-color="">'./pantone'</span>);<br><br><span data-darkreader-inline-color="">const</span>&nbsp;_clean&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;del(DIST);<br><span data-darkreader-inline-color="">const</span>&nbsp;_copy&nbsp;=&nbsp;<span>(<span>ext</span>)&nbsp;=&gt;</span>&nbsp;gulp.src(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.<span data-darkreader-inline-color="">${ext}</span>`</span>).pipe(gulp.dest(DIST));<br><span data-darkreader-inline-color="">const</span>&nbsp;staticExts&nbsp;=&nbsp;[<span data-darkreader-inline-color="">'png'</span>,&nbsp;<span data-darkreader-inline-color="">'jpg'</span>];<br><span data-darkreader-inline-color="">const</span>&nbsp;_static&nbsp;=&nbsp;gulp.parallel(staticExts.map(<span><span>ext</span>&nbsp;=&gt;</span>&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;_copy(ext)));<br><span data-darkreader-inline-color="">const</span>&nbsp;_wxml&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;_copy(<span data-darkreader-inline-color="">'wxml'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;_wxs&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;_copy(<span data-darkreader-inline-color="">'wxs'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;_json&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;_copy(<span data-darkreader-inline-color="">'json'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;_wxss&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;_copy(<span data-darkreader-inline-color="">'wxss'</span>);<br><span data-darkreader-inline-color="">const</span>&nbsp;_sass&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span><br>&nbsp;&nbsp;gulp<br>&nbsp;&nbsp;&nbsp;&nbsp;.src(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.scss`</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(sass())<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(gulpIf(isProd,&nbsp;uglifycss()))<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(rename({&nbsp;<span data-darkreader-inline-color="">extname</span>:&nbsp;<span data-darkreader-inline-color="">'.wxss'</span>&nbsp;}))<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(gulp.dest(DIST));<br><span data-darkreader-inline-color="">const</span>&nbsp;_js&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;gulp.src(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.js`</span>).pipe(gulpIf(isProd,&nbsp;terser())).pipe(gulp.dest(DIST));<br><span data-darkreader-inline-color="">const</span>&nbsp;_pantone&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span><br>&nbsp;&nbsp;gulp<br>&nbsp;&nbsp;&nbsp;&nbsp;.src(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${PANTONE}</span>/pantone.scss`</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(sass())<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(rename(<span data-darkreader-inline-color="">'variables.css'</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;.pipe(gulp.dest(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${PANTONE}</span>/assets`</span>));<br><br><span data-darkreader-inline-color="">const</span>&nbsp;build&nbsp;=&nbsp;gulp.series(_clean,&nbsp;gulp.parallel(_wxml,&nbsp;_wxs,&nbsp;_json,&nbsp;_wxss,&nbsp;_static,&nbsp;_sass,&nbsp;_js));<br><span data-darkreader-inline-color="">const</span>&nbsp;watch&nbsp;=&nbsp;gulp.series(build,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.wxml`</span>,&nbsp;_wxml);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.wxss`</span>,&nbsp;_wxss);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.wxs`</span>,&nbsp;_wxs);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.json`</span>,&nbsp;_json);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.{<span data-darkreader-inline-color="">${staticExts.join(<span data-darkreader-inline-color="">','</span>)}</span>}`</span>,&nbsp;_static);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.js`</span>,&nbsp;_js);<br>&nbsp;&nbsp;gulpWatch(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${SRC}</span>/**/*.scss`</span>,&nbsp;_sass);<br>});<br><span data-darkreader-inline-color="">const</span>&nbsp;pantone&nbsp;=&nbsp;gulp.series(_pantone);<br><br><span data-darkreader-inline-color="">module</span>.exports&nbsp;=&nbsp;{&nbsp;build,&nbsp;watch,&nbsp;pantone&nbsp;};<br></code>
```

-   `package.json`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">"scripts"</span>:&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"dev"</span>:&nbsp;<span data-darkreader-inline-color="">"NODE_ENV=development&nbsp;npx&nbsp;gulp&nbsp;watch"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"build"</span>:&nbsp;<span data-darkreader-inline-color="">"NODE_ENV=production&nbsp;npx&nbsp;gulp&nbsp;build"</span><br>},<br></code>
```

## â­ï¸ ä½¿ç”¨ CSS å˜é‡

ä¸ºäº†è®©é¡¹ç›®ä¸­çš„å„ç§é¢œè‰²ã€å­—å·æ›´åŠ ç»Ÿä¸€ï¼Œæˆ‘ä»¬æœ‰å¿…è¦æå‰å®šä¹‰å¥½ä¸€äº›å¯ç”¨çš„è‰²å€¼å­—å·ã€‚æ¯”èµ· Scss å˜é‡ï¼Œæˆ‘æ›´æ¨èåœ¨é¡¹ç›®ä¸­ä½¿ç”¨åŸç”Ÿçš„ CSS å˜é‡ã€‚

-   Example
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">// styles/_reset.scss<br>page {<br>  // å®šä¹‰ CSS å˜é‡<br>  --color-primary: #fbd45f;<br>  --size-base: 28rpx;<br><br>  // ...<br>}<br><br>view {<br>  box-sizing: border-box;<br>}<br></code>
```

ç„¶è€Œï¼Œå½“é¡¹ç›®ä¸­ä½¿ç”¨çš„ CSS å˜é‡è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ Scss è‡ªåŠ¨ç”Ÿæˆ CSS å˜é‡ã€‚ä¸‹é¢çš„ä»£ç å¤§å¹…å‚è€ƒäº† Bootstrap<sup data-darkreader-inline-color="">[13]</sup>ã€‚å¦å¤–ï¼Œå¦‚æœä½ æƒ³æ›´æ·±å…¥çš„äº†è§£ Scssï¼Œæˆ‘ä¹Ÿå¼ºçƒˆå»ºè®®ä½ é˜…è¯» Bootstrap çš„æºç ï¼ŒçœŸçš„æ˜¯é›†ä¼˜é›…ä¸èŠ±å“¨äºä¸€èº«ã€‚

-   `styles/_functions.scss`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">// Tint a color: mix a color with white<br>@function tint-color($color, $weight) {<br>  @return mix(white, $color, $weight);<br>}<br><br>// Shade a color: mix a color with black<br>@function shade-color($color, $weight) {<br>  @return mix(black, $color, $weight);<br>}<br></code>
```

-   `styles/_variables.scss`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">@import 'functions';<br><br>@mixin use-css-variables() {<br>  // ===============================================<br>  // Size<br>  // ===============================================<br>  $css-variable-prefix-size: size-;<br><br>  $size-base: 28rpx; // é»˜è®¤<br>  $size-master: 36rpx; // æœ€é«˜çº§æ ‡é¢˜ã€ç”¨æˆ·åã€tab é€‰ä¸­ç­‰<br>  $size-title: 32rpx; // æ ‡é¢˜ã€tab æœªé€‰ä¸­ç­‰<br>  $size-secondary: 24rpx; // æç¤ºã€æ¬¡çº§æ–‡å­—ã€æ¬¡çº§æŒ‰é’®ç­‰<br>  $size-label: 22rpx; // æ ‡ç­¾ã€æ—¥æœŸã€ç‚¹èµæ•°é‡ã€æç¤ºç­‰<br><br>  $special-sizes: (<br>    'base': $size-base,<br>    'master': $size-master,<br>    'title': $size-title,<br>    'secondary': $size-secondary,<br>    'label': $size-label,<br>  );<br><br>  @each $size, $value in $special-sizes {<br>    --#{$css-variable-prefix-size}#{$size}: #{$value};<br>  }<br><br>  // ===============================================<br>  // Color<br>  // ===============================================<br>  $css-variable-prefix-color: color-;<br><br>  // ========== Themes ==========<br>  $color-primary: #fbd45f;<br>  $color-gray: #888;<br>  $color-yellow: #f7dc00;<br>  $color-blue: #5a94e3;<br>  $color-red: #ee0a24;<br><br>  $theme-colors: (<br>    'primary': $color-primary,<br>    'gray': $color-gray,<br>    'blue': $color-blue,<br>    'red': $color-red,<br>    'yellow': $color-yellow,<br>  );<br><br>  @each $color, $value in $theme-colors {<br>    --#{$css-variable-prefix-color}#{$color}: #{$value};<br><br>    @for $i from 1 through 9 {<br>      @if $i&lt;5 {<br>        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{tint-color($value, 100% - $i * 20%)};<br>      } @else if $i == 5 {<br>        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{$value};<br>      } @else {<br>        --#{$css-variable-prefix-color}#{$color}-#{$i*100}: #{shade-color($value, ($i - 5) * 20%)};<br>      }<br>    }<br>  }<br>}<br></code>
```

-   `styles/_reset.scss`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">@import 'variables';<br><br>page {<br>  // å¼•å…¥é¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨çš„ css å˜é‡<br>  @include use-css-variables();<br><br>  height: 100%;<br>  ...<br>}<br></code>
```

-   é¡µé¢ä¸­ä½¿ç”¨
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&amp;-placeholder {<br>  font-size: 28rpx;<br>  color: var(--color-gray-300);<br>}<br></code>
```

## å¼•å…¥ Stylelint å®ç°æ ·å¼ä»£ç æ£€æŸ¥

å°ç¨‹åºå¼•å…¥ Gulp å·¥ä½œæµåå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ Scss ç¼–å†™æ ·å¼äº†ã€‚è€Œå½“æˆ‘é‡æ–°æ•´ç†æ ·å¼ä»£ç æ—¶æ‰å‘ç°é¡¹ç›®ä¸­çš„æ ·å¼ä»£ç é‡å·²ç»éå¸¸å¯è§‚ï¼Œæˆ‘ä»¬æœ€å¥½è¿›ä¸€æ­¥å¯¹æ ·å¼ä»£ç è¿›è¡Œè§„èŒƒï¼Œå› æ­¤æˆ‘ä¹Ÿåœ¨å°ç¨‹åºé¡¹ç›®ä¸­å¼•å…¥äº† Stylelintã€‚

ä¸ ESLint ç±»ä¼¼ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.stylelintrc.js` å’Œ `.stylelintignore` è¿›è¡Œä¸€ç‚¹ç‚¹é…ç½®ã€‚

-   `.stylelintrc.js`
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">module</span>.exports&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">extends</span>:&nbsp;[<span data-darkreader-inline-color="">'stylelint-config-standard'</span>,&nbsp;<span data-darkreader-inline-color="">'stylelint-config-recess-order'</span>],<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">plugins</span>:&nbsp;[<span data-darkreader-inline-color="">'stylelint-order'</span>],<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">rules</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'selector-type-no-unknown'</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">ignoreTypes</span>:&nbsp;[<span data-darkreader-inline-color="">'page'</span>,&nbsp;<span data-darkreader-inline-color="">'scroll-view'</span>,&nbsp;<span data-darkreader-inline-color="">'block'</span>],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'unit-no-unknown'</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">ignoreUnits</span>:&nbsp;[<span data-darkreader-inline-color="">'rpx'</span>],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'at-rule-no-unknown'</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">ignoreAtRules</span>:&nbsp;[<span data-darkreader-inline-color="">'function'</span>,&nbsp;<span data-darkreader-inline-color="">'if'</span>,&nbsp;<span data-darkreader-inline-color="">'else'</span>,&nbsp;<span data-darkreader-inline-color="">'for'</span>,&nbsp;<span data-darkreader-inline-color="">'each'</span>,&nbsp;<span data-darkreader-inline-color="">'include'</span>,&nbsp;<span data-darkreader-inline-color="">'mixin'</span>,&nbsp;<span data-darkreader-inline-color="">'return'</span>],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'no-empty-source'</span>:&nbsp;[<span data-darkreader-inline-color="">true</span>,&nbsp;{&nbsp;<span data-darkreader-inline-color="">severity</span>:&nbsp;<span data-darkreader-inline-color="">'warning'</span>&nbsp;}],<br>&nbsp;&nbsp;},<br>};<br></code>
```

## å¼•å…¥åˆ†åŒ…æœºåˆ¶

åœ¨é¡¹ç›®è¿­ä»£ä¸¤ä¸ªå¤§ç‰ˆæœ¬åï¼Œå°ç¨‹åºä½“ç§¯å·²ç»è¾¾åˆ°äº† 985KB å·¦å³ï¼Œå¯¹äºä½“ç§¯çš„ä¼˜åŒ–è¿«åœ¨çœ‰ç«ã€‚ä»”ç»†åˆ†æå‘ç°ï¼Œå…‰æ˜¯ç”¨äºè§£æå¯Œæ–‡æœ¬çš„ towxml ä¾èµ–å°±å äº† 337KBï¼Œè€Œè¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨é¢‘ç‡å®é™…ä¸Šéå¸¸ä½ã€‚

å› æ­¤è¿‘æœŸå°ç¨‹åºå°†ä½¿ç”¨åˆ°å¯Œæ–‡æœ¬çš„æ¨¡å—å’Œç§¯åˆ†å•†åŸæ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼Œä½¿ç”¨äº†å°ç¨‹åºåˆ†åŒ…æœºåˆ¶<sup data-darkreader-inline-color="">[14]</sup>ã€‚ä½¿ç”¨åˆ†åŒ…åï¼Œå°ç¨‹åºä¸»åŒ…ä½“ç§¯ä¸‹é™è‡³ 631KBã€‚æœªæ¥çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä¹Ÿåº”è¯¥ç§¯æè€ƒè™‘ä½¿ç”¨å°ç¨‹åºåˆ†åŒ…æŠ€æœ¯ï¼Œä¼˜åŒ–ç”¨æˆ·é¦–æ¬¡æ‰“å¼€ä½“éªŒã€‚

## å¼•ç”¨é“¾æ¥

\[1\]

å¼‚æ­¥ API è¿”å› Promise: https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html#API

\[2\]

API Promise åŒ–: https://developers.weixin.qq.com/miniprogram/dev/extended/utils/api-promise.html

\[3\]

SemVer è§„èŒƒ: https://semver.org/lang/zh-CN/

\[4\]

Editorconfig: https://editorconfig.org/

\[5\]

Prettier: https://prettier.io/

\[6\]

Vant Weapp: https://youzan.github.io/vant-weapp/#/home

\[7\]

shelljs: https://www.npmjs.com/package/shelljs

\[8\]

chalk: https://www.npmjs.com/package/chalk

\[9\]

commander.js: https://www.npmjs.com/package/commander

\[10\]

å•å…ƒæµ‹è¯•: https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/unit-test.html

\[11\]

CI å·¥å…·: https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html

\[12\]

EventChannel: https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.html

\[13\]

Bootstrap: https://getbootstrap.com/

\[14\]

å°ç¨‹åºåˆ†åŒ…æœºåˆ¶: https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**ä¹Ÿè®¸ä½ è¿˜æƒ³çœ‹**  

**ï¼ˆâ–¼ç‚¹å‡»æ–‡ç« æ ‡é¢˜æˆ–å°é¢æŸ¥çœ‹ï¼‰**

[

å°ç¨‹åºé¡¹ç›®æ¡†æ¶è¿ç§»å®è·µ

2022-02-17

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

](https://mp.weixin.qq.com/s?__biz=MzU3NTY3MTQzMg==&mid=2247528323&idx=1&sn=ba847bc6e073f21d851fc8c88ab9c81a&chksm=fd1db264ca6a3b7235fd9cb34d3b6715a0f8be79b56ad03df7cd71155337c1fd38fb732043a5&scene=21#wechat_redirect)

[

å‰ç«¯å·¥ç¨‹åŒ–-æ‰“é€ ä¼ä¸šé€šç”¨è„šæ‰‹æ¶

2022-01-13

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

](https://mp.weixin.qq.com/s?__biz=MzU3NTY3MTQzMg==&mid=2247526408&idx=1&sn=80cd1ff8a007b17249f77e94ae0a257b&chksm=fd1db5efca6a3cf9454539d85a474655d672d31f7eb0d1ff610b87620e611af87e0cd9b5df62&scene=21#wechat_redirect)

[

å‰ç«¯é€šç”¨SEOæŠ€æœ¯ä¼˜åŒ–æŒ‡å—

2021-10-07

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

](https://mp.weixin.qq.com/s?__biz=MzU3NTY3MTQzMg==&mid=2247513066&idx=1&sn=15ab76d27f0fd885583d724de6a97195&chksm=fd1d6e0dca6ae71bbb40405c0c6b4bdfd9f120287fc22fdddc2b56c876c1685c828bb7385e43&scene=21#wechat_redirect)

[

Androidè‡ªå®šä¹‰ViewGroupçš„é‚£äº›äº‹å„¿

2021-10-14

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

](https://mp.weixin.qq.com/s?__biz=MzU3NTY3MTQzMg==&mid=2247513585&idx=1&sn=d142068c2a7ee9b2af19653656a3d2d7&chksm=fd1d6816ca6ae1008cdf60aa4924c402ba37b1fbcd8fecb4174879fa61b3d80215012e346fe9&scene=21#wechat_redirect)

[

Androidä¸HEIFæ ¼å¼å›¾ç‰‡é€‚é…æ–¹æ³•

2021-12-02

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

](https://mp.weixin.qq.com/s?__biz=MzU3NTY3MTQzMg==&mid=2247520993&idx=1&sn=adbe1452ae3ba0c7212427cc7f1bbddf&chksm=fd1d4f06ca6ac6105ee3f966105ee6ef775d42702c85b8e892f2bc79200f9c2cd6abd5dba6fe&scene=21#wechat_redirect)