```
<section><mp-common-profile data-pluginname="mpprofile" data-id="MzUxNzk1MjQ0Ng==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/YBFV3Da0Nwvv72YkFO0qPibDKicOCsfltiaE9070DOu4iahXnicYwRIHcxe9VBicAy45MkPqy8nZzLTVibugOtV0ORFcg/300?wx_fmt=png&amp;wxfrom=19" data-nickname="ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—" data-alias="coder_growth" data-signature="ä¸“æ³¨ Node.js æŠ€æœ¯æ ˆåˆ†äº«ï¼Œä» å‰ç«¯ åˆ° Node.js å†åˆ° åç«¯æ•°æ®åº“ï¼Œç¥æ‚¨æˆä¸ºä¼˜ç§€çš„é«˜çº§ Node.js å…¨æ ˆå·¥ç¨‹å¸ˆã€‚ä¸€ä¸ªæœ‰è¶£çš„ä¸”ä¹äºåˆ†äº«çš„äººã€‚åº§å³é“­ï¼šä»Šå¤©æœªå®Œæˆçš„ï¼Œæ˜å¤©æ›´ä¸ä¼šå®Œæˆã€‚" data-from="0" data-is_biz_ban="0" data-origin_num="101" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><section data-darkreader-inline-outline=""><span data-style="padding: 4px 7px; outline: 0px; background: rgb(255, 242, 232); border-color: rgb(255, 187, 150); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(212, 56, 13); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">å¤§å‚æŠ€æœ¯</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;&nbsp;</span><span data-style="padding: 4px 7px; outline: 0px; background: rgb(240, 245, 255); border-color: rgb(173, 198, 255); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(29, 57, 196); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">é«˜çº§å‰ç«¯</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;&nbsp;</span><span data-style="padding: 4px 7px; outline: 0px; background: rgb(246, 255, 237); border-color: rgb(183, 235, 143); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(56, 158, 13); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">Nodeè¿›é˜¶</span></section><pre data-darkreader-inline-outline="" data-darkreader-inline-color=""><p data-darkmode-bgcolor-166718259710710="rgb(25, 25, 25)" data-darkmode-original-bgcolor-166718259710710="#fff|rgb(255, 255, 255)" data-darkmode-color-166718259710710="rgb(163, 163, 163)" data-darkmode-original-color-166718259710710="#fff|rgb(62, 62, 62)" data-style="margin-bottom: 0px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; font-size: 16px; letter-spacing: 2px; text-wrap: wrap; word-spacing: 0.8px; background-color: rgb(255, 255, 255); color: rgb(62, 62, 62); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; caret-color: rgb(51, 51, 51); text-align: center; visibility: visible;" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(168, 168, 168)" data-darkmode-original-color="rgb(62, 62, 62)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">ç‚¹å‡»ä¸Šæ–¹&nbsp;</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">ï¼Œå…³æ³¨å…¬ä¼—å·</span></p><p data-darkmode-bgcolor-166718259710710="rgb(25, 25, 25)" data-darkmode-original-bgcolor-166718259710710="#fff|rgb(255, 255, 255)" data-darkmode-color-166718259710710="rgb(163, 163, 163)" data-darkmode-original-color-166718259710710="#fff|rgb(0, 0, 0)" data-style="margin-bottom: 0px; outline: 0px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; letter-spacing: 2px; text-wrap: wrap; color: rgb(0, 0, 0); word-spacing: 0.8px; background-color: rgb(255, 255, 255); caret-color: rgb(51, 51, 51); text-align: center; visibility: visible;" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">å›å¤</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">1</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">ï¼ŒåŠ å…¥é«˜çº§Nodeäº¤æµç¾¤</span></p></pre>
```

å‰è¨€  

æ¢è®¨äº†ä¸åŒçš„ React çŠ¶æ€ç®¡ç†ç»„ä»¶ï¼ŒåŒ…æ‹¬ Reduxã€Zustandã€Jotaiã€Recoilã€MobX å’Œ Valtioï¼Œå¹¶æ¯”è¾ƒäº†å®ƒä»¬åœ¨è§£å†³ props drilling å’Œ context é€ æˆæ•´ä¸ªå­æ ‘é‡æ–°æ¸²æŸ“çš„é—®é¢˜ä¸Šçš„ä¸åŒæ–¹æ³•å’ŒåŸç†å®ç°ã€‚è¿˜ç®€è¦ä»‹ç»äº† Flux æ¶æ„åŠå…¶å¯¹ React çŠ¶æ€ç®¡ç†çš„å½±å“ã€‚

å…³äºæœ¬æ–‡ä½œè€…ï¼š@Leo Chiu

åŸæ–‡ï¼šhttps://medium.com/æ‰‹å¯«ç­†è¨˜/a-comparison-of-react-state-management-libraries-ba61db07332b

#### React çŠ¶æ€ç®¡ç†

#### çŠ¶æ€ç®¡ç†

React æ˜¯ä¸€ä¸ªå•å‘æ•°æ®æµçš„ libraryï¼Œåœ¨éšç€ç»„ä»¶è¶Šæ¥è¶Šå¤æ‚ä¹‹åï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ç”¨ä¸åŒçš„æ–¹å¼ç®¡ç†çŠ¶æ€ï¼Œä¾‹å¦‚å½“ä¸¤ä¸ªåŒå±‚çº§çš„ Child ç»„ä»¶éœ€è¦å…±ç”¨çŠ¶æ€æ—¶ï¼Œé¦–é€‰çš„ç­–ç•¥æ˜¯ lifting state upï¼Œå°†åŸæœ¬åœ¨ Child çš„çŠ¶æ€ç§»åŠ¨åˆ° Parent ç®¡ç†ï¼Œå†ä» Parent å‘ä¸‹ä¼ é€’åˆ°éœ€è¦å…±ç”¨çŠ¶æ€çš„ Childï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå¸¸è§çš„æƒ…å¢ƒã€‚

å†æ›´å¤æ‚ä¸€ç‚¹çš„æ—¶å€™ï¼Œä¸åŒå±‚çº§çš„ç»„ä»¶æˆ–æ˜¯å¤šå±‚çº§çš„ç»„ä»¶éœ€è¦å…±ç”¨çŠ¶æ€ï¼Œæ ¹æ® lifting state up çš„è§„åˆ™ï¼ŒçŠ¶æ€è¢«ä¸æ–­åœ°è¢«å¾€ä¸Šæä¹‹åï¼ŒçŠ¶æ€ä¼šåœ¨å¤šå±‚çš„ç»„ä»¶ä¹‹é—´ä¼ é€’ï¼Œè¿™ä¾¿æ˜¯ props drilling çš„é—®é¢˜ã€‚

![Image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/meG6Vo0MevgBSNqMoKVFbvyic6SAoztEpyTmy4EeKia8FibgZu3xM0zUYQlQxBNrcXricZ4fKmQiaZRKPoibakhg8cJQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

ä¸ºäº†è§£å†³ props drilling çš„é—®é¢˜ï¼ŒReact æä¾›äº† context å¯ä»¥ç”¨æ¥è·¨ç»„ä»¶ä¼ é€’çŠ¶æ€ï¼ŒåŸºæœ¬ä¸Šç®€å•çš„æƒ…å¢ƒç”¨ context å·²ç»ç»°ç»°æœ‰ä½™ï¼Œå¦‚æœæƒ…å¢ƒå¤æ‚ä¸€ç‚¹ï¼Œæ­é… useReducer ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†çŠ¶æ€ã€‚

ä½†æ˜¯ä½¿ç”¨ context ä¼šé‡åˆ°ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œåƒæ˜¯ provider ä¼ é€’çš„çŠ¶æ€å¦‚æœä¸ä½¿ç”¨ useMemo è·Ÿ useCallback å°è£…ï¼Œä»¥åŠ Child ä¸ä½¿ç”¨ memoï¼Œåœ¨ provider çš„ç»„ä»¶ re-render æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨åˆ° context çš„åœ°æ–¹éƒ½ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚

å¦ä¸€ä¸ªé—®é¢˜åˆ™æ˜¯å¦‚æœ provider ä¼ é€’çš„çŠ¶æ€è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç»å¸¸ä¼šå› ä¸º provider çš„å…¶ä¸­ä¸€çŠ¶æ€æ”¹å˜å¯¼è‡´æ•´é¢—å­æ ‘éƒ½ re-renderã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜åˆ™æ˜¯è¦æŠŠ Provider çš„çŠ¶æ€åˆ‡åˆ†çš„æ›´ç»†ï¼Œç”¨ä¸åŒçš„ Provider åˆ†ç¦»çŠ¶æ€ã€‚ä½†å¦‚æœåˆ†æˆå¤šä¸ª Providerï¼Œéšç€éœ€è¦ç®¡ç†çš„çŠ¶æ€è¶Šæ¥è¶Šå¤šï¼ŒProvider ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œä»‹æ—¶ä¹Ÿä¸å¥½ç®¡ç†ã€‚

##### è¦è§£å†³çš„é—®é¢˜

é‡æ–°æ•´ç†ä¸€ä¸‹ä½¿ç”¨ React åŸç”Ÿçš„çŠ¶æ€ç®¡ç†æœºåˆ¶ä¸»è¦ä¼šé­é‡ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¼šä¸€ç›´æåŠä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼Œè®²åˆ°å„ä¸ªå·¥å…·åŒ…æ€ä¹ˆè§£å†³çš„ï¼š

-   props drilling çš„é—®é¢˜
    
-   context é€ æˆæ•´é¢—å­æ ‘æ¸²æŸ“çš„é—®é¢˜
    

#### ç¬¬ä¸‰æ–¹ç»„ä»¶

React çš„çŠ¶æ€ç®¡ç†ç»„ä»¶æœ‰éå¸¸å¤šé€‰æ‹©ï¼Œä» mental model æ¥è¯´å¯ä»¥åˆ†æˆä¸‰å¤§ç±» Fluxã€Atomicã€Proxyï¼Œè€Œè¢«å®ç°å‡ºæ¥çš„ç»„ä»¶åŒ…æ‹¬ Reduxã€MobXã€Recoilã€Zustandã€ Jotaiã€Valtio ç­‰ç­‰ã€‚

è€Œæˆ‘ä»¬ä»ä¸‹è½½é‡æ¥çœ‹ç›®å‰æ˜¯ Redux è·Ÿ Zustand çš„ä¸‹è½½é‡æœ€å¤šï¼Œå†æ¥æ˜¯ Mobxï¼Œè€Œå¦å¤–ä¸¤ä¸ªå®ç° atomic æœºåˆ¶çš„ Jotai è·Ÿ Recoil æ¯å‘¨ä¸‹è½½é‡å¤§çº¦æ˜¯ 50 ä¸‡å·¦å³ï¼Œæœ€å°‘äººç”¨çš„ Valtio ç›®å‰å·®ä¸å¤šæ˜¯æ¯å‘¨ 30 ä¸‡ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://npmtrends.com/jotai-vs-mobx-vs-recoil-vs-redux-vs-valtio-vs-zustand

åœ¨ä»Šå¹´å¹´åˆçš„æ—¶å€™ signal çªç„¶å˜æˆçƒ­é—¨çš„å…³é”®å­—ä¹‹ä¸€ï¼Œä»¥ React çš„ç”Ÿæ€ç³»æ¥è¯´æœ‰ä¸¤ä¸ªç»„ä»¶ç›¸ç»§å‡ºç°ï¼Œåˆ†åˆ«æ˜¯ @preact/signals ã€ jotai-signalï¼Œä½†ä»ä¸‹è½½é‡æ¥çœ‹ï¼Œç›®å‰ä½¿ç”¨è¿™ä¸¤ä¸ªç»„ä»¶çš„äººæ•°æå°‘ï¼Œåç»­åœ¨æ–‡ä¸­ä¼šæåˆ°ä¸ºä»€ä¹ˆæ¯”è¾ƒå°‘äººä½¿ç”¨çš„åŸå› ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://npmtrends.com/Â jotai-signal-vs-@preact/signals

#### Flux

##### MVC æ¶æ„é‡åˆ°çš„é—®é¢˜

åœ¨ 2014 å¹´ä»¥å‰ï¼ŒFacebook å¤§é‡ä½¿ç”¨äº† MVC æ¶æ„åœ¨ Web ä¸Šï¼Œç„¶è€Œ MVC æ¶æ„è®©æ•´ä¸ªæ•°æ®æµå˜å¾—ç›¸å½“å¤æ‚ï¼Œè€Œä¸”è®©åº”ç”¨ç¨‹åºå˜å¾—éš¾ä»¥æ‰©å±•ï¼ˆscaleï¼‰ï¼Œä¸”æ–°çš„å·¥ç¨‹å¸ˆåŠ å…¥ä¹‹åä¼šéš¾ä»¥ä¸Šæ‰‹ï¼Œå› æ­¤å¾ˆéš¾åœ¨çŸ­æ—¶é—´å†…å°±æœ‰å¾ˆé«˜æ•ˆçš„äº§å‡ºã€‚

ä»¥ä¸‹æ˜¯å½“åˆ Facebook åœ¨ 2014 å¹´åœ¨å‘å¸ƒ Flux è·Ÿ React çš„æ¼”è®²æ—¶ç”¨çš„ä¸€å¼ å›¾ï¼Œè¿™å¼ åŸæ„åº”è¯¥æ˜¯è¦è¡¨æ˜æ•°æ®æµçš„é—®é¢˜ï¼Œä½†æ˜¯åæ¥è®¸å¤šäººéƒ½åœ¨ reddit ä¸Šéƒ½è¯½è°¤è¿™å¼ å›¾ï¼Œè¯´ Facebook çš„å¼€å‘äººå‘˜å¹¶ä¸æ˜¯å¾ˆäº†è§£ MVC æ¶æ„ï¼Œåœ¨ MVC æ¶æ„ä¸­ View è·Ÿ Model æ˜¯ä¸ä¼šåŒå‘æ²Ÿé€šçš„ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://www.youtube.com/watch?v=nYkdrAPrdcw&t=1454s&ab\_channel=MetaDevelopers

ä½†æ¼”è®²çš„ä¸Šä¸‹æ–‡æœ‰æåˆ° Facebook é‡åˆ°çš„é—®é¢˜æ˜¯åœ¨ä¸€ä¸ªé¡µé¢ä¸­çš„è®¸å¤šåŒºå—ï¼ˆViewï¼‰ä¼šä¾èµ–å¤šä¸ªï¼ˆModelï¼‰ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—å¯ä»¥ç†è§£æˆä»–ä»¬æƒ³è§£å†³çš„é—®é¢˜æ˜¯è®©ç”»é¢çš„æ•°æ®å¯ä»¥æ›´å¥½å¾—è¢«ç®¡ç†ã€‚

æ­¤å¤–ï¼Œåœ¨é‚£ä¸ªæ—¶å€™ä»–ä»¬ç”¨çš„æ¡†æ¶æ˜¯ imperative programmingï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é€ æˆ cascading update çš„é—®é¢˜ï¼Œä¼šè®©ä¸€ä¸ª function éœ€è¦ç®¡ç†çŠ¶æ€ï¼Œåˆéœ€è¦ç®¡ç† UIï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œæœ€åå°±æœ‰äº† Flux è·Ÿ React çš„å‡ºç°ã€‚

> è™½ç„¶è¿™å¼ å›¾è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œä½†å¤§å®¶å¯ä»¥è¶…è¯‘ä¸€ä¸‹ï¼Œæƒ³è±¡ä¸€ä¸‹ Facebook çš„å·¥ç¨‹å¸ˆæƒ³è®²ä»€ä¹ˆ ğŸ˜…

ä¸‹é¢è¿™å¼ å›¾æ˜¯ 2014 å¹´å·¦å³æ—¶ Facebook çš„èŠå¤©åŒºï¼Œå¯ä»¥æƒ³è±¡èŠå¤©çš„æ•°æ®ã€æ˜¯å¦å·²è¯»çš„æ•°æ®æ•£è½åœ¨å››ä¸ªåœ°æ–¹ï¼Œä¸ºäº†åŒæ­¥å››ä¸ªåœ°æ–¹çš„æ•°æ®ä»¥åŠç”»é¢çš„ä¸€è‡´æ€§ï¼Œimperative programming ä¼šè®©ä»£ç å˜å¾—éš¾ä»¥é˜…è¯»ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://www.youtube.com/watch?v=nYkdrAPrdcw&t=1454s&ab\_channel=MetaDevelopers

å› æ­¤ï¼ŒFacebook æå‡ºäº† Flux è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å‘æ•°æ®æµçš„æ¶æ„ï¼Œä¸»è¦ç»„æˆæœ‰ dispatcherã€storeã€actionã€view å››ä¸ªéƒ¨åˆ†ã€‚view å®é™…ä¸Šå°±æ˜¯ React æœ¬èº«ï¼Œåœ¨æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ä¼šå‘å‡º actionï¼Œç„¶åç”± dispatcher æ´¾å‘æ›´æ–° store ä¸­å‚¨å­˜çš„çŠ¶æ€ï¼Œæœ€å React ä¼šä½¿ç”¨ store ä¸­çš„è¿™äº›çŠ¶æ€æ”¹å˜ viewã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://github.com/facebookarchive/flux

Flux å¯¹æ¯”äº MVC çš„å‰ç«¯æ¶æ„æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š

-   æ”¹å–„æ•°æ®çš„ä¸€è‡´æ€§
    
-   æ›´å®¹æ˜“æ‰¾å‡ºå“ªé‡Œæœ‰ bug
    
-   å†™å‡ºæ›´å¥½çš„ unit tests
    

ä»¥ä¸Šçš„æ˜¯ä¼˜ç‚¹æ˜¯åœ¨ Facebook å‘è¡¨ React è·Ÿ Flux æ—¶æåˆ°çš„ä¼˜ç‚¹

è¿™äº›ä¼˜ç‚¹åœ¨ç°ä»Šä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯åœ¨éšç€ React è“¬å‹ƒå‘å±•è¿™äº›ä¼˜ç‚¹ä»¿ä½›å·²ç»å˜å¾—ç†æ‰€å½“ç„¶ï¼Œä¸è®ºé€‰æ‹©çš„æ˜¯å“ªä¸ªå¥—ä»¶æˆ–æ˜¯åœ¨ React éƒ½æœ‰è¿™äº›ä¼˜ç‚¹ã€‚

Flux åœ¨åˆæœŸåªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œåæ¥åœ¨ 2015 å¹´çš„æ—¶å€™ Facebook å¼€æºäº† flux è¿™ä¸ªå¥—ä»¶ï¼Œä½†æœ€åè¿˜æ˜¯ç”± Redux æˆä¸ºç°ä»Šæœ€å¤šäººä½¿ç”¨çš„å¥—ä»¶ï¼Œè€Œ flux å¼€æºä¸“æ¡ˆä¹Ÿåœ¨ 2023 å¹´ 3 æœˆçš„æ—¶å€™è¢« archived äº†ï¼Œåœ¨ flux çš„ repo ä¸­ä¹Ÿæåˆ°å¦‚æœéœ€è¦çŠ¶æ€ç®¡ç†çš„å¥—ä»¶ï¼Œå°±å»ä½¿ç”¨ Reduxã€MobXã€Recoilã€Zustand æˆ– Jotai è¿™å‡ ä¸ªå¥—ä»¶ã€‚

ç°åœ¨æœ€å¤šäººä½¿ç”¨çš„çŠ¶æ€ç®¡ç†å¥—ä»¶æ˜¯ Redux è·Ÿ Zustandï¼Œåœ¨ 2023 å¹´ 9 æœˆçš„ç°åœ¨ï¼ŒRedux æ¯å‘¨æœ‰å°†è¿‘ 900 ä¸‡çš„ä¸‹è½½æ¬¡æ•°ï¼ŒåŸºæœ¬ä¸Šåªè¦æƒ³åˆ°çŠ¶æ€ç®¡ç†å°±ä¼šæƒ³åˆ° Reduxã€‚è€Œ Zustand ç›®å‰æ¯å‘¨ä¹Ÿæœ‰ 200 ä¸‡çš„äººæ•°ï¼Œåœ¨ 2019 å¹´å‘å¸ƒä¹‹åï¼Œè‡³ä»Šå·²ç»æ˜¯ç¬¬äºŒå¤šäººä½¿ç”¨çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œæ¯”èµ·è€ç‰Œçš„ Mobx å…¶æ¯å‘¨ä¸‹è½½é‡å¤šäº†å°†è¿‘ä¸€å€ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://npmtrends.com/redux-vs-zustand

#### Redux

Redux æ˜¯åœ¨ 2015 å¹´ç”± Dan Abramov å¼€å‘çš„ä¸€ä¸ªåŸºäº Flux æ¶æ„çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œç›®å‰æ˜¯ä¸ªæ¯å‘¨å°†è¿‘æœ‰ 900 ä¸‡ä¸‹è½½æ¬¡æ•°çš„å¥—ä»¶ï¼Œä¹Ÿæ˜¯å¤§éƒ¨åˆ†çš„äººåœ¨å­¦ä¹  React æ—¶ç¬¬ä¸€ä¸ªä¼šç¢°åˆ°çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ã€‚

åŸç”Ÿçš„ Redux åœ¨è®¾ç½®ä¸ä½¿ç”¨ä¸Šæ¯”è¾ƒçç¢ï¼Œåƒæ˜¯ actionã€reducer ç­‰ç­‰çš„ï¼Œç”šè‡³å¦‚æœæœ‰ TypeScript çš„è¯åœ¨ç±»å‹è®¾ç½®ä¸Šæ›´ä¸ºç¹çï¼Œå¦‚æœæœ‰ä¸€å¤„éœ€è¦ä¿®æ”¹æ—¶å¾€å¾€ä¼šéœ€è¦åŠ¨åˆ°ä¸å°‘çš„åœ°æ–¹ã€‚

è€Œå¯¼å…¥ Redux Toolkit åå¯ä»¥å‡å°‘åˆ›å»º storeã€reducer çš„ boilerplate codeï¼Œå¹¶ä¸”è®©åŸæœ¬æ›´æ–° Redux store ä¸­çš„çŠ¶æ€æ—¶éœ€è¦ä»¥ immutable çš„è¯­æ³•å˜æˆå¯ä»¥ç”¨ mutable çš„æ–¹å¼æ’°å†™ï¼Œæ‰€ä»¥ç°ä»Šä½¿ç”¨ Redux æ—¶é€šå¸¸éƒ½ä¼šåŒæ—¶å¯¼å…¥ RTKã€‚

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> createSlice<span data-darkreader-inline-color="">,</span> configureStore <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'@reduxjs/toolkit'</span><br><br><span data-darkreader-inline-color="">const</span> counterSlice <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">createSlice</span><span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">name</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">'counter'</span><span data-darkreader-inline-color="">,</span><br>  <span data-darkreader-inline-color="">initialState</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">value</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">0</span><br>  <span data-darkreader-inline-color="">},</span><br>  <span data-darkreader-inline-color="">reducers</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">incremented</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">state</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>      state<span data-darkreader-inline-color="">.</span>value <span data-darkreader-inline-color="">+=</span> <span data-darkreader-inline-color="">1</span><br>    <span data-darkreader-inline-color="">},</span><br>    <span data-darkreader-inline-color="">decremented</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">state</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>      state<span data-darkreader-inline-color="">.</span>value <span data-darkreader-inline-color="">-=</span> <span data-darkreader-inline-color="">1</span><br>    <span data-darkreader-inline-color="">}</span><br>  <span data-darkreader-inline-color="">}</span><br><span data-darkreader-inline-color="">})</span><br><br><span data-darkreader-inline-color="">export</span> <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">{</span> incremented<span data-darkreader-inline-color="">,</span> decremented <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">=</span> counterSlice<span data-darkreader-inline-color="">.</span>actions<br><br><span data-darkreader-inline-color="">const</span> store <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">configureStore</span><span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">reducer</span><span data-darkreader-inline-color="">:</span> counterSlice<span data-darkreader-inline-color="">.</span>reducer<br><span data-darkreader-inline-color="">})</span><br><br>store<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">dispatch</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">incremented</span><span data-darkreader-inline-color="">())</span><br>store<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">dispatch</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">decremented</span><span data-darkreader-inline-color="">())</span><br>
```

Redux å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜ ç°åœ¨ Redux é€šå¸¸ä¼šè·Ÿ react-redux ä¸€èµ·ä½¿ç”¨ï¼Œreact-redux æä¾›äº† useSelector è®©æˆ‘ä»¬å¯ä»¥ä» redux store é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„çŠ¶æ€ï¼Œå¹¶ä¸” react-redux ä¼šä¾¦æµ‹é€‰æ‹©çš„çŠ¶æ€æ˜¯å¦æ”¹å˜ï¼Œå¹¶ä¸”è§¦å‘é‡æ–°æ¸²æŸ“ã€‚

ä¾‹å¦‚ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œå½“ counter æ”¹å˜äº†ï¼Œä½†æ˜¯ username æ²¡æœ‰å˜ï¼Œè¿™æ—¶å€™ useSelector çŸ¥é“ counter å‰åçš„å€¼ä¸ä¸€æ ·äº†ï¼Œå› æ­¤ä¼šè§¦å‘æ¸²æŸ“ï¼Œè¿™æ—¶å€™åªæœ‰ ComponentA ä¼šè¢«æ¸²æŸ“ï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> useSelector <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'react-redux'</span><br><br><span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">ComponentA</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> counter <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSelector</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> state<span data-darkreader-inline-color="">.</span>counter<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;{</span>counter<span data-darkreader-inline-color="">}&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span> <br><br><span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">ComponentB</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> username <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSelector</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> state<span data-darkreader-inline-color="">.</span>username<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;{</span>username<span data-darkreader-inline-color="">}&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span><br>
```

åœ¨ 2021 å¹´çš„ä¹‹å‰ react-redux è¿˜æ˜¯ä½¿ç”¨ useReducer å»ºç«‹å¼ºåˆ¶æ¸²æŸ“çš„ function ï¼Œ useSelector ä¼šå…ˆæŠŠ state.counter çš„å€¼å‚¨å­˜èµ·æ¥ï¼Œå½“ä» redux store å–å¾—çš„å€¼æ”¹å˜æ—¶å°±ä¼šä½¿ç”¨ forceRerender() é‡æ–°æ¸²æŸ“è¯¥å…ƒä»¶ã€‚

```
<span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">[,</span> forceRender<span data-darkreader-inline-color="">]</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useReducer</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">s</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> s <span data-darkreader-inline-color="">+</span> <span data-darkreader-inline-color="">1</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">)</span><br>
```

ä½†åœ¨ React 18 çš„ hook å‡ºæ¥ä¹‹åï¼Œreact-redux å°±ä½¿ç”¨äº† useSyncExternalStoreWithSelector ä½œä¸ºä¾¦æµ‹çŠ¶æ€å¹¶é‡æ–°æ¸²æŸ“çš„è§£å†³æ–¹æ¡ˆã€‚

```
<span data-darkreader-inline-color="">import</span> type <span data-darkreader-inline-color="">{</span> useSyncExternalStoreWithSelector <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'use-sync-external-store/with-selector'</span><br>
```

#### Zustand

Zustandï¼ˆå¾·è¯­çš„çŠ¶æ€ï¼‰æ˜¯ç”± Jotai è·Ÿ Valtio çš„ä½œè€… Daishi Kato å¼€å‘çš„ä¸€ä¸ªåŸºäº Flux æ¶æ„çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œå®ƒæ¯” Redux ä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼Œè€Œä¸”å†™èµ·æ¥æ›´ç®€æ´ï¼Œä¸éœ€è¦åƒæ˜¯ Redux ç”¨ context provider å°† store ä¼ é€’ä¸‹å»ï¼Œä¾¿å¯ä»¥è®©å…¨åŸŸä½¿ç”¨ Zustand çš„çŠ¶æ€ã€‚

åœ¨ Zustand ä¸­åªè¦ä½¿ç”¨ create() å°±å¯ä»¥å¿«é€Ÿå»ºç«‹ store è·Ÿ action ï¼Œä¸åƒæ˜¯ Redux åœ¨å»ºç«‹ store æ—¶å³ä½¿ä½¿ç”¨ RTK ä¹Ÿæ˜¯è¦å†™ä¸å°‘çš„ boilerplateï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> create <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'zustand'</span><br><br><span data-darkreader-inline-color="">const</span> useBearStore <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">create</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">set</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">bears</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">,</span><br>  <span data-darkreader-inline-color="">increasePopulation</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">set</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">bears</span><span data-darkreader-inline-color="">:</span> state<span data-darkreader-inline-color="">.</span>bears <span data-darkreader-inline-color="">+</span> <span data-darkreader-inline-color="">1</span> <span data-darkreader-inline-color="">})),</span><br>  <span data-darkreader-inline-color="">removeAllBears</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">set</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">bears</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">0</span> <span data-darkreader-inline-color="">}),</span><br><span data-darkreader-inline-color="">}))</span><br>
```

è€Œè¦è¯»å–çŠ¶æ€ä»¥åŠ dispatch action ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨ create() å»ºç«‹çš„ hook å°±å¯ä»¥å°†çŠ¶æ€è·Ÿ action ä» store ä¸­è¯»å–å‡ºæ¥ï¼š

```
<span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">BearCounter</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> bears <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useBearStore</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> state<span data-darkreader-inline-color="">.</span>bears<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>h1<span data-darkreader-inline-color="">&gt;{</span>bears<span data-darkreader-inline-color="">}</span> around here <span data-darkreader-inline-color="">...&lt;/</span>h1<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span><br><br><span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">Controls</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> increasePopulation <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useBearStore</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> state<span data-darkreader-inline-color="">.</span>increasePopulation<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>button onClick<span data-darkreader-inline-color="">={</span>increasePopulation<span data-darkreader-inline-color="">}&gt;</span>one up<span data-darkreader-inline-color="">&lt;/</span>button<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span><br>
```

è€Œåœ¨ Redux ä¸­ç”šè‡³è¦å…ˆå»ºç«‹ dispatcher çš„ instanceï¼Œè¿˜è¦ import action æ‰èƒ½ä½¿ç”¨ï¼ŒZustand çš„å…¶ä¸­ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ DX æ¯” Redux æ›´å¥½ã€‚

##### Zustand å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜

Zustand è·Ÿ react-redux ä¸€æ ·ï¼Œéƒ½æ˜¯é€è¿‡åˆ¤æ–­ selector çš„å€¼æ˜¯å¦æ”¹å˜äº†ï¼Œå¹¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œ useBearStore ä¼šä¾¦æµ‹ state.bears çš„å€¼æ˜¯å¦æ”¹å˜ï¼Œå½“æ”¹å˜æ—¶ä¼šé‡æ–°æ¸²æŸ“è¯¥å…ƒä»¶ï¼š

```
<span data-darkreader-inline-color="">const</span> bears <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useBearStore</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">state</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> state<span data-darkreader-inline-color="">.</span>bears<span data-darkreader-inline-color="">)</span><br>
```

åœ¨ 2022 å¹´ 8 æœˆä¹‹å‰ï¼ŒZustand ä½¿ç”¨äº† useReducer è‡ªå·±ç»´æŠ¤ forceUpdate() çš„ functionï¼Œä½†æ˜¯ååœ¨ #550 ä¹‹åä½¿ç”¨äº† useSyncExternalStoreWithSelector å–ä»£ä½œä¸ºè§¦å‘æ¸²æŸ“çš„ functionã€‚

ç›®å‰çœ‹åˆ°è¿™é‡Œå‘ç° react-redux è·Ÿ Zustand éƒ½ä½¿ç”¨äº† use-sync-external-store è¿™ä¸ªå¥—ä»¶ï¼Œå®ƒæ˜¯ React 18 çš„å…¶ä¸­ä¸€ä¸ª hookï¼Œä½†ä¹Ÿè¢«åˆ†ç¦»å‡ºæ¥å˜æˆç‹¬ç«‹çš„å¥—ä»¶ï¼Œå°½ç®¡ä¸ç”¨å‡çº§åˆ° React 18 ä¹Ÿå¯ä»¥é€è¿‡å®‰è£…å¥—ä»¶ä½¿ç”¨è¿™ä¸ª hookã€‚

##### Zustand vs Redux

ğŸ‘‰ Download trend

ç°ä»Šåœ¨ç¤¾ç¾¤æ¨èå¦‚æœæƒ³è¦æŒ‘é€‰åŸºäº Flux æ¶æ„çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œä¸å¦¨å¯ä»¥ç›´æ¥é€‰æ‹© Zustandï¼Œè™½ç„¶ä»¥ç›®å‰çš„ç¤¾ç¾¤å£°é‡ä»¥åŠä¸‹è½½é‡ Redux æ¯å‘¨æœ‰ 800 ä¸‡çš„ä¸‹è½½æ¬¡æ•°ï¼Œä½†æ˜¯ä¹Ÿåˆ«å¿˜è®° Zustand ä¹Ÿå·²ç»åˆ°äº†æ¯å‘¨ 200 ä¸‡ã€‚ä»¥å¼€æºé¡¹ç›®å¯ç»´æŠ¤æ€§å·²ç»ç¤¾ç¾¤å¤§å°ï¼ŒZustand ä¸ä»…å¯ä»¥åœ¨å°é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨äº§å“ä¸­ã€‚

ğŸ‘‰ Developer experience

ä»ä»¥ä¸Šå¿«é€Ÿå¼€ç®±çš„èŒƒä¾‹å°±å¯ä»¥çœ‹åˆ°åœ¨ä½¿ç”¨ Zustand æ¯” Redux ç®€å•è®¸å¤šï¼Œä¸éœ€è¦æ’°å†™ç¹æ‚ boilerplateï¼Œä½¿ç”¨ä¸Šä¹Ÿå¾ˆç›´è§‚ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å½“ä½œ custom hook åœ¨ä½¿ç”¨ã€‚

#### Atomic

æ¥ä¸‹æ¥è¦æåŠçš„æ˜¯ä¸€ä¸ªè·Ÿ Flux å¾ˆä¸ä¸€æ ·çš„æ¦‚å¿µ â€” Atomicï¼Œä¹Ÿæ˜¯ Recoil è·Ÿ Jotai çš„åŸºæœ¬æ¦‚å¿µã€‚åœ¨ä¸€å¼€å§‹ Recoil ä»‹ç»å½±ç‰‡ä¸­æƒ³è§£å†³çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼Œ

-   å¦‚æœä½¿ç”¨ context æˆ–æ˜¯ props ä¼ é€’çŠ¶æ€åˆ™ä¼šå®¹æ˜“é€ æˆ re-render çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æœ¬æ–‡ä¸€å¼€å§‹æåˆ°çš„å…¶ä¸­ä¸€ä¸ªé—®é¢˜ï¼›
    
-   å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä½¿ç”¨ context ä¼šè®© code-splitting æ— æ³•åˆ‡åˆ†çš„æ›´ç»†ï¼Œå› ä¸ºæ•´ä¸ª component tree éƒ½ä½¿ç”¨äº† context æˆ– props çš„çŠ¶æ€ã€‚
    

Atomic çš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯æƒ³è®© React çš„çŠ¶æ€ç®¡ç†å¯ä»¥è¢«åˆ†æ•£åœ¨ component tree ä¸­ï¼Œè¿™äº›çŠ¶æ€å°±æ˜¯ atomï¼Œè€Œ atom å¯ä»¥åƒæ˜¯ context å–å¾—çŠ¶æ€ï¼ŒåŒæ—¶åˆå¯ä»¥è®© code-splitting å°†å…ƒä»¶åˆ‡åˆ†çš„æ›´ç»†ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://youtu.be/\_ISAA\_Jt9kI?si=3fzywPPnwL-3sr\_U

#### Recoil

Recoil æ˜¯ç”± Facebook å¼€å‘ä¸ç»´æŠ¤çš„ä¸€ä¸ªå¥—ä»¶ï¼Œåœ¨ 2020 çš„æ—¶å€™è¢«å‘å¸ƒå‡ºæ¥ã€‚Recoil ä¸»è¦æƒ³è§£å†³çš„é—®é¢˜å¦‚ä¸Šè¿°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ context render çš„é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯ code-splitting çš„é—®é¢˜ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå¤§æ¦‚æ˜¯ä¸ºäº†è·Ÿå†…éƒ¨å¤æ‚çš„å¤§å‹ç³»ç»Ÿæ•´åˆï¼ŒRecoil çš„ API éå¸¸çš„ä¸°å¯Œï¼Œå¯ä»¥ç”¨å„ç§æ–¹å¼ä½¿ç”¨ Recoilã€‚

åœ¨å»ºç«‹çŠ¶æ€å¯ä»¥ç”¨ atom è·Ÿ selector ï¼Œ atom å³æ˜¯ä¸€èˆ¬çš„çŠ¶æ€ï¼Œå¦‚ React çš„ stateï¼Œä½†ä¸ useState ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯åœ¨å»ºç«‹ atom æ—¶ä¼šåœ¨ component å¤–é¢ï¼›è€Œ selector æ˜¯æ‹¿æ¥å»ºæ„ derived dataï¼Œå¯ä»¥ä»å¦ä¸€ä¸ª atom ç”Ÿæˆæ–°çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰å†™è¿‡ Vueï¼Œä¹Ÿå¯ä»¥æƒ³åƒæ˜¯ Vue çš„ computed APIã€‚

```
<span data-darkreader-inline-color="">const</span> todoListState <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">key</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">'TodoList'</span><span data-darkreader-inline-color="">,</span><br>  <span data-darkreader-inline-color="">default</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">[],</span><br><span data-darkreader-inline-color="">});</span><br><br><span data-darkreader-inline-color="">const</span> filteredTodoListState <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">selector</span><span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">key</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">'FilteredTodoList'</span><span data-darkreader-inline-color="">,</span><br>  <span data-darkreader-inline-color="">get</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color=""><span data-darkreader-inline-color="">{</span>get<span data-darkreader-inline-color="">}</span></span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">const</span> filter <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">get</span><span data-darkreader-inline-color="">(</span>todoListState<span data-darkreader-inline-color="">);</span><br>    <span data-darkreader-inline-color="">const</span> list <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">get</span><span data-darkreader-inline-color="">(</span>todoListState<span data-darkreader-inline-color="">);</span><br><br>    <span data-darkreader-inline-color="">switch</span> <span data-darkreader-inline-color="">(</span>filter<span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">{</span><br>      <span data-darkreader-inline-color="">case</span> <span data-darkreader-inline-color="">'Show Completed'</span><span data-darkreader-inline-color="">:</span><br>        <span data-darkreader-inline-color="">return</span> list<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">filter</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">item</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> item<span data-darkreader-inline-color="">.</span>isComplete<span data-darkreader-inline-color="">);</span><br>      <span data-darkreader-inline-color="">case</span> <span data-darkreader-inline-color="">'Show Uncompleted'</span><span data-darkreader-inline-color="">:</span><br>        <span data-darkreader-inline-color="">return</span> list<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">filter</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">item</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">!</span>item<span data-darkreader-inline-color="">.</span>isComplete<span data-darkreader-inline-color="">);</span><br>      <span data-darkreader-inline-color="">default</span><span data-darkreader-inline-color="">:</span><br>        <span data-darkreader-inline-color="">return</span> list<span data-darkreader-inline-color="">;</span><br>    <span data-darkreader-inline-color="">}</span><br>  <span data-darkreader-inline-color="">},</span><br><span data-darkreader-inline-color="">});</span><br>
```

ä»¥ä¸‹æ˜¯æ¸²æŸ“ todo list çš„ç¤ºä¾‹ï¼Œæƒ³è¦ä½¿ç”¨çŠ¶æ€æ—¶å¯ä»¥ä½¿ç”¨ useRecoilValue å–å¾— atom çš„å€¼ï¼š

```
<span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">TodoList</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> todoList <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useRecoilValue</span><span data-darkreader-inline-color="">(</span>todoListState<span data-darkreader-inline-color="">);</span><br><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;&gt;</span><br>      <span data-darkreader-inline-color="">{</span>todoList<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">map</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">todoItem</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">(</span><br>        <span data-darkreader-inline-color="">&lt;</span>TodoItem key<span data-darkreader-inline-color="">={</span>todoItem<span data-darkreader-inline-color="">.</span>id<span data-darkreader-inline-color="">}</span> item<span data-darkreader-inline-color="">={</span>todoItem<span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">/&gt;</span><br>      <span data-darkreader-inline-color="">))}</span><br>    <span data-darkreader-inline-color="">&lt;/&gt;</span><br>  <span data-darkreader-inline-color="">);</span><br><span data-darkreader-inline-color="">}</span><br>
```

å¦‚æœæƒ³è¦è®¾å®š atom çš„æ•°å€¼ï¼Œåˆ™æ˜¯å¯ä»¥ä½¿ç”¨ useSetRecoilState è¿™ä¸ª APIï¼Œå®ƒä¼šå›ä¼ ä¸€ä¸ªåƒæ˜¯ setState çš„ functionï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥è®¾å®š atom çš„å€¼ï¼š

```
<span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">TodoItemCreator</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">[</span>inputValue<span data-darkreader-inline-color="">,</span> setInputValue<span data-darkreader-inline-color="">]</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useState</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">''</span><span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">const</span> setTodoList <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSetRecoilState</span><span data-darkreader-inline-color="">(</span>todoListState<span data-darkreader-inline-color="">);</span><br><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">addItem</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">setTodoList</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">oldTodoList</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">[</span><br>      <span data-darkreader-inline-color="">...</span>oldTodoList<span data-darkreader-inline-color="">,</span><br>      <span data-darkreader-inline-color="">{</span><br>        <span data-darkreader-inline-color="">id</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">getId</span><span data-darkreader-inline-color="">(),</span><br>        <span data-darkreader-inline-color="">text</span><span data-darkreader-inline-color="">:</span> inputValue<span data-darkreader-inline-color="">,</span><br>        <span data-darkreader-inline-color="">isComplete</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">false</span><span data-darkreader-inline-color="">,</span><br>      <span data-darkreader-inline-color="">},</span><br>    <span data-darkreader-inline-color="">]);</span><br>    <span data-darkreader-inline-color="">setInputValue</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">''</span><span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">};</span><br><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">onChange</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color=""><span data-darkreader-inline-color="">{</span>target<span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">{</span>value<span data-darkreader-inline-color="">}}</span></span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">setInputValue</span><span data-darkreader-inline-color="">(</span>value<span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">};</span><br><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">&lt;</span>input type<span data-darkreader-inline-color="">=</span><span data-darkreader-inline-color="">"text"</span> value<span data-darkreader-inline-color="">={</span>inputValue<span data-darkreader-inline-color="">}</span> onChange<span data-darkreader-inline-color="">={</span>onChange<span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">/&gt;</span><br>      <span data-darkreader-inline-color="">&lt;</span>button onClick<span data-darkreader-inline-color="">={</span>addItem<span data-darkreader-inline-color="">}&gt;</span>Add<span data-darkreader-inline-color="">&lt;/</span>button<span data-darkreader-inline-color="">&gt;</span><br>    <span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br>  <span data-darkreader-inline-color="">);</span><br><span data-darkreader-inline-color="">}</span><br>
```

å¦‚å‰é¢æ‰€è¯´ï¼ŒRecoil æä¾›çš„ API éå¸¸ä¸°å¯Œï¼Œè¿˜æä¾›äº† useRecoilState ã€ useRecoilStateLoadable ç­‰ç­‰ï¼Œå¦‚æœæœ‰å…´è¶£çš„è¯»è€…åœ¨å»å®˜æ–¹æ–‡ä»¶ä¸Šé¢çœ‹çœ‹å§ï¼

##### Recoil å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜

Recoil è§£å†³æ¸²æŸ“çš„æ–¹å¼åŸºæœ¬ä¸Šä¸ Reduxã€Zustand æœ‰äº›ç›¸ä¼¼ï¼ŒRedux è·Ÿ Zustand éƒ½ä½¿ç”¨äº† selector çš„æœºåˆ¶åˆ¤æ–­é€‰å–çš„å€¼æ—¶å¦æ”¹å˜æ¥è§¦å‘æ¸²æŸ“ã€‚æ¢è¨€ä¹‹ï¼ŒRecoil ä¼šåˆ¤æ–­ atom çš„å€¼æ˜¯å¦æ”¹å˜æ¥è§¦å‘å…ƒä»¶æ¸²æŸ“ï¼Œä¾‹å¦‚ä½¿ç”¨ useRecoilValue æ—¶ä¼šåˆ¤æ–­ todoListState æ˜¯å¦æ”¹å˜äº†ï¼Œè¿›è€Œè§¦å‘æ¸²æŸ“ï¼š

```
<span data-darkreader-inline-color="">const</span> todoList <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useRecoilValue</span><span data-darkreader-inline-color="">(</span>todoListState<span data-darkreader-inline-color="">);</span><br>
```

ä½†æ˜¯ Recoil çš„å®æ–½æ–¹å¼æœ‰ç‚¹å¤æ‚ï¼Œå®ƒè¢«å¼€å‘å‡ºæ¥å°±æ˜¯ä¸ºäº†åœ¨å¤æ‚ä¸”åºå¤§çš„ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯å¦è¦æ¸²æŸ“çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œç²—ç•¥åˆ‡åˆ†å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼Œåˆ†åˆ«ä¸ºï¼š

-   TRANSITION\_SUPPORT
    
-   SYNC\_EXTERNAL\_STORE
    
-   LEGACY
    

ç¬¬ä¸€ç§ TRANSITION\_SUPPORT æ¨¡å¼åˆ™æ˜¯éœ€è¦é€šè¿‡è®¾ç½® RecoilEnv æ¥è¾¾åˆ°ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒRecoil ä¼šä½¿ç”¨å†…éƒ¨è‡ªå·±å»ºç«‹çš„ subscribeToRecoilValue æ¥åˆ¤æ–­ atom æ˜¯å¦æ”¹å˜äº†ï¼Œå¦‚æœæ”¹å˜åˆ™ç”¨ useState å»ºç«‹çš„ forceUpdate æ¥è§¦å‘æ¸²æŸ“ï¼š

```
RecoilEnv<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">RECOIL_GKS_ENABLED</span><span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">add</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">'recoil_transition_support'</span><span data-darkreader-inline-color="">);</span><br>
```

subscribeToRecoilValue çš„è®¾è®¡è·Ÿ useSyncExternalStore å¾ˆåƒï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¼šåˆ¤æ–­ä¼ è¿›å»çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ï¼Œå¦‚æœæ”¹å˜çš„æ—¶å€™å°±è§¦å‘ callbackã€‚å¦‚æœæœ‰å…´è¶£å†…éƒ¨å®æ–½çš„è¯»è€…å†è‡ªå·±å»çœ‹åŸå§‹ç å§ï¼

ç¬¬äºŒç§ SYNC\_EXTERNAL\_STORE æ¨¡å¼åˆ™æ˜¯ä¼šçœ‹ React æœ‰æ²¡æœ‰ useSyncExternalStore å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰ä¼š fallback åˆ°ç¬¬ä¸€ç§ TRANSITION\_SUPPORT çš„æ¨¡å¼ã€‚

```
<span data-darkreader-inline-color="">SYNC_EXTERNAL_STORE</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">currentRendererSupportsUseSyncExternalStore</span><span data-darkreader-inline-color="">()</span><br>  <span data-darkreader-inline-color="">?</span> useRecoilValueLoadable_SYNC_EXTERNAL_STORE<br>  <span data-darkreader-inline-color="">:</span> useRecoilValueLoadable_TRANSITION_SUPPORT<br>
```

ç¬¬ä¸‰ç§ LEGACY åˆ™æ˜¯ä¼šä½¿ç”¨å‰é¢è¯´çš„ç±»ä¼¼ useSyncExternalStore çš„ subscribeToRecoilValueæ¥åˆ¤æ–­ atom æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜åˆ™è§¦å‘æ¸²æŸ“ã€‚

#### Jotai

Jotaiï¼ˆæ—¥æ–‡çš„çŠ¶æ€ï¼‰æ˜¯ç”± Zustand è·Ÿ Valtio çš„ä½œè€… Daishi Kato åœ¨ 2020 å¹´å‘å¸ƒçš„åŸºäº Atomic çš„å¥—ä»¶ï¼Œå®ƒçš„ API å¯å‘äº Recoilï¼Œä½†ä½¿ç”¨èµ·æ¥æ¯” Recoil æ›´ç®€å•ã€‚

åœ¨ Jotai ä¸­ atom æ˜¯ç”¨æ¥å»ºç«‹ atom çŠ¶æ€çš„è®¾å®šæ¡£ï¼Œå¹¶ä¸æ˜¯åƒ React.useState å›ä¼ å¯è¯»å–çš„çŠ¶æ€ï¼Œå®é™…ä¸Šçš„çŠ¶æ€æ˜¯è¢«å­˜åœ¨äº store ä¸­ï¼Œéœ€è¦é€è¿‡ useAtom æ‰èƒ½è¯»å†™çŠ¶æ€ã€‚

è€Œ atom è·Ÿ useState ä¸€æ ·éƒ½æ˜¯ä¼ å…¥åˆå§‹åŒ–çš„çŠ¶æ€ï¼ŒåŒæ—¶ atom ä¹Ÿå¯ä»¥è¢«ä¼ å…¥åˆ°å¦ä¸€ä¸ª atom ä¸­ä½¿ç”¨ï¼Œç›¸è¾ƒäº Recoil å¦‚æœè¦äº§ç”Ÿ derived dataï¼Œåˆ™æ˜¯è¦ä½¿ç”¨ selector è¿™ä¸ª APIï¼Œä½†åœ¨ Jotai ä¸­ç»Ÿä¸€éƒ½æ˜¯ä½¿ç”¨ atomï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> atom <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'jotai'</span><br><br><span data-darkreader-inline-color="">const</span> countAtom <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">const</span> countryAtom <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">'Japan'</span><span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">const</span> citiesAtom <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">([</span><span data-darkreader-inline-color="">'Tokyo'</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">'Kyoto'</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">'Osaka'</span><span data-darkreader-inline-color="">])</span><br><span data-darkreader-inline-color="">const</span> mangaAtom <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">'Dragon Ball'</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">1984</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">'One Piece'</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">1997</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">Naruto</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">1999</span> <span data-darkreader-inline-color="">})</span><br><span data-darkreader-inline-color="">const</span> isJapanAtom <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">atom</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">get</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">get</span><span data-darkreader-inline-color="">(</span>countryAtom<span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">===</span> <span data-darkreader-inline-color="">'Japan'</span><span data-darkreader-inline-color="">)</span><br>
```

useAtom è·Ÿ useState çš„ä½¿ç”¨æ–¹å¼å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯å›ä¼ ä¸€ä¸ª tupleï¼Œç¬¬ä¸€ä¸ªå€¼ç”¨æ¥è¯»å–çŠ¶æ€ï¼Œç¬¬äºŒä¸ªå€¼ç”¨æ¥è®¾å®šçŠ¶æ€ï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> useAtom <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'jotai'</span><br><br><span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">Counter</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">[</span>count<span data-darkreader-inline-color="">,</span> setCount<span data-darkreader-inline-color="">]</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useAtom</span><span data-darkreader-inline-color="">(</span>countAtom<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>h1<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">{</span>count<span data-darkreader-inline-color="">}</span><br>      <span data-darkreader-inline-color="">&lt;</span>button onClick<span data-darkreader-inline-color="">={()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">setCount</span><span data-darkreader-inline-color="">((</span><span data-darkreader-inline-color="">c</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">=&gt;</span> c <span data-darkreader-inline-color="">+</span> <span data-darkreader-inline-color="">1</span><span data-darkreader-inline-color="">)}&gt;</span>one up<span data-darkreader-inline-color="">&lt;/</span>button<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">...</span><br>
```

##### Jotai å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜

çœ‹åˆ°è¿™é‡Œï¼ŒJotai ä¸ Reduxã€Zustandã€Recoil è§£å†³æ¸²æŸ“é—®é¢˜çš„æ–¹å¼éƒ½å¾ˆç›¸ï¼Œåœ¨ç”¨ useAtom çš„æ—¶å€™ Jotai ä¼šè‡ªåŠ¨åˆ¤æ–­ atom çš„å€¼æ˜¯å¦æ”¹å˜äº†ï¼Œå½“æ”¹å˜æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“è¯¥å…ƒä»¶ã€‚

```
<span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">[</span>count<span data-darkreader-inline-color="">,</span> setCount<span data-darkreader-inline-color="">]</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useAtom</span><span data-darkreader-inline-color="">(</span>countAtom<span data-darkreader-inline-color="">)</span><br>
```

ç„¶è€Œï¼Œæ—¢ç„¶ä¸ Reduxã€Zustandã€Recoil çš„æœºåˆ¶ç±»ä¼¼ï¼Œé‚£æ˜¯ä¸æ˜¯å†…éƒ¨å®ç°éƒ½ä½¿ç”¨ useSyncExternalStoreï¼Œä½†æ˜¯å®é™…ä¸Šä¸æ˜¯è¿™æ ·ã€‚

Jotai ä¸ºäº†è§£å†³ time slicing çš„é—®é¢˜ï¼Œä½¿ç”¨äº† useReducer æ¥å¤„ç† re-render çš„é—®é¢˜ã€‚è€Œåƒæ˜¯ Zustand ä½¿ç”¨äº† useSyncExternalStore ï¼Œåœ¨æ­é… useTransition å°±ä¼šå‘ç”Ÿéé¢„æœŸçš„é—®é¢˜ï¼Œæ¯”å¦‚ä½œè€…æä¾›çš„ä¸€ä¸ªèŒƒä¾‹Â https://codesandbox.io/s/9ss9r6ï¼Œåœ¨è¿™ä¸ªèŒƒä¾‹ä¸­é¢„æœŸåº”è¯¥è¦æ˜¾ç¤ºã€ŒPendingâ€¦ã€ï¼Œè€Œä¸æ˜¯Â Suspense çš„ã€ŒLoadingâ€¦ã€ã€‚

å¦‚æœæƒ³è¦çŸ¥é“åå¤šçš„ç»†èŠ‚å¯ä»¥å‚è€ƒä½œè€…å‘çš„è¿™ç¯‡æ–‡ç«  Why useSyncExternalStore Is Not Used in Jotaiï¼Œæˆ–æ˜¯å¯ä»¥ follow è¿™ä¸ª discussion#2137ã€‚

##### Recoil vs Jotai

Jotai çš„å®˜æ–¹æ–‡ä»¶ä¸­ä¹Ÿæœ‰è®¨è®ºä¸€ç›´å¼€ç€ï¼Œæœ‰äº›äººå¸®å¿™æ•´ç†äº†ä¸¤è€…çš„ä¸åŒï¼Œä¾‹å¦‚ï¼š

-   Jotai çš„æºä»£ç æ›´åŠ ç®€å•
    
-   Jotai æœ‰æ›´å°‘çš„ boilerplate codeï¼Œä¸éœ€è¦åƒ Recoil
    
-   å»ºç«‹ atom æ—¶è¦ä½¿ç”¨ key Recoil çš„ bundle size æ¯” Jotai å¤šäº† 10 å€
    
-   åœ¨ DX ä¸Š Jotai æ›´åŠ ç›´è§‚
    

åŸºæœ¬ä¸Šä»¥ç›®å‰çš„è¶‹åŠ¿æ¥çœ‹ï¼Œ Jotai çš„æœªæ¥æ˜¯ä¼˜äº Recoil çš„ã€‚è¿‡äº†å‡ å¹´ Recoil è¿˜æ”¾åœ¨ facebookexperimental è¿™ä¸ª GitHub repoï¼Œå¦‚æœè¦é€‰æ‹© Recoil çš„è¯éœ€è¦è°¨æ…æ€è€ƒä¸€ä¸‹ã€‚

#### Proxy-based

ä»¥ proxy-based å®ä½œçš„å¥—ä»¶ï¼Œè¾ƒå¤šäººä½¿ç”¨çš„å¥—ä»¶æœ‰ Mobx è·Ÿ Valtioï¼ŒMobx å·²ç»è¡Œä¹‹æœ‰å¹´ï¼Œä» 2015 å¹´å°±å·²ç»é—®ä¸–ï¼Œåˆ°ç°åœ¨ä»ç„¶æ˜¯è®¸å¤šå¼€å‘è€…çš„é€‰æ‹©ï¼Œæ¯å‘¨è¿˜æœ‰ 100 ä¸‡çš„ä¸‹è½½é‡ã€‚è€Œ Valtio ä½œä¸ºæ–°èµ·ä¹‹ç§€ï¼Œä» 2020 å¹´å¼€å§‹ç»è¿‡äº†ä¸‰å¹´ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ¯å‘¨å¤§æ¦‚æœ‰ 30 ä¸‡çš„ä¸‹è½½é‡ï¼Œä»è¶‹åŠ¿çœ‹èµ·æ¥æœªæ¥ä¼šè¶Šæ¥è¶Šå¤šäººä½¿ç”¨ Valtioã€‚

##### ä½¿ç”¨ Valtio çš„ proxy-state

Valtio æ˜¯ç”± Zustand è·Ÿ Jotai çš„ä½œè€… Daishi Kato å¼€å‘çš„ä¸€ä¸ª proxy-state çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå®ƒä½¿ç”¨èµ·æ¥éå¸¸å®¹æ˜“ä¸Šæ‰‹ï¼Œå®˜æ–¹æ–‡ä»¶å†™å¾—å¾ˆå®Œæ•´ï¼Œå„ç§å®ç”¨æƒ…å¢ƒéƒ½æœ‰ä¸¾ä¾‹ï¼Œè€Œä¸”ä¹Ÿæ”¯æ´ TypeScriptï¼Œå¦‚æœæ˜¯ React çš„æ–°æ‰‹æˆ–æ˜¯æƒ³è¦ä¸€ä¸ªç®€å•çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼ŒValtio å¯ä»¥ä½œä¸ºé¦–é€‰ä¹‹ä¸€ã€‚

åœ¨ Valtio ä¸­ä¸¤ä¸ªæ ¸å¿ƒçš„ API æ˜¯ proxy è·Ÿ useSnapshot ï¼Œ proxy è¢«ç”¨åœ¨ä»£ç†åŸå§‹çš„ç‰©ä»¶ï¼Œå½“ä»£ç†çš„ç‰©ä»¶æ”¹å˜æ—¶ï¼ŒValtio ä¼šé€šçŸ¥ä½¿ç”¨è¿™ä¸ªç‰©ä»¶çš„åœ°æ–¹è¿›è¡Œæ›´æ–°å¹¶é‡æ–°æ¸²æŸ“ï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> proxy<span data-darkreader-inline-color="">,</span> useSnapshot <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'valtio'</span><br><br><span data-darkreader-inline-color="">const</span> state <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">count</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">text</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">'hello'</span> <span data-darkreader-inline-color="">})</span><br>
```

è¦å–å¾— proxy çš„çŠ¶æ€åˆ™æ˜¯ç”¨ useSnapshot ï¼Œè€Œè¦æ”¹å˜çŠ¶æ€å¯ä»¥ç›´æ¥ mutate åŸå§‹çš„ stateï¼š

```
<span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">Counter</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> snap <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSnapshot</span><span data-darkreader-inline-color="">(</span>state<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">{</span>snap<span data-darkreader-inline-color="">.</span>count<span data-darkreader-inline-color="">}</span><br>      <span data-darkreader-inline-color="">&lt;</span>button onClick<span data-darkreader-inline-color="">={()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">++</span>state<span data-darkreader-inline-color="">.</span>count<span data-darkreader-inline-color="">}&gt;+</span><span data-darkreader-inline-color="">1</span><span data-darkreader-inline-color="">&lt;/</span>button<span data-darkreader-inline-color="">&gt;</span><br>    <span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br>  <span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">}</span><br>
```

è€Œ proxy ä»£ç†çš„ä¸åªæ˜¯ç‰©ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»åˆ«æˆ–æ˜¯å¦å¤–ä¸€ä¸ª proxyï¼š

```
<span data-darkreader-inline-color="">// ä»£ç† class</span><br><span data-darkreader-inline-color="">class</span> <span data-darkreader-inline-color="">User</span> <span data-darkreader-inline-color="">{</span><br>  first <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">null</span><br>  last <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">null</span><br>  <span data-darkreader-inline-color="">constructor</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">first<span data-darkreader-inline-color="">,</span> last</span><span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">this</span><span data-darkreader-inline-color="">.</span>first <span data-darkreader-inline-color="">=</span> first<br>    <span data-darkreader-inline-color="">this</span><span data-darkreader-inline-color="">.</span>last <span data-darkreader-inline-color="">=</span> last<br>  <span data-darkreader-inline-color="">}</span><br>  <span data-darkreader-inline-color="">greet</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">`Hi </span><span data-darkreader-inline-color=""><span data-darkreader-inline-color="">${this</span><span data-darkreader-inline-color="">.</span>first<span data-darkreader-inline-color="">}</span></span><span data-darkreader-inline-color="">!`</span><br>  <span data-darkreader-inline-color="">}</span><br>  <span data-darkreader-inline-color="">get</span> <span data-darkreader-inline-color="">fullName</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">`</span><span data-darkreader-inline-color=""><span data-darkreader-inline-color="">${this</span><span data-darkreader-inline-color="">.</span>first<span data-darkreader-inline-color="">}</span></span><span data-darkreader-inline-color=""><span data-darkreader-inline-color="">${this</span><span data-darkreader-inline-color="">.</span>last<span data-darkreader-inline-color="">}</span></span><span data-darkreader-inline-color="">`</span><br>  <span data-darkreader-inline-color="">}</span><br><span data-darkreader-inline-color="">}</span><br><span data-darkreader-inline-color="">const</span> state <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">new</span> <span data-darkreader-inline-color="">User</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">'Timo'</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">'Kivinen'</span><span data-darkreader-inline-color="">))</span><br><br><span data-darkreader-inline-color="">// ä»£ç† proxy</span><br><span data-darkreader-inline-color="">const</span> obj1State <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">a</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">1</span> <span data-darkreader-inline-color="">})</span><br><span data-darkreader-inline-color="">const</span> obj2State <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">a</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">2</span> <span data-darkreader-inline-color="">})</span><br><br><span data-darkreader-inline-color="">const</span> state <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">({</span><br>  <span data-darkreader-inline-color="">obj1</span><span data-darkreader-inline-color="">:</span> obj1State<span data-darkreader-inline-color="">,</span><br>  <span data-darkreader-inline-color="">obj2</span><span data-darkreader-inline-color="">:</span> obj2State<span data-darkreader-inline-color="">,</span><br><span data-darkreader-inline-color="">})</span><br>
```

##### Valtio å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜

åœ¨ Valtio ä¸­å¹¶ä¸æ˜¯ä½¿ç”¨å¦‚ Redux æˆ–æ˜¯ Zustand çš„ selector æ–¹å¼å–å¾—çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥æŠŠä»£ç†çš„çŠ¶æ€ç›´æ¥æ‹¿å‡ºæ¥ä½¿ç”¨ï¼Œåœ¨é£æ ¼ä¸Šæ›´æ¥è¿‘ atom çš„ç”¨æ³•ã€‚Valtio åˆ¤æ–­ä»£ç†çš„å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘å…ƒä»¶é‡æ–°æ¸²æŸ“ã€‚

ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œå½“ count æ”¹å˜æ—¶ä¸¤ä¸ªå…ƒä»¶éƒ½ä¼šæ¸²æŸ“ï¼Œè€Œä¸” text æ”¹å˜ä¹Ÿä¼šé€ æˆä¸¤ä¸ªå…ƒä»¶éƒ½æ¸²æŸ“ï¼š

```
<span data-darkreader-inline-color="">const</span> state <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">proxy</span><span data-darkreader-inline-color="">({</span> <span data-darkreader-inline-color="">count</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">,</span> <span data-darkreader-inline-color="">text</span><span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">'hello'</span> <span data-darkreader-inline-color="">})</span><br><br><span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">ComponentA</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> snap <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSnapshot</span><span data-darkreader-inline-color="">(</span>state<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;{</span>snap<span data-darkreader-inline-color="">.</span>count<span data-darkreader-inline-color="">}&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span><br><br><span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">ComponentB</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> snap <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSnapshot</span><span data-darkreader-inline-color="">(</span>state<span data-darkreader-inline-color="">)</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;{</span>snap<span data-darkreader-inline-color="">.</span>text<span data-darkreader-inline-color="">}&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br><span data-darkreader-inline-color="">}</span><br>
```

ç”±æ­¤å¯çŸ¥ï¼ŒValtio åœ¨æ ¹æœ¬çš„è®¾è®¡ä¸Šæ¯”è¾ƒé€‚åˆè¾ƒå°çš„å¯¹è±¡ï¼Œå¦åˆ™å®¹æ˜“å› ä¸ºå¯¹è±¡çš„å…¶ä¸­ä¸€ä¸ªå±æ€§æ”¹å˜äº†ï¼Œé€ æˆå¤šå¤„çš„å…ƒä»¶éƒ½è¢«é‡æ–°æ¸²æŸ“ã€‚ä»è¿™ä¸ªç”¨æ³•çœ‹èµ·æ¥å…¶å®ä¹Ÿå¾ˆåƒæ˜¯åŸç”Ÿçš„ context APIï¼Œåªæ˜¯ä¸éœ€è¦ context providerã€‚

Valtio åœ¨å¤„ç†é‡æ–°æ¸²æŸ“çš„æ–¹å¼åœ¨ 2021 å¹´ 9 æœˆä¹‹å‰æ˜¯ä½¿ç”¨ useReducer ä½œä¸ºé‡æ–°æ¸²æŸ“çš„æ‰‹æ®µï¼Œä½†åœ¨ #234 ä¹‹åå°±æ”¹æˆäº†ä½¿ç”¨ useSyncExternalStore ä¾¦æµ‹ä»£ç†çŠ¶æ€æ˜¯å¦æ”¹å˜ï¼Œå¹¶ä¸”è§¦å‘é‡æ–°æ¸²æŸ“ã€‚

#### Mobx

Mobx æ˜¯éå¸¸è€ç‰Œçš„å…¨åŸŸçŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œè·Ÿ Redux æ˜¯å·®ä¸å¤šæ—¶æœŸå‡ºç°çš„å¥—ä»¶ï¼Œåœ¨ç›®å‰è¾ƒæœ‰åæ°”çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ä¸‹è½½é‡æ’è¡Œç¬¬ä¸‰ï¼Œæ¯å‘¨å¤§çº¦æœ‰ 100 ä¸‡çš„ä¸‹è½½é‡ã€‚

ä»ç°ä»Šä¸ºæ•°ä¼—å¤šçš„çŠ¶æ€ç®¡ç†å¥—ä»¶ä¸­ï¼Œå®ƒçš„å†™æ³•å¯ä»¥è¯´æ˜¯ç‹¬æ ‘ä¸€æ ¼ï¼Œéå¸¸å¾—ä¸ä¸€æ ·ï¼Œå°½ç®¡åæ¥ Mobx æ¨å‡ºäº† hook APIï¼Œä½†å…¶æ ¸å¿ƒçš„æ¦‚å¿µå¯¼è‡´å†™èµ·æ¥æœ‰ç‚¹ç¥å¥‡ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹å§ï¼

ä¼šæŠŠ Mobx å½’ç±»åœ¨ proxy-based çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€åœ¨å®ƒçš„åº•å±‚æœ‰ proxy API å­˜åœ¨ï¼ŒMobx ä¼šã€Œè§‚å¯Ÿã€æ‰€æœ‰ä½¿ç”¨çš„çŠ¶æ€ï¼Œåœ¨æ”¹å˜æ—¶é€šçŸ¥ç›¸å¯¹åº”çš„å…ƒä»¶æ¸²æŸ“ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://mobx.js.org/README.html

åœ¨ Mobx ä¸­æœ‰è®¸å¤šå»ºç«‹ store çš„æ–¹å¼ï¼Œä½†åŸºæœ¬ä¸Šéƒ½å¯ä»¥ç†è§£æˆè£…é¥°å™¨æ¨¡å¼ï¼ŒæŠŠè‡ªå®šä¹‰çš„çŠ¶æ€åŠ function åŠ ä¸Šé¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ä»¥ä¸‹çš„ä¾‹å­ï¼Œä½¿ç”¨ @observable ç›‘å¬äº† count çš„å˜åŒ–ï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ª @action å«åš setCountï¼š

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> action<span data-darkreader-inline-color="">,</span> observable <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'mobx'</span><span data-darkreader-inline-color="">;</span><br><br><span data-darkreader-inline-color="">class</span> <span data-darkreader-inline-color="">Store</span> <span data-darkreader-inline-color="">{</span><br>    @observable<br>    count <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">1</span><span data-darkreader-inline-color="">;</span><br><br>    @action<br>    <span data-darkreader-inline-color="">setCount</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>        <span data-darkreader-inline-color="">this</span><span data-darkreader-inline-color="">.</span>count<span data-darkreader-inline-color="">++;</span><br>    <span data-darkreader-inline-color="">}</span><br><span data-darkreader-inline-color="">}</span><br>
```

ä¼ é€’ store æ–¹å¼å®˜æ–¹æ¨èä½¿ç”¨ React çš„ context APIï¼Œå› ä¸ºè¿™æ ·æ¯”è¾ƒå¥½åšå•å…ƒæµ‹è¯•ã€‚è€Œåœ¨ä½¿ç”¨ store çš„æ—¶å€™ï¼Œéœ€è¦åœ¨ç»„ä»¶å¤–ä½¿ç”¨ HOC observer åŒ…èµ·æ¥ã€‚

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> createContext<span data-darkreader-inline-color="">,</span> useContext <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">"react"</span><br><span data-darkreader-inline-color="">import</span> ReactDOM <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">"react-dom"</span><br><span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> observer <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">"mobx-react-lite"</span><br><br><span data-darkreader-inline-color="">const</span> StoreContext <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">createContext</span><span data-darkreader-inline-color="">()</span><br><br><span data-darkreader-inline-color="">const</span> App <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">observer</span><span data-darkreader-inline-color="">(()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">const</span> store <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useContext</span><span data-darkreader-inline-color="">(</span>StoreContext<span data-darkreader-inline-color="">)</span> <span data-darkreader-inline-color="">// See the Timer definition above.</span><br>    <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>        <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span><br>            <span data-darkreader-inline-color="">&lt;</span>button<span data-darkreader-inline-color="">&gt;</span>count<span data-darkreader-inline-color="">++&lt;/</span>button<span data-darkreader-inline-color="">&gt;</span><br>            <span data-darkreader-inline-color="">&lt;</span>span<span data-darkreader-inline-color="">&gt;</span>Count<span data-darkreader-inline-color="">:</span> <span data-darkreader-inline-color="">{</span>store<span data-darkreader-inline-color="">.</span>count<span data-darkreader-inline-color="">}&lt;/</span>span<span data-darkreader-inline-color="">&gt;</span><br>        <span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br>    <span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">})</span><br><br>ReactDOM<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">render</span><span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>StoreContext<span data-darkreader-inline-color="">.</span>Provider value<span data-darkreader-inline-color="">={</span><span data-darkreader-inline-color="">new</span> <span data-darkreader-inline-color="">Store</span><span data-darkreader-inline-color="">()}&gt;</span><br>        <span data-darkreader-inline-color="">&lt;</span>App <span data-darkreader-inline-color="">/&gt;</span><br>    <span data-darkreader-inline-color="">&lt;/</span>StoreContext<span data-darkreader-inline-color="">.</span>Provider<span data-darkreader-inline-color="">&gt;,</span><br>    document<span data-darkreader-inline-color="">.</span>body<br><span data-darkreader-inline-color="">)</span><br>
```

Mobx å¦‚ä½•è§£å†³æ¸²æŸ“çš„é—®é¢˜ åœ¨ Mobx ä¸­åŒæ ·ä¹Ÿä¼˜åŒ–æ¸²æŸ“çš„æœºåˆ¶ï¼Œä¾‹å¦‚ä»¥ä¸‹æœ‰ä¸¤ä¸ªç»„ä»¶åœ¨ username æ”¹å˜æ—¶ï¼Œåªæœ‰ MyComponent ä¼šé‡æ–°æ¸²æŸ“ï¼š

```
<span data-darkreader-inline-color="">const</span> MyComponent <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">observer</span><span data-darkreader-inline-color="">(()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">{</span> todos<span data-darkreader-inline-color="">,</span> username <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useContext</span><span data-darkreader-inline-color="">(</span>StoreContext<span data-darkreader-inline-color="">)</span><br><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span><br>        <span data-darkreader-inline-color="">{</span>username<span data-darkreader-inline-color="">}</span><br>        <span data-darkreader-inline-color="">&lt;</span>TodosView todos<span data-darkreader-inline-color="">={</span>todos<span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">/&gt;</span><br>    <span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br>  <span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">})</span><br><br><span data-darkreader-inline-color="">const</span> TodosView <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">observer</span><span data-darkreader-inline-color="">(()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> <span data-darkreader-inline-color="">{</span> todos <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useContext</span><span data-darkreader-inline-color="">(</span>StoreContext<span data-darkreader-inline-color="">)</span><br><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>ul<span data-darkreader-inline-color="">&gt;</span><br>        <span data-darkreader-inline-color="">{</span>todos<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">map</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">todo</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">&lt;</span>li<span data-darkreader-inline-color="">&gt;{</span>todo<span data-darkreader-inline-color="">}&lt;/</span>li<span data-darkreader-inline-color="">&gt;)}</span><br>    <span data-darkreader-inline-color="">&lt;/</span>ul<span data-darkreader-inline-color="">&gt;</span><br>  <span data-darkreader-inline-color="">)</span><br><span data-darkreader-inline-color="">})</span><br>
```

Mobx çš„å®æ–½æœºåˆ¶æ˜¯çœ‹åˆ°ç›®å‰ä¸ºæ­¢æœ€ç‰¹åˆ«ä¹Ÿæ˜¯æœ€å¤æ‚çš„ï¼Œç®€å•æ¥è¯´ï¼ŒMobx çš„æœºåˆ¶æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œåœ¨ä½¿ç”¨ store ä¸­çš„çŠ¶æ€æ—¶ä¼šè§¦å‘è®¢é˜…ï¼Œè€ŒçŠ¶æ€æ”¹å˜æ—¶ Mobx ä¼šé€šçŸ¥ç›¸åº”çš„ç»„ä»¶è§¦å‘æ›´æ–°ã€‚

è€Œå®æ–½è§‚å¯Ÿè€…çš„æ–¹å¼æ˜¯å°† observable å®šä¹‰çš„å±æ€§å’Œå¯¹è±¡éƒ½ç”¨ Proxy ä»£ç†ï¼Œå¹¶ä¸”åœ¨å…¶å±æ€§å’Œå¯¹è±¡ä¸Šéƒ½åŠ äº†ç‚¹æ–™ï¼Œåœ¨æ‰§è¡Œ get å’Œ set æ—¶éƒ½ä¼šè§¦å‘ Mobx çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚

æˆ‘ä»¬ä¼šåœ¨éœ€è¦ä½¿ç”¨ store çš„ç»„ä»¶åŠ ä¸Š observerï¼Œå½“åœ¨ç»„ä»¶é‡Œé¢ä½¿ç”¨æŸä¸ªå±æ€§æ—¶ï¼Œè¯¥å±æ€§å°±ä¼šè¢«æŒ‚åˆ° observer ä¸Šï¼Œç„¶åå†æŠŠ observer æŒ‚åˆ° Mobx å…¨å±€å¯¹è±¡ï¼Œå¯ä»¥æƒ³è±¡æˆè¯¥ observer è®¢é˜…äº†ä½¿ç”¨çš„å±æ€§ã€‚å½“æœ‰å±æ€§è¢«æ”¹å˜æ—¶ï¼Œå°±ä¼šæŠŠæ‰€æœ‰è®¢é˜…è¯¥å±æ€§çš„ observer éƒ½æ‰§è¡Œä¸€éã€‚

åœ¨è®¢é˜…å‘å¸ƒæ—¶ï¼Œobserver å†…éƒ¨ä¼šå»å‘¼å« useSyncExternalStore çš„ callbackï¼Œé€šçŸ¥ React åº”è¯¥é‡æ–°æ¸²æŸ“è¯¥ç»„ä»¶äº†ã€‚

ä»¥ä¸Šæ˜¯éå¸¸æŠ½è±¡çš„æè¿°äº† Mobx çš„å®æ–½é€»è¾‘ï¼Œå¦‚æœå¯¹äºå®æ–½æœ‰å…´è¶£çš„è¯»è€…å†å»çœ‹æºä»£ç æˆ–æ˜¯è¯»ä¸€äº›ç›¸å…³çš„æ–‡ç« å§ï¼åœ¨è¿™è¾¹æˆ‘ä»¬åªè¦äº†è§£åˆ°å¤§æ–¹å‘çš„å®æ–½ç»†èŠ‚å³å¯ã€‚

#### Preact çš„ signals

Signals æ˜¯ Preact åœ¨ 2022 å¹´ 9 æœˆå‘è¡¨çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ï¼Œå…¶å‘½åçš„çµæ„Ÿæ˜¯æ¥è‡ªäº SolidJSï¼Œè€Œä¸”æ˜¯ç”¨ pure Javascript ç¼–å†™çš„å¥—ä»¶ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œä½ ç”šè‡³å¯ä»¥åœ¨ Reactã€Vueã€Svelte ä¸­ä½¿ç”¨ @preact/signals-reactã€‚

èµ·åˆ Preact å›¢é˜Ÿåœ¨ä¸€ä¸ª startup å›¢é˜Ÿä¸­å‘ç°ï¼Œéšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæœ‰ 100 å¤šå¯¹å·¥ç¨‹å¸ˆåœ¨ commit codeï¼Œå¯¹äº component çš„ render ä¼˜åŒ–å°±å˜å¾—éå¸¸éš¾ä»¥ç®¡ã€‚

è™½ç„¶æœ‰ useMemo ã€ useCallback ã€ memo ç­‰ç­‰çš„ä¼˜åŒ–æ–¹æ³•ï¼Œä½†æ˜¯å¤§å‹é¡¹ç›®åœ¨ä¼˜åŒ– render è¿™ä¸€å—æ˜¯éå¸¸ä¸å®¹æ˜“çš„ï¼Œå¾€å¾€å¼€å‘è€…éƒ½å¿…é¡»èŠ±è´¹è®¸å¤šæ—¶é—´æ£€æŸ¥ dependencies array ä¸­çš„å¯¹è±¡ä¸ºä½•æ”¹å˜äº†ï¼Œæœ‰æ—¶å€™è¿™æ˜¯éå¸¸ä¸ç¬¦åˆæ•ˆç›Šæˆæœ¬ï¼Œä¸ºäº†ä¼˜åŒ– render èŠ±è´¹æ¯”å¼€å‘åŠŸèƒ½æ›´å¤šçš„æ—¶é—´ã€‚

Preact ä¸ºäº†è®©å¼€å‘ä½“éªŒä»¥åŠä¼˜åŒ–çš„æ•ˆæœå¯ä»¥æ›´å¥½ï¼Œæ‰€ä»¥å»ºç«‹äº† Signals è¿™ä¸ªå¥—ä»¶ï¼Œä¸å†éœ€è¦å¤„ç†éº»çƒ¦çš„ dependencies arrayï¼Œè€Œä¸”åœ¨é¡¹ç›®ä¸­å¼€ç®±å³å¯ä½¿ç”¨ã€‚

è€Œä¸”ç›¸å¯¹äº Fluxã€Atomicã€Proxy ç­‰ç­‰å¥—ä»¶è§£å†³çš„æ˜¯ç»„ä»¶ç­‰çº§çš„é‡æ–°æ¸²æŸ“é—®é¢˜ï¼Œä½† Signal çš„ç›®æ ‡æ˜¯ element ç­‰çº§çš„æ¸²æŸ“é—®é¢˜ã€‚

ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœç”¨ React çš„é€»è¾‘æ¥çœ‹ï¼Œé¢„æœŸå½“ count.value++ çš„æ—¶å€™Â `<App/>`Â è·ŸÂ `<Child/>`Â éƒ½ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œè¿™æ˜¯ setState æ—¶ä¼šè§¦å‘çš„æµç¨‹ã€‚ä½†æ˜¯ä½¿ç”¨Â `@preact/signals-react`Â åˆ™æ˜¯ä¼šç›´æ¥ç ´å reconciliation çš„è¿‡ç¨‹ï¼Œåœ¨æ¯ä¸€ç§’ count.value++ æ—¶ï¼Œåªæœ‰Â `<h1>`Â ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚

```
<span data-darkreader-inline-color="">import</span> <span data-darkreader-inline-color="">{</span> useSignal<span data-darkreader-inline-color="">,</span> useSignalEffect <span data-darkreader-inline-color="">}</span> <span data-darkreader-inline-color="">from</span> <span data-darkreader-inline-color="">'@preact/signals-react'</span><span data-darkreader-inline-color="">;</span><br><br><span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">Child</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  console<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">log</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">'render child'</span><span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span>child<span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;;</span><br><span data-darkreader-inline-color="">}</span><br><br><span data-darkreader-inline-color="">export</span> <span data-darkreader-inline-color="">default</span> <span data-darkreader-inline-color="">function</span> <span data-darkreader-inline-color="">App</span><span data-darkreader-inline-color="">()</span> <span data-darkreader-inline-color="">{</span><br>  <span data-darkreader-inline-color="">const</span> count <span data-darkreader-inline-color="">=</span> <span data-darkreader-inline-color="">useSignal</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">0</span><span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">useSignalEffect</span><span data-darkreader-inline-color="">(()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>    <span data-darkreader-inline-color="">setInterval</span><span data-darkreader-inline-color="">(()</span> <span data-darkreader-inline-color="">=&gt;</span> <span data-darkreader-inline-color="">{</span><br>      count<span data-darkreader-inline-color="">.</span>value<span data-darkreader-inline-color="">++;</span><br>    <span data-darkreader-inline-color="">},</span> <span data-darkreader-inline-color="">1000</span><span data-darkreader-inline-color="">);</span><br>  <span data-darkreader-inline-color="">});</span><br>  console<span data-darkreader-inline-color="">.</span><span data-darkreader-inline-color="">log</span><span data-darkreader-inline-color="">(</span><span data-darkreader-inline-color="">'rendering'</span><span data-darkreader-inline-color="">);</span><br><br>  <span data-darkreader-inline-color="">return</span> <span data-darkreader-inline-color="">(</span><br>    <span data-darkreader-inline-color="">&lt;</span>div<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">&lt;</span>h1<span data-darkreader-inline-color="">&gt;{</span>count<span data-darkreader-inline-color="">}&lt;/</span>h1<span data-darkreader-inline-color="">&gt;</span><br>      <span data-darkreader-inline-color="">&lt;</span>Child <span data-darkreader-inline-color="">/&gt;</span><br>    <span data-darkreader-inline-color="">&lt;/</span>div<span data-darkreader-inline-color="">&gt;</span><br>  <span data-darkreader-inline-color="">);</span><br><span data-darkreader-inline-color="">}</span><br>
```

Signal çš„è®¾è®¡è·Ÿ Mobx è¿˜æœ‰ Valtio å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯è®©çŠ¶æ€åŒå‘ç»‘å®šï¼Œä½†æ˜¯åšåˆ°é‡æ–°æ¸²æŸ“çš„é¢—ç²’åº¦å˜æˆåªæœ‰ä½¿ç”¨çŠ¶æ€çš„ elementã€‚

åœ¨ Preact çš„å®˜æ–¹æ–‡ä»¶ä¸­ç”šè‡³æåˆ°ä½¿ç”¨äº† signal åï¼Œç›¸æ¯”ä¸åŸæœ¬ä½¿ç”¨ state çš„èƒŒåæ˜¯ virtual domï¼Œå…¶æ•ˆèƒ½ä¼˜åŒ–äº†è®¸å¤šå€ï¼Œå› ä¸º signal åœ¨ä¼ é€’çŠ¶æ€æ—¶ä¼šç›´æ¥ç•¥è¿‡æ²¡æœ‰ä½¿ç”¨åˆ° signal çš„ç»„ä»¶ã€‚

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://preactjs.com/blog/introducing-signals/

#### Signal æ˜¯æœªæ¥å—ï¼Ÿ

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)https://npmtrends.com/Â jotai-signal-vs-@preact/signals

ä»ä¸‹è½½é‡æ¥çœ‹çš„è¯ signal çš„å¥—ä»¶ä¸‹è½½é‡æ˜¯å°‘ä¹‹åˆå°‘ï¼Œä¼šæ¯”è¾ƒå°‘äººä½¿ç”¨çš„åŸå› é™¤äº†æ˜¯è¿™ä¸¤ä¸ªå¥—ä»¶æ¯”è¾ƒæ–°ä¹‹å¤–ï¼Œsignal å¹¶ä¸æ˜¯ React å›¢é˜Ÿæ‰€æ¨å´‡çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œå› ä¸ºå®ƒç ´åäº† React çš„ç”Ÿå‘½å‘¨æœŸã€‚

Dan æœ¬äººä¹Ÿæåˆ° @preact/signals çš„å®ä½œåŸç†æ˜¯åŸºäºä¸€ä¸ªè„†å¼±çš„å‡è®¾ï¼ŒReact å®Œå…¨å¹¶ä¸æ”¯æ´ signal çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œå¦‚æœä½¿ç”¨åƒæ˜¯ @preact/signals è¿™ç§å¥—ä»¶å¯¼è‡´ React å‘ç”Ÿé—®é¢˜ï¼ŒReact å›¢é˜Ÿæ— æ³•å¸®å¿™æ‰¾å‡ºé—®é¢˜ã€‚

ä»¥ç»“è®ºæ¥è¯´ï¼Œç›®å‰åœ¨ React ç”Ÿæ€ç³»ä¸­ä½¿ç”¨ signal å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ—¶é—´ç‚¹æˆ–æ˜¯å¥½çš„é€‰æ‹©ï¼Œä¸å¦‚ä½¿ç”¨åŸç”Ÿçš„çŠ¶æ€ç®¡ç†æœºåˆ¶æˆ–æ˜¯è¾ƒå¤šäººä½¿ç”¨çš„çŠ¶æ€ç®¡ç†å¥—ä»¶ã€‚

ä¸è¿‡è™½ç„¶è¯´ signal ç›®å‰æ²¡åŠæ³•åœ¨ React ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯è®¸å¤šæ¡†æ¶å·²ç»é€æ¸æ‹¥æŠ±è¿™ä¸ªæ¦‚å¿µï¼Œåƒæ˜¯ Solidã€Qwikã€Vueã€Preactã€Angular ç­‰ç­‰çš„æ¡†æ¶éƒ½æœ‰å®ç° signalã€‚

é¢˜å¤–è¯ï¼Œåœ¨ 13 å¹´å‰Â https://knockoutjs.com/Â è¿™ä¸ªå¥—ä»¶å·²ç»æœ‰ signal è¿™ä¸ªæ¦‚å¿µ

ç»“è®º åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ¢è®¨äº†ä½¿ç”¨ React åŸç”Ÿçš„çŠ¶æ€ç®¡ç†æœºåˆ¶ä¸»è¦ä¼šé­é‡ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š

props drilling çš„é—®é¢˜ context é€ æˆæ•´é¢—å­æ ‘æ¸²æŸ“çš„é—®é¢˜ åŸºæœ¬ä¸Š props drilling çš„é—®é¢˜åœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯é€è¿‡ context API æ¥è§£å†³ï¼Œä½†å°±è¡ç”Ÿ context é€ æˆæ•´é¢—å­æ ‘æ¸²æŸ“çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸è®ºæ˜¯åŸºäº Fluxã€Atomicã€Proxy å®ä½œçš„å¥—ä»¶ï¼Œé™¤äº† Jotai ä»¥å¤–ï¼Œåœ¨ä¾¦æµ‹çŠ¶æ€æ”¹å˜å¹¶è§¦å‘å…ƒä»¶æ¸²æŸ“çš„å®ä½œéƒ½é‡‡ç”¨äº† useSyncExternalStore è¿™ä¸ª APIï¼Œåªæ˜¯ä¼šæ ¹æ®ä¸åŒçš„æ ¸å¿ƒæ¦‚å¿µå®ä½œã€‚

æœ€åä¹Ÿç¨å¾®æåˆ°äº† signal è¿™ä¸ªåœ¨ React åœˆå­è¾ƒæ–°çš„æ¦‚å¿µï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸é€‚åˆåœ¨ React ç”Ÿæ€ç³»ä¸­ï¼Œè€Œä¸”é¢ä¸´çš„ issue å¯èƒ½ React çš„å¼€å‘è€…ä¹Ÿæ— æ³•è§£å†³ã€‚

ä»¥æˆ‘ä¸ªäººçš„åˆ¤æ–­ï¼Œç›®å‰åœ¨å›¢é˜Ÿä¸­ä½¿ç”¨ Reduxã€Zustand è·Ÿ Jotai æ˜¯è¾ƒå¥½çš„é€‰æ‹©ï¼›ä¸è€ƒè™‘ Recoil ä¸»å› æ˜¯ issue å¤ªå¤šè€Œä¸”è‡³ä»Šè¿˜æ”¾åœ¨ facebookexperimental repoï¼Œå¦‚æœè¦ä½¿ç”¨ Atomic çš„å†™æ³•ï¼ŒJotai æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼›è€Œ Valtio çœ‹èµ·æ¥å¾ˆé…·ï¼Œä½†æ˜¯ mutable çš„å†™æ³•ä¸ React ç»å¸¸ä½¿ç”¨çš„ immutable å†™æ³•èƒŒé“è€Œé©°ï¼Œå¦‚æœè¦åœ¨å›¢é˜Ÿä¸­ä½¿ç”¨ä¹Ÿè®¸å°±è¦æœ‰æ›´å¥½çš„æ•™è‚²è®­ç»ƒï¼Œå¦åˆ™ coding style ä¼šå·®åˆ«å¤ªå¤šã€‚Mobx çš„å†™æ³•â€¦ï¼Œä¸ªäººä¸çˆ± ğŸ˜…ã€‚

#### Reference

-   Hacker Way: Rethinking Web App Development at Facebook
    
-   https://github.com/facebookarchive/flux
    
-   https://github.com/pmndrs/zustand
    
-   https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global\_Objects/Proxy
    
-   https://github.com/pmndrs/valtio
    
-   https://valtio.pmnd.rs/docs/introduction/getting-started
    
-   https://jotai.org/
    
-   Differences between Recoil and Jotai
    
-   When to use Valtio, when to use Jotai #128
    
-   Why are signals still not so popular?
    
-   How Valtio Proxy State Works (Vanilla Part)
    
-   https://mobx.js.org/README.html
    
-   How does observer HoC work?
    
-   A simple Mobx under 50 LOC to understand observer pattern
    
-   https://juejin.cn/post/7274211579692269583?searchId=20231129222759956FB008A6CDB12EF5EF
    
-   https://preactjs.com/guide/v10/signals/
    

Node ç¤¾ç¾¤

```
<section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-tools="135ç¼–è¾‘å™¨" data-id="89226"><section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section><section mpa-from-tpl="t" data-style="margin-left: 10px; outline: 0px; border-top: 4px solid rgb(68, 68, 68); display: inline-block; width: 50px;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section></section><p data-style="outline: 0px; color: rgb(34, 34, 34); letter-spacing: 0.544px; white-space: normal; font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;" data-darkmode-color="rgb(196, 196, 196)" data-darkmode-original-color="rgb(34, 34, 34)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-style="outline: 0px; color: rgb(63, 63, 63); font-variant-ligatures: common-ligatures; letter-spacing: 0.544px; text-align: left; font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; word-spacing: 0.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color="">æˆ‘ç»„å»ºäº†ä¸€ä¸ªæ°›å›´ç‰¹åˆ«å¥½çš„ Node.js ç¤¾ç¾¤ï¼Œé‡Œé¢æœ‰å¾ˆå¤š Node.jså°ä¼™ä¼´ï¼Œå¦‚æœä½ å¯¹Node.jså­¦ä¹ æ„Ÿå…´è¶£çš„è¯ï¼ˆåç»­æœ‰è®¡åˆ’ä¹Ÿå¯ä»¥ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·è¿›è¡ŒNode.jsç›¸å…³çš„äº¤æµã€å­¦ä¹ ã€å…±å»ºã€‚ä¸‹æ–¹åŠ  è€ƒæ‹‰ å¥½å‹å›å¤ã€ŒNodeã€å³å¯ã€‚</span></p><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><img data-cropselx1="0" data-cropselx2="147" data-cropsely1="0" data-cropsely2="178" data-fileid="100016913" data-galleryid="" data-imgfileid="100034665" data-ratio="1.29073482428115" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YBFV3Da0NwtUt8z7MwaX6yicG6weUJYZ4kDUq34gs35gHuAVHnxrwxSQgclB6MXAyUIogJvUrFgZA7CuuFjNeLA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="626" data-darkreader-inline-outline="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="" data-original-style="outline: 0px; border-style: none; border-radius: 8px; background-color: rgb(36, 36, 36); color: rgb(18, 18, 18); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; display: initial; background-size: 16px !important; visibility: visible !important; width: 236.945px !important; --darkreader-inline-outline: initial; --darkreader-inline-bgcolor: #1b1d1e; --darkreader-inline-color: #dddad5;" data-index="13" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="236.945px" crossorigin="anonymous" alt="Image"></p><pre data-style="margin-bottom: 1rem; outline: 0px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 1em; color: rgb(33, 37, 41); overflow: auto; letter-spacing: 0.544px;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;&nbsp;</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;â€œåˆ†äº«ã€ç‚¹èµ</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">ã€</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">åœ¨çœ‹â€ æ”¯æŒä¸€ä¸‹</span></span><span data-darkreader-inline-color=""></span></p></pre>
```