## 

```
<section><mp-common-profile data-pluginname="mpprofile" data-id="MzUxNzk1MjQ0Ng==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/YBFV3Da0Nwvv72YkFO0qPibDKicOCsfltiaE9070DOu4iahXnicYwRIHcxe9VBicAy45MkPqy8nZzLTVibugOtV0ORFcg/300?wx_fmt=png&amp;wxfrom=19" data-nickname="程序员成长指北" data-alias="coder_growth" data-signature="专注 Node.js 技术栈分享，从 前端 到 Node.js 再到 后端数据库，祝您成为优秀的高级 Node.js 全栈工程师。一个有趣的且乐于分享的人。座右铭：今天未完成的，明天更不会完成。" data-from="0" data-is_biz_ban="0" data-origin_num="101" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><section data-darkreader-inline-outline=""><span data-style="padding: 4px 7px; outline: 0px; background: rgb(255, 242, 232); border-color: rgb(255, 187, 150); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(212, 56, 13); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">大厂技术</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;&nbsp;</span><span data-style="padding: 4px 7px; outline: 0px; background: rgb(240, 245, 255); border-color: rgb(173, 198, 255); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(29, 57, 196); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">高级前端</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;&nbsp;</span><span data-style="padding: 4px 7px; outline: 0px; background: rgb(246, 255, 237); border-color: rgb(183, 235, 143); letter-spacing: 0.544px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; word-spacing: 0.8px; caret-color: rgb(51, 51, 51); font-size: 12px; text-align: left; border-radius: 2px; line-height: 20px; font-weight: bold; color: rgb(56, 158, 13); visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="">Node进阶</span></section><pre data-darkreader-inline-outline="" data-darkreader-inline-color=""><p data-darkmode-bgcolor-166718259710710="rgb(25, 25, 25)" data-darkmode-original-bgcolor-166718259710710="#fff|rgb(255, 255, 255)" data-darkmode-color-166718259710710="rgb(163, 163, 163)" data-darkmode-original-color-166718259710710="#fff|rgb(62, 62, 62)" data-style="margin-bottom: 0px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; font-size: 16px; letter-spacing: 2px; text-wrap: wrap; word-spacing: 0.8px; background-color: rgb(255, 255, 255); color: rgb(62, 62, 62); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; caret-color: rgb(51, 51, 51); text-align: center; visibility: visible;" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(168, 168, 168)" data-darkmode-original-color="rgb(62, 62, 62)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">点击上方&nbsp;</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">程序员成长指北</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，关注公众号</span></p><p data-darkmode-bgcolor-166718259710710="rgb(25, 25, 25)" data-darkmode-original-bgcolor-166718259710710="#fff|rgb(255, 255, 255)" data-darkmode-color-166718259710710="rgb(163, 163, 163)" data-darkmode-original-color-166718259710710="#fff|rgb(0, 0, 0)" data-style="margin-bottom: 0px; outline: 0px; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; letter-spacing: 2px; text-wrap: wrap; color: rgb(0, 0, 0); word-spacing: 0.8px; background-color: rgb(255, 255, 255); caret-color: rgb(51, 51, 51); text-align: center; visibility: visible;" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">回复</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">1</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，加入高级Node交流群</span></p></pre>
```

前言

在日常的开发中，我们经常能碰见服务端需要主动推送给客户端数据的业务场景，比如\_数据大屏的实时数据\_，比如\_消息中心的未读消息\_，比如\_聊天功能\_等等。

本文主要介绍SSE的使用场景和如何使用SSE。

![Image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/yRIqhMamWtRbaFlyW45ElTWnlicOH2TLXmuzm9KdGQLjzMPAEnn3POmyUbicPhYLwITB0GpSPCQOicsfISJPrPpUw/640?wx_fmt=jpeg&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

image.png

## 服务端向客户端推送数据的实现方案有哪几种？

我们常规实现这些需求的方案有以下三种

1.  轮询
    
2.  websocket
    
3.  SSE
    

### 轮询简介

在很久很久以前，前端一般使用轮询来进行服务端向客户端进行消息的\_伪推送\_，为什么说轮询是伪推送？因为\_轮询本质上还是通过客户端向服务端发起一个单项传输的请求\_，服务端对这个请求做出响应而已。通过不断的请求来实现服务端向客户端推送数据的错觉。并不是服务端主动向客户端推送数据。显然，轮询一定是上述三个方法里最下策的决定。

**轮询的缺点：**

1.  首先轮询需要不断的发起请求，\_每一个请求都需要经过http建立连接的流程\_（比如三次握手，四次挥手），是没有必要的消耗。
    
2.  客户端需要从页面被打开的那一刻开始就\_一直处理请求\_。虽然每次轮询的消耗不大，但是一直处理请求对于客户端来说一定是不友好的。
    
3.  \_浏览器请求并发是有限制的\_。比如Chrome 最大并发请求数目为 6，这个限制还有一个前提是针对同一域名的，超过这一限制的后续请求将会被阻塞。\_而轮询意味着会有一个请求长时间的占用并发名额\_。
    
4.  而如果轮询时间较长，可能又\_没有办法非常及时的获取数据\_
    

### websocket简介

websocket是一个双向通讯的协议，他的优点是，可以同时支持客户端和服务端彼此相互进行通讯。功能上很强大。

缺点也很明显，websocket是一个新的协议，ws/wss。也就是说，支持http协议的浏览器不一定支持ws协议。

相较于SSE来说，websocket因为功能更强大。结构更复杂。所以相对比较\_重\_。

**websocket对于各大浏览器的兼容性↓** ![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

### SSE简介

sse是一个单向通讯的协议也是一个\_长链接\_，它只能支持服务端主动向客户端推送数据，但是无法让客户端向服务端推送消息。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">长链接是一种HTTP/1.1的持久连接技术，它允许客户端和服务器在一次TCP连接上进行多个HTTP请求和响应，而不必为每个请求/响应建立和断开一个新的连接。长连接有助于减少服务器的负载和提高性能。<br></code>
```

SSE的优点是，它是一个轻量级的协议，相对于websockte来说，他的复杂度就没有那么高，\_相对于客户端的消耗也比较少\_。而且\_SSE使用的是http协议\_（websocket使用的是ws协议），也就是现有的服务端都支持SSE，无需像websocket一样需要服务端提供额外的支持。

注意:IE大魔王不支持SSE

**SSE对于各大浏览器的兼容性↓** ![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

注意哦，上图是SSE对于浏览器的兼容不是对于服务端的兼容。

## websocket和SSE有什么区别？

### 轮询

对于当前计算机的发展来说，几乎很少出现同时不支持websocket和sse的情况，所以轮询是在极端情况下浏览器实在是不支持websocket和see的下策。

### Websocket和SSE

我们一般的服务端和客户端的通讯基本上使用这两个方案。首先声明:这两个方案没有绝对的好坏，只有在不同的业务场景下更好的选择。

SSE的官方对于SSE和Websocket的评价是

1.  WebSocket是全双工通道，可以双向通信，功能更强；SSE是单向通道，只能服务器向浏览器端发送。
    
2.  WebSocket是一个新的协议，需要服务器端支持；SSE则是部署在HTTP协议之上的，现有的服务器软件都支持。
    
3.  SSE是一个轻量级协议，相对简单；WebSocket是一种较重的协议，相对复杂。
    
4.  SSE默认支持断线重连，WebSocket则需要额外部署。
    
5.  SSE支持自定义发送的数据类型。
    

### Websocket和SSE分别适用于什么业务场景？

对于SSE来说，它的\_优点就是轻\_，而且对于服务端的支持度要更好。换言之，\_可以使用SSE完成的功能需求，没有必要使用更重更复杂的websocket。\_

比如：数据大屏的实时数据，消息中心的消息推送等一系列只需要服务端单方面推送而\_不需要客户端同时进行反馈的需求\_，SSE就是不二之选。

对于Websocket来说，\_他的优点就是可以同时支持客户端和服务端的双向通讯\_。所适用的业务场景：最典型的就是\_聊天功能\_。这种服务端需要主动向客户端推送信息，并且客户端也有向服务端推送消息的需求时，Websocket就是更好的选择。

## SSE有哪些主要的API?

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">建立一个SSE链接&nbsp;：<span data-darkreader-inline-color="">var</span>&nbsp;source&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;EventSource(url);<br></code>
```

#### SSE连接状态

**source.readyState**

-   0，相当于常量EventSource.CONNECTING，表示连接还未建立，或者连接断线。
    
-   1，相当于常量EventSource.OPEN，表示连接已经建立，可以接受数据。
    
-   2，相当于常量EventSource.CLOSED，表示连接已断，且不会重连。
    

#### SSE相关事件

-   open事件(连接一旦建立，就会触发open事件，可以定义相应的回调函数)
    
-   message事件(收到数据就会触发message事件)
    
-   error事件(如果发生通信错误（比如连接中断），就会触发error事件)
    

#### 数据格式

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">Content-Type:&nbsp;text/event-stream&nbsp;<span data-darkreader-inline-color="">//文本返回格式</span><br>Cache-Control:&nbsp;no-cache&nbsp;&nbsp;<span data-darkreader-inline-color="">//不要缓存</span><br><span data-darkreader-inline-color="">Connection</span>:&nbsp;keep-alive&nbsp;<span data-darkreader-inline-color="">//长链接标识</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

SSE：相关文档，文档入口文档入口文档入口文档入口<sup data-darkreader-inline-color="">[1]</sup>

显然，如果直接看api介绍不论是看这里还是看官网，大部分同学都是比较懵圈的状态，\_那么我们写个demo来看一下?\_

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

demo请看下方

我更建议您先把Demo跑起来，然后在看看上面这个w3cschool的SSE文档<sup data-darkreader-inline-color="">[2]</sup>。两个配合一起看，会更方便理解些。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

## 如何实操一个SSE链接？Demo↓

这里Demo前端使用的就是最基本的html静态页面连接，没有使用任何框架。后端选用语言是node，框架是Express。

理论上，把这两段端代码复制过去跑起来就直接可以用了。

1.  第一步，建立一个index.html文件，然后复制前端代码Demo到index.html文件中，打开文件
    
2.  第二步，进入一个新的文件夹，建立一个index.js文件，然后将后端Demo代码复制进去，然后在该文件夹下执行
    

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">npm&nbsp;init&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//初始化npm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>npm&nbsp;i&nbsp;express&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//下载node&nbsp;express框架</span><br>node&nbsp;index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//启动服务</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

在这一层文件夹下执行命令。

完成以上操作就可以把项目跑起来了

### 前端代码Demo

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;!DOCTYPE&nbsp;html&gt;<br>&lt;html&nbsp;lang="en"&gt;<br>&lt;head&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset="UTF-8"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv="X-UA-Compatible"&nbsp;content="IE=edge"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;name="viewport"&nbsp;content="width=device-width,&nbsp;initial-scale=1.0"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Document&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;id="ul"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>&lt;/body&gt;<br>&lt;script&gt;<br><br>//生成li元素<br>function&nbsp;createLi(data){<br>&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;li&nbsp;=&nbsp;document.createElement("li");<br>&nbsp;&nbsp;&nbsp;&nbsp;li.innerHTML&nbsp;=&nbsp;String(data.message);<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;li;<br>}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>//判断当前浏览器是否支持SSE<br>&nbsp;&nbsp;let&nbsp;source&nbsp;=&nbsp;''<br>&nbsp;if&nbsp;(!!window.EventSource)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;=&nbsp;new&nbsp;EventSource('http://localhost:8088/sse/');<br>&nbsp;}else{<br>&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;Error("当前浏览器不支持SSE")<br>&nbsp;}<br><br>&nbsp;//对于建立链接的监听<br>&nbsp;source.onopen&nbsp;=&nbsp;function(event)&nbsp;{<br>&nbsp;&nbsp;&nbsp;console.log(source.readyState);<br>&nbsp;&nbsp;&nbsp;console.log("长连接打开");<br>&nbsp;};<br><br>&nbsp;//对服务端消息的监听<br>&nbsp;source.onmessage&nbsp;=&nbsp;function(event)&nbsp;{<br>&nbsp;&nbsp;&nbsp;console.log(JSON.parse(event.data));<br>&nbsp;&nbsp;&nbsp;console.log("收到长连接信息");<br>&nbsp;&nbsp;&nbsp;let&nbsp;li&nbsp;=&nbsp;createLi(JSON.parse(event.data));<br>&nbsp;&nbsp;&nbsp;document.getElementById("ul").appendChild(li)<br>&nbsp;};<br><br>&nbsp;//对断开链接的监听<br>&nbsp;source.onerror&nbsp;=&nbsp;function(event)&nbsp;{<br>&nbsp;&nbsp;&nbsp;console.log(source.readyState);<br>&nbsp;&nbsp;&nbsp;console.log("长连接中断");<br>&nbsp;};<br><br>&lt;/script&gt;<br>&lt;/html&gt;<br></code>
```

### 后端代码Demo（node的express）

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;express&nbsp;=&nbsp;<span data-darkreader-inline-color="">require</span>(<span data-darkreader-inline-color="">'express'</span>);&nbsp;<span data-darkreader-inline-color="">//引用框架</span><br><span data-darkreader-inline-color="">const</span>&nbsp;app&nbsp;=&nbsp;express();&nbsp;<span data-darkreader-inline-color="">//创建服务</span><br><span data-darkreader-inline-color="">const</span>&nbsp;port&nbsp;=&nbsp;<span data-darkreader-inline-color="">8088</span>;&nbsp;<span data-darkreader-inline-color="">//项目启动端口</span><br><br><span data-darkreader-inline-color="">//设置跨域访问</span><br>app.all(<span data-darkreader-inline-color="">"*"</span>,&nbsp;<span><span data-darkreader-inline-color="">function</span>(<span>req,&nbsp;res,&nbsp;next</span>)&nbsp;</span>{<br>&nbsp;<span data-darkreader-inline-color="">//设置允许跨域的域名，*代表允许任意域名跨域</span><br>&nbsp;res.header(<span data-darkreader-inline-color="">"Access-Control-Allow-Origin"</span>,&nbsp;<span data-darkreader-inline-color="">'*'</span>);<br>&nbsp;<span data-darkreader-inline-color="">//允许的header类型</span><br>&nbsp;res.header(<span data-darkreader-inline-color="">"Access-Control-Allow-Headers"</span>,&nbsp;<span data-darkreader-inline-color="">"Content-Type,&nbsp;Authorization,&nbsp;X-Requested-With"</span>);<br>&nbsp;<span data-darkreader-inline-color="">//跨域允许的请求方式&nbsp;</span><br>&nbsp;res.header(<span data-darkreader-inline-color="">"Access-Control-Allow-Methods"</span>,&nbsp;<span data-darkreader-inline-color="">"PUT,POST,GET,DELETE,OPTIONS"</span>);<br>&nbsp;<span data-darkreader-inline-color="">//&nbsp;可以带cookies</span><br>&nbsp;res.header(<span data-darkreader-inline-color="">"Access-Control-Allow-Credentials"</span>,&nbsp;<span data-darkreader-inline-color="">true</span>);<br>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(req.method&nbsp;==&nbsp;<span data-darkreader-inline-color="">'OPTIONS'</span>)&nbsp;{<br>&nbsp;&nbsp;res.sendStatus(<span data-darkreader-inline-color="">200</span>);<br>&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;next();<br>&nbsp;}<br>})<br><br>app.get(<span data-darkreader-inline-color="">"/sse"</span>,(req,res)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;res.set({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'Content-Type'</span>:&nbsp;<span data-darkreader-inline-color="">'text/event-stream'</span>,&nbsp;<span data-darkreader-inline-color="">//设定数据类型</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'Cache-Control'</span>:&nbsp;<span data-darkreader-inline-color="">'no-cache'</span>,<span data-darkreader-inline-color="">//&nbsp;长链接拒绝缓存</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'Connection'</span>:&nbsp;<span data-darkreader-inline-color="">'keep-alive'</span>&nbsp;<span data-darkreader-inline-color="">//设置长链接</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">"进入到长连接了"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//持续返回数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setInterval(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">"正在持续返回数据中ing"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;data&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">message</span>:&nbsp;<span data-darkreader-inline-color="">`Current&nbsp;time&nbsp;is&nbsp;<span data-darkreader-inline-color="">${<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Date</span>().toLocaleTimeString()}</span>`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.write(<span data-darkreader-inline-color="">`data:&nbsp;<span data-darkreader-inline-color="">${<span data-darkreader-inline-color="">JSON</span>.stringify(data)}</span>\n\n`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">1000</span>);&nbsp;&nbsp;<br>})<br><br><span data-darkreader-inline-color="">//创建项目</span><br>app.listen(port,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">`项目启动成功-http://localhost:<span data-darkreader-inline-color="">${port}</span>`</span>)<br>})<br></code>
```

### 效果  

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

## 总结

1.  SSE比websocket更轻
    
2.  SSE是基于http/https协议的
    
3.  websocket是一个新的协议，ws/wss协议
    
4.  如果只需要服务端向客户端推送消息，推荐使用SSE
    
5.  如果需要服务端和客户端双向推送，请选择websocket
    
6.  不论是SSE还是websocket，对于浏览器的兼容性都不错
    
7.  轮询是下策，很占用客户端资源，不建议使用。（不过偷懒的时候他确实方便）
    
8.  _IE不支持SSE_
    
9.  小白同学demo如果跑不明白可以私信我
    

> 原文链接: https://juejin.cn/post/7325730345840066612
> 
> 作者:工边页字

**对了，小程序不支持SSE哦**，但是websocket在一些低配手机上电量消耗又很快。而且很占用资源。搞不好还会变卡。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

### 最后

如果文章对您有帮助的话。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

image.png

Node 社群

```
<section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-tools="135编辑器" data-id="89226"><section mpa-from-tpl="t" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section><section mpa-from-tpl="t" data-style="margin-left: 10px; outline: 0px; border-top: 4px solid rgb(68, 68, 68); display: inline-block; width: 50px;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-border-top=""><br></section></section><p data-style="outline: 0px; color: rgb(34, 34, 34); letter-spacing: 0.544px; white-space: normal; font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;" data-darkmode-color="rgb(196, 196, 196)" data-darkmode-original-color="rgb(34, 34, 34)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-style="outline: 0px; color: rgb(63, 63, 63); font-variant-ligatures: common-ligatures; letter-spacing: 0.544px; text-align: left; font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; word-spacing: 0.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color="">我组建了一个氛围特别好的 Node.js 社群，里面有很多 Node.js小伙伴，如果你对Node.js学习感兴趣的话（后续有计划也可以），我们可以一起进行Node.js相关的交流、学习、共建。下方加 考拉 好友回复「Node」即可。</span></p><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><img data-cropselx1="0" data-cropselx2="147" data-cropsely1="0" data-cropsely2="178" data-fileid="100016913" data-galleryid="" data-imgfileid="100035293" data-ratio="1.29073482428115" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/YBFV3Da0NwtUt8z7MwaX6yicG6weUJYZ4kDUq34gs35gHuAVHnxrwxSQgclB6MXAyUIogJvUrFgZA7CuuFjNeLA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="626" data-darkreader-inline-outline="" data-darkreader-inline-bgcolor="" data-darkreader-inline-color="" data-original-style="outline: 0px; border-style: none; border-radius: 8px; background-color: rgb(36, 36, 36); color: rgb(18, 18, 18); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; display: initial; background-size: 16px !important; visibility: visible !important; width: 236.922px !important; --darkreader-inline-outline: initial; --darkreader-inline-bgcolor: #1b1d1e; --darkreader-inline-color: #dddad5;" data-index="12" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="236.922px" crossorigin="anonymous" alt="Image"></p><pre data-style="margin-bottom: 1rem; outline: 0px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 1em; color: rgb(33, 37, 41); overflow: auto; letter-spacing: 0.544px;" data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline="" data-darkreader-inline-color=""><p data-darkmode-color="rgb(230, 230, 230)" data-darkmode-original-color="rgb(0, 0, 0)" data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;&nbsp;</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">&nbsp;“分享、点赞</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">、</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">在看” 支持一下</span></span></p></pre>
```