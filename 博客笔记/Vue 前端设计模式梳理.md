**1\. 什么是单例模式？**

单例模式 （Singleton Pattern）又称为单体模式，保证一个类只有一个实例，并提供一个访问它的全局访问点。也就是说，第二次使用同一个类创建新对象的时候，应该得到与第一次创建的对象完全相同的对象。

**Vue中的单例模式**

（1）Element UI

Element UI是使用Vue开发的一个前端UI框架。ElementUI 中的全屏 Loading 蒙层调用有两种形式：

●指令形式：Vue.use(Loading.directive)

●服务形式：Vue.prototype.$loading = service

指令形式注册的使用方式 ：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:v-loading.fullscreen</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"true"</span>&gt;</span>...<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">div</span>&gt;</span>；<br>
```

服务形式注册的使用方式 ：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.$loading({&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">fullscreen</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">true</span>&nbsp;});
```

用服务方式使用全屏 Loading 是单例的，即在前一个全屏 Loading 关闭前再次调用全屏 Loading，并不会创建一个新的 Loading 实例，而是返回现有全屏 Loading 的实例。

下面是 ElementUI 实现全屏 Loading 的源码：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">import</span>&nbsp;Vue&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'vue'</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">import</span>&nbsp;loadingVue&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'./loading.vue'</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;LoadingConstructor&nbsp;=&nbsp;Vue.extend(loadingVue)<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">let</span>&nbsp;fullscreenLoading<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;Loading&nbsp;=&nbsp;<span data-darkreader-inline-outline="">(<span data-darkreader-inline-outline="">options&nbsp;=&nbsp;{}</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(options.fullscreen&nbsp;&amp;&amp;&nbsp;fullscreenLoading)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;fullscreenLoading<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">let</span>&nbsp;instance&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;LoadingConstructor({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">document</span>.createElement(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'div'</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">data</span>:&nbsp;options<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(options.fullscreen)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullscreenLoading&nbsp;=&nbsp;instance<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;instance<br>}<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;Loading<br>
```

这里的单例是 fullscreenLoading，是存放在闭包中的，如果用户传的 options 的 fullscreen 为 true 且已经创建了单例，则直接返回之前创建的单例，如果之前没有创建过，则创建单例并赋值给闭包中的 fullscreenLoading 后返回新创建的单例实例。

#### （2）Vuex

Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。Vuex，它们都实现了一个全局的 Store 用于存储应用的所有状态。这个 Store 的实现，正是单例模式的典型应用。

  
Vuex 使用单一状态树，用一个对象就包含了全部的应用层级状态。至此它便作为一个“唯一数据源 (SSOT)”而存在。这也意味着，每个应用将仅仅包含一个 store 实例。单一状态树让我们能够直接地定位任一特定的状态片段，在调试的过程中也能轻易地取得整个当前应用状态的快照。——Vuex官方文档

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;安装vuex插件</span><br>Vue.use(Vuex)<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;将store注入到Vue实例中</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;Vue({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'#app'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;store<br>})<br>
```

通过调用Vue.use()方法，安装了 Vuex 插件。Vuex 插件是一个对象，它在内部实现了一个 install 方法，这个方法会在插件安装时被调用，从而把 Store 注入到Vue实例里去。也就是说每 install 一次，都会尝试给 Vue 实例注入一个 Store。

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">let</span>&nbsp;Vue&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;这个Vue的作用和楼上的instance作用一样</span><br>...<br>export&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">install</span>&nbsp;(<span data-darkreader-inline-outline="">_Vue</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;判断传入的Vue实例对象是否已经被install过Vuex插件（是否有了唯一的state）</span><br>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(Vue&nbsp;&amp;&amp;&nbsp;_Vue&nbsp;===&nbsp;Vue)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(process.env.NODE_ENV&nbsp;!==&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'production'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">console</span>.error(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'[vuex]&nbsp;already&nbsp;installed.&nbsp;Vue.use(Vuex)&nbsp;should&nbsp;be&nbsp;called&nbsp;only&nbsp;once.'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span><br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;若没有，则为这个Vue实例对象install一个唯一的Vuex</span><br>&nbsp;&nbsp;Vue&nbsp;=&nbsp;_Vue<br>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;将Vuex的初始化逻辑写进Vue的钩子函数里</span><br>&nbsp;&nbsp;applyMixin(Vue)<br>}<br>
```

     可以保证一个 Vue 实例（即一个 Vue 应用）只会被 install 一次 Vuex 插件，所以每个 Vue 实例只会拥有一个全局的 Store。

## 工厂模式

**1\. 什么是工厂模式？**

工厂模式就是根据不用的输入返回不同的实例，一般用来创建同一类对象，它的主要思想就是将对象的创建与对象的实现分离。  
在创建对象时，不暴露具体的逻辑，而是将逻辑封装在函数中，那么这个函数就可以被视为一个工厂。工厂模式根据抽象程度的不同可以分为：简单工厂、工厂方法、抽象工厂。

 **Vue中的工厂模式**

（1）VNode

和原生的 document.createElement 类似，Vue 这种具有虚拟 DOM 树（Virtual Dom Tree）机制的框架在生成虚拟 DOM 的时候，提供了 createElement 方法用来生成 VNode，用来作为真实 DOM 节点的映射：

```
createElement(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'h3'</span>,&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'main-title'</span>&nbsp;},&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;createElement(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'img'</span>,&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'avatar'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">attrs</span>:&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">src</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'../avatar.jpg'</span>&nbsp;}&nbsp;}),<br>&nbsp;&nbsp;&nbsp;&nbsp;createElement(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'p'</span>,&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'user-desc'</span>&nbsp;},&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'hello&nbsp;world'</span>)<br>])
```

createElement 函数结构大概如下：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">Vnode</span>&nbsp;(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">tag</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">data</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">children</span>)&nbsp;</span>{&nbsp;...&nbsp;}<br><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">createElement</span>(<span data-darkreader-inline-outline="">tag,&nbsp;data,&nbsp;children</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;Vnode(tag,&nbsp;data,&nbsp;children)<br>}<br>
```

（2）vue-route

在Vue在路由创建模式中，也多次用到了工厂模式：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">VueRouter</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">constructor</span>(options)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.mode&nbsp;=&nbsp;mode&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;路由模式</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">switch</span>&nbsp;(mode)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;简单工厂</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'history'</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;history&nbsp;方式</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.history&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;HTML5History(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>,&nbsp;options.base)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'hash'</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;hash&nbsp;方式</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.history&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;HashHistory(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>,&nbsp;options.base,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.fallback)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">case</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'abstract'</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;abstract&nbsp;方式</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.history&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;AbstractHistory(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>,&nbsp;options.base)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">break</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;...&nbsp;初始化失败报错</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br>
```

mode 是路由创建的模式，这里有三种 History、Hash、Abstract，其中，History 是 H5 的路由方式，Hash 是路由中带 # 的路由方式，Abstract 代表非浏览器环境中路由方式，比如 Node、weex 等；this.history 用来保存路由实例，vue-router 中使用了工厂模式的思想来获得响应路由控制类的实例。

## 策略模式

**1\. 什么是策略模式？**

策略模式 （Strategy Pattern）又称政策模式，其定义一系列的算法，把它们一个个封装起来，并且使它们可以互相替换。封装的策略算法一般是独立的，策略模式根据输入来调整采用哪个算法。关键是策略的实现和使用分离。

**策略模式的实际应用**

（1）表格 formatter

Element UI 的表格控件的 Column 接受一个 formatter 参数，用来格式化内容，其类型为函数，并且还可以接受几个特定参数，像这样：Function(row, column, cellValue, index)。

以文件大小转化为例，后端经常会直接传 bit 单位的文件大小，那么前端需要根据后端的数据，根据需求转化为自己需要的单位的文件大小，比如 KB/MB。

首先实现文件计算的算法：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;StrategyMap&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;Strategy&nbsp;1:&nbsp;将文件大小（bit）转化为&nbsp;KB&nbsp;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">bitToKB</span>:&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">val</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;num&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">Number</span>(val)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">isNaN</span>(num)&nbsp;?&nbsp;val&nbsp;:&nbsp;(num&nbsp;/&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1024</span>).toFixed(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">0</span>)&nbsp;+&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'KB'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;Strategy&nbsp;2:&nbsp;将文件大小（bit）转化为&nbsp;MB&nbsp;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">bitToMB</span>:&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">val</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;num&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">Number</span>(val)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">isNaN</span>(num)&nbsp;?&nbsp;val&nbsp;:&nbsp;(num&nbsp;/&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1024</span>&nbsp;/&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1024</span>).toFixed(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1</span>)&nbsp;+&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'MB'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;Context:&nbsp;生成el表单&nbsp;formatter&nbsp;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;strategyContext&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>(<span data-darkreader-inline-outline="">type,&nbsp;rowKey</span>)</span>{&nbsp;<br>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>(<span data-darkreader-inline-outline="">row,&nbsp;column,&nbsp;cellValue,&nbsp;index</span>)</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StrategyMap[type](row[rowKey])<br>&nbsp;&nbsp;}<br>}<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;strategyContext<br>
```

在组件中直接使用：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:data</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"tableData"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"date"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"日期"</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"name"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"文件名"</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;!--&nbsp;直接调用&nbsp;strategyContext&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"sizeKb"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"文件大小(KB)"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:formatter</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'strategyContext("bitToKB",&nbsp;"sizeKb")'</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"sizeMb"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"附件大小(MB)"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:formatter</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'strategyContext("bitToMB",&nbsp;"sizeMb")'</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table-column</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-table</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'text/javascript'</span>&gt;</span><span data-darkreader-inline-outline=""><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">import</span>&nbsp;strategyContext&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'./strategyContext.js'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'ElTableDemo'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strategyContext,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">tableData</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">date</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'2019-05-02'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'文件1'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">sizeKb</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1234</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">sizeMb</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">1234426</span>&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">date</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'2019-05-04'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'文件2'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">sizeKb</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">4213</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">sizeMb</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">8636152</span>&nbsp;}]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">style</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">scoped</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">style</span>&gt;</span><br>
```

运行结果如下图

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

（2）表单验证

除了表格中的 formatter 之外，策略模式也经常用在表单验证的场景。Element UI 的 Form 表单 具有表单验证功能，用来校验用户输入的表单内容。实际需求中表单验证项一般会比较复杂，所以需要给每个表单项增加 validator 自定义校验方法。

实现通用的表单验证方法：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;src/utils/validates.js</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;姓名校验&nbsp;由2-10位汉字组成&nbsp;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">validateUsername</span>(<span data-darkreader-inline-outline="">str</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;reg&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">/^[\u4e00-\u9fa5]{2,10}$/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;reg.test(str)<br>}<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;手机号校验&nbsp;由以1开头的11位数字组成&nbsp;&nbsp;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">validateMobile</span>(<span data-darkreader-inline-outline="">str</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;reg&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">/^1\d{10}$/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;reg.test(str)<br>}<br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;邮箱校验&nbsp;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">validateEmail</span>(<span data-darkreader-inline-outline="">str</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;reg&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;reg.test(str)<br>}<br>
```

增加一个柯里化方法，用来生成表单验证函数：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;src/utils/index.js</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">import</span>&nbsp;*&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">as</span>&nbsp;Validates&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'./validates.js'</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;生成表格自定义校验函数&nbsp;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">const</span>&nbsp;formValidateGene&nbsp;=&nbsp;<span data-darkreader-inline-outline="">(<span data-darkreader-inline-outline="">key,&nbsp;msg</span>)&nbsp;=&gt;</span>&nbsp;<span data-darkreader-inline-outline="">(<span data-darkreader-inline-outline="">rule,&nbsp;value,&nbsp;cb</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(Validates[key](value))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb()<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">Error</span>(msg))<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br>
```

具体使用：  

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">ref</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"ruleForm"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label-width</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"100px"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"demo-ruleForm"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:rules</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"rules"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">:model</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"ruleForm"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"用户名"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"username"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"ruleForm.username"</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"手机号"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"mobile"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"ruleForm.mobile"</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"邮箱"</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"email"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"ruleForm.email"</span>&gt;&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-input</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">el-form</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'text/javascript'</span>&gt;</span><span data-darkreader-inline-outline=""><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">import</span>&nbsp;*&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">as</span>&nbsp;Utils&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'../utils'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'ElTableDemo'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">ruleForm</span>:&nbsp;{&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">pass</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">''</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">checkPass</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">''</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">age</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">''</span>&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">rules</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">username</span>:&nbsp;[{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">validator</span>:&nbsp;Utils.formValidateGene(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'validateUsername'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'姓名由2-10位汉字组成'</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">trigger</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'blur'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">mobile</span>:&nbsp;[{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">validator</span>:&nbsp;Utils.formValidateGene(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'validateMobile'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'手机号由以1开头的11位数字组成'</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">trigger</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'blur'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">email</span>:&nbsp;[{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">validator</span>:&nbsp;Utils.formValidateGene(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'validateEmail'</span>,&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'不是正确的邮箱格式'</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">trigger</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'blur'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&gt;</span><br>
```

效果如图：  

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## 代理模式

**1\. 什么是代理模式？**

代理模式 （Proxy Pattern）又称委托模式，它为目标对象创造了一个代理对象，以控制对目标对象的访问。

代理模式把代理对象插入到访问者和目标对象之间，从而为访问者对目标对象的访问引入一定的间接性。正是这种间接性，给了代理对象很多操作空间，比如在调用目标对象前和调用后进行一些预操作和后操作，从而实现新的功能或者扩展目标的功能。

**代理模式在实战中的应用**

（1）拦截器

在项目中经常使用 Axios 的实例来进行 HTTP 的请求，使用拦截器 interceptor 可以提前对 request 请求和 response 返回进行一些预处理，比如：

  
1、request 请求头的设置，和 Cookie 信息的设置；  
2、权限信息的预处理，常见的比如验权操作或者 Token 验证；  
3、数据格式的格式化，比如对组件绑定的 Date 类型的数据在请求前进行一些格式约定好的序列化操作；  
4、空字段的格式预处理，根据后端进行一些过滤操作；  
5、response 的一些通用报错处理，比如使用 Message 控件抛出错误；

除了 HTTP 相关的拦截器之外，还有路由跳转的拦截器，可以进行一些路由跳转的预处理等操作。

（2）前端框架的数据响应式化

Vue 2.x 中通过 Object.defineProperty 来劫持各个属性的 setter/getter，在数据变动时，通过发布-订阅模式发布消息给订阅者，触发相应的监听回调，从而实现数据的响应式化，也就是数据到视图的双向绑定。

为什么 Vue 2.x 到 3.x 要从

 Object.defineProperty 改用 Proxy 呢，是因为前者的一些局限性，导致的以下缺陷：

  
1、无法监听利用索引直接设置数组的一个项，例如：vm.items\[indexOfItem\] = newValue；  
2、无法监听数组的长度的修改，例如：vm.items.length = newLength；  
3、无法监听 ES6 的 Set、WeakSet、Map、WeakMap 的变化；  
4、无法监听 Class 类型的数据；  
5、无法监听对象属性的新加或者删除；

## 适配器模式

**1\. 什么是适配器模式？**

适配器模式（Adapter Pattern）又称包装器模式，将一个类（对象）的接口（方法、属性）转化为用户需要的另一个接口，解决类（对象）之间接口不兼容的问题。

主要功能是进行转换匹配，目的是复用已有的功能，而不是来实现新的接口。也就是说，访问者需要的功能应该是已经实现好了的，不需要适配器模式来实现，适配器模式主要是负责把不兼容的接口转换成访问者期望的格式而已。

**适配器的实际案例**

（1）Vue 计算属性

Vue 中的计算属性也是一个适配器模式的实例，以官网的例子为例：

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">id</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">"example"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">p</span>&gt;</span>Original&nbsp;message:&nbsp;"{{&nbsp;message&nbsp;}}"<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">p</span>&gt;</span>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;!--&nbsp;Hello&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">p</span>&gt;</span>Computed&nbsp;reversed&nbsp;message:&nbsp;"{{&nbsp;reversedMessage&nbsp;}}"<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">p</span>&gt;</span>&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;!--&nbsp;olleH&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">div</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">template</span>&gt;</span><br><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'text/javascript'</span>&gt;</span><span data-darkreader-inline-outline=""><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">name</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'demo'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">message</span>:&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'Hello'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">computed</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">reversedMessage</span>:&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>()&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">this</span>.message.split(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">''</span>).reverse().join(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">''</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-outline="" data-darkreader-inline-color="">script</span>&gt;</span>
```

对原有数据并没有改变，只改变了原有数据的表现形式。

（2） 源码中的适配器模式

Axios 的用来发送请求的 adapter 本质上是封装浏览器提供的 API XMLHttpRequest。

```
<span data-darkreader-inline-outline="" data-darkreader-inline-color="">module</span>.exports&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">xhrAdapter</span>(<span data-darkreader-inline-outline="">config</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">Promise</span>(<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">dispatchXhrRequest</span>(<span data-darkreader-inline-outline="">resolve,&nbsp;reject</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">var</span>&nbsp;requestData&nbsp;=&nbsp;config.data<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">var</span>&nbsp;requestHeaders&nbsp;=&nbsp;config.headers<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">var</span>&nbsp;request&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">new</span>&nbsp;XMLHttpRequest()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;初始化一个请求</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.open(config.method.toUpperCase(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildURL(config.url,&nbsp;config.params,&nbsp;config.paramsSerializer),&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">true</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;设置最大超时时间</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.timeout&nbsp;=&nbsp;config.timeout<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;readyState&nbsp;属性发生变化时的回调</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.onreadystatechange&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">handleLoad</span>()&nbsp;</span>{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;浏览器请求退出时的回调</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.onabort&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">handleAbort</span>()&nbsp;</span>{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;当请求报错时的回调</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.onerror&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">handleError</span>()&nbsp;</span>{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;当请求超时调用的回调</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.ontimeout&nbsp;=&nbsp;<span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-outline="">handleTimeout</span>()&nbsp;</span>{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;设置HTTP请求头的值</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-outline="" data-darkreader-inline-color="">'setRequestHeader'</span>&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">in</span>&nbsp;request)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setRequestHeader(key,&nbsp;val)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;跨域的请求是否应该使用证书</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(config.withCredentials)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.withCredentials&nbsp;=&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">true</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;响应类型</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">if</span>&nbsp;(config.responseType)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.responseType&nbsp;=&nbsp;config.responseType<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-outline="" data-darkreader-inline-color="">//&nbsp;发送请求</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.send(requestData)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br>
```

这个模块主要是对请求头、请求配置和一些回调的设置，并没有对原生的 API 有改动，所以也可以在其他地方正常使用。这个适配器可以看作是对 XMLHttpRequest 的适配，是用户对 Axios 调用层到原生 XMLHttpRequest 这个 API 之间的适配层。

## 观察者模式/发布-订阅模式

**1\. 什么是观察者模式？**

观察者模式（Observer Pattern）定义了一种一对多的关系，让多个订阅者对象同时监听某一个发布者，或者叫主题对象，这个主题对象的状态发生变化时就会通知所有订阅自己的订阅者对象，使得它们能够自动更新自己。

2**. 什么是发布-订阅模式？**

其实它是发布订阅模式的一个别名，但两者又有所不同。这个别名非常形象地诠释了观察者模式里两个核心的角色要素——发布者和订阅者。

**发布-订阅模式有一个调度中心**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

观察者模式是由具体目标调度的，而发布-订阅模式是统一由调度中心调的

**Vue中的发布-订阅模式**

（1）EventBus

在Vue中有一套事件机制，其中一个用法是 EventBus。可以使用 EventBus 来解决组件间的数据通信问题。

响应式化大致就是使用 Object.defineProperty 把数据转为 getter/setter，并为每个数据添加一个订阅者列表的过程。这个列表是 getter 闭包中的属性，将会记录所有依赖这个数据的组件。也就是说，响应式化后的数据相当于发布者。

每个组件都对应一个 Watcher 订阅者。当每个组件的渲染函数被执行时，都会将本组件的 Watcher 放到自己所依赖的响应式数据的订阅者列表里，这就相当于完成了订阅，一般这个过程被称为依赖收集（Dependency Collect）。

  
当响应式数据发生变化的时候，也就是触发了 setter 时，setter 会负责通知（Notify）该数据的订阅者列表里的 Watcher，Watcher 会触发组件重渲染（Trigger re-render）来更新（update）视图。