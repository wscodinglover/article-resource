> 作者：隔壁老王z
> 
> https://juejin.cn/post/7293173815181738022

在日常开发时，弹窗是一个经常使用的功能，而且重复性极高，你可能会遇到下面这些问题:1、一个页面内多个弹窗, 要维护多套弹窗状态,看的眼花缭乱2、弹窗内容比较简单，声明变量 + 模板语法的方式写起来比较麻烦

关于这些问题, 我首先想到的是应该弄一个即用即走的`Dialog`，不用去单独维护它的状态，使用`Dialog({ xxx })`这种形式去调用它，例如下面这种配置的方式：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">Dialog({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'xxx'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">render</span>:&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;xxx<br>})<br></code>
```

其中`render`可以是一个`html`字符串，也可以是`jsx`(需要配置对jsx的支持)，这样可以对内容区域实现自定义。

## 通过配置项调用

各大主流的ui库基本都实现了这种调用方式：

-   Ant Design Vue的  Modal
    
-   Element-plus的  MessageBox
    

之前没有注意到`Element-plus`的`MessageBox`可以使用jsx，大部分场景下,用它来代替`Dialog`还是很方便的。**示例代码:**

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;lang=<span data-darkreader-inline-color="">"jsx"</span>&nbsp;setup&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;reactive,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ElMessageBox,&nbsp;ElForm,&nbsp;ElFormItem,&nbsp;ElInput&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'element-plus'</span><br><br><span data-darkreader-inline-color="">const</span>&nbsp;formRef&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">null</span>)<br><span data-darkreader-inline-color="">const</span>&nbsp;form&nbsp;=&nbsp;reactive({&nbsp;<span data-darkreader-inline-color="">height</span>:&nbsp;<span data-darkreader-inline-color="">''</span>,&nbsp;<span data-darkreader-inline-color="">width</span>:&nbsp;<span data-darkreader-inline-color="">''</span>&nbsp;})<br><span data-darkreader-inline-color="">const</span>&nbsp;rules&nbsp;=&nbsp;reactive({<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">height</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">required</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">trigger</span>:&nbsp;<span data-darkreader-inline-color="">'blur'</span><br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">width</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">required</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">trigger</span>:&nbsp;<span data-darkreader-inline-color="">'blur'</span><br>&nbsp;&nbsp;}<br>})<br><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">openMessageBox</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;ElMessageBox({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;<span data-darkreader-inline-color="">'Message'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">showCancelButton</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;message如果不是函数形式&nbsp;绑定ref会失败</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">message</span>:&nbsp;<span><span>()</span>&nbsp;=&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span data-darkreader-inline-color="">ElForm</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">ref</span>=<span data-darkreader-inline-color="">{formRef}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">model</span>=<span data-darkreader-inline-color="">{form}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">rules</span>=<span data-darkreader-inline-color="">{rules}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ElFormItem</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"height"</span>&nbsp;<span data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-color="">"height"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ElInput</span>&nbsp;<span data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-color="">{form.height}</span>&gt;</span><span>&lt;/<span data-darkreader-inline-color="">ElInput</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">ElFormItem</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ElFormItem</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"width"</span>&nbsp;<span data-darkreader-inline-color="">prop</span>=<span data-darkreader-inline-color="">"width"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ElInput</span>&nbsp;<span data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-color="">{form.width}</span>&gt;</span><span>&lt;/<span data-darkreader-inline-color="">ElInput</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">ElFormItem</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">ElForm</span>&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">beforeClose</span>:&nbsp;<span>(<span>action,&nbsp;instance,&nbsp;done</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(action,&nbsp;instance)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formRef.value&nbsp;&amp;&amp;&nbsp;formRef.value.validate(<span><span>status</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">'校验状态:&nbsp;'</span>,&nbsp;status)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(status&nbsp;||&nbsp;action===<span data-darkreader-inline-color="">'cancel'</span>)&nbsp;done()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;})<br>}<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="container"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;@click="openMessageBox"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打开messagebox<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span>button&gt;<br>&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br>&lt;/</span>template&gt;<br></code>
```

**效果如下:**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## vueuse的createTemplatePromise

如果你不想使用`jsx`，而是想使用模板，`vue`的`hooks`工具库`vueuse`中提供了 createTemplatePromise 这个函数用来创建对话框、模态框、Toast 等，并且完全使用的是`template`的方式，因此自定义程度更高，并且没有任何额外成本(不需要jsx)。下面是一个`createTemplatePromise`结合`el-dialog`的例子(当然也可以结合其它的`dialog`或者自定义`dialog`)：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;lang=<span data-darkreader-inline-color="">"jsx"</span>&nbsp;setup&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;createTemplatePromise&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'@vueuse/core'</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ElDialog,&nbsp;ElButton&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'element-plus'</span><br><br><span data-darkreader-inline-color="">const</span>&nbsp;TemplatePromise&nbsp;=&nbsp;createTemplatePromise()<br><br><span data-darkreader-inline-color="">async</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">open</span>(<span>idx</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(idx,&nbsp;<span data-darkreader-inline-color="">'Before'</span>)<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;result&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;TemplatePromise.start(<span data-darkreader-inline-color="">'Title'</span>,&nbsp;<span data-darkreader-inline-color="">`Hello&nbsp;<span data-darkreader-inline-color="">${idx}</span>`</span>)<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(idx,&nbsp;<span data-darkreader-inline-color="">'After'</span>,&nbsp;result)<br>}<br><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">asyncFn</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span>(<span>resolve</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(<span data-darkreader-inline-color="">'ok'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">1000</span>)<br>&nbsp;&nbsp;})<br>}<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br><br>&lt;template&gt;<br>&nbsp;&nbsp;&lt;div&nbsp;class="container"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;@click="open(1);&nbsp;open(2)"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打开两个弹框<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span>button&gt;<br>&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/div&gt;<br>&nbsp;&nbsp;&lt;TemplatePromise&nbsp;v-slot="{&nbsp;resolve,&nbsp;args,&nbsp;isResolving&nbsp;}"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;el-dialog&nbsp;:modelValue="true"&nbsp;:title="args[0]"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Dialog&nbsp;{{&nbsp;args[1]&nbsp;}}&lt;/</span>div&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span data-darkreader-inline-color="">p</span>&gt;</span>可以打开控制台查看logs<span>&lt;/<span data-darkreader-inline-color="">p</span>&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><span>&lt;<span data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"flex&nbsp;gap-2&nbsp;justify-end"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">el-button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"resolve('cancel')"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">el-button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">el-button</span>&nbsp;<span data-darkreader-inline-color="">type</span>=<span data-darkreader-inline-color="">"primary"</span>&nbsp;<span data-darkreader-inline-color="">:disabled</span>=<span data-darkreader-inline-color="">"isResolving"</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"resolve(asyncFn())"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{&nbsp;isResolving&nbsp;?&nbsp;'loading...'&nbsp;:&nbsp;'确认'&nbsp;}}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">el-button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span data-darkreader-inline-color="">/el-dialog&gt;<br>&nbsp;&nbsp;&lt;/</span>TemplatePromise&gt;<br>&lt;<span data-darkreader-inline-color="">/template&gt;<br></span></code>
```

**效果如图:**

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

  

#### Promise化Dialog的优点

这样有小伙伴可能会说, 这看起来和原来用`dialog`也没有很大区别啊, 也要写模版 + 函数方法. 那么让`dialog`变成这样有什么好处呢?

1、最大的好处是弹窗变得可编程了, 通过函数调用的方式来控制`UI`. 不用再单独声明变量控制显隐, 也不用单独再去控制按钮的`禁用`、`loading`等状态. 例如以上的例子中, 我们可以轻松的处理`button`的`loading`状态(不用再额外声明变量), 用`Promise`让`Dialog`的`UI`和状态实现了內聚.

2、相比第一种方式, 对UI的可自定义程度更高.

## demo地址

代码地址：https://github.com/plutda/functional-dialog

在线预览地址：https://plutda.github.io/functional-dialog