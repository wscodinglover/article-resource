> ä½œè€…ï¼šedisonC

> åŸæ–‡åœ°å€ï¼šhttps://juejin.im/post/6854573222415826957

## ç®€ä»‹

ğŸ˜› é—²æš‡æ—¶é—´æƒ³åšä¸€ä¸ªèŠå¤©å®¤å¤ç›˜ä¸€ä¸‹è¿™äº›å¹´å­¦ä¹ åˆ°çš„æŠ€æœ¯ï¼Œäºæ˜¯åœ¨2020å¹´6æœˆ24å·å°±å¼€å§‹äº† Genal èŠå¤©å®¤çš„å¼€å‘ä¹‹æ—…ã€‚  
ğŸ˜ˆ é¡¹ç›®é‡‡ç”¨å…¨ typescript å¼€å‘ï¼Œè¿™æ˜¯ä¸ºäº†ä»¥åçš„åŠŸèƒ½è¿­ä»£æ‰“åŸºç¡€ã€‚å½“ç„¶ï¼Œæˆ‘æœ¬èº«ä¹Ÿæ˜¯å¾ˆå–œæ¬¢ typescript çš„ã€‚

## é¡¹ç›®ç•Œé¢

Â ![Image](https://mmbiz.qpic.cn/mmbiz_gif/YBFV3Da0NwthzZHH0XvSRTIw64h1wBMmia6vcoDRdaxQyxIgZH9EILGwTXdF6GnnJTOTxWQqp7buWP0gYiaiauxKQ/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)Â 

## åŠŸèƒ½ä»‹ç»  

-   æ›´æ”¹ç”¨æˆ·å/å¤´åƒä¸Šä¼ 
    
-   ç¾¤èŠ/ç§èŠ
    
-   åˆ›å»ºç¾¤/åŠ å…¥ç¾¤èŠ/æ¨¡ç³Šæœç´¢ç¾¤
    
-   æ·»åŠ å¥½å‹/æ¨¡ç³Šæœç´¢å¥½å‹
    
-   è¡¨æƒ…åŒ…
    
-   æ¶ˆæ¯åˆ†é¡µ
    

## æŠ€æœ¯æ¦‚è§ˆ

-   **Typescript**ï¼šJavaScript çš„ä¸€ä¸ªè¶…é›†ï¼Œå®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯æä¾›äº†ç±»å‹ç³»ç»Ÿå’Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
    
-   **Vue2.6.x**ï¼šå‰ç«¯æ¸è¿›å¼æ¡†æ¶ã€‚
    
-   **Socket/io**ï¼šå®ç°å®æ—¶é€šä¿¡ï¼Œwebsocket ç¬¬ä¸‰æ–¹åº“ã€‚
    
-   **Vuex**ï¼šä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚
    
-   **Nestjs**ï¼šæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ Node.js æœåŠ¡ç«¯åº”ç”¨æ¡†æ¶ï¼ŒåŸºäº TypeScript ç¼–å†™å¹¶ä¸”ç»“åˆäº† OOP1ã€FP2ã€FRP3 çš„ç›¸å…³ç†å¿µã€‚
    
-   **Typeorm**: æ”¯æŒæœ€æ–°çš„ JavaScript ç‰¹æ€§å¹¶æä¾›é¢å¤–çš„ç‰¹æ€§ä»¥å¸®åŠ©ä½ å¼€å‘ä»»ä½•ä½¿ç”¨æ•°æ®åº“çš„åº”ç”¨ç¨‹åºã€‚
    
-   **ES6+**ï¼šé‡‡ç”¨ ES6+ è¯­æ³•ï¼Œç®­å¤´å‡½æ•°ã€async/await ç­‰ç­‰è¯­æ³•å¾ˆå¥½ç”¨ã€‚
    
-   **SASS(SCSS)**ï¼šç”¨ SCSS åš CSS é¢„å¤„ç†è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨æœ€é«˜æ•ˆçš„æ–¹å¼ï¼Œä»¥å°‘é‡çš„ä»£ç åˆ›å»ºå¤æ‚çš„è®¾è®¡ã€‚
    

## æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

æ•°æ®åº“ä½¿ç”¨äº†å…­å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯

-   user ç”¨æˆ·è¡¨
    
-   group ç¾¤è¡¨
    
-   user\_group ç”¨æˆ·\_ç¾¤ä¸­é—´è¡¨
    
-   group\_message ç¾¤æ¶ˆæ¯è¡¨
    
-   user\_friend ç”¨æˆ·\_å¥½å‹ä¸­é—´è¡¨
    
-   friend\_message ç§èŠæ¶ˆæ¯è¡¨
    

å…¶ä¸­ä¸­é—´è¡¨ç”¨äºå»ºç«‹å¯¹äºç¾¤/å¥½å‹ä¸ç”¨æˆ·ä¹‹é—´çš„è”ç³»ã€‚ä¸‹é¢æ˜¯æˆ‘ç”»çš„æ€ç»´å¯¼å›¾ï¼Œç›¸ä¿¡å¤§å®¶çœ‹å®Œå°±èƒ½ç†è§£å…¶ä¸­çš„å¥¥å¦™å•¦ã€‚  
![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## WebSocketçš„å»ºç«‹é€»è¾‘

### ç”¨æˆ·æˆ¿é—´çš„å»ºç«‹

æ¯ä¸ªç”¨æˆ·è¿›å…¥èŠå¤©å®¤éƒ½ä¼šè‡ªåŠ¨åŠ å…¥åä¸º public çš„ WebSocket æˆ¿é—´å’Œä»¥ç”¨æˆ· id ä¸ºå‘½åçš„ WebSocket æˆ¿é—´ï¼Œå…¶ä¸­å»ºç«‹ç”¨æˆ·æˆ¿é—´æ˜¯ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿé’ˆå¯¹ç”¨æˆ·å•ç‹¬å¹¿æ’­äº‹ä»¶ã€‚å¦‚æœä¸äº†è§£æˆ¿é—´çš„æ¦‚å¿µï¼Œå¯ä»¥è®¤ä¸ºåªæœ‰æˆ¿é—´å†…çš„äººæ‰èƒ½æ¥æ”¶åˆ°æˆ¿é—´å†…çš„å¹¿æ’­ï¼Œæ›´å¤šä¿¡æ¯è¯·ç§»æ­¥ socket.io å®˜ç½‘ã€‚

### ç¾¤èŠæˆ¿é—´çš„å»ºç«‹

ä»¥ groupId ä½œä¸º WebSocket æˆ¿é—´çš„åå­—ï¼Œæ¯æ¬¡æœ‰æ–°ç”¨æˆ·åŠ å…¥ç¾¤éƒ½ä¼šåœ¨ç¾¤æˆ¿é—´å†…å¹¿æ’­ç”¨æˆ·è¿›ç¾¤äº‹ä»¶å¹¶é™„å¸¦ä¸Šæ–°ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œç„¶åå…¶ä»–ç”¨æˆ·ä¼šå­˜å‚¨æ–°ç”¨æˆ·çš„ä¿¡æ¯ã€‚å½“æ–°ç”¨æˆ·å‘æ¶ˆæ¯çš„æ—¶å€™ï¼Œå…¶ä»–ç”¨æˆ·æ”¶åˆ°æ¶ˆæ¯åå¯ä»¥é€šè¿‡æ¶ˆæ¯çš„userIdæ‰¾åˆ°å¯¹åº”ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™æ ·èƒ½ä¿è¯æ¶ˆæ¯å‘å‡ºåå…¶ä»–ç”¨æˆ·èƒ½å¤Ÿå¿«é€ŸçŸ¥é“æ¶ˆæ¯çš„ä¸»äºº.

### ç§èŠæˆ¿é—´çš„å»ºç«‹

æ¯å½“å‘èµ·ä¸€ä¸ªæ·»åŠ å¥½å‹çš„è¯·æ±‚ï¼Œå°±ä¼šæŠŠç”¨æˆ·çš„ userId å’Œå¥½å‹çš„ userId æ‹¼æ¥æˆçš„å­—ç¬¦ä¸²ä½œä¸º WebSocket çš„æˆ¿é—´åï¼Œä»è€Œå»ºç«‹ç§èŠæˆ¿é—´ã€‚

## åç«¯æ¶æ„

åç«¯ä½¿ç”¨äº† nestjs è¿™ä¸ªè¿‘å‡ å¹´å‘å±•è¿…çŒ›çš„ node.js æ¡†æ¶ã€‚nestjs çš„ä¼˜åŠ¿æœ‰å¾ˆå¤šï¼Œ æˆ‘åªåˆ—ä¸¾å‡ºä»¥ä¸‹å‡ ç‚¹ï¼š

1.  åŸºäº TypeScript æ„å»ºï¼ŒåŒæ—¶å…¼å®¹æ™®é€šçš„ ES6ã€‚
    
2.  nestjs çš„ä¾èµ–æ³¨å…¥ä»¥åŠæ¨¡å—åŒ–çš„æ€æƒ³ï¼Œä½¿å¾—ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤ã€‚
    
3.  nestjs çš„ @nestjs/websockets åŒ…å°è£…å¥½äº†å¯¹äº WebSocket äº‹ä»¶çš„å¤„ç†ï¼Œå¯¹äºå¼€å‘èŠå¤©å®¤æœ‰ä¼˜åŠ¿ã€‚
    

ä¸‹é¢æ˜¯ä¸€äº›åç«¯çš„é€»è¾‘ä»£ç ã€‚

1.  ä½¿ç”¨ nestjs å»ºç«‹ WebSocket è¿æ¥
    

```
<span data-darkreader-inline-color="">//&nbsp;chat.gateway.ts</span><br>@WebSocketGateway()<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color=""><span data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-color="">ChatGateway</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;socketè¿æ¥é’©å­</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;handleConnection(client:&nbsp;Socket):&nbsp;<span data-darkreader-inline-color="">Promise</span>&lt;string&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;userRoom&nbsp;=&nbsp;client.handshake.query.userId;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;è¿æ¥é»˜è®¤åŠ å…¥publicæˆ¿é—´</span><br>&nbsp;&nbsp;&nbsp;&nbsp;client.join(<span data-darkreader-inline-color="">'public'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ç”¨æˆ·ç‹¬æœ‰æ¶ˆæ¯æˆ¿é—´&nbsp;æ ¹æ®userId</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>(userRoom)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.join(userRoom);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'è¿æ¥æˆåŠŸ'</span><br>&nbsp;&nbsp;}<br>}<br>
```

2.  å°è£…å…¨å±€çš„ä¸­é—´ä»¶ï¼Œæ–¹ä¾¿åœ¨å¼€å‘è¿‡ç¨‹ä¸­è°ƒè¯•ã€‚
    

```
<span data-darkreader-inline-color="">//&nbsp;middleware.js</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span>logger</span>(<span>req,&nbsp;res,&nbsp;next</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;method,&nbsp;path&nbsp;}&nbsp;=&nbsp;req;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${method}</span>&nbsp;<span data-darkreader-inline-color="">${path}</span>`</span>);<br>&nbsp;&nbsp;next();<br>};<br><br><span data-darkreader-inline-color="">//&nbsp;main.js&nbsp;</span><br>ä½¿ç”¨å…¨å±€ä¸­é—´ä»¶<br>app.use(logger)<br>
```

3.  nestjs çš„é™æ€èµ„æºé…ç½®
    

```
<span data-darkreader-inline-color="">//&nbsp;main.js</span><br>é…ç½®é™æ€èµ„æº<br>app.useStaticAssets(join(__dirname,&nbsp;<span data-darkreader-inline-color="">'../public/'</span>,&nbsp;<span data-darkreader-inline-color="">'static'</span>),&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">prefix</span>:&nbsp;<span data-darkreader-inline-color="">'/static/'</span>,&nbsp;<br>});<br>
```

4.  nestjs è‡ªå®šä¹‰å¼‚å¸¸è¿‡æ»¤å™¨
    

```
<span data-darkreader-inline-color="">//&nbsp;http-exception.filter.ts</span><br>@Catch(HttpException)<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color=""><span data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-color="">HttpExceptionFilter</span>&nbsp;<span data-darkreader-inline-color="">implements</span>&nbsp;<span data-darkreader-inline-color="">ExceptionFilter</span>&lt;<span data-darkreader-inline-color="">HttpException</span>&gt;&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">catch</span>(exception:&nbsp;HttpException,&nbsp;<span data-darkreader-inline-color="">host</span>:&nbsp;ArgumentsHost)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;ctx&nbsp;=&nbsp;host.switchToHttp();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;response&nbsp;=&nbsp;ctx.getResponse();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;request&nbsp;=&nbsp;ctx.getRequest();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;status&nbsp;=&nbsp;exception.getStatus();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;exceptionRes:&nbsp;any&nbsp;=&nbsp;exception.getResponse();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message,<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;=&nbsp;exceptionRes;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ä»¥ä¸‹æ ¼å¼å°†åœ¨å‘ç”Ÿé”™è¯¯æ˜¯è¿”å›ç»™å‰ç«¯</span><br>&nbsp;&nbsp;&nbsp;&nbsp;response.status(status).json({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">timestamp</span>:&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Date</span>().toISOString(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">path</span>:&nbsp;request.url,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message,<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>}<br>
```

## å‰ç«¯æ¶æ„

### é¡µé¢åˆå§‹åŒ–

åˆå§‹åŒ–ä¼šè°ƒèµ· WebSocket è¿æ¥å‡½æ•°ï¼Œç„¶åæ‹¿åˆ°ç”¨æˆ·æ‰€æœ‰çš„ç¾¤ä¿¡æ¯å’Œæ‰€æœ‰çš„å¥½å‹ä¿¡æ¯ï¼Œå†é€šè¿‡å»ºç«‹ WebSocket é€šä¿¡çš„è§„åˆ™åŠ å…¥åˆ°å¯¹åº”çš„æˆ¿é—´ï¼Œç„¶åä½¿ç”¨ vuex æ´¾å‘æœ€æ–°çš„æ•°æ®ã€‚

### æ•°æ®å¤„ç†

ç¾¤çš„æ•°æ®ç±»å‹

```
<span data-darkreader-inline-color="">//&nbsp;ç¾¤ç»„</span><br>interface&nbsp;Group&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">groupId</span>:&nbsp;string;<br>&nbsp;&nbsp;userId:&nbsp;string;&nbsp;<span data-darkreader-inline-color="">//&nbsp;ç¾¤ä¸»id</span><br>&nbsp;&nbsp;groupName:&nbsp;string;<br>&nbsp;&nbsp;notice:&nbsp;string;<br>&nbsp;&nbsp;messages:&nbsp;GroupMessage[];<br>&nbsp;&nbsp;createTime:&nbsp;number;<br>}<br>
```

å¥½å‹çš„æ•°æ®ç±»å‹

```
<span data-darkreader-inline-color="">//&nbsp;å¥½å‹</span><br>interface&nbsp;Friend&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">userId</span>:&nbsp;string;<br>&nbsp;&nbsp;username:&nbsp;string;<br>&nbsp;&nbsp;avatar:&nbsp;string;<br>&nbsp;&nbsp;role?:&nbsp;string;<br>&nbsp;&nbsp;tag?:&nbsp;string;<br>&nbsp;&nbsp;messages:&nbsp;FriendMessage[];<br>&nbsp;&nbsp;createTime:&nbsp;number;<br>}<br>
```

æˆ‘æ›¾ç»ç”¨å¯¹è±¡æ•°ç»„ \[ friend1 , friend2 ... \] è¿™æ ·çš„ç»“æ„å»ç®¡ç†æ‰€æœ‰çš„ ç¾¤/å¥½å‹ æ•°æ®ï¼Œä½†æ˜¯å½“æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢å’Œæ›´æ–° ç¾¤/å¥½å‹ æ•°æ®ä¼šå˜å¾—å¾ˆæ¶ˆè€—æ€§èƒ½ã€‚æ¯æ¬¡å¥½å‹åå­—å˜äº†æˆ–è€…å¤´åƒå˜äº†å°±å¾—éå†æŸ¥æ‰¾ä¸€éæ•°ç»„æ‰èƒ½æ›´æ–°ç›¸åº”ä¿¡æ¯ã€‚  
åæ¥æˆ‘ç”¨å¯¹è±¡çš„ç»“æ„ï¼Œä¼˜åŒ–äº†èŠå¤©å®¤çš„ä»£ç ã€‚æˆ‘ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ gather æ¥ç®¡ç† ç¾¤/å¥½å‹ çš„ä¿¡æ¯ï¼Œ gather çš„é”®ä¸º groupId/userId ï¼Œå€¼ä¸ºå¯¹åº”çš„ ç¾¤/å¥½å‹ çš„æ•°æ®ï¼Œç»“æ„å¦‚ä¸‹

```
gather&nbsp;=&nbsp;{<br>&nbsp;<span data-darkreader-inline-color="">'userId'</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">userId</span>:&nbsp;<span data-darkreader-inline-color="">'userId'</span><br>&nbsp;&nbsp;&nbsp;username:&nbsp;<span data-darkreader-inline-color="">'xxx'</span><br>&nbsp;&nbsp;&nbsp;messages:&nbsp;[];<br>&nbsp;&nbsp;&nbsp;...<br>&nbsp;}<br>}<br>
```

æ¯ä¸ªç¾¤å’Œç”¨æˆ·éƒ½æœ‰ç‹¬ä¸€æ— äºŒçš„ idï¼Œæ‰€ä»¥æ— éœ€æ‹…å¿ƒé‡å¤ã€‚ä½¿ç”¨è¿™æ ·çš„ç»“æ„åï¼Œæ›´æ–°æ•°æ®ä¾¿éå¸¸çš„è½»æ¾ï¼Œåªéœ€è¦æ‹¿åˆ°éœ€è¦æ›´æ–°çš„idï¼Œç„¶åç›´æ¥è¦†ç›– gather.id å¯¹åº”çš„å€¼å°±è¡Œäº†

## vuex

èŠå¤©å®¤æ¶‰åŠåˆ°æ•°æ®çš„å³æ—¶æ›´æ–°å’Œå„ä¸ª vue ç»„ä»¶çš„æ•°æ®åŒæ­¥ï¼Œå¤„ç†è¿™æ ·çš„ä¸šåŠ¡åœºæ™¯æ˜¯ vuex çš„å¼ºé¡¹ã€‚æˆ‘æŠŠå»ºç«‹ WebSocket è¿æ¥çš„å‡½æ•°å†™åœ¨äº† vuex çš„ action ä¸­ï¼Œåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåè°ƒèµ·è¿æ¥å‡½æ•°ï¼Œä¸‹é¢æ˜¯ç²¾ç®€åçš„ä»£ç ã€‚

```
<span data-darkreader-inline-color="">//&nbsp;actions.ts</span><br><span data-darkreader-inline-color="">const</span>&nbsp;actions:&nbsp;ActionTree&lt;ChatState,&nbsp;RootState&gt;&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;åˆå§‹åŒ–WebSocket</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;connectSocket({commit,&nbsp;state,&nbsp;dispatch,&nbsp;rootState},&nbsp;callback)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;WebSocketè¿æ¥å»ºç«‹</span><br>&nbsp;&nbsp;&nbsp;&nbsp;socket.on(<span data-darkreader-inline-color="">'connect'</span>,&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;è®¢é˜…ç¾¤æ¶ˆæ¯æ—¶é—´</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket.on(<span data-darkreader-inline-color="">'groupMessage'</span>,&nbsp;(res:&nbsp;any)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">'on&nbsp;groupMessage'</span>,&nbsp;res)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!res.code)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;å¯¹ç¾¤æ¶ˆæ¯è¿›è¡Œå¤„ç†</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commit(ADD_GROUP_MESSAGE,&nbsp;res.data)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>
```

ä¸å¾—ä¸è¯´ vuex-class è¿™ä¸ªåº“å¸®äº†æˆ‘å¾ˆå¤§çš„å¿™ï¼Œå®ƒæ˜¯ vuex ç»“åˆ typescript å¼€å‘çš„å¾ˆå¥½çš„ç²˜åˆå‰‚ã€‚ä½¿ç”¨äº† vuex-class ï¼Œé‚£ä¹ˆåœ¨ vue ç»„ä»¶ä¸­è°ƒç”¨ vuex çš„æ–¹æ³•åªéœ€è¦è¿™ä¹ˆå†™ï¼š

```
<span data-darkreader-inline-color="">//&nbsp;GenalChat.vue</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;namespace&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vuex-class'</span><br><span data-darkreader-inline-color="">const</span>&nbsp;appModule&nbsp;=&nbsp;namespace(<span data-darkreader-inline-color="">'app'</span>)<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;<span data-darkreader-inline-color=""><span data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-color="">GenalChat</span>&nbsp;<span data-darkreader-inline-color="">extends</span>&nbsp;<span data-darkreader-inline-color="">Vue</span>&nbsp;</span>{<br>&nbsp;&nbsp;@appModule.Getter(<span data-darkreader-inline-color="">'user'</span>)&nbsp;user:&nbsp;User;<br>&nbsp;&nbsp;@appModule.Action(<span data-darkreader-inline-color="">'login'</span>)&nbsp;login:&nbsp;<span data-darkreader-inline-color="">Function</span>;<br>}<br>
```

## æ€»ç»“

â€ƒâ€ƒç›®å‰èŠå¤©å®¤å·²ç»å®Œæˆæ—¥å¸¸èŠå¤©çš„åŸºç¡€åŠŸèƒ½ï¼Œå› ä¸ºèŠå¤©å®¤çš„æ•°æ®ç»“æ„åŸºæœ¬éƒ½å¤§åŒå°å¼‚ï¼Œå› æ­¤ç›®å‰çš„èŠå¤©å®¤æ¶æ„æ˜¯éå¸¸åˆ©äºåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•å’Œæ–°å¢åŠŸèƒ½çš„ã€‚åŒæ—¶ï¼Œæˆ‘ä»Šåä¹Ÿä¼šé™†ç»­å¼€å‘å¾ˆå¤šé…·ç‚«çš„åŠŸèƒ½ï¼Œå–œæ¬¢çš„æœ‹å‹ç»™ä¸ª star é¼“åŠ±ä¸€ä¸‹æˆ‘å§ï¼

## é¡¹ç›®åœ°å€

githubï¼šhttps://github.com/genaller/genal-chat