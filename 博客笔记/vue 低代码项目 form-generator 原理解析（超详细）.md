> 重新梳理了一下 form-generator 的实现原理，扒了一下源码。虽然项目是 vue2 的，但其实低代码思路是一致的，所以还是有价值的，源码版本使用的 `0.2.0`，一起来学习一下吧

## 使用

![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/jvk5ko4Osp4Y8d988kHoeaB1HqGabpOKmvY3luCMmEr8kZhhQaWTmmcAOErTh6ibsBH0S9icZAhrdcXOtjeuZAeg/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

如上图所示，从左侧组件列表将组件拖入中间，中间可以看到整体表单的效果，同时支持上下拖动、调整顺序；组件的属性可以通过右侧的配置面板修改，例如标签、大小、字段名等

支持出码，点击上方运行后，进入预览页面

![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/jvk5ko4Osp4Y8d988kHoeaB1HqGabpOKibG3d9cZNI5hzQKAK2pCTGekTAJTaCTFEawfyZZJ7ibNjsotwicbtwEvg/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

左侧为产出的代码，右侧为渲染出的表单效果

这是产出的 JSON DSL，不用细看，贴出来只是为了后面讲源码可以对照

```
<span data-remoteid="c1701274869484" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"fields"</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"__config__"</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"layout"</span>:&nbsp;<span data-darkreader-inline-color="">"rowFormItem"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"tagIcon"</span>:&nbsp;<span data-darkreader-inline-color="">"row"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"layoutTree"</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"document"</span>:&nbsp;<span data-darkreader-inline-color="">"https://element.eleme.cn/#/zh-CN/component/layout#row-attributes"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"span"</span>:&nbsp;<span data-darkreader-inline-color="">24</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"formId"</span>:&nbsp;<span data-darkreader-inline-color="">101</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"renderKey"</span>:&nbsp;<span data-darkreader-inline-color="">"1011701267042417"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"componentName"</span>:&nbsp;<span data-darkreader-inline-color="">"row101"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"children"</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"__config__"</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"label"</span>:&nbsp;<span data-darkreader-inline-color="">"单行文本"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"labelWidth"</span>:&nbsp;<span data-darkreader-inline-color="">null</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"showLabel"</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"changeTag"</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"tag"</span>:&nbsp;<span data-darkreader-inline-color="">"el-input"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"tagIcon"</span>:&nbsp;<span data-darkreader-inline-color="">"input"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"required"</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"layout"</span>:&nbsp;<span data-darkreader-inline-color="">"colFormItem"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"span"</span>:&nbsp;<span data-darkreader-inline-color="">24</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"document"</span>:&nbsp;<span data-darkreader-inline-color="">"https://element.eleme.cn/#/zh-CN/component/input"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"regList"</span>:&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"formId"</span>:&nbsp;<span data-darkreader-inline-color="">102</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"renderKey"</span>:&nbsp;<span data-darkreader-inline-color="">"1021701267046717"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"__slot__"</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"prepend"</span>:&nbsp;<span data-darkreader-inline-color="">""</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"append"</span>:&nbsp;<span data-darkreader-inline-color="">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"placeholder"</span>:&nbsp;<span data-darkreader-inline-color="">"请输入单行文本"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"style"</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"width"</span>:&nbsp;<span data-darkreader-inline-color="">"100%"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"clearable"</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"prefix-icon"</span>:&nbsp;<span data-darkreader-inline-color="">""</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"suffix-icon"</span>:&nbsp;<span data-darkreader-inline-color="">""</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"maxlength"</span>:&nbsp;<span data-darkreader-inline-color="">null</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"show-word-limit"</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"readonly"</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"disabled"</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"__vModel__"</span>:&nbsp;<span data-darkreader-inline-color="">"field102"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"type"</span>:&nbsp;<span data-darkreader-inline-color="">"default"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"justify"</span>:&nbsp;<span data-darkreader-inline-color="">"start"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">"align"</span>:&nbsp;<span data-darkreader-inline-color="">"top"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;],<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"formRef"</span>:&nbsp;<span data-darkreader-inline-color="">"elForm"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"formModel"</span>:&nbsp;<span data-darkreader-inline-color="">"formData"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"size"</span>:&nbsp;<span data-darkreader-inline-color="">"medium"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"labelPosition"</span>:&nbsp;<span data-darkreader-inline-color="">"right"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"labelWidth"</span>:&nbsp;<span data-darkreader-inline-color="">100</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"formRules"</span>:&nbsp;<span data-darkreader-inline-color="">"rules"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"gutter"</span>:&nbsp;<span data-darkreader-inline-color="">15</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"disabled"</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"span"</span>:&nbsp;<span data-darkreader-inline-color="">24</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"formBtns"</span>:&nbsp;<span data-darkreader-inline-color="">true</span><br>}<br></code>
```

感兴趣地可以自行体验一波  https://mrhj.gitee.io/form-generator

## 思路

低代码的本质无非就是

`可视化配置 => JSON DSL => 组件组合 => 生成页面`

本次我打算将这个过程拆成两部分来介绍

1.  出码：`JSON DSL => vue 代码 => 生成页面`
    
2.  配置：`可视化配置 => JSON DSL => 生成页面`
    

## 出码

代码做了简化，仅保留了主流程代码，感兴趣可以自行查阅完整代码

### template

```
<span data-remoteid="c1701274869485" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\html.js</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span>makeUpHtml</span>(<span>formConfig,&nbsp;type</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;htmlList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;formConfig&nbsp;即上面的&nbsp;json&nbsp;串</span><br>&nbsp;&nbsp;confGlobal&nbsp;=&nbsp;formConfig;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;每行默认&nbsp;24&nbsp;列栅格，可手动修改<br>&nbsp;&nbsp;&nbsp;*&nbsp;这里先判断布局是否都沾满了24个栅格<br>&nbsp;&nbsp;&nbsp;*&nbsp;先将结果缓存起来<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;someSpanIsNot24&nbsp;=&nbsp;formConfig.fields.some(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span>(<span>item</span>)&nbsp;=&gt;</span>&nbsp;item.__config__.span !==&nbsp;<span data-darkreader-inline-color="">24</span><br>&nbsp;&nbsp;);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;遍历渲染每个组件成html</span><br>&nbsp;&nbsp;formConfig.fields.forEach(<span>(<span>el</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;通过&nbsp;layout&nbsp;字段，判断使用哪种布局</span><br>&nbsp;&nbsp;&nbsp;&nbsp;htmlList.push(layouts[el.__config__.layout](el));<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;htmlStr&nbsp;=&nbsp;htmlList.join(<span data-darkreader-inline-color="">"\n"</span>);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;将组件代码放进form标签</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;temp&nbsp;=&nbsp;buildFormTemplate(formConfig,&nbsp;htmlStr,&nbsp;type);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;dialog&nbsp;标签包裹代码</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(type&nbsp;===&nbsp;<span data-darkreader-inline-color="">"dialog"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;=&nbsp;dialogWrapper(temp);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;confGlobal&nbsp;=&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;temp;<br>}<br></code>
```

layouts 中声明了两种布局：colFormItem 和 rowFormItem，关系如下：

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

下面开始扒源码

```
<span data-remoteid="c1701274869486" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\html.js</span><br><span data-darkreader-inline-color="">const</span>&nbsp;layouts&nbsp;=&nbsp;{<br>&nbsp;&nbsp;colFormItem(scheme)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;从&nbsp;__config__&nbsp;字段获取配置<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;组装&nbsp;label、label-width&nbsp;等属性<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;config&nbsp;=&nbsp;scheme.__config__;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;labelWidth&nbsp;=&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;label&nbsp;=&nbsp;<span data-darkreader-inline-color="">`label="<span data-darkreader-inline-color="">${config.label}</span>"`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(config.labelWidth&nbsp;&amp;&amp;&nbsp;config.labelWidth&nbsp;!==&nbsp;confGlobal.labelWidth)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;labelWidth&nbsp;=&nbsp;<span data-darkreader-inline-color="">`label-width="<span data-darkreader-inline-color="">${config.labelWidth}</span>px"`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(config.showLabel&nbsp;===&nbsp;<span data-darkreader-inline-color="">false</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;labelWidth&nbsp;=&nbsp;<span data-darkreader-inline-color="">'label-width="0"'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label&nbsp;=&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;required&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!ruleTrigger[config.tag]&nbsp;&amp;&amp;&nbsp;config.required&nbsp;?&nbsp;<span data-darkreader-inline-color="">"required"</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这一步就是加载&nbsp;输入型&nbsp;或&nbsp;选择型&nbsp;组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;组件信息同样存在一个对象中&nbsp;tags<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;tagDom&nbsp;=&nbsp;tags[config.tag]&nbsp;?&nbsp;tags[config.tag](scheme)&nbsp;:&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里就能明显看出<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;colFormItem&nbsp;布局就是直接使用的&nbsp;el-form-item&nbsp;组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;str&nbsp;=&nbsp;<span data-darkreader-inline-color="">`&lt;el-form-item&nbsp;<span data-darkreader-inline-color="">${labelWidth}</span>&nbsp;<span data-darkreader-inline-color="">${label}</span>&nbsp;prop="<span data-darkreader-inline-color="">${scheme.__vModel__}</span>"&nbsp;<span data-darkreader-inline-color="">${required}</span>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">${tagDom}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/el-form-item&gt;`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里判断当前行是不是占用&nbsp;24&nbsp;列栅格<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;通过&nbsp;__config__&nbsp;下的&nbsp;span 字段判断<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如果不是&nbsp;24<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;将在外层再包裹一个&nbsp;el-col&nbsp;组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;=&nbsp;colWrapper(scheme,&nbsp;str);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;str;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;rowFormItem(scheme)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;同样从&nbsp;__config__&nbsp;字段获取配置<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;组装属性<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;config&nbsp;=&nbsp;scheme.__config__;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;type&nbsp;有&nbsp;default&nbsp;和&nbsp;flex&nbsp;两种布局</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;type&nbsp;=&nbsp;scheme.type&nbsp;===&nbsp;<span data-darkreader-inline-color="">"default"</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">""</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">`type="<span data-darkreader-inline-color="">${scheme.type}</span>"`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;justify&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheme.type&nbsp;===&nbsp;<span data-darkreader-inline-color="">"default"</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">""</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">`justify="<span data-darkreader-inline-color="">${scheme.justify}</span>"`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;align&nbsp;=&nbsp;scheme.type&nbsp;===&nbsp;<span data-darkreader-inline-color="">"default"</span>&nbsp;?&nbsp;<span data-darkreader-inline-color="">""</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">`align="<span data-darkreader-inline-color="">${scheme.align}</span>"`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;gutter&nbsp;=&nbsp;scheme.gutter&nbsp;?&nbsp;<span data-darkreader-inline-color="">`:gutter="<span data-darkreader-inline-color="">${scheme.gutter}</span>"`</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;与&nbsp;colFormItem&nbsp;不同的是<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;rowFormItem&nbsp;的子组件还是一个布局组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;里面包裹的正是&nbsp;colFormItem<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;children&nbsp;=&nbsp;config.children.map(<span>(<span>el</span>)&nbsp;=&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layouts[el.__config__.layout](el)<br>&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;rowFormItem&nbsp;布局使用的是&nbsp;el-row&nbsp;组件</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;str&nbsp;=&nbsp;<span data-darkreader-inline-color="">`&lt;el-row&nbsp;<span data-darkreader-inline-color="">${type}</span>&nbsp;<span data-darkreader-inline-color="">${justify}</span>&nbsp;<span data-darkreader-inline-color="">${align}</span>&nbsp;<span data-darkreader-inline-color="">${gutter}</span>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">${children.join(<span data-darkreader-inline-color="">"\n"</span>)}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/el-row&gt;`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;同样判断是否需要加&nbsp;el-col</span><br>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;=&nbsp;colWrapper(scheme,&nbsp;str);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;str;<br>&nbsp;&nbsp;},<br>};<br></code>
```

布局的问题就搞定了，接下来就是 输入型组件 和 选择型组件，它们的逻辑在 tags 对象内

源码中定义了 15 种类型的组件，这里我们就只看其中一种就好，原理都大差不差

```
<span data-remoteid="c1701274869487" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\html.js</span><br><span data-darkreader-inline-color="">const</span>&nbsp;tags&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;输入框组件</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"el-input"</span>:&nbsp;<span>(<span>el</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;attrBuilder&nbsp;提前解析并配置好属性值<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如：__vModel__&nbsp;若存在，则拼接&nbsp;v-model&nbsp;字符串<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`v-model="${confGlobal.formModel}.${el.__vModel__}"`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;再赋值给&nbsp;vModel。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;猜测是大部分组件都有这些属性<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;所以单独提出了个函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;tag,&nbsp;disabled,&nbsp;vModel,&nbsp;clearable,&nbsp;placeholder,&nbsp;width&nbsp;}&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attrBuilder(el);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;maxlength&nbsp;=&nbsp;el.maxlength&nbsp;?&nbsp;<span data-darkreader-inline-color="">`:maxlength="<span data-darkreader-inline-color="">${el.maxlength}</span>"`</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;showWordLimit&nbsp;=&nbsp;el[<span data-darkreader-inline-color="">"show-word-limit"</span>]&nbsp;?&nbsp;<span data-darkreader-inline-color="">"show-word-limit"</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;readonly&nbsp;=&nbsp;el.readonly&nbsp;?&nbsp;<span data-darkreader-inline-color="">"readonly"</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;prefixIcon&nbsp;=&nbsp;el[<span data-darkreader-inline-color="">"prefix-icon"</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;<span data-darkreader-inline-color="">`prefix-icon='<span data-darkreader-inline-color="">${el[<span data-darkreader-inline-color="">"prefix-icon"</span>]}</span>'`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;suffixIcon&nbsp;=&nbsp;el[<span data-darkreader-inline-color="">"suffix-icon"</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;<span data-darkreader-inline-color="">`suffix-icon='<span data-darkreader-inline-color="">${el[<span data-darkreader-inline-color="">"suffix-icon"</span>]}</span>'`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;showPassword&nbsp;=&nbsp;el[<span data-darkreader-inline-color="">"show-password"</span>]&nbsp;?&nbsp;<span data-darkreader-inline-color="">"show-password"</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;type&nbsp;=&nbsp;el.type&nbsp;?&nbsp;<span data-darkreader-inline-color="">`type="<span data-darkreader-inline-color="">${el.type}</span>"`</span>&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;autosize&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;el.autosize&nbsp;&amp;&amp;&nbsp;el.autosize.minRows<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;<span data-darkreader-inline-color="">`:autosize="{minRows:&nbsp;<span data-darkreader-inline-color="">${el.autosize.minRows}</span>,&nbsp;maxRows:&nbsp;<span data-darkreader-inline-color="">${el.autosize.maxRows}</span>}"`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span data-darkreader-inline-color="">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里处理子组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如&nbsp;el-select&nbsp;组件的&nbsp;el-option<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;el-input&nbsp;组件的子组件是两个插槽：prepend&nbsp;与&nbsp;append<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`&lt;template&nbsp;slot="append"&gt;${slot.append}&lt;/template&gt;`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;child&nbsp;=&nbsp;buildElInputChild(el);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;给子组件换行<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;因为最终得到的代码不止是用来渲染<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;还需要展示以及出码，还是要尽量美观(-_-)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(child)&nbsp;child&nbsp;=&nbsp;<span data-darkreader-inline-color="">`\n<span data-darkreader-inline-color="">${child}</span>\n`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里&nbsp;tag&nbsp;就是&nbsp;el-input<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;然后拼接属性、拼接子组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">`&lt;<span data-darkreader-inline-color="">${tag}</span>&nbsp;<span data-darkreader-inline-color="">${vModel}</span>&nbsp;<span data-darkreader-inline-color="">${type}</span>&nbsp;<span data-darkreader-inline-color="">${placeholder}</span>&nbsp;<span data-darkreader-inline-color="">${maxlength}</span>&nbsp;<span data-darkreader-inline-color="">${showWordLimit}</span>&nbsp;<span data-darkreader-inline-color="">${readonly}</span>&nbsp;<span data-darkreader-inline-color="">${disabled}</span>&nbsp;<span data-darkreader-inline-color="">${clearable}</span>&nbsp;<span data-darkreader-inline-color="">${prefixIcon}</span>&nbsp;<span data-darkreader-inline-color="">${suffixIcon}</span>&nbsp;<span data-darkreader-inline-color="">${showPassword}</span>&nbsp;<span data-darkreader-inline-color="">${autosize}</span>&nbsp;<span data-darkreader-inline-color="">${width}</span>&gt;<span data-darkreader-inline-color="">${child}</span>&lt;/<span data-darkreader-inline-color="">${tag}</span>&gt;`</span>;<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;...<br>};<br></code>
```

到这里就完成了 vue 组件中 template 部分的代码

### js

接下来是 js 代码的生成

```
<span data-remoteid="c1701274869488" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\js.js</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span>makeUpJs</span>(<span>formConfig,&nbsp;type</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;深拷贝一份&nbsp;json</span><br>&nbsp;&nbsp;confGlobal&nbsp;=&nbsp;formConfig&nbsp;=&nbsp;deepClone(formConfig);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;dataList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;ruleList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;optionsList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;propsList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;mixinMethod&nbsp;混入通用函数</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;如果是生成页面<br>&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;在提交表单时增加表单验证，即：<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;this.$refs['${confGlobal.formRef}'].validate(valid&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!valid)&nbsp;return<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO&nbsp;提交表单<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;*&nbsp;2.&nbsp;在重置表单时，重置掉表单字段<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;this.$refs['${confGlobal.formRef}'].resetFields()<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;如果是生成弹窗<br>&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;监听弹窗唤起：onOpen<br>&nbsp;&nbsp;&nbsp;*&nbsp;2.&nbsp;监听弹窗关闭：onClose<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;同时在关闭后重置表单字段<br>&nbsp;&nbsp;&nbsp;*&nbsp;3.&nbsp;添加关闭事件：close<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;this.$emit('update:visible',&nbsp;false)<br>&nbsp;&nbsp;&nbsp;*&nbsp;4.&nbsp;添加确认事件：handelConfirm<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;同时在确认后校验表单<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;methodList&nbsp;=&nbsp;mixinMethod(type);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;uploadVarList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;created&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;核心部分，下面展开细说</span><br>&nbsp;&nbsp;formConfig.fields.forEach(<span>(<span>el</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;buildAttributes(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;el,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ruleList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optionsList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propsList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uploadVarList,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created<br>&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;...<br>}<br></code>
```

```
<span data-remoteid="c1701274869489" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\js.js</span><br><span data-darkreader-inline-color="">//&nbsp;构建组件属性</span><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span>buildAttributes</span>(<span>...</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;config&nbsp;=&nbsp;scheme.__config__<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;slot&nbsp;=&nbsp;scheme.__slot__<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;以&nbsp;__vModel__&nbsp;为键名，defaultValue&nbsp;为值<br>&nbsp;&nbsp;&nbsp;*&nbsp;以键值对的方式&nbsp;push&nbsp;进&nbsp;dataList<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;buildData(scheme,&nbsp;dataList)<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;仅处理了必填和自定义正则<br>&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;必填设置<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;补充&nbsp;message&nbsp;等字段，push&nbsp;到&nbsp;ruleList<br>&nbsp;&nbsp;&nbsp;*&nbsp;2.&nbsp;正则列表<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;遍历正则列表，使用&nbsp;pattern&nbsp;字段，补充&nbsp;message、trigger<br>&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;push&nbsp;到&nbsp;ruleList<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;buildRules(scheme,&nbsp;ruleList)<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;特殊处理options属性</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(scheme.options&nbsp;||&nbsp;(slot&nbsp;&amp;&amp;&nbsp;slot.options&nbsp;&amp;&amp;&nbsp;slot.options.length))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;处理静态&nbsp;options<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;el-cascader&nbsp;组件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;buildOptions(scheme,&nbsp;optionsList)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理动态&nbsp;options</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(config.dataType&nbsp;===&nbsp;<span data-darkreader-inline-color="">'dynamic'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;model&nbsp;=&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${scheme.__vModel__}</span>Options`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;options&nbsp;=&nbsp;titleCase(model)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;methodName&nbsp;=&nbsp;<span data-darkreader-inline-color="">`get<span data-darkreader-inline-color="">${options}</span>`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;定义动态获取&nbsp;options&nbsp;的函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;methodName&nbsp;就是函数名<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;内部使用&nbsp;axios&nbsp;获取<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildOptionMethod(methodName,&nbsp;model,&nbsp;methodList,&nbsp;scheme)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;将上一步定义的获取函数&nbsp;push&nbsp;入&nbsp;created&nbsp;列表<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;created&nbsp;列表在&nbsp;vue&nbsp;组件的&nbsp;creaded&nbsp;阶段被调用<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callInCreated(methodName,&nbsp;created)<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理props</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(scheme.props&nbsp;&amp;&amp;&nbsp;scheme.props.props)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;buildProps(scheme,&nbsp;propsList)<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理&nbsp;el-upload&nbsp;的action</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(scheme.action&nbsp;&amp;&amp;&nbsp;config.tag&nbsp;===&nbsp;<span data-darkreader-inline-color="">'el-upload'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理&nbsp;upload&nbsp;的&nbsp;aciton&nbsp;和&nbsp;fileList&nbsp;变量</span><br>&nbsp;&nbsp;&nbsp;&nbsp;uploadVarList.push(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${scheme.__vModel__}</span>Action:&nbsp;'<span data-darkreader-inline-color="">${scheme.action}</span>',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">${scheme.__vModel__}</span>fileList:&nbsp;[],`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;增加文件上传相关函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;若设置了fileSize，增加判断文件大小的函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;2.&nbsp;若设置了&nbsp;accept，增加判断文件类型的函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;methodList.push(buildBeforeUpload(scheme))<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;非自动上传时，生成手动上传的函数</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!scheme[<span data-darkreader-inline-color="">'auto-upload'</span>])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;增加&nbsp;submitUpload&nbsp;函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;this.$refs['${scheme.__vModel__}'].submit()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodList.push(buildSubmitUpload(scheme))<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;构建子级组件属性</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(config.children)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;config.children.forEach(<span><span>item</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildAttributes(...)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;}<br>}<br></code>
```

解析完成后就得到了几个列表: dataList、ruleList、optionsList、methodList、propsList、uploadVarList、created

最后一步，使用 join 将列表每一项通过换行符连接，拼接为 vue2 Option API 的形式

```
<span data-remoteid="c1701274869490" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\js.js</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span>makeUpJs</span>(<span>formConfig,&nbsp;type</span>)&nbsp;</span>{<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;buildexport&nbsp;拼接整体js<br>&nbsp;&nbsp;&nbsp;*&nbsp;也就是将上一步得到的&nbsp;data、methods&nbsp;等信息<br>&nbsp;&nbsp;&nbsp;*&nbsp;以&nbsp;vue2&nbsp;option&nbsp;API&nbsp;的方式拼接<br>&nbsp;&nbsp;&nbsp;*&nbsp;export&nbsp;default&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;components:&nbsp;{},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props:&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${conf.formModel}:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${data}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${conf.formRules}:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${rules}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${uploadVar}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${selectOptions}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${props}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;computed:&nbsp;{},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;watch:&nbsp;{},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${created}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mounted&nbsp;()&nbsp;{},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${methods}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;script&nbsp;=&nbsp;buildexport(<br>&nbsp;&nbsp;&nbsp;&nbsp;formConfig,<br>&nbsp;&nbsp;&nbsp;&nbsp;type,<br>&nbsp;&nbsp;&nbsp;&nbsp;dataList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;ruleList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;optionsList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;uploadVarList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;propsList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;methodList.join(<span data-darkreader-inline-color="">"\n"</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;created.join(<span data-darkreader-inline-color="">"\n"</span>)<br>&nbsp;&nbsp;);<br>&nbsp;&nbsp;confGlobal&nbsp;=&nbsp;<span data-darkreader-inline-color="">null</span>;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;script;<br>}<br></code>
```

以上就是 js 部分的解析

### css

css 部分就简单很多了，因为 form-generator 根本就没想让你通过自定义设置样式，也可能没空做那部分的功能

```
<span data-remoteid="c1701274869491" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\generator\css.js</span><br><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;仅新增了&nbsp;el-rate、el-upload<br>&nbsp;*&nbsp;两个组件的自定义样式<br>&nbsp;*&nbsp;通过类名的方式实现<br>&nbsp;*/</span><br><span data-darkreader-inline-color="">const</span>&nbsp;styles&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"el-rate"</span>:&nbsp;<span data-darkreader-inline-color="">".el-rate{display:&nbsp;inline-block;&nbsp;vertical-align:&nbsp;text-top;}"</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">"el-upload"</span>:&nbsp;<span data-darkreader-inline-color="">".el-upload__tip{line-height:&nbsp;1.2;}"</span>,<br>};<br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span>addCss</span>(<span>cssList,&nbsp;el</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;css&nbsp;=&nbsp;styles[el.__config__.tag];<br>&nbsp;&nbsp;css&nbsp;&amp;&amp;&nbsp;cssList.indexOf(css)&nbsp;===&nbsp;<span data-darkreader-inline-color="">-1</span>&nbsp;&amp;&amp;&nbsp;cssList.push(css);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(el.__config__.children)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;el.__config__.children.forEach(<span>(<span>el2</span>)&nbsp;=&gt;</span>&nbsp;addCss(cssList,&nbsp;el2));<br>&nbsp;&nbsp;}<br>}<br><span data-darkreader-inline-color="">export</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span>makeUpCss</span>(<span>conf</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;cssList&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;conf.fields.forEach(<span>(<span>el</span>)&nbsp;=&gt;</span>&nbsp;addCss(cssList,&nbsp;el));<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;cssList.join(<span data-darkreader-inline-color="">"\n"</span>);<br>}<br></code>
```

上面的代码就是 css.js 完整的代码，没啥特别的东西就不解释了

最终的代码会使用 style 标签包裹

如果要预览，会直接插入到 html 文件中；当然了，会插入到根结点之前，element-ui 样式链接之后

如果要出码，也就是将代码下载下来，直接放在 vue 文件中

### 展示/渲染/导出

到这里就完成了 json DSL 到可用代码的转换，接下来无论是想出码还是直接渲染，都不是啥大问题了。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

#### 展示

form-generator 展示代码时用到了第三方库 `monaco-editor`，感兴趣的可以自行研究一下这个库。

#### 预览

预览本质就是要将转换后的代码渲染出来；

form-generator 这里加了一个 iframe，iframe 加载的是提前写好的 html

-   head 部分提前加载 vue、vue-router、element-ui 的 CDN 文件
    
-   body 部分声明一个 id 为 previewApp 的 div 结点
    

这个 previewApp 的根结点并不直接挂载 vue 实例，实际执行预览时，还会往里加入 style 标签包裹的样式（上一步生成的 css 部分的代码）、一个 id 为 app 的 div 结点

接下来就只要将上面生成的代码搞成 vue 实例挂载到 id 为 app 的结点上

```
<span data-remoteid="c1701274869492" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\views\preview\main.js</span><br><span data-darkreader-inline-color="">/**<br>&nbsp;*&nbsp;attrs:&nbsp;仅当渲染的是弹窗时用到，添加&nbsp;width、visible&nbsp;等属性<br>&nbsp;*&nbsp;main：上一步的&nbsp;js&nbsp;部分生成的代码，移除了&nbsp;`export&nbsp;default`<br>&nbsp;*&nbsp;html：上一步的&nbsp;template&nbsp;部分生成的代码<br>&nbsp;*/</span><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span>newVue</span>(<span>attrs,&nbsp;main,&nbsp;html</span>)&nbsp;</span>{<br>&nbsp;&nbsp;main&nbsp;=&nbsp;<span data-darkreader-inline-color="">eval</span>(<span data-darkreader-inline-color="">`(<span data-darkreader-inline-color="">${main}</span>)`</span>);<br>&nbsp;&nbsp;main.template&nbsp;=&nbsp;<span data-darkreader-inline-color="">`&lt;div&gt;<span data-darkreader-inline-color="">${html}</span>&lt;/div&gt;`</span>;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;新建&nbsp;vue&nbsp;实例<br>&nbsp;&nbsp;&nbsp;*&nbsp;生成的表单以子组件的形式引入<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;Vue({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">components</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">child</span>:&nbsp;main,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;data()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">visible</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">template</span>:&nbsp;<span data-darkreader-inline-color="">`&lt;div&gt;&lt;child&nbsp;<span data-darkreader-inline-color="">${attrs}</span>/&gt;&lt;/div&gt;`</span>,<br>&nbsp;&nbsp;}).$mount(<span data-darkreader-inline-color="">"#app"</span>);<br>}<br></code>
```

#### 导出 vue 文件

拼接上面得到的代码，组成 vue 文件（由 template、script、style 三部分组成），再自动下载下来。

## 配置

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

可以看出来，可视化配置页面主要分为三部分：左侧的组件列表、中间的渲染面板、右侧的配置面板

为了实现可拖拽，引入了第三方库 `vuedraggable`

### 组件列表

这一部分没啥好说的，维护一个组件列表数组，通过 draggable 实现可拖拽，值得一说的也就只有 draggable 组件了

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

```
<span data-remoteid="c1701274869493" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;组件列表&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\Home.vue&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-color="">v-for</span>=<span data-darkreader-inline-color="">"(item,&nbsp;listIndex)&nbsp;in&nbsp;leftComponents"</span>&nbsp;<span data-darkreader-inline-color="">:key</span>=<span data-darkreader-inline-color="">"listIndex"</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"components-title"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">svg-icon</span>&nbsp;<span data-darkreader-inline-color="">icon-class</span>=<span data-darkreader-inline-color="">"component"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;{{&nbsp;item.title&nbsp;}}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;这里说一下&nbsp;group&nbsp;参数的配置<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可跨越拖拽的共同类名<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pull:&nbsp;clone&nbsp;拖出操作，变成了复制<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;put:&nbsp;&nbsp;false&nbsp;禁止拖入这里<br>&nbsp;&nbsp;&nbsp;--&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">draggable</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"components-draggable"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:list</span>=<span data-darkreader-inline-color="">"item.list"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:group</span>=<span data-darkreader-inline-color="">"{&nbsp;name:&nbsp;'componentsGroup',&nbsp;pull:&nbsp;'clone',&nbsp;put:&nbsp;false&nbsp;}"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:clone</span>=<span data-darkreader-inline-color="">"cloneComponent"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">draggable</span>=<span data-darkreader-inline-color="">".components-item"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:sort</span>=<span data-darkreader-inline-color="">"false"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">end</span>=<span data-darkreader-inline-color="">"onEnd"</span><br>&nbsp;&nbsp;&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">div</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">v-for</span>=<span data-darkreader-inline-color="">"(element,&nbsp;index)&nbsp;in&nbsp;item.list"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:key</span>=<span data-darkreader-inline-color="">"index"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"components-item"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"addComponent(element)"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"components-body"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">svg-icon</span>&nbsp;<span data-darkreader-inline-color="">:icon-class</span>=<span data-darkreader-inline-color="">"element.__config__.tagIcon"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{&nbsp;element.__config__.label&nbsp;}}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">draggable</span>&gt;</span><br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br></code>
```

draggable 组件，同名的 group 之间可以实现拖拽效果。

在 form-generator 中，组件列表的 draggable 的 group 名为 componentsGroup，与中间渲染面板的 draggable 的 group 名称一致；所以，组件列表与渲染面板之间可以进行拖拽操作。

```
<span data-remoteid="c1701274869494" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;渲染面板使用的&nbsp;draggable&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\Home.vue&nbsp;--&gt;</span><br>...<br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">draggable</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"drawing-board"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">:list</span>=<span data-darkreader-inline-color="">"drawingList"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">:animation</span>=<span data-darkreader-inline-color="">"340"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">group</span>=<span data-darkreader-inline-color="">"componentsGroup"</span><br>&gt;</span><br>&nbsp;&nbsp;...<br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">draggable</span>&gt;</span><br>...<br></code>
```

drawingList 是渲染面板用到的组件列表

当组件列表中的组件拖拽到中间渲染面板，渲染面板中绑定的 drawingList 变量将会改变

1.  从 item.list 中拿到拖拽出来的元素
    
2.  经过 cloneComponent 拷贝一个新元素
    
3.  将新元素放入 drawingList 中
    

上述的三个步骤都是 draggable 组件内部完成的，也就是 draggable 实现了跨组件的拖拽，并且自己完成了两个 draggable 组件间的通信（自动更新 drawingList），还直接更新了父组件的 drawingList 变量

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

#### 跨组件

这里不打算深究，直接讲原理 （懒）

vuedraggable 组件本身是基于 sortablejs 实现的（这俩项目是同一个大佬的手笔）

在 vuedraggable 组件的 mounted 阶段，新建了一个 sortable 实例

```
<span data-remoteid="c1701274869495" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;Vue.Draggable-2.23.2\src\vuedraggable.js</span><br>mounted()&nbsp;{<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;this._sortable&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;Sortable(<span data-darkreader-inline-color="">this</span>.rootContainer,&nbsp;options);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.computeIndexes();<br>}<br></code>
```

让我们把视线再转向 sortablejs

sortablejs 内部维护了一个数组 `sortables`

```
<span data-remoteid="c1701274869496" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;Sortable\src\Sortable.js</span><br><span><span data-darkreader-inline-color="">function</span>&nbsp;<span>Sortable</span>(<span>el,&nbsp;options</span>)&nbsp;</span>{<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;创建实例时<br>&nbsp;&nbsp;&nbsp;*&nbsp;将&nbsp;html&nbsp;元素存入&nbsp;sortables<br>&nbsp;&nbsp;&nbsp;*&nbsp;这里的&nbsp;el&nbsp;我们可以简单理解为&nbsp;draggable&nbsp;组件<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;sortables.push(<span data-darkreader-inline-color="">this</span>.el);<br>&nbsp;&nbsp;...<br>}<br></code>
```

每新建一个 Sortable 实例，sortables 中就会多一个实例

在拖拽过程中以及完成时，sortablejs 会去查找可拖入的元素(组件)，怎么找呢？

就是通过 sortables

```
<span data-remoteid="c1701274869497" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">_detectNearestEmptySortable&nbsp;=&nbsp;<span><span data-darkreader-inline-color="">function</span>(<span>x,&nbsp;y</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;ret;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;遍历组件们</span><br>&nbsp;&nbsp;sortables.some(<span>(<span>sortable</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获取&nbsp;draggable&nbsp;组件的位置信息<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;以此确定拖入的地方在不在可拖入的范围内<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;rect&nbsp;=&nbsp;getRect(sortable),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;insideHorizontally&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&gt;=&nbsp;rect.left&nbsp;-&nbsp;threshold&nbsp;&amp;&amp;&nbsp;x&nbsp;&lt;=&nbsp;rect.right&nbsp;+&nbsp;threshold,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;insideVertically&nbsp;=<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&gt;=&nbsp;rect.top&nbsp;-&nbsp;threshold&nbsp;&amp;&amp;&nbsp;y&nbsp;&lt;=&nbsp;rect.bottom&nbsp;+&nbsp;threshold;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(insideHorizontally&nbsp;&amp;&amp;&nbsp;insideVertically)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;在范围内，直接返回组件</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;(ret&nbsp;=&nbsp;sortable);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;ret;<br>}<br></code>
```

之后的事就简单了，通知 vuedraggable，该更新更新

#### 更新父组件变量

你们以为 vuedraggable 会使用 `$emit` `$ref` 吗？

No~ No~ No~

从上面的使用中也能看到，list 属性并没有加 sync

我直接贴段源码

```
<span data-remoteid="c1701274869498" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;Vue.Draggable-2.23.2\src\vuedraggable.js</span><br>alterList(onList)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">this</span>.list)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;onList(<span data-darkreader-inline-color="">this</span>.list);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;newList&nbsp;=&nbsp;[...this.value];<br>&nbsp;&nbsp;onList(newList);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;用的&nbsp;list&nbsp;属性，没有&nbsp;v-model<br>&nbsp;&nbsp;&nbsp;*&nbsp;忽略这行<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.$emit(<span data-darkreader-inline-color="">"input"</span>,&nbsp;newList);<br>},<br>updatePosition(oldIndex,&nbsp;newIndex)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;updatePosition&nbsp;=&nbsp;<span><span>list</span>&nbsp;=&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.splice(newIndex,&nbsp;<span data-darkreader-inline-color="">0</span>,&nbsp;list.splice(oldIndex,&nbsp;<span data-darkreader-inline-color="">1</span>)[<span data-darkreader-inline-color="">0</span>]);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.alterList(updatePosition);<br>},<br></code>
```

看到了吗？就是简单粗暴的 splice，然后？然后就没了

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

### 渲染展示

```
<span data-remoteid="c1701274869499" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\Home.vue&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;!--&nbsp;页面滚动，增加&nbsp;scrollbar&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-scrollbar</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"center-scrollbar"</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;布局组件，美观&nbsp;--&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-row</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"center-board-row"</span>&nbsp;<span data-darkreader-inline-color="">:gutter</span>=<span data-darkreader-inline-color="">"formConf.gutter"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;直接写好&nbsp;el-form&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:size</span>=<span data-darkreader-inline-color="">"formConf.size"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:label-position</span>=<span data-darkreader-inline-color="">"formConf.labelPosition"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:disabled</span>=<span data-darkreader-inline-color="">"formConf.disabled"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:label-width</span>=<span data-darkreader-inline-color="">"formConf.labelWidth&nbsp;+&nbsp;'px'"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;老熟人了，draggable&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">draggable</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"drawing-board"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:list</span>=<span data-darkreader-inline-color="">"drawingList"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:animation</span>=<span data-darkreader-inline-color="">"340"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">group</span>=<span data-darkreader-inline-color="">"componentsGroup"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;!--&nbsp;自定义组件，一会儿展开细嗦&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">draggable-item</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">v-for</span>=<span data-darkreader-inline-color="">"(item,&nbsp;index)&nbsp;in&nbsp;drawingList"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:key</span>=<span data-darkreader-inline-color="">"item.renderKey"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:drawing-list</span>=<span data-darkreader-inline-color="">"drawingList"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:current-item</span>=<span data-darkreader-inline-color="">"item"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:index</span>=<span data-darkreader-inline-color="">"index"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:active-id</span>=<span data-darkreader-inline-color="">"activeId"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">:form-conf</span>=<span data-darkreader-inline-color="">"formConf"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">activeItem</span>=<span data-darkreader-inline-color="">"activeFormItem"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">copyItem</span>=<span data-darkreader-inline-color="">"drawingItemCopy"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">deleteItem</span>=<span data-darkreader-inline-color="">"drawingItemDelete"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">draggable</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">div</span>&nbsp;<span data-darkreader-inline-color="">v-show</span>=<span data-darkreader-inline-color="">"!drawingList.length"</span>&nbsp;<span data-darkreader-inline-color="">class</span>=<span data-darkreader-inline-color="">"empty-info"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从左侧拖入或点选组件进行表单设计<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-row</span>&gt;</span><br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-scrollbar</span>&gt;</span><br></code>
```

这里主要的重点在于 `draggable-item` 组件的实现

`draggable-item` 组件仅有 scripts 部分，它没有使用 template，而是使用了 vue 的 render 函数替代 template

```
<span data-remoteid="c1701274869500" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\DraggableItem.vue&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">script</span>&gt;</span><span><br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;export&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">components</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;render,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draggable<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;render(h)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;layout&nbsp;=&nbsp;layouts[<span data-darkreader-inline-color="">this</span>.currentItem.__config__.layout]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(layout)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;layout.call(<span data-darkreader-inline-color="">this</span>,&nbsp;h,&nbsp;<span data-darkreader-inline-color="">this</span>.currentItem,&nbsp;<span data-darkreader-inline-color="">this</span>.index,&nbsp;<span data-darkreader-inline-color="">this</span>.drawingList)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;layoutIsNotFound.call(<span data-darkreader-inline-color="">this</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br></span><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

布局这里就不细讲了，与前面渲染的区别就是渲染时返回的是字符串，而这里直接返回的是 JSX；同时，在外层多加了几个按钮（复制、删除）

```
<span data-remoteid="c1701274869501" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\views\index\DraggableItem.vue</span><br><span data-darkreader-inline-color="">const</span>&nbsp;layouts&nbsp;=&nbsp;{<br>&nbsp;&nbsp;colFormItem(h,&nbsp;currentItem,&nbsp;index,&nbsp;list)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-col</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">render</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>=<span data-darkreader-inline-color="">{config.renderKey}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">conf</span>=<span data-darkreader-inline-color="">{currentItem}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">onInput</span>=<span data-darkreader-inline-color="">{(event)</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.$set(config,&nbsp;"defaultValue",&nbsp;event);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{child}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">render</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{components.itemBtns.apply(this,&nbsp;arguments)}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-col</span>&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;...<br>};<br></code>
```

很显然，里面有个很突兀的 render 组件，它是渲染输入型组件、选择型组件的关键

```
<span data-remoteid="c1701274869502" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">//&nbsp;src\components\render\render.js</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">props</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">conf</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">Object</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">required</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;render(h)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;先整个默认属性对象<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;参考链接&nbsp;4<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;dataObject&nbsp;=&nbsp;makeDataObject();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;拷贝一份&nbsp;json&nbsp;DSL</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;confClone&nbsp;=&nbsp;deepClone(<span data-darkreader-inline-color="">this</span>.conf);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;children&nbsp;=&nbsp;<span data-darkreader-inline-color="">this</span>.$slots.default&nbsp;||&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如果slots文件夹存在与当前tag同名的文件<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;则执行文件中的代码<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;mountSlotFiles.call(<span data-darkreader-inline-color="">this</span>,&nbsp;h,&nbsp;confClone,&nbsp;children);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;将字符串类型的事件，发送为消息</span><br>&nbsp;&nbsp;&nbsp;&nbsp;emitEvents.call(<span data-darkreader-inline-color="">this</span>,&nbsp;confClone);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;将&nbsp;json&nbsp;表单配置转化为vue&nbsp;render可以识别的&nbsp;“数据对象”<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;同样参考链接&nbsp;4<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;buildDataObject.call(<span data-darkreader-inline-color="">this</span>,&nbsp;confClone,&nbsp;dataObject);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;调用&nbsp;vue&nbsp;的&nbsp;h&nbsp;函数（render）<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;h(<span data-darkreader-inline-color="">this</span>.conf.__config__.tag,&nbsp;dataObject,&nbsp;children);<br>&nbsp;&nbsp;},<br>};<br></code>
```

就是调用 vue 的 render 函数，也即代码中的 h 函数，要做的只是将 json DSL 转换为 render 函数能识别的对象

转换也很简单，甚至没有解析，只有二十几行代码

篇幅有限，可自行查阅 vue2 文档关于渲染函数的部分（参考链接 4）

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

### 配置面板

这一块内容就真的没啥好说的了，所有配置项都写死在 `Rightpanel.vue` 组件中，通过 `v-if` 决定该展示哪个配置项

```
<span data-remoteid="c1701274869503" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\RightPanel.vue&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;!--&nbsp;截取部分&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-color="">v-if</span>=<span data-darkreader-inline-color="">"activeData.__vModel__!==undefined"</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"字段名"</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-input</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-color="">"activeData.__vModel__"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">placeholder</span>=<span data-darkreader-inline-color="">"请输入字段名（v-model）"</span><br>&nbsp;&nbsp;/&gt;</span><br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form-item</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">v-if</span>=<span data-darkreader-inline-color="">"activeData.__config__.componentName!==undefined"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"组件名"</span><br>&gt;</span><br>&nbsp;&nbsp;{{&nbsp;activeData.__config__.componentName&nbsp;}}<br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-color="">v-if</span>=<span data-darkreader-inline-color="">"activeData.__config__.label!==undefined"</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"标题"</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-input</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-color="">"activeData.__config__.label"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">placeholder</span>=<span data-darkreader-inline-color="">"请输入标题"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;@<span data-darkreader-inline-color="">input</span>=<span data-darkreader-inline-color="">"changeRenderKey"</span><br>&nbsp;&nbsp;/&gt;</span><br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br></code>
```

如何与渲染面板通信呢？以下是可视化配置页面引用的 RightPanel 组件代码

```
<span data-remoteid="c1701274869504" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\Home.vue&nbsp;--&gt;</span><br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">right-panel</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">:active-data</span>=<span data-darkreader-inline-color="">"activeData"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">:form-conf</span>=<span data-darkreader-inline-color="">"formConf"</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">:show-field</span>=<span data-darkreader-inline-color="">"!!drawingList.length"</span><br>&nbsp;&nbsp;@<span data-darkreader-inline-color="">tag-change</span>=<span data-darkreader-inline-color="">"tagChange"</span><br>&nbsp;&nbsp;@<span data-darkreader-inline-color="">fetch-data</span>=<span data-darkreader-inline-color="">"fetchData"</span><br>/&gt;</span><br></code>
```

其中 `tag-change` 用于监听组件类型的切换（输入型组件与选择型组件间地切换）

`fetch-data` 用于监听 级联组件、表格组件动态化数据的接口配置更改

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

其余数据通过 `activeData`、`formConf` 两个 prop 传递

将 formConf、activeData 对象中的属性直接作为值绑定

```
<span data-remoteid="c1701274869505" data-cacheurl="https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;src\views\index\RightPanel.vue&nbsp;--&gt;</span><br>...<br><span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-form-item</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"表单尺寸"</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-radio-group</span>&nbsp;<span data-darkreader-inline-color="">v-model</span>=<span data-darkreader-inline-color="">"formConf.size"</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-radio-button</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"medium"</span>&gt;</span>&nbsp;中等&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-radio-button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-radio-button</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"small"</span>&gt;</span>&nbsp;较小&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-radio-button</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;<span data-darkreader-inline-color="">el-radio-button</span>&nbsp;<span data-darkreader-inline-color="">label</span>=<span data-darkreader-inline-color="">"mini"</span>&gt;</span>&nbsp;迷你&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-radio-button</span>&gt;</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-radio-group</span>&gt;</span><br><span data-darkreader-inline-color="">&lt;/<span data-darkreader-inline-color="">el-form-item</span>&gt;</span><br>...<br></code>
```

直接修改属性，父级的 formConf、activeData 也会被修改

### 生成 JSON

`JSON DSL` 就是 drawingList 与 formConf 的组合

## 总结

大概是考虑到要做出码的缘故，在 出码 与 配置 所用的页面渲染方式是不一样的

出码预览时使用 new Vue 实例的方式；可视化配置时，中间面板渲染表单时巧妙地使用了 JSX + render 函数的方式。在执行效率上，明显是后者更胜一筹

But，该项目仅适用于 Vue2 + elementUI 的场景。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## 题外话

vuedraggable 的源码地址是这个：https://github.com/SortableJS/Vue.Draggable

你上 github 搜，排名前面的都是假的，只是使用了 vuedraggable 的同名 demo 项目，居然还能有几百个 star，属实是羡慕了

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

## 参考

1.  https://jakhuang.github.io/form-generator
    
2.  https://github.com/SortableJS/Vue.Draggable
    
3.  https://github.com/SortableJS/Sortable#readme
    
4.  https://v2.cn.vuejs.org/v2/guide/render-function.html#深入数据对象