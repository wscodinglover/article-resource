## 手写 instanceof 操作符

instanceof 可以用于判断一个构造函数的原型是否在一个对象的原型链上

```
<span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>myInstanceof</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>left</span><span>,</span><span>&nbsp;right</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//获取对象原型</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>let</span></span><span>&nbsp;proto&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>Object</span></span><span>.</span><span data-darkreader-inline-color=""><span>getPrototypeOf</span></span><span>(</span><span>left</span><span>);</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//获取构造函数的prototype</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;prototype&nbsp;</span><span>=</span><span>&nbsp;right</span><span>.</span><span><span data-darkreader-inline-color=""><span>prototype</span></span></span><span>;</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;判断构造函数的&nbsp;prototype&nbsp;对象是否在对象的原型链上</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>while</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>true</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(!</span><span>proto</span><span>)</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>false</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>proto&nbsp;</span><span>===</span><span>&nbsp;prototype</span><span>)</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>true</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果没有找到，就继续从其原型上找，Object.getPrototypeOf方法用来获取指定对象的原型</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;proto&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>Object</span></span><span>.</span><span data-darkreader-inline-color=""><span>getPrototypeOf</span></span><span>(</span><span>proto</span><span>);</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><span>};</span>
```

## 手写 call 函数

call 是函数原型上的一个方法,它可以改变函数的 this 指向

```
<span data-darkreader-inline-color=""><span>Function</span></span><span>.</span><span><span data-darkreader-inline-color=""><span>prototype</span></span></span><span>.</span><span><span>myCall</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span>(</span><span><span>context</span><span>,</span><span>&nbsp;</span><span>...</span><span>args</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;判断context是否为null或undefined，如果是，则将其设置为全局对象（浏览器中为window）</span></span><br><span>&nbsp;&nbsp;context&nbsp;</span><span>=</span><span>&nbsp;context&nbsp;</span><span>||</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>window</span></span><span>;</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;将当前函数作为context的一个属性方法,避免key重复这里使用Symbol</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;key&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>Symbol</span></span><span>();</span><br><span>&nbsp;&nbsp;context</span><span>[</span><span>key</span><span>]</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>;</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;调用该方法，并传入参数</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;result&nbsp;</span><span>=</span><span>&nbsp;context</span><span>[</span><span>key</span><span>](...</span><span>args</span><span>);</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;删除该方法</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>delete</span></span><span>&nbsp;context</span><span>[</span><span>key</span><span>];</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>console</span></span><span>.</span><span data-darkreader-inline-color=""><span>log</span></span><span>(</span><span>context</span><span>);</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;返回调用结果</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;result</span><span>;</span><br><span>};</span>
```

## 手写 new 操作符

实现之前我们需要知道 new xxx 做了什么

1.  1. 创建一个对象
    
2.  2. 将构造函数的作用域赋给新对象（也就是将对象的**proto**属性指向构造函数的 prototype 属性）
    
3.  3. 指向构造函数中的代码，构造函数中的 this 指向该对象（也就是为这个对象添加属性和方法）
    
4.  4. 返回新的对象(如果构造函数返回了一个对象,那么 new 出来的就是这个返回的对象,否则返回新的对象)
    

```
<span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>myNew</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>constructor</span><span>,</span><span>&nbsp;</span><span>...</span><span>args</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;创建一个新对象，该对象的原型指向构造函数的原型</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;obj&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>Object</span></span><span>.</span><span data-darkreader-inline-color=""><span>create</span></span><span>(</span><span>constructor</span><span>.</span><span><span data-darkreader-inline-color=""><span>prototype</span></span></span><span>);</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;调用构造函数，并将新对象作为this参数传递</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;result&nbsp;</span><span>=</span><span>&nbsp;constructor</span><span>.</span><span data-darkreader-inline-color=""><span>apply</span></span><span>(</span><span>obj</span><span>,</span><span>&nbsp;args</span><span>);</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果构造函数返回一个对象，则返回该对象；否则返回新对象</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;result&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"object"</span></span><span>&nbsp;</span><span>&amp;&amp;</span><span>&nbsp;result&nbsp;</span><span>!==</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>null</span></span><span>&nbsp;</span><span>?</span><span>&nbsp;result&nbsp;</span><span>:</span><span>&nbsp;obj</span><span>;</span><br><span>};</span>
```

## 手写深拷贝

```
<span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>deepClone</span></span><span>(</span><span><span>obj</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;判断obj是否为null或undefined，如果是，则直接返回obj</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>obj&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>null</span></span><span>&nbsp;</span><span>||</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;obj&nbsp;</span><span>!==</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"object"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;obj</span><span>;</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;创建一个新的对象或数组</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;clone&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>Array</span></span><span>.</span><span data-darkreader-inline-color=""><span>isArray</span></span><span>(</span><span>obj</span><span>)</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>[]</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>{};</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;遍历obj的属性或元素</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>for</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>let</span></span><span>&nbsp;key&nbsp;</span><span data-darkreader-inline-color=""><span>in</span></span><span>&nbsp;obj</span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;判断obj的属性或元素是否为自身属性</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>obj</span><span>.</span><span data-darkreader-inline-color=""><span>hasOwnProperty</span></span><span>(</span><span>key</span><span>))</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;递归调用deepClone函数，将属性或元素的值赋给新对象或数组的对应属性或元素</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span>[</span><span>key</span><span>]</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>deepClone</span></span><span>(</span><span>obj</span><span>[</span><span>key</span><span>]);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;返回新的对象或数组</span></span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;clone</span><span>;</span><br><span>}</span>
```

## 实现防抖和节流

-   • 防抖
    

用于限制某个函数在短时间内频繁触发。防抖的原理是在函数被调用后，等待一段时间，如果在这段时间内没有再次调用该函数，则执行该函数；如果在这段时间内再次调用了该函数，则重新计时。

```
<span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>debounce</span></span><span>(</span><span><span>func</span><span>,</span><span>&nbsp;delay</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>let</span></span><span>&nbsp;timer</span><span>;</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span>(</span><span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>clearTimeout</span></span><span>(</span><span>timer</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>setTimeout</span></span><span>(</span><span>func</span><span>,</span><span>&nbsp;delay</span><span>);</span><br><span>&nbsp;&nbsp;</span><span>};</span><br><span>}</span><br><br><span data-darkreader-inline-color=""><span>//&nbsp;示例</span></span><br><span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>handleInput</span></span><span>(</span><span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>console</span></span><span>.</span><span data-darkreader-inline-color=""><span>log</span></span><span>(</span><span data-darkreader-inline-color=""><span>"输入事件被触发"</span></span><span>);</span><br><span>}</span><br><br><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;debouncedHandleInput&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>debounce</span></span><span>(</span><span>handleInput</span><span>,</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>300</span></span><span>);</span><br><br><span data-darkreader-inline-color=""><span>//&nbsp;模拟输入事件</span></span><br><span data-darkreader-inline-color=""><span>debouncedHandleInput</span></span><span>();</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;300毫秒后输出&nbsp;"输入事件被触发"</span></span><br><span data-darkreader-inline-color=""><span>debouncedHandleInput</span></span><span>();</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;取消上一次的定时器，重新计时</span></span><br><span data-darkreader-inline-color=""><span>debouncedHandleInput</span></span><span>();</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;取消上一次的定时器，重新计时</span></span>
```

-   • 节流
    

节流用于限制某个函数在一定时间内的执行次数。节流的原理是在函数被调用后，等待一段时间，如果在这段时间内再次调用该函数，则忽略该次调用。

```
<span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>throttle</span></span><span>(</span><span><span>fn</span><span>,</span><span>&nbsp;delay</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>let</span></span><span>&nbsp;timer</span><span>;</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>function</span></span><span>&nbsp;</span><span>(</span><span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(!</span><span>timer</span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>setTimeout</span></span><span>(</span><span><span>()</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>func</span></span><span>();</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>null</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>},</span><span>&nbsp;delay</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;</span><span>};</span><br><span>}</span>
```

## 实现 promise

```
<span data-darkreader-inline-color=""><span>class</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>constructor</span></span><span>(</span><span><span>executor</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;初始化Promise的状态、值和回调数组</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"pending"</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>undefined</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>callbacks</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>[];</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;定义resolve函数，用于将Promise状态设置为fulfilled并执行回调</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>value</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"pending"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"fulfilled"</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;value</span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>callbacks</span></span><span>.</span><span data-darkreader-inline-color=""><span>forEach</span></span><span>(</span><span><span>(</span><span><span>callback</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;callback</span><span>.</span><span data-darkreader-inline-color=""><span>onFulfilled</span></span><span>(</span><span>value</span><span>));</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>};</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;定义reject函数，用于将Promise状态设置为rejected并执行回调</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>reason</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"pending"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"rejected"</span></span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;reason</span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>callbacks</span></span><span>.</span><span data-darkreader-inline-color=""><span>forEach</span></span><span>(</span><span><span>(</span><span><span>callback</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;callback</span><span>.</span><span data-darkreader-inline-color=""><span>onRejected</span></span><span>(</span><span>reason</span><span>));</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>};</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>try</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;执行executor函数，并传入resolve和reject函数作为参数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>executor</span></span><span>(</span><span>resolve</span><span>,</span><span>&nbsp;reject</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>catch</span></span><span>&nbsp;</span><span>(</span><span>error</span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果executor函数抛出异常，则将Promise状态设置为rejected</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>(</span><span>error</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>then</span></span><span>(</span><span><span>onFulfilled</span><span>,</span><span>&nbsp;onRejected</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;创建一个新的Promise实例，并返回该实例</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>new</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>(</span><span><span>(</span><span><span>resolve</span><span>,</span><span>&nbsp;reject</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;定义处理回调的函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>handleCallback</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>callback</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>try</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;执行回调，并获取返回值</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;result&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>callback</span></span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果返回值是一个Promise实例，则调用其then方法，并传入resolve和reject函数作为参数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>result&nbsp;</span><span data-darkreader-inline-color=""><span>instanceof</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><span>.</span><span data-darkreader-inline-color=""><span>then</span></span><span>(</span><span>resolve</span><span>,</span><span>&nbsp;reject</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果返回值不是一个Promise实例，则将返回值作为新Promise实例的值，并调用resolve函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span>result</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>catch</span></span><span>&nbsp;</span><span>(</span><span>error</span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果回调执行过程中抛出异常，则将Promise状态设置为rejected，并调用reject函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>(</span><span>error</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>};</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"fulfilled"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise状态已经是fulfilled，则立即执行onFulfilled回调</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;onFulfilled&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"function"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>handleCallback</span></span><span>(</span><span>onFulfilled</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果onFulfilled不是一个函数，则直接将Promise的值作为新Promise实例的值，并调用resolve函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>state</span></span><span>&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"rejected"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise状态已经是rejected，则立即执行onRejected回调</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;onRejected&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"function"</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>handleCallback</span></span><span>(</span><span>onRejected</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果onRejected不是一个函数，则直接将Promise的值作为新Promise实例的值，并调用reject函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>(</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>value</span></span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise状态是pending，则将回调添加到回调数组中</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span><span>callbacks</span></span><span>.</span><span data-darkreader-inline-color=""><span>push</span></span><span>({</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>onFulfilled</span></span><span>:</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;onFulfilled&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"function"</span></span><span>&nbsp;</span><span>?</span><span>&nbsp;onFulfilled&nbsp;</span><span>:</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>null</span></span><span>,</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>onRejected</span></span><span>:</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>typeof</span></span><span>&nbsp;onRejected&nbsp;</span><span>===</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>"function"</span></span><span>&nbsp;</span><span>?</span><span>&nbsp;onRejected&nbsp;</span><span>:</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>null</span></span><span>,</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>catch</span></span><span>(</span><span>onRejected</span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;catch方法是then方法的一个简写形式，用于捕获Promise链中的错误</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>this</span></span><span>.</span><span data-darkreader-inline-color=""><span>then</span></span><span>(</span><span data-darkreader-inline-color=""><span>null</span></span><span>,</span><span>&nbsp;onRejected</span><span>);</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>static</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span><span>value</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;resolve方法用于创建一个已经被解析为给定值的Promise实例</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>new</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>(</span><span><span>(</span><span><span>resolve</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span>value</span><span>));</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>static</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>(</span><span><span>reason</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;reject方法用于创建一个已经被拒绝为给定原因的Promise实例</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>new</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>(</span><span><span>(</span><span><span>resolve</span><span>,</span><span>&nbsp;reject</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>reject</span></span><span>(</span><span>reason</span><span>));</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>static</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>all</span></span><span>(</span><span><span>promises</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;all方法用于将多个Promise实例包装成一个新的Promise实例</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>new</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>(</span><span><span>(</span><span><span>resolve</span><span>,</span><span>&nbsp;reject</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;创建一个数组用于存储每个Promise实例的结果</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;results&nbsp;</span><span>=</span><span>&nbsp;</span><span>[];</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;创建一个计数器，用于记录已经完成的Promise实例的数量</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>let</span></span><span>&nbsp;count&nbsp;</span><span>=</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>0</span></span><span>;</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;定义处理结果的函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>const</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>processResult</span></span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span><span>index</span><span>,</span><span>&nbsp;value</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;将每个Promise实例的结果存储到results数组中</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results</span><span>[</span><span>index</span><span>]</span><span>&nbsp;</span><span>=</span><span>&nbsp;value</span><span>;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;每次处理一个Promise实例的结果时，计数器加1</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count</span><span>++;</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;当所有Promise实例都已经完成时，调用resolve函数，并将results数组作为参数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>count&nbsp;</span><span>===</span><span>&nbsp;promises</span><span>.</span><span><span>length</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span>results</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>};</span><br><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;遍历每个Promise实例，并处理其结果</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promises</span><span>.</span><span data-darkreader-inline-color=""><span>forEach</span></span><span>(</span><span><span>(</span><span><span>promise</span><span>,</span><span>&nbsp;index</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>promise&nbsp;</span><span data-darkreader-inline-color=""><span>instanceof</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise实例是一个MyPromise实例，则调用其then方法，并传入processResult和reject函数作为参数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise</span><span>.</span><span data-darkreader-inline-color=""><span>then</span></span><span>(</span><span><span>(</span><span><span>value</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>processResult</span></span><span>(</span><span>index</span><span>,</span><span>&nbsp;value</span><span>),</span><span>&nbsp;reject</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise实例不是一个MyPromise实例，则直接将其作为结果，并调用processResult函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>processResult</span></span><span>(</span><span>index</span><span>,</span><span>&nbsp;promise</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><br><span>&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>static</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>race</span></span><span>(</span><span><span>promises</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;race方法用于将多个Promise实例包装成一个新的Promise实例，并返回最先完成的Promise实例的结果</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>return</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>new</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>(</span><span><span>(</span><span><span>resolve</span><span>,</span><span>&nbsp;reject</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;遍历每个Promise实例</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promises</span><span>.</span><span data-darkreader-inline-color=""><span>forEach</span></span><span>(</span><span><span>(</span><span><span>promise</span></span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>if</span></span><span>&nbsp;</span><span>(</span><span>promise&nbsp;</span><span data-darkreader-inline-color=""><span>instanceof</span></span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>MyPromise</span></span><span>)</span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise实例是一个MyPromise实例，则调用其then方法，并传入resolve和reject函数作为参数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise</span><span>.</span><span data-darkreader-inline-color=""><span>then</span></span><span>(</span><span>resolve</span><span>,</span><span>&nbsp;reject</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;</span><span data-darkreader-inline-color=""><span>else</span></span><span>&nbsp;</span><span>{</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>//&nbsp;如果Promise实例不是一个MyPromise实例，则直接将其作为结果，并调用resolve函数</span></span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span data-darkreader-inline-color=""><span>resolve</span></span><span>(</span><span>promise</span><span>);</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>});</span><br><span>&nbsp;&nbsp;</span><span>}</span><br><span>}</span>
```