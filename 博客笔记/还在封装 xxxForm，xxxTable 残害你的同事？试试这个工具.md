> 作者：若邪
> 
> 原文：https://juejin.cn/post/7315242945454735414

之前写过一篇文章我理想中的低代码开发工具的形态，已经吐槽了各种封装 xxxForm，xxxTable 的行为，这里就不啰嗦了。今天再来看看我的工具达到了什么程度。

多图预警。。。

## 以管理后台一个列表页为例

![Image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/XP4dRIhZqqXnTYbR17hlE3fCPDrTrqiaclgZKtgYicPOJhnp9fCUPTX0iaplyoG4urWoIRWVIxoyzSPibF9bdo9kxg/640?wx_fmt=jpeg&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

然后：

1.   选择对应的模板
    
2.  截图查询区域，使用 OCR 初始化查询表单的配置
    
3.  截图表头，使用 OCR 初始化 table 的配置
    
4.  使用 ChatGPT翻译中文字段
    
5.  生成代码
    

## 效果

目前我们没有写一行代码，效果就已经不错了，下面是一部分生成的代码

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;reactive,&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span><br><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;IFetchTableListResult&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./api'</span><br><br>interface&nbsp;ITableListItem&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;决算单状态<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">settlementStatus</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;主合同编号<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">mainContractNumber</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;客户名称<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">customerName</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;客户手机号<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">customerPhone</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;房屋地址<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">houseAddress</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;工程管理<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">projectManagement</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;接口返回的数据，新增字段不需要改&nbsp;ITableListItem&nbsp;直接从这里取<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">apiResult</span>:&nbsp;IFetchTableListResult[<span data-darkreader-inline-color="">'result'</span>][<span data-darkreader-inline-color="">'records'</span>][<span data-darkreader-inline-color="">0</span>]<br>}<br><br>interface&nbsp;IFormData&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;决算单状态<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;settlementStatus?:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;主合同编号<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;mainContractNumber?:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;客户名称<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;customerName?:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;客户手机号<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;customerPhone?:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">/**<br>&nbsp;&nbsp;&nbsp;*&nbsp;工程管理<br>&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;projectManagement?:&nbsp;string<br>}<br><br>interface&nbsp;IOptionItem&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">label</span>:&nbsp;string<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">value</span>:&nbsp;string<br>}<br><br>interface&nbsp;IOptions&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">settlementStatus</span>:&nbsp;IOptionItem[]<br>}<br><br><span data-darkreader-inline-color="">const</span>&nbsp;defaultOptions:&nbsp;IOptions&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">settlementStatus</span>:&nbsp;[],<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;defaultFormData:&nbsp;IFormData&nbsp;=&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">settlementStatus</span>:&nbsp;<span data-darkreader-inline-color="">undefined</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">mainContractNumber</span>:&nbsp;<span data-darkreader-inline-color="">undefined</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">customerName</span>:&nbsp;<span data-darkreader-inline-color="">undefined</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">customerPhone</span>:&nbsp;<span data-darkreader-inline-color="">undefined</span>,<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">projectManagement</span>:&nbsp;<span data-darkreader-inline-color="">undefined</span>,<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;useModel&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;filterForm&nbsp;=&nbsp;reactive&lt;IFormData&gt;({&nbsp;...defaultFormData&nbsp;})<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;options&nbsp;=&nbsp;reactive&lt;IOptions&gt;({&nbsp;...defaultOptions&nbsp;})<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;tableList&nbsp;=&nbsp;ref&lt;(ITableListItem&nbsp;&amp;&nbsp;{&nbsp;_?:&nbsp;unknown&nbsp;})[]&gt;([])<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;pagination&nbsp;=&nbsp;reactive&lt;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">page</span>:&nbsp;number<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">pageSize</span>:&nbsp;number<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">total</span>:&nbsp;number<br>&nbsp;&nbsp;}&gt;({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">page</span>:&nbsp;<span data-darkreader-inline-color="">1</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">pageSize</span>:&nbsp;<span data-darkreader-inline-color="">10</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">total</span>:&nbsp;<span data-darkreader-inline-color="">0</span>,<br>&nbsp;&nbsp;})<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;loading&nbsp;=&nbsp;reactive&lt;{&nbsp;<span data-darkreader-inline-color="">list</span>:&nbsp;boolean&nbsp;}&gt;({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">list</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;})<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;filterForm,<br>&nbsp;&nbsp;&nbsp;&nbsp;options,<br>&nbsp;&nbsp;&nbsp;&nbsp;tableList,<br>&nbsp;&nbsp;&nbsp;&nbsp;pagination,<br>&nbsp;&nbsp;&nbsp;&nbsp;loading,<br>&nbsp;&nbsp;}<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;type&nbsp;Model&nbsp;=&nbsp;ReturnType&lt;<span data-darkreader-inline-color="">typeof</span>&nbsp;useModel&gt;<br></code>
```

这就是用模板生成的好处，有规范，随时可以改，而封装 xxxForm，xxxTable 就是一个黑盒。

## 原理

下面大致说一下原理

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

首先是写好一个个模版，vscode 插件读取指定目录下模版显示到界面上

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

每个模版下可能包含如下内容：

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

选择模版后，进入动态表单配置界面

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

动态表单是读取 config/schema.json 里的内容进行动态渲染的，目前支持 amis、form-render、formily

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

配置表单是为了生成 JSON 数据，然后根据 JSON 数据生成代码。所以最终还是无法避免的使用私有的 DSL ，但是生成后的代码是没有私有 DSL 的痕迹的。生成代码本质是 JSON + EJS 模版引擎编译 src 目录下的 ejs 文件。

为了加快表单的配置，可以自定义脚本进行操作

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

这部分内容是读取 config/preview.json 内容进行显示的

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

选择对应的脚本方法后，插件会动态加载 script/index.js 脚本，并执行里面对应的方法

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

以 initColumnsFromImage 方法为例，这个方法是读取剪贴板里的图片，然后使用百度 OCR 解析出文本，再使用文本初始化表单

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">initColumnsFromImage:&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;(lowcodeContext)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;context.lowcodeContext&nbsp;=&nbsp;lowcodeContext;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;res&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;main.handleInitColumnsFromImage();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;res;<br>&nbsp;&nbsp;},<br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">js<br>复制代码<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">handleInitColumnsFromImage</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;lowcodeContext&nbsp;}&nbsp;=&nbsp;context;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!lowcodeContext?.clipboardImage)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.showInformationMessage(<span data-darkreader-inline-color="">'剪贴板里没有截图'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;lowcodeContext?.model;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;ocrRes&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;generalBasic({&nbsp;<span data-darkreader-inline-color="">image</span>:&nbsp;lowcodeContext!.clipboardImage!&nbsp;});<br>&nbsp;&nbsp;env.clipboard.writeText(ocrRes.words_result.map(<span>(<span>s</span>)&nbsp;=&gt;</span>&nbsp;s.words).join(<span data-darkreader-inline-color="">'\r\n'</span>));<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.showInformationMessage(<span data-darkreader-inline-color="">'内容已经复制到剪贴板'</span>);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;columns&nbsp;=&nbsp;ocrRes.words_result.map(<span>(<span>s</span>)&nbsp;=&gt;</span>&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">slot</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">title</span>:&nbsp;s.words,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">dataIndex</span>:&nbsp;s.words,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">key</span>:&nbsp;s.words,<br>&nbsp;&nbsp;}));<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;{&nbsp;...lowcodeContext.model,&nbsp;columns&nbsp;};<br>}<br></code>
```

反正就是可以根据自己的需求定义各种各样的脚本。比如使用 ChatGPT 翻译 JSON 里的指定字段，可以看我的上一篇文章TypeChat、JSONSchemaChat实战 - 让ChatGPT更听你的话<sup data-darkreader-inline-color="">[2]</sup>

再比如要实现把中文翻译成英文，然后英文使用驼峰语法，这样就可以将中文转成英文代码变量，下面是实现的效果

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

选择对应的命令菜单后 vscode 插件会加载对应模版里的脚本，然后执行里面的 onSelect 方法。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

main.ts 代码如下

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;env,&nbsp;<span data-darkreader-inline-color="">window</span>,&nbsp;Range&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vscode'</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;context&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./context'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">bootstrap</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;clipboardText&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;env.clipboard.readText();<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;{&nbsp;selection,&nbsp;<span data-darkreader-inline-color="">document</span>&nbsp;}&nbsp;=&nbsp;<span data-darkreader-inline-color="">window</span>.activeTextEditor!;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;selectText&nbsp;=&nbsp;<span data-darkreader-inline-color="">document</span>.getText(selection).trim();<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;content&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;context.lowcodeContext!.createChatCompletion({<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">messages</span>:&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">role</span>:&nbsp;<span data-darkreader-inline-color="">'system'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">content</span>:&nbsp;<span data-darkreader-inline-color="">`你是一个翻译家，你的目标是把中文翻译成英文单词，请翻译时使用驼峰格式，小写字母开头，不要带翻译腔，而是要翻译得自然、流畅和地道，使用优美和高雅的表达方式。请翻译下面用户输入的内容`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">role</span>:&nbsp;<span data-darkreader-inline-color="">'user'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">content</span>:&nbsp;selectText&nbsp;||&nbsp;clipboardText,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;content&nbsp;=&nbsp;content.charAt(<span data-darkreader-inline-color="">0</span>).toLowerCase()&nbsp;+&nbsp;content.slice(<span data-darkreader-inline-color="">1</span>);<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.activeTextEditor?.edit(<span>(<span>editBuilder</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(<span data-darkreader-inline-color="">window</span>.activeTextEditor?.selection.isEmpty)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;editBuilder.insert(<span data-darkreader-inline-color="">window</span>.activeTextEditor.selection.start,&nbsp;content);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;editBuilder.replace(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;Range(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.activeTextEditor!.selection.start,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.activeTextEditor!.selection.end,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;});<br>}<br></code>
```

使用了 ChatGPT。

再来看看，之前生成管理后台 CURD 页面的时候，连 mock 也一起生成了，主要逻辑放在了 complete 方法里，这是插件的一个生命周期函数。

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

因为 mock 服务在另一个项目里，所以需要跨目录去生成代码，这里我在 mock 服务里加了个接口返回 mock 项目所在的目录

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">.get(<span data-darkreader-inline-color="">`/mockProjectPath`</span>,&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;(ctx,&nbsp;next)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;ctx.body&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">status</span>:&nbsp;<span data-darkreader-inline-color="">200</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">msg</span>:&nbsp;<span data-darkreader-inline-color="">''</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">result</span>:&nbsp;__dirname,<br>&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;})<br></code>
```

生成代码的时候请求这个接口，就知道往哪个目录生成代码了

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;mockProjectPathRes&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;axios<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(<span data-darkreader-inline-color="">'http://localhost:3001/mockProjectPath'</span>,&nbsp;{&nbsp;<span data-darkreader-inline-color="">timeout</span>:&nbsp;<span data-darkreader-inline-color="">1000</span>&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.catch(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">window</span>.showInformationMessage(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'获取&nbsp;mock&nbsp;项目路径失败，跳过更新&nbsp;mock&nbsp;服务'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(mockProjectPathRes?.data.result)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;projectName&nbsp;=&nbsp;workspace.rootPath<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?.replace(<span data-darkreader-inline-color="">/\\/g</span>,&nbsp;<span data-darkreader-inline-color="">'/'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.split(<span data-darkreader-inline-color="">'/'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.pop();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;mockRouteFile&nbsp;=&nbsp;path.join(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockProjectPathRes.data.result,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${projectName}</span>.js`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;mockFileContent&nbsp;=&nbsp;<span data-darkreader-inline-color="">`<br>&nbsp;&nbsp;&nbsp;import&nbsp;KoaRouter&nbsp;from&nbsp;'koa-router';<br>&nbsp;&nbsp;&nbsp;import&nbsp;proxy&nbsp;from&nbsp;'../middleware/Proxy';<br>&nbsp;&nbsp;&nbsp;import&nbsp;{&nbsp;delay&nbsp;}&nbsp;from&nbsp;'../lib/util';<br><br>&nbsp;&nbsp;&nbsp;const&nbsp;Mock&nbsp;=&nbsp;require('mockjs');<br><br>&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;Random&nbsp;}&nbsp;=&nbsp;Mock;<br><br>&nbsp;&nbsp;&nbsp;const&nbsp;router&nbsp;=&nbsp;new&nbsp;KoaRouter();<br>&nbsp;&nbsp;&nbsp;router{{mockScript}}<br>&nbsp;&nbsp;&nbsp;module.exports&nbsp;=&nbsp;router;<br>&nbsp;&nbsp;&nbsp;`</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(fs.existsSync(mockRouteFile))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockFileContent&nbsp;=&nbsp;fs.readFileSync(mockRouteFile).toString().toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;index&nbsp;=&nbsp;mockFileContent.lastIndexOf(<span data-darkreader-inline-color="">')'</span>)&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockFileContent&nbsp;=&nbsp;<span data-darkreader-inline-color="">`<span data-darkreader-inline-color="">${mockFileContent.substring(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">0</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}</span>{{mockScript}}\n<span data-darkreader-inline-color="">${mockFileContent.substring(index)}</span>`</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockFileContent&nbsp;=&nbsp;mockFileContent.replace(<span data-darkreader-inline-color="">/{{mockScript}}/g</span>,&nbsp;mockScript);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fs.writeFileSync(mockRouteFile,&nbsp;mockFileContent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execa.sync(<span data-darkreader-inline-color="">'node'</span>,&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path.join(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockProjectPathRes.data.result<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.replace(<span data-darkreader-inline-color="">/\\/g</span>,&nbsp;<span data-darkreader-inline-color="">'/'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.replace(<span data-darkreader-inline-color="">'/src/routes'</span>,&nbsp;<span data-darkreader-inline-color="">''</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'/node_modules/eslint/bin/eslint.js'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockRouteFile,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'--resolve-plugins-relative-to'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mockProjectPathRes.data.result<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.replace(<span data-darkreader-inline-color="">/\\/g</span>,&nbsp;<span data-darkreader-inline-color="">'/'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.replace(<span data-darkreader-inline-color="">'/src/routes'</span>,&nbsp;<span data-darkreader-inline-color="">''</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'--fix'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">catch</span>&nbsp;(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br></code>
```

mock 项目也可以通过 vscode 插件快速创建和使用

上面展示的模版都放在了github.com/lowcode-sca…<sup data-darkreader-inline-color="">[3]</sup>仓库里，照着 README 步骤做就可以使用了。

参考资料

\[1\]

https://juejin.cn/post/7248207744086638629:https://juejin.cn/post/7248207744086638629

\[2\]

https://juejin.cn/post/7309732396081020928:https://juejin.cn/post/7309732396081020928

\[3\]

https://github.com/lowcode-scaffold/lowcode-materials:https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flowcode-scaffold%2Flowcode-materials