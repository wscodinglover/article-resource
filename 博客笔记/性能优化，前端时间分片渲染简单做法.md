```
<section><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="0" data-is_biz_ban="0" data-origin_num="50" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><p data-style="outline: 0px; color: rgb(0, 0, 0); font-size: 16px; white-space: normal; font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; text-align: center; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">点击上方&nbsp;</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，关注公众号</span><span data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><p data-style="outline: 0px; color: rgb(34, 34, 34); font-size: 16px; white-space: normal; font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; text-align: center; word-spacing: 0.8px; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">回复</span><span data-style="outline: 0px; color: rgb(0, 0, 0); caret-color: rgb(51, 51, 51); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 14px; letter-spacing: 0.544px; word-spacing: 2px; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">加群</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，加入技术交流群交流</span></p>
```

前言

大家好，我是Dennis，用最通俗易懂的话讲最难的知识点是我的座右铭，基础是进阶的前提是我的初心~

在经典的面试题中：”**如果后端返回了十万条数据要你插入到页面中，你会怎么处理？** ”

除了像 useVirtualList\[1\] 这样的虚拟列表来处理外，我们还可以通过 `时间分片` 来处理

## 通过 setTimeout

直接上一个例子：

```
<span data-darkreader-inline-color="">&lt;!--<br>&nbsp;*&nbsp;@Author:&nbsp;Jolyne<br>&nbsp;*&nbsp;@Date:&nbsp;2023-09-22&nbsp;15:45:45<br>&nbsp;*&nbsp;@LastEditTime:&nbsp;2023-09-22&nbsp;15:47:24<br>&nbsp;*&nbsp;@LastEditors:&nbsp;Jolyne<br>&nbsp;*&nbsp;@Description:&nbsp;<br>--&gt;</span><br><span data-darkreader-inline-color="">&lt;!DOCTYPE&nbsp;<span>html</span>&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">html</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"en"</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">head</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">charset</span>=<span data-darkreader-inline-color="">"UTF-8"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">http-equiv</span>=<span data-darkreader-inline-color="">"X-UA-Compatible"</span>&nbsp;<span data-darkreader-inline-color="">content</span>=<span data-darkreader-inline-color="">"IE=edge"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">name</span>=<span data-darkreader-inline-color="">"viewport"</span>&nbsp;<span data-darkreader-inline-color="">content</span>=<span data-darkreader-inline-color="">"width=device-width,&nbsp;initial-scale=1.0"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">title</span>&gt;</span>十万数据渲染<span>&lt;/<span data-darkreader-inline-color="">title</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">head</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">body</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ul</span>&nbsp;<span data-darkreader-inline-color="">id</span>=<span data-darkreader-inline-color="">"list-container"</span>&gt;</span><span>&lt;/<span data-darkreader-inline-color="">ul</span>&gt;</span><br><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">script</span>&gt;</span><span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;oListContainer&nbsp;=&nbsp;<span data-darkreader-inline-color="">document</span>.getElementById(<span data-darkreader-inline-color="">'list-container'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;fetchData&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span><span>resolve</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;response&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">code</span>:&nbsp;<span data-darkreader-inline-color="">0</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">msg</span>:&nbsp;<span data-darkreader-inline-color="">'success'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">data</span>:&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;i&nbsp;=&nbsp;<span data-darkreader-inline-color="">0</span>;&nbsp;i&nbsp;&lt;&nbsp;<span data-darkreader-inline-color="">100000</span>;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.data.push(<span data-darkreader-inline-color="">`content-<span data-darkreader-inline-color="">${i&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>}</span>`</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(response)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">100</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;模拟请求后端接口返回十万条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;渲染&nbsp;total&nbsp;条数据中的第&nbsp;page&nbsp;页，每页&nbsp;pageCount&nbsp;条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;renderData&nbsp;=&nbsp;<span>(<span>data,&nbsp;total,&nbsp;page,&nbsp;pageCount</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;base&nbsp;case&nbsp;--&nbsp;total&nbsp;为&nbsp;0&nbsp;时没有数据要渲染&nbsp;不再递归调用</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(total&nbsp;&lt;=&nbsp;<span data-darkreader-inline-color="">0</span>)&nbsp;<span data-darkreader-inline-color="">return</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;total&nbsp;比&nbsp;pageCount&nbsp;少时只渲染&nbsp;total&nbsp;条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageCount&nbsp;=&nbsp;<span data-darkreader-inline-color="">Math</span>.min(pageCount,&nbsp;total)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;startIdx&nbsp;=&nbsp;page&nbsp;*&nbsp;pageCount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;endIdx&nbsp;=&nbsp;startIdx&nbsp;+&nbsp;pageCount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;dataList&nbsp;=&nbsp;data.slice(startIdx,&nbsp;endIdx)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;将&nbsp;pageCount&nbsp;条数据插入到容器中</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;i&nbsp;=&nbsp;<span data-darkreader-inline-color="">0</span>;&nbsp;i&nbsp;&lt;&nbsp;pageCount;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;oItem&nbsp;=&nbsp;<span data-darkreader-inline-color="">document</span>.createElement(<span data-darkreader-inline-color="">'li'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oItem.innerText&nbsp;=&nbsp;dataList[i]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oListContainer.appendChild(oItem)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderData(data,&nbsp;total&nbsp;-&nbsp;pageCount,&nbsp;page&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>,&nbsp;pageCount)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;fetchData().then(<span><span>res</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderData(res.data,&nbsp;res.data.length,&nbsp;<span data-darkreader-inline-color="">0</span>,&nbsp;<span data-darkreader-inline-color="">200</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br><br>&nbsp;&nbsp;</span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">body</span>&gt;</span><br><br><span>&lt;/<span data-darkreader-inline-color="">html</span>&gt;</span><br>
```

上面的例子中，我们使用了 `setTimeout`，在每一次宏任务中插入一页数据，然后设置多个这样地宏任务，直到把所有数据都插入为止。

![Image](https://mmbiz.qpic.cn/mmbiz_jpg/TZL4BdZpLdgzSB5caU86DGwIVAoA7RBU9BBW3D8JHDicLicXwO6qfQIPR3X0SnSbWLAGngA8HGTjsgq72iazXGvEA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

1111111.webp

但是很明显能看到的问题是，快速拖动滚动条时，数据列表中会有闪烁的情况

这是因为：

> 当使用 `setTimeout` 来拆分大量的 DOM 插入操作时，虽然我们将延迟时间设置为 0ms，但实际上由于 JavaScript 是单线程的，任务执行时会被放入到事件队列中，而事件队列中的任务需要等待当前任务执行完成后才能执行。所以即使设置了 0ms 延迟，`setTimeout` 的回调函数也不一定会立即执行，可能会受到其他任务的阻塞。

> 当 `setTimeout` 的回调函数执行的间隔超过了浏览器每帧更新的时间间隔（一般是 16.7ms），就会出现丢帧现象。丢帧指的是浏览器在更新页面时，没有足够的时间执行全部的任务，导致部分任务被跳过，从而导致页面渲染不连续，出现闪烁的情况

所以，我们改善一下，通过 `requestAnimationFrame` 来处理

## 通过 requestAnimationFrame

```
<span data-darkreader-inline-color="">&lt;!--<br>&nbsp;*&nbsp;@Author:&nbsp;Jolyne<br>&nbsp;*&nbsp;@Date:&nbsp;2023-09-22&nbsp;15:45:45<br>&nbsp;*&nbsp;@LastEditTime:&nbsp;2023-09-22&nbsp;15:47:24<br>&nbsp;*&nbsp;@LastEditors:&nbsp;Jolyne<br>&nbsp;*&nbsp;@Description:&nbsp;<br>--&gt;</span><br><span data-darkreader-inline-color="">&lt;!DOCTYPE&nbsp;<span>html</span>&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">html</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"en"</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">head</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">charset</span>=<span data-darkreader-inline-color="">"UTF-8"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">http-equiv</span>=<span data-darkreader-inline-color="">"X-UA-Compatible"</span>&nbsp;<span data-darkreader-inline-color="">content</span>=<span data-darkreader-inline-color="">"IE=edge"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">meta</span>&nbsp;<span data-darkreader-inline-color="">name</span>=<span data-darkreader-inline-color="">"viewport"</span>&nbsp;<span data-darkreader-inline-color="">content</span>=<span data-darkreader-inline-color="">"width=device-width,&nbsp;initial-scale=1.0"</span>&nbsp;/&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">title</span>&gt;</span>直接插入十万条数据<span>&lt;/<span data-darkreader-inline-color="">title</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">head</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">body</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">ul</span>&nbsp;<span data-darkreader-inline-color="">id</span>=<span data-darkreader-inline-color="">"list-container"</span>&gt;</span><span>&lt;/<span data-darkreader-inline-color="">ul</span>&gt;</span><br><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">script</span>&gt;</span><span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;oListContainer&nbsp;=&nbsp;<span data-darkreader-inline-color="">document</span>.getElementById(<span data-darkreader-inline-color="">'list-container'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;fetchData&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>(<span><span>resolve</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;response&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">code</span>:&nbsp;<span data-darkreader-inline-color="">0</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">msg</span>:&nbsp;<span data-darkreader-inline-color="">'success'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">data</span>:&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;i&nbsp;=&nbsp;<span data-darkreader-inline-color="">0</span>;&nbsp;i&nbsp;&lt;&nbsp;<span data-darkreader-inline-color="">100000</span>;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.data.push(<span data-darkreader-inline-color="">`content-<span data-darkreader-inline-color="">${i&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>}</span>`</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(response)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span data-darkreader-inline-color="">100</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;模拟请求后端接口返回十万条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;渲染&nbsp;total&nbsp;条数据中的第&nbsp;page&nbsp;页，每页&nbsp;pageCount&nbsp;条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;renderData&nbsp;=&nbsp;<span>(<span>data,&nbsp;total,&nbsp;page,&nbsp;pageCount</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;base&nbsp;case&nbsp;--&nbsp;total&nbsp;为&nbsp;0&nbsp;时没有数据要渲染&nbsp;不再递归调用</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(total&nbsp;&lt;=&nbsp;<span data-darkreader-inline-color="">0</span>)&nbsp;<span data-darkreader-inline-color="">return</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;total&nbsp;比&nbsp;pageCount&nbsp;少时只渲染&nbsp;total&nbsp;条数据</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pageCount&nbsp;=&nbsp;<span data-darkreader-inline-color="">Math</span>.min(pageCount,&nbsp;total)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestAnimationFrame(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;startIdx&nbsp;=&nbsp;page&nbsp;*&nbsp;pageCount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;endIdx&nbsp;=&nbsp;startIdx&nbsp;+&nbsp;pageCount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;dataList&nbsp;=&nbsp;data.slice(startIdx,&nbsp;endIdx)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;将&nbsp;pageCount&nbsp;条数据插入到容器中</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;i&nbsp;=&nbsp;<span data-darkreader-inline-color="">0</span>;&nbsp;i&nbsp;&lt;&nbsp;pageCount;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;oItem&nbsp;=&nbsp;<span data-darkreader-inline-color="">document</span>.createElement(<span data-darkreader-inline-color="">'li'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oItem.innerText&nbsp;=&nbsp;dataList[i]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oListContainer.appendChild(oItem)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderData(data,&nbsp;total&nbsp;-&nbsp;pageCount,&nbsp;page&nbsp;+&nbsp;<span data-darkreader-inline-color="">1</span>,&nbsp;pageCount)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;fetchData().then(<span><span>res</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderData(res.data,&nbsp;res.data.length,&nbsp;<span data-darkreader-inline-color="">0</span>,&nbsp;<span data-darkreader-inline-color="">200</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br><br>&nbsp;&nbsp;</span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">body</span>&gt;</span><br><br><span>&lt;/<span data-darkreader-inline-color="">html</span>&gt;</span><br>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

222222.webp

很明显，闪烁的问题被解决了

这是因为：

> `requestAnimationFrame` 会在浏览器每次进行页面渲染时执行回调函数，保证了每次任务的执行间隔是稳定的，避免了丢帧现象。所以在处理大量 DOM 插入操作时，推荐使用 `requestAnimationFrame` 来拆分任务，以获得更流畅的渲染效果

> 作者：Jolyne\_  
> 链接：https://juejin.cn/post/7282756858174980132  
> 来源：稀土掘金

## 结语

```
<section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 2px; word-spacing: 2px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">欢迎关注「</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span><span data-darkreader-inline-outline="">」</span></span></section><section data-style="margin-bottom: 0px; outline: 0px; background-color: rgb(255, 255, 255); font-size: 16px; text-align: left; white-space: normal; letter-spacing: 0.544px; color: rgb(102, 102, 102); font-family: Lato, &quot;Helvetica Neue&quot;, Helvetica, sans-serif; font-variant-ligatures: common-ligatures;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="2" data-is_biz_ban="0" has-insert-preloading="1" data-index="1" data-origin_num="50" data-isban="0" data-weui-theme="light" data-biz_account_status="0"></mp-common-profile></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 2px; word-spacing: 2px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">号内回复</span></span></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;"<span data-darkreader-inline-outline="">精选</span>" ，将为您推送 历史精选文章"<span data-darkreader-inline-outline="">react"</span>&nbsp;，将为您推送 React.js 相关的学习资料&nbsp;"<span data-darkreader-inline-outline="">学习指南</span>" ，将为您推送 React-Native学习指南&nbsp;"<span data-darkreader-inline-outline="">vue</span>" ，将为您推送vue.js 相关文章&nbsp;"<span data-darkreader-inline-outline="">小程序</span>" ，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">微信小商店</span>"，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">加群</span>" ，添加群主好友拉你进群</section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">加我私人微信，拉你进 React进阶、面试交流群，互相监督学习进步等！</section><p data-style="margin-bottom: 0em; outline: 0px; color: rgb(0, 0, 0); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: center;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><img data-galleryid="" data-ratio="1.261480787253983" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/e93fo6YQKNlJReqfJKqeft8SuT9o4DliaoUIJqmbtBw72F7nYumlpJ5dxIvLfbNv5W0Nf1ZtIltr9bFsL4qd6fg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="1067" data-darkreader-inline-outline="" data-original-style="outline: 0px; border-style: none; border-radius: 3px; display: initial; visibility: visible !important; width: 344px !important; --darkreader-inline-outline: initial;" data-index="4" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="344px" crossorigin="anonymous" alt="Image"><span data-style="outline: 0px; color: rgb(51, 51, 51); font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-size: 17px; letter-spacing: 0.544px; text-align: justify; word-spacing: 0.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><section data-brushtype="text" mp-original-font-size="16" mp-original-line-height="25.600000381469727" data-darkreader-inline-outline="" data-style="margin-bottom: 0em; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(89, 89, 89); font-size: 16px; white-space: normal; letter-spacing: 2px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; widows: 1; word-spacing: 2px; font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light; border-width: 0px; border-style: none; border-color: initial; text-align: right; line-height: 25.6px;" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">“在看和转发”</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">就是最大的支持</span></section>
```