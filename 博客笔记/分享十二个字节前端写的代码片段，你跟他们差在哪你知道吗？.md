```
<section><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="0" data-is_biz_ban="0" data-origin_num="50" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><p data-style="outline: 0px; color: rgb(0, 0, 0); font-size: 16px; white-space: normal; font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; text-align: center; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">点击上方&nbsp;</span><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，关注公众号</span><span data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><p data-style="outline: 0px; color: rgb(34, 34, 34); font-size: 16px; white-space: normal; font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; text-align: center; word-spacing: 0.8px; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">回复</span><span data-style="outline: 0px; color: rgb(0, 0, 0); caret-color: rgb(51, 51, 51); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 14px; letter-spacing: 0.544px; word-spacing: 2px; visibility: visible;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">加群</span></span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">，加入技术交流群交流</span><span data-darkreader-inline-color=""></span></p>
```

## 如何使用交互式的命令行工具下载项目模板

这部分代码实现了一个用户交互的 GitHub 模板下载工具。首先你需要在github上创建一个项目，然后使用下面介绍的代码就可以用命令行拉取到本地，并解压了。

它使用 `enquirer` 库提示用户输入仓库的创建者、名称、分支、和目标目录，然后使用 `downloadTemplate` 函数下载模板，最后使用 `fs-extra` 库存储下载的文件。 `print`函数封装了日志记录的函数。

代码的具体实现如下：

1.  引入依赖：`fs-extra`、`enquirer`、`downloadTemplate` 和 `print`。（print函数实现下面会有）
    

```
import&nbsp;fs&nbsp;from&nbsp;<span data-darkreader-inline-color="">'fs-extra'</span>;<br>import&nbsp;enquirer&nbsp;from&nbsp;<span data-darkreader-inline-color="">'enquirer'</span>;<br>import&nbsp;downloadTemplate&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./download'</span>;<br>import&nbsp;<span data-darkreader-inline-color="">print</span>&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./print'</span>;<br>复制代码<br>
```

2.  定义接口 `IRepo` 和 `IAnswers`，用来描述仓库信息和用户输入的答案。
    

```
<span data-darkreader-inline-color="">type</span>&nbsp;IRepo&nbsp;=&nbsp;{<br>&nbsp;&nbsp;owner:&nbsp;string;<br>&nbsp;&nbsp;name:&nbsp;string;<br>&nbsp;&nbsp;branch:&nbsp;string;<br>};<br><span data-darkreader-inline-color="">type</span>&nbsp;IAnswers&nbsp;=&nbsp;IRepo&nbsp;&amp;&nbsp;{<br>&nbsp;&nbsp;targetDir?:&nbsp;string;<br>};<br>复制代码<br>
```

3.  定义函数 `githubDownloadUrl`，用来构造仓库的下载 URL。
    

```
<span data-darkreader-inline-color="">function</span>&nbsp;githubDownloadUrl(repo:&nbsp;IRepo)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'https://github.com/'</span>&nbsp;+&nbsp;repo.owner&nbsp;+&nbsp;<span data-darkreader-inline-color="">'/'</span>&nbsp;+&nbsp;repo.name&nbsp;+&nbsp;<span data-darkreader-inline-color="">'/archive/refs/heads/'</span>&nbsp;+&nbsp;repo.branch&nbsp;+&nbsp;<span data-darkreader-inline-color="">'.zip'</span>;<br>}<br>复制代码<br>
```

4.  定义一个问题数组，包含需要提示用户输入的问题及其验证逻辑。
    

-   type：表示问题的类型，例如输入、选择、确认等。这里的问题都是输入类型。
    
-   name：表示问题产生的结果值的 key，例如当你在回答问题时输入的值会以 name 作为 key 存储在答案对象中。
    
-   message：表示问题的提示语，例如 "请输入仓库的创建者"。
    
-   default：表示问题的默认值，如果用户没有输入答案，则使用默认值。
    
-   validate：表示问题的验证函数，用来验证用户输入的答案是否合法。如果答案不合法，可以返回一个错误消息，提示用户重新输入。
    
-   questions 数组包含了四个问题对象，每个问题对象都有以下几个属性：
    
-   这些问题将用于提示用户输入，并根据用户输入的答案计算下载模板的 URL 和存储文件的目录。
    

```
const&nbsp;questions&nbsp;=&nbsp;[<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">'input'</span>,&nbsp;//&nbsp;<span data-darkreader-inline-color="">type</span>为交互的类型<br>&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">'owner'</span>,&nbsp;//&nbsp;产生的值的key，比如你输入<span data-darkreader-inline-color="">''</span><br>&nbsp;&nbsp;&nbsp;&nbsp;message:&nbsp;<span data-darkreader-inline-color="">'请输入仓库的创建者(example:&nbsp;"lio-mengxiang")'</span>,&nbsp;//&nbsp;提示语<br>&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;<span data-darkreader-inline-color="">'lio-mengxiang'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;validate(val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'请输入文件名'</span>;&nbsp;//&nbsp;验证一下输入是否不为空<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(fs.accessSync(val,&nbsp;fs.constants.F_OK))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'文件已存在'</span>;&nbsp;//&nbsp;判断文件是否存在<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">'input'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">'name'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;message:&nbsp;<span data-darkreader-inline-color="">'请输入仓库名称(example:&nbsp;"react")'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;<span data-darkreader-inline-color="">'react-pnpm-monorepo-subTemplate'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;validate(val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'请输入仓库名'</span>;&nbsp;//&nbsp;验证一下输入是否不为空<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">'input'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">'branch'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;message:&nbsp;<span data-darkreader-inline-color="">'请输入分支名(example:&nbsp;"main")'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;<span data-darkreader-inline-color="">'main'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;validate(val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!val)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">'请输入分支名'</span>;&nbsp;//&nbsp;验证一下输入是否不为空<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">type</span>:&nbsp;<span data-darkreader-inline-color="">'input'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span data-darkreader-inline-color="">'targetDir'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;message:&nbsp;<span data-darkreader-inline-color="">'请输入放文件的目录(默认当前目录:&nbsp;"./")'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;<span data-darkreader-inline-color="">'./'</span>,<br>&nbsp;&nbsp;},<br>];<br>复制代码<br>
```

3.  使用 `enquirer.prompt` 方法提示用户输入，并处理用户输入的答案。如果输入有误，则输出错误信息并退出程序。
    

```
enquirer<br>&nbsp;&nbsp;.prompt(questions)<br>&nbsp;&nbsp;.<span data-darkreader-inline-color="">then</span>((answers:&nbsp;IAnswers)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;获取用户输入值<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;owner&nbsp;=&nbsp;answers.owner;<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;name&nbsp;=&nbsp;answers.name;<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;branch&nbsp;=&nbsp;answers.branch;<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;targetDir&nbsp;=&nbsp;answers.targetDir;<br>&nbsp;&nbsp;&nbsp;&nbsp;downloadTemplate({&nbsp;url:&nbsp;githubDownloadUrl({&nbsp;owner,&nbsp;name,&nbsp;branch&nbsp;}),&nbsp;targetDir&nbsp;});<br>&nbsp;&nbsp;})<br>&nbsp;&nbsp;.catch((err)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;print.error(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;process.exit(1);<br>&nbsp;&nbsp;});<br>复制代码<br>
```

如果用户输入的答案合法，则使用 `downloadTemplate` 函数下载模板并使用 `fs-extra` 存储文件。

```
import&nbsp;download&nbsp;from&nbsp;<span data-darkreader-inline-color="">'download'</span>;<br>import&nbsp;compressing&nbsp;from&nbsp;<span data-darkreader-inline-color="">'compressing'</span>;<br>import&nbsp;<span data-darkreader-inline-color="">print</span>&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./print'</span>;<br><br>/**<br>&nbsp;*&nbsp;下载远程项目模板的方法<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;downloadTemplate({&nbsp;url,&nbsp;targetDir&nbsp;=&nbsp;<span data-darkreader-inline-color="">'./'</span>&nbsp;}:&nbsp;{&nbsp;url:&nbsp;string;&nbsp;targetDir?:&nbsp;string&nbsp;}):&nbsp;Promise&lt;any&gt;&nbsp;{<br>&nbsp;&nbsp;print.info(<span data-darkreader-inline-color="">'download&nbsp;start,&nbsp;please&nbsp;wait...'</span>);<br>&nbsp;&nbsp;//&nbsp;通过get方法下载<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;download(url,&nbsp;targetDir)<br>&nbsp;&nbsp;&nbsp;&nbsp;.on(<span data-darkreader-inline-color="">'end'</span>,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.success(<span data-darkreader-inline-color="">'download&nbsp;done'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;.<span data-darkreader-inline-color="">then</span>((stream)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;compressing.zip.uncompress(stream,&nbsp;<span data-darkreader-inline-color="">'./'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;.catch((err)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.error(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>}<br><br>复制代码<br>
```

## 分组函数

例如，假设我们有一个数组 \[1, 2, 3, 4, 5, 6\]，如果我们调用 group(\[1, 2, 3, 4, 5, 6\], 2)，那么这个函数会返回一个新的数组 \[\[1, 2\], \[3, 4\], \[5, 6\]\]。

```
<span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;group(array:&nbsp;any[],&nbsp;subGroupLength:&nbsp;number)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;index&nbsp;=&nbsp;0;<br>&nbsp;&nbsp;const&nbsp;newArray&nbsp;=&nbsp;[];<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">while</span>&nbsp;(index&nbsp;&lt;&nbsp;array.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;newArray.push(array.slice(index,&nbsp;(index&nbsp;+=&nbsp;subGroupLength)));<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;newArray;<br>}<br>复制代码<br>
```

## node快速执行linux命令

这段代码定义了一个 `execQuick` 函数，它使用 `spawn` 子进程的方式执行一条命令。`spawn` 子进程的优点是比 `exec` 更高效，因为它不需要创建新的 shell 环境，并且不会因超出最大缓冲区的限制而导致错误。

`execQuick` 函数接受一条命令和一些选项作为参数，并返回一个包含命令执行结果的 Promise 对象。

-   如果用户指定了 `time` 选项，`execQuick` 会在执行完命令后打印出命令执行所花费的时间；
    
-   如果用户指定了 `silent` 选项，`execQuick` 会禁止打印出命令的标准输出和标准错误输出。
    

```
import&nbsp;{&nbsp;spawn&nbsp;}&nbsp;from&nbsp;<span data-darkreader-inline-color="">'child_process'</span>;<br>import&nbsp;<span data-darkreader-inline-color="">print</span>&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./print'</span>;<br><br>/**<br>&nbsp;*&nbsp;spawn优于<span data-darkreader-inline-color="">exec</span>的点<br>&nbsp;*&nbsp;1是在于不用新建shell，减少性能开销<br>&nbsp;*&nbsp;2是没有maxbuffer的限制<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;async&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;execQuick(<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">command</span>:&nbsp;string,<br>&nbsp;&nbsp;options:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cwd?:&nbsp;string;<br>&nbsp;&nbsp;&nbsp;&nbsp;time?:&nbsp;boolean;<br>&nbsp;&nbsp;&nbsp;&nbsp;silent?:&nbsp;boolean;<br>&nbsp;&nbsp;}&nbsp;=&nbsp;{}<br>):&nbsp;Promise&lt;{&nbsp;pid:&nbsp;number;&nbsp;code:&nbsp;number;&nbsp;stdout:&nbsp;string;&nbsp;stderr:&nbsp;string&nbsp;}&gt;&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;new&nbsp;Promise((resolve)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;silent&nbsp;=&nbsp;options.silent&nbsp;!==&nbsp;<span data-darkreader-inline-color="">false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;begin&nbsp;=&nbsp;new&nbsp;Date().getTime();<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;result&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pid:&nbsp;null,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code:&nbsp;null,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stdout:&nbsp;<span data-darkreader-inline-color="">''</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stderr:&nbsp;<span data-darkreader-inline-color="">''</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;stdout,&nbsp;stderr,&nbsp;pid&nbsp;}&nbsp;=&nbsp;spawn(<span data-darkreader-inline-color="">command</span>,&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cwd:&nbsp;options.cwd,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shell:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;}).on(<span data-darkreader-inline-color="">'close'</span>,&nbsp;(code)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(options.time)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;end&nbsp;=&nbsp;new&nbsp;Date().getTime();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;waste&nbsp;=&nbsp;((end&nbsp;-&nbsp;begin)&nbsp;/&nbsp;1000).toFixed(2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.info(<span data-darkreader-inline-color="">command</span>,&nbsp;`Command&nbsp;executed&nbsp;<span data-darkreader-inline-color="">in</span>&nbsp;<span data-darkreader-inline-color="">${waste}</span>&nbsp;ms.`);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(code&nbsp;!==&nbsp;0&nbsp;&amp;&amp;&nbsp;!silent)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.error(<span data-darkreader-inline-color="">command</span>,&nbsp;<span data-darkreader-inline-color="">'Command&nbsp;executed&nbsp;failed'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.code&nbsp;=&nbsp;code;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(result);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;result.pid&nbsp;=&nbsp;pid;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;stdout.on(<span data-darkreader-inline-color="">'data'</span>,&nbsp;(data)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;dataStr&nbsp;=&nbsp;data.toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!silent)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.info(dataStr);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.stdout&nbsp;+=&nbsp;dataStr;<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;stderr.on(<span data-darkreader-inline-color="">'data'</span>,&nbsp;(data)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;dataStr&nbsp;=&nbsp;data.toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!silent)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.error(dataStr);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.stderr&nbsp;+=&nbsp;dataStr;<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;});<br>}<br><br>复制代码<br>
```

## 简单的日志记录函数

这段代码定义了一个打印日志的函数，名为 `log`。它使用了 `chalk` 库来设置日志的颜色。

`log` 函数接受任意数量的参数，并将它们打印到标准输出。它也定义了四个分别对应不同颜色的打印函数，分别是 `log.info`、`log.warn`、`log.error` 和 `log.success`。

这些函数会把它们的参数以不同的颜色打印出来。例如，`log.success('成功')` 会把字符串 `'成功'` 以绿色打印出来。

此外，`log` 还定义了一个名为 `log.divider` 的函数，它可以打印一条分隔线，用于区分不同的日志。分隔线的颜色可以通过 `level` 参数来指定，默认为 `'info'`。

```
/**<br>&nbsp;*&nbsp;更改颜色<br>&nbsp;*&nbsp;example&nbsp;chalk.green(<span data-darkreader-inline-color="">'成功'</span>)&nbsp;文字显示绿色<br>&nbsp;*/<br>import&nbsp;chalk&nbsp;from&nbsp;<span data-darkreader-inline-color="">'chalk'</span>;<br><br><span data-darkreader-inline-color="">type</span>&nbsp;ILevel&nbsp;=&nbsp;<span data-darkreader-inline-color="">'info'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'warn'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'success'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'error'</span>;<br><br><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">print</span>(color:&nbsp;string,&nbsp;...args:&nbsp;string[])&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(args.length&nbsp;&gt;&nbsp;1)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">log</span>(chalk[`<span data-darkreader-inline-color="">bg</span><span data-darkreader-inline-color="">${color.replace(/^\w/,&nbsp;(w)&nbsp;=&gt;&nbsp;w.toUpperCase())}</span>`](`&nbsp;<span data-darkreader-inline-color="">${args[0]}</span>&nbsp;`),&nbsp;chalk[color](args.slice(1)));<br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">log</span>(chalk[color](...args));<br>&nbsp;&nbsp;}<br>}<br><br><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">log</span>(...args)&nbsp;{<br>&nbsp;&nbsp;console.log(...args);<br>}<br><br>log.info&nbsp;=&nbsp;print.bind(null,&nbsp;<span data-darkreader-inline-color="">'gray'</span>);<br>log.warn&nbsp;=&nbsp;print.bind(null,&nbsp;<span data-darkreader-inline-color="">'yellow'</span>);<br>log.error&nbsp;=&nbsp;print.bind(null,&nbsp;<span data-darkreader-inline-color="">'red'</span>);<br>log.success&nbsp;=&nbsp;print.bind(null,&nbsp;<span data-darkreader-inline-color="">'green'</span>);<br>log.chalk&nbsp;=&nbsp;chalk;<br><br>/**<br>&nbsp;*&nbsp;Print&nbsp;divider<br>&nbsp;*&nbsp;@param&nbsp;{<span data-darkreader-inline-color="">'info'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'warn'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'success'</span>&nbsp;|&nbsp;<span data-darkreader-inline-color="">'error'</span>}&nbsp;level<br>&nbsp;*/<br>log.divider&nbsp;=&nbsp;(level:&nbsp;ILevel&nbsp;=&nbsp;<span data-darkreader-inline-color="">'info'</span>)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;const&nbsp;logger&nbsp;=&nbsp;<span data-darkreader-inline-color="">log</span>[level]&nbsp;||&nbsp;log.info;<br>&nbsp;&nbsp;logger(<span data-darkreader-inline-color="">'---------------------------------------------------------------------------------------'</span>);<br>};<br><br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">log</span>;<br><br>复制代码<br>
```

## 判断类型函数

这些函数用于检查 JavaScript 中的对象是否属于特定的类型。例如，函数 isArray() 可以用来检查传入的对象是否为数组类型。isObject() 函数可以用来检查对象是否为对象类型，isString() 函数可以用来检查对象是否为字符串类型，以此类推。

主要基于的是一下函数去做判断

```
const&nbsp;getType&nbsp;=&nbsp;(obj)&nbsp;=&gt;&nbsp;Object.prototype.toString.call(obj).slice(8,&nbsp;-1);<br>复制代码<br>
```

这个函数也是大家从juqery代码里学来的，一直沿用到现在，也是极为推崇的判断类型的方法，因为它非常准确。

```
const&nbsp;getType&nbsp;=&nbsp;(obj)&nbsp;=&gt;&nbsp;Object.prototype.toString.call(obj).slice(8,&nbsp;-1);<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isArray(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;any[]&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'Array'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isObject(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;{&nbsp;[key:&nbsp;string]:&nbsp;any&nbsp;}&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'Object'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isString(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;string&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'String'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isNumber(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;number&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'Number'</span>&nbsp;&amp;&amp;&nbsp;obj&nbsp;===&nbsp;obj;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isRegExp(obj:&nbsp;any)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'RegExp'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isFile(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;File&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'File'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isBlob(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;Blob&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;getType(obj)&nbsp;===&nbsp;<span data-darkreader-inline-color="">'Blob'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isUndefined(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;undefined&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;obj&nbsp;===&nbsp;undefined;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isFunction(obj:&nbsp;any):&nbsp;obj&nbsp;is&nbsp;(...args:&nbsp;any[])&nbsp;=&gt;&nbsp;any&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;typeof&nbsp;obj&nbsp;===&nbsp;<span data-darkreader-inline-color="">'function'</span>;<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;isEmptyObject(obj:&nbsp;any):&nbsp;boolean&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;isObject(obj)&nbsp;&amp;&amp;&nbsp;Object.keys(obj).length&nbsp;===&nbsp;0;<br>}<br><br><br>复制代码<br>
```

## 精简版classnames函数

这段代码实现了一个名为`cs`的函数，该函数能够将一组字符串类型的参数合并成一个字符串，并返回合并后的字符串。这个函数可以接受多个参数，并且支持字符串、字符串数组、对象等多种参数类型。在合并字符串时，会自动去除重复的字符串，并将所有字符串用空格隔开。

例如，对于以下调用：

```
cs(<span data-darkreader-inline-color="">'a'</span>,&nbsp;<span data-darkreader-inline-color="">'b'</span>,&nbsp;[<span data-darkreader-inline-color="">'c'</span>,&nbsp;<span data-darkreader-inline-color="">'d'</span>],&nbsp;{&nbsp;e:&nbsp;<span data-darkreader-inline-color="">true</span>,&nbsp;f:&nbsp;<span data-darkreader-inline-color="">false</span>&nbsp;},&nbsp;null,&nbsp;undefined);<br>复制代码<br>
```

会返回字符串：

```
<span data-darkreader-inline-color="">'a&nbsp;b&nbsp;c&nbsp;d&nbsp;e'</span><br>复制代码<br>
```

该函数可以用来替代类似的库（例如`classnames`），用于合并一组字符串并作为一个类名使用。

```
import&nbsp;{&nbsp;isString,&nbsp;isArray,&nbsp;isObject&nbsp;}&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./is'</span>;<br><br><span data-darkreader-inline-color="">type</span>&nbsp;ClassNamesArg&nbsp;=&nbsp;string&nbsp;|&nbsp;string[]&nbsp;|&nbsp;{&nbsp;[key:&nbsp;string]:&nbsp;any&nbsp;}&nbsp;|&nbsp;undefined&nbsp;|&nbsp;null&nbsp;|&nbsp;boolean;<br><br>/**<br>&nbsp;*&nbsp;代替classnames库,样式合并的方法<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;cs(...args:&nbsp;ClassNamesArg[]):&nbsp;string&nbsp;{<br>&nbsp;&nbsp;const&nbsp;length&nbsp;=&nbsp;args.length;<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;classNames:&nbsp;string[]&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">for</span>&nbsp;(<span data-darkreader-inline-color="">let</span>&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;v&nbsp;=&nbsp;args[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!v)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">continue</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isString(v))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classNames.push(v);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isArray(v))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classNames&nbsp;=&nbsp;classNames.concat(v);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(isObject(v))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object.keys(v).forEach((k)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(v[k])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classNames.push(k);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;[...new&nbsp;Set(classNames)].join(<span data-darkreader-inline-color="">'&nbsp;'</span>);<br>}<br><br>复制代码<br>
```

## omit函数

omit函数，它接受两个参数：一个对象和一个数组。函数会返回一个新对象，该对象为传入的对象的浅拷贝，并删除了数组中列出的所有属性。

例如，如果传入的对象为 { a: 1, b: 2, c: 3 }，数组为 \['a', 'c'\]，则返回的对象为 { b: 2 }。

```
/**<br>&nbsp;*&nbsp;delete&nbsp;keys&nbsp;from&nbsp;object<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;omit&lt;T&nbsp;extends&nbsp;Record&lt;string&nbsp;|&nbsp;number,&nbsp;any&gt;,&nbsp;K&nbsp;extends&nbsp;keyof&nbsp;T&gt;(<br>&nbsp;&nbsp;obj:&nbsp;T,<br>&nbsp;&nbsp;keys:&nbsp;Array&lt;K&nbsp;|&nbsp;string&gt;&nbsp;//&nbsp;string&nbsp;为了某些没有声明的属性被omit<br>):&nbsp;Omit&lt;T,&nbsp;K&gt;&nbsp;{<br>&nbsp;&nbsp;const&nbsp;<span data-darkreader-inline-color="">clone</span>&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;...obj,<br>&nbsp;&nbsp;};<br>&nbsp;&nbsp;keys.forEach((key)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;((key&nbsp;as&nbsp;K)&nbsp;<span data-darkreader-inline-color="">in</span>&nbsp;<span data-darkreader-inline-color="">clone</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;<span data-darkreader-inline-color="">clone</span>[key&nbsp;as&nbsp;K];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;});<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">clone</span>;<br>}<br><br>复制代码<br>
```

## 获取项目文件,以命令输入的目录为根目录

这个函数定义了一个 getProjectPath() 函数。它接受一个目录路径作为参数，并返回这个目录在项目中的绝对路径。如果没有提供目录路径，默认使用当前工作目录作为目录路径。

这个函数可以用来根据相对路径获取文件在项目中的绝对路径。

例如，如果工作目录为 /home/user/project，传入目录路径为 './src'，则返回值为 '/home/user/project/src'。

```
import&nbsp;path&nbsp;from&nbsp;<span data-darkreader-inline-color="">'path'</span>;<br><br>/**<br>&nbsp;*&nbsp;获取项目文件,以命令输入的目录为根目录<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;getProjectPath(dir&nbsp;=&nbsp;<span data-darkreader-inline-color="">'./'</span>):&nbsp;string&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;path.join(process.cwd(),&nbsp;dir);<br>}<br><br>复制代码<br>
```

## 更改主题的方法

通过更改css变量达到更换主题的目的

```
import&nbsp;{&nbsp;isObject&nbsp;}&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./is'</span>;<br><br>/**<br>&nbsp;*&nbsp;更换css变量的方法<br>&nbsp;*/<br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;setCssVariables(variables:&nbsp;Record&lt;string,&nbsp;any&gt;,&nbsp;root&nbsp;=&nbsp;document.body)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(variables&nbsp;&amp;&amp;&nbsp;isObject(variables))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;Object.keys(variables).forEach((themKey)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root.style.setProperty(themKey,&nbsp;variables[themKey]);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>}<br><br>复制代码<br>
```

## 自动化发布git脚本之检测git仓库是否初始化的代码

这个函数定义了一个 checkGitRemote() 函数。它首先会使用 getGitRootPath() 函数检测当前目录是否为 Git 仓库。

如果是，它会执行 git remote -v 命令，然后检查命令的输出中是否包含 push。如果包含，则打印空行；

如果不包含，则打印错误信息，并退出程序。如果检测到的当前目录不是 Git 仓库，则打印错误信息，并退出程序

```
import&nbsp;execQuick&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./execQuick'</span>;<br>import&nbsp;getGitRootPath&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./getGitRootPath'</span>;<br>import&nbsp;<span data-darkreader-inline-color="">print</span>&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./print'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;async&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;<span><span data-darkreader-inline-color="">checkGitRemote</span></span>()&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(getGitRootPath())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;code,&nbsp;stdout&nbsp;}&nbsp;=&nbsp;await&nbsp;execQuick(<span data-darkreader-inline-color="">'git&nbsp;remote&nbsp;-v'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(code&nbsp;===&nbsp;0&nbsp;&amp;&amp;&nbsp;stdout.match(<span data-darkreader-inline-color="">'(push)'</span>))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">print</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print.error([<span data-darkreader-inline-color="">'publish'</span>],&nbsp;<span data-darkreader-inline-color="">'在指定&nbsp;git&nbsp;remote&nbsp;前，您无法发布代码，请手动添加&nbsp;git&nbsp;remote。'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process.exit(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;print.error([<span data-darkreader-inline-color="">'publish'</span>],&nbsp;<span data-darkreader-inline-color="">'没有检测到&nbsp;Git&nbsp;仓库。'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;process.exit(1);<br>&nbsp;&nbsp;}<br>}<br><br>复制代码<br>
```

## 异步函数组合，是否调用下一个函数，完全由中间件自己决定

这个函数定义了一个 compose() 函数，它接受一个包含一组中间件对象的数组作为参数。

每个中间件对象都有一个名称和一个函数。

compose() 函数会按照数组中的顺序执行每个中间件函数。每个中间件函数执行完毕后，会更新一个名为 middlewareData 的对象，该对象包含了每个中间件函数处理后的数据。

最终返回的 middlewareData 对象可以用来在多个中间件之间共享数据。

```
/**<br>&nbsp;*&nbsp;异步函数组合，是否调用下一个函数，完全由中间件自己决定<br>&nbsp;*&nbsp;@param&nbsp;middleware&nbsp;中间件<br>&nbsp;*/<br><br><span data-darkreader-inline-color="">type</span>&nbsp;IMiddleware&nbsp;=&nbsp;{<br>&nbsp;&nbsp;name:&nbsp;string;<br>&nbsp;&nbsp;fn:&nbsp;({&nbsp;middlewareData,&nbsp;next&nbsp;}:&nbsp;{&nbsp;middlewareData:&nbsp;Record&lt;string,&nbsp;any&gt;;&nbsp;next:&nbsp;()&nbsp;=&gt;&nbsp;void&nbsp;})&nbsp;=&gt;&nbsp;Promise&lt;{&nbsp;data:&nbsp;Record&lt;string,&nbsp;any&gt;&nbsp;}&gt;;<br>};<br><br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;compose(middleware:&nbsp;IMiddleware[])&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">let</span>&nbsp;middlewareData:&nbsp;Record&lt;string,&nbsp;any&gt;&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;async&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;dispatch(index:&nbsp;number)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(index&nbsp;===&nbsp;middleware.length)&nbsp;<span data-darkreader-inline-color="">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;name,&nbsp;fn&nbsp;}&nbsp;=&nbsp;middleware[index];<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;data&nbsp;}&nbsp;=&nbsp;await&nbsp;fn({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;middlewareData,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next:&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch(++index);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;middlewareData&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...middlewareData,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[name]:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...middlewareData[name],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...data,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;dispatch(0);<br>}<br><br>复制代码<br>
```

## 命令行工具如何显示loading动画

我们封装了在命令行工具中常用ora这个库，ora 是一个 JavaScript 库，用于在命令行中显示 loading 指示器。

它可以用来提示用户在执行异步操作时的进度和结果。例如，可以使用 ora 库在执行某个异步任务时显示一个转圈圈的 loading 指示器，并在任务完成后显示成功或失败信息。

接着看我们封装的函数，如果函数执行成功，则 loading 指示器会显示成功信息，并将函数的返回值作为 Promise 的成功值；

如果函数执行失败，则 loading 指示器会显示失败信息，并将函数抛出的错误作为 Promise 的失败值。这个函数可以用来提示用户在执行异步操作时的进度和结果。

```
import&nbsp;ora&nbsp;from&nbsp;<span data-darkreader-inline-color="">'ora'</span>;<br>import&nbsp;<span data-darkreader-inline-color="">print</span>&nbsp;from&nbsp;<span data-darkreader-inline-color="">'./print'</span>;<br><br><span data-darkreader-inline-color="">export</span>&nbsp;default&nbsp;<span data-darkreader-inline-color="">function</span>&nbsp;withOra(<br>&nbsp;&nbsp;promiseFn:&nbsp;()&nbsp;=&gt;&nbsp;Promise&lt;any&gt;,<br>&nbsp;&nbsp;{&nbsp;text,&nbsp;successText,&nbsp;failText,&nbsp;startText&nbsp;}:&nbsp;{&nbsp;text:&nbsp;string;&nbsp;successText:&nbsp;string;&nbsp;failText:&nbsp;string;&nbsp;startText?:&nbsp;string&nbsp;}<br>)&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;new&nbsp;Promise((resolve,&nbsp;reject)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;spinner&nbsp;=&nbsp;ora(text).start();<br>&nbsp;&nbsp;&nbsp;&nbsp;startText&nbsp;&amp;&amp;&nbsp;print.info(startText);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;promiseFn()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<span data-darkreader-inline-color="">then</span>((result)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spinner.succeed(`✅&nbsp;<span data-darkreader-inline-color="">${successText}</span>`);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(result);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.catch((err)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spinner.fail(`❎&nbsp;<span data-darkreader-inline-color="">${failText}</span>`);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;});<br>}<br><br>复制代码<br>
```

> 作者：孟祥\_成都  
> 链接：https://juejin.cn/post/7176935575302668346  
> 来源：稀土掘金

## 结语

```
<section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 2px; word-spacing: 2px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">欢迎关注「</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">React</span><span data-darkreader-inline-outline="">」</span></span></section><section data-style="margin-bottom: 0px; outline: 0px; background-color: rgb(255, 255, 255); font-size: 16px; text-align: left; white-space: normal; letter-spacing: 0.544px; color: rgb(102, 102, 102); font-family: Lato, &quot;Helvetica Neue&quot;, Helvetica, sans-serif; font-variant-ligatures: common-ligatures;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><mp-common-profile data-pluginname="mpprofile" data-id="MzAxMTMyOTk3MA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/e93fo6YQKNmP3YCibFqeuFenfGuV6cesicX6UicG1VZwLlibogEJmbSRNoSwx8JxuQ06WKJXgz5xyv20jicbGTUbwxw/300?wx_fmt=png&amp;wxfrom=19" data-nickname="React" data-alias="react_native" data-signature="互联网从业者，专注于 React系列精彩内容推荐。关注大前端、Node技术全栈、Flutter、WebAssembly、鸿蒙（harmonyOS）、小程序等互联网科技领域最前沿技术，定期分享个人创业经验。" data-from="2" data-is_biz_ban="0" has-insert-preloading="1" data-index="1" data-origin_num="50" data-isban="0" data-weui-theme="light" data-biz_account_status="0"></mp-common-profile></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 20px; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 2px; word-spacing: 2px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><span data-darkreader-inline-outline=""><span data-darkreader-inline-outline="">号内回复</span></span></section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">&nbsp;"<span data-darkreader-inline-outline="">精选</span>" ，将为您推送 历史精选文章"<span data-darkreader-inline-outline="">react"</span>&nbsp;，将为您推送 React.js 相关的学习资料&nbsp;"<span data-darkreader-inline-outline="">学习指南</span>" ，将为您推送 React-Native学习指南&nbsp;"<span data-darkreader-inline-outline="">vue</span>" ，将为您推送vue.js 相关文章&nbsp;"<span data-darkreader-inline-outline="">小程序</span>" ，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">微信小商店</span>"，将为您推送小程序相关文章&nbsp;"<span data-darkreader-inline-outline="">加群</span>" ，添加群主好友拉你进群</section><section mp-original-font-size="16" mp-original-line-height="28.799999237060547" data-style="margin-bottom: 5px; outline: 0px; color: rgb(58, 58, 58); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-size-adjust: inherit; line-height: 28.8px; word-break: break-word;" data-darkreader-inline-outline="" data-darkreader-inline-color="">加我私人微信，拉你进 React进阶、面试交流群，互相监督学习进步等！</section><p data-style="margin-bottom: 0em; outline: 0px; color: rgb(0, 0, 0); letter-spacing: 0.544px; word-spacing: 0.8px; white-space: normal; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif; font-size: 16px; text-align: center;" data-darkreader-inline-outline="" data-darkreader-inline-color=""><img data-galleryid="" data-ratio="1.261480787253983" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/e93fo6YQKNlJReqfJKqeft8SuT9o4DliaoUIJqmbtBw72F7nYumlpJ5dxIvLfbNv5W0Nf1ZtIltr9bFsL4qd6fg/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="1067" data-darkreader-inline-outline="" data-original-style="outline: 0px; border-style: none; border-radius: 3px; display: initial; visibility: visible !important; width: 344px !important; --darkreader-inline-outline: initial;" data-index="2" src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E" _width="344px" crossorigin="anonymous" alt="Image"><span data-style="outline: 0px; color: rgb(51, 51, 51); font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-size: 17px; letter-spacing: 0.544px; text-align: justify; word-spacing: 0.8px;" data-darkreader-inline-outline="" data-darkreader-inline-color=""></span></p><section data-brushtype="text" mp-original-font-size="16" mp-original-line-height="25.600000381469727" data-darkreader-inline-outline="" data-style="margin-bottom: 0em; padding-right: 0.5em; padding-left: 0.5em; outline: 0px; background-color: rgb(255, 255, 255); color: rgb(89, 89, 89); font-size: 16px; white-space: normal; letter-spacing: 2px; font-variant-ligatures: common-ligatures; text-size-adjust: inherit; widows: 1; word-spacing: 2px; font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light; border-width: 0px; border-style: none; border-color: initial; text-align: right; line-height: 25.6px;" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><span data-darkreader-inline-outline="" data-darkreader-inline-color="">“在看和转发”</span><span data-darkreader-inline-outline="" data-darkreader-inline-color="">就是最大的支持</span></section>
```