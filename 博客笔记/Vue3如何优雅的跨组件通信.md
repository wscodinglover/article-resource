开发中经常会遇到跨组件通信的场景。props 逐层传递的方法实在是太不优雅了，所以今天总结下可以更加简单的跨组件通信的一些方法。

![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/CtsaVVKdWEoor5lAxnkvMJ33CgJMUlIIrLfW7NY3cZ6lOWVBCAg5QWjwTiaRhT2lNuqmp280BmTmicpvuCAthgMQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

### 依赖注入

![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/CtsaVVKdWEoor5lAxnkvMJ33CgJMUlII5sDDbiam5wLZjou5EebKfJIRXH3ThPPDWrxHTmL9MuxG5P0BTKshPhg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;App.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref,&nbsp;provide&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;Child&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./components/Child.vue"</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;count&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">0</span>)<br><span data-darkreader-inline-color="">const</span>&nbsp;updateCount&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;count.value&nbsp;++<br>provide(<span data-darkreader-inline-color="">"count"</span>,&nbsp;{count,&nbsp;updateCount})<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">h4</span>&gt;</span>公众号：萌萌哒草头将军<span>&lt;/<span data-darkreader-inline-color="">h4</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Child</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;Child.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Other</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;Other&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./other.vue"</span><br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;other.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>other&nbsp;change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;inject&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span><br><span data-darkreader-inline-color="">const</span>&nbsp;{count,&nbsp;updateCount}&nbsp;=&nbsp;inject(<span data-darkreader-inline-color="">"count"</span>)<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

在 setup 组件中，使用 inject 跨组件通信是最佳的方案。所以该模式下，是没有提供event bus 事件总线。

但是在 option api 模式下，还需要额外的注册，显的有点麻烦。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">emits</span>:&nbsp;[<span data-darkreader-inline-color="">"some-name"</span>]<br>}<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

### 属性透传

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;App.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref,&nbsp;provide&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;Attr&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./components/Attr.vue"</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;count&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">0</span>)<br><span data-darkreader-inline-color="">const</span>&nbsp;updateCount&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;count.value&nbsp;++<br>provide(<span data-darkreader-inline-color="">"count"</span>,&nbsp;{count,&nbsp;updateCount})<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">h4</span>&gt;</span>公众号：萌萌哒草头将军<span>&lt;/<span data-darkreader-inline-color="">h4</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Attr</span>&nbsp;<span data-darkreader-inline-color="">:count</span>=<span data-darkreader-inline-color="">"count"</span>&nbsp;<span data-darkreader-inline-color="">:updateCount</span>=<span data-darkreader-inline-color="">"updateCount"</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;Attr.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>attr&nbsp;component<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Child</span>&nbsp;<span data-darkreader-inline-color="">v-bind</span>=<span data-darkreader-inline-color="">"$attrs"</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;Child&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'./Child.vue'</span>;<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

属性透传这种方式类似于react中手动透传属性。感觉有点暴力，但是又特别方便快捷。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">App</span>&nbsp;(<span>props</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span>&lt;<span data-darkreader-inline-color="">Other</span>&nbsp;{<span data-darkreader-inline-color="">...props</span>}&nbsp;/&gt;</span><br>}<br></code>
```

Vue中默认透传的属性有 style、class、key。如果子组件也存在class、style，则会自动合并class、style。

如果你的子组件是根组件时，可以省略 v-bind="$attrs"。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Child</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

### 状态库

状态管理库我们以Pinia为例。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;App.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;Other&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./components/Other.vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useCounterStore&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./store/index"</span><br><span data-darkreader-inline-color="">const</span>&nbsp;state&nbsp;=&nbsp;useCounterStore()<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">h4</span>&gt;</span>公众号：萌萌哒草头将军<span>&lt;/<span data-darkreader-inline-color="">h4</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Other</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;defineStore&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"pinia"</span>&nbsp;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span><br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;useCounterStore&nbsp;=&nbsp;defineStore(<span data-darkreader-inline-color="">'counter'</span>,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;count&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">0</span>)<br>&nbsp;&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">updateCount</span>(<span></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;count.value++<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;{&nbsp;count,&nbsp;updateCount&nbsp;}<br>})<br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;Other.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>pinia&nbsp;store<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;state.count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"state.updateCount"</span>&gt;</span>other&nbsp;change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useCounterStore&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'../store'</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;state&nbsp;=&nbsp;useCounterStore()<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

状态管理库最大的缺点是，没法使用解构语法。因为这会导致失去响应式的能力。

### 事件总线

事件总线（event bus）比较特殊，因为在组合式API里不支持该方式，所以下面的例子适合 Option API 组件。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;App.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;Other&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./components/Other.vue"</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;count&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">0</span>)<br><span data-darkreader-inline-color="">const</span>&nbsp;updateCount&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;count.value&nbsp;++<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">h4</span>&gt;</span>公众号：萌萌哒草头将军<span>&lt;/<span data-darkreader-inline-color="">h4</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Other</span>&nbsp;@<span data-darkreader-inline-color="">updateCount</span>=<span data-darkreader-inline-color="">"updateCount()"</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;Other.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>eventBus&nbsp;store<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"$emit('updateCount')"</span>&gt;</span>other&nbsp;change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">emits</span>:&nbsp;[<span data-darkreader-inline-color="">"updateCount"</span>]<br>}<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

事件总线更适合传递事件。

### 自定义事件

但是有时候，你可能非常想使用事件总线的方式在 setup 组件中传递事件，这时候我们可以使用自定义的事件的方式实现这种功能。

下面是实现。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span><span data-darkreader-inline-color="">class</span>&nbsp;<span data-darkreader-inline-color="">EventBus</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">constructor</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.events&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;订阅事件</span><br>&nbsp;&nbsp;on(eventName,&nbsp;callback)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(!<span data-darkreader-inline-color="">this</span>.events[eventName])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.events[eventName]&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.events[eventName].push(callback);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;发布事件</span><br>&nbsp;&nbsp;emit(eventName,&nbsp;eventData)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;eventCallbacks&nbsp;=&nbsp;<span data-darkreader-inline-color="">this</span>.events[eventName];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(eventCallbacks)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventCallbacks.forEach(<span><span>callback</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback(eventData);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;取消订阅事件</span><br>&nbsp;&nbsp;off(eventName,&nbsp;callback)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;eventCallbacks&nbsp;=&nbsp;<span data-darkreader-inline-color="">this</span>.events[eventName];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(eventCallbacks)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">this</span>.events[eventName]&nbsp;=&nbsp;eventCallbacks.filter(<span><span>cb</span>&nbsp;=&gt;</span>&nbsp;cb&nbsp;!==&nbsp;callback);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;eventBus&nbsp;=&nbsp;<span data-darkreader-inline-color="">new</span>&nbsp;EventBus()<br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;App.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">"ts"</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;ref&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;Other&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./components/Other.vue"</span>;<br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;eventBus&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"./store/eventBus"</span>;<br><span data-darkreader-inline-color="">const</span>&nbsp;count&nbsp;=&nbsp;ref(<span data-darkreader-inline-color="">0</span>)<br><span data-darkreader-inline-color="">const</span>&nbsp;updateCount&nbsp;=&nbsp;<span><span>()</span>&nbsp;=&gt;</span>&nbsp;count.value&nbsp;++<br>eventBus.on(<span data-darkreader-inline-color="">"updateCount"</span>,&nbsp;updateCount)<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">h4</span>&gt;</span>公众号：萌萌哒草头将军<span>&lt;/<span data-darkreader-inline-color="">h4</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>{{&nbsp;count&nbsp;}}<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"updateCount"</span>&gt;</span>change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">Other</span>&nbsp;@<span data-darkreader-inline-color="">updateCount</span>=<span data-darkreader-inline-color="">"updateCount()"</span>&nbsp;/&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br></code>
```

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">&lt;!--&nbsp;Other.vue&nbsp;--&gt;</span><br><span>&lt;<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">div</span>&gt;</span>eventBus<span>&lt;/<span data-darkreader-inline-color="">div</span>&gt;</span><br>&nbsp;&nbsp;<span>&lt;<span data-darkreader-inline-color="">button</span>&nbsp;@<span data-darkreader-inline-color="">click</span>=<span data-darkreader-inline-color="">"eventBus.emit('updateCount',&nbsp;null)"</span>&gt;</span>other&nbsp;change<span>&lt;/<span data-darkreader-inline-color="">button</span>&gt;</span><br><span>&lt;/<span data-darkreader-inline-color="">template</span>&gt;</span><br>&nbsp;&nbsp;<br><span>&lt;<span data-darkreader-inline-color="">script</span>&nbsp;<span data-darkreader-inline-color="">setup</span>&nbsp;<span data-darkreader-inline-color="">lang</span>=<span data-darkreader-inline-color="">'ts'</span>&gt;</span><span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;eventBus&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">"../store/eventBus"</span>;<br></span><span>&lt;/<span data-darkreader-inline-color="">script</span>&gt;</span><br></code>
```

![Image](data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

当然，我们这里不止可以使用 event bus，发布订阅模式也很适合。可以参考我以前的设计模式的文章实现这个功能。

### 总结

每种方式都有自己的优点和缺点，根据使用场景选择最合适的才能算是最优的方案。

今天的分享就这些了，十分感谢您的阅读，希望可以帮助到您。