  

### 安装

`useAxios`是从`@vueuse/integrations/useAxios`中导入的自定义钩子，用于简化axios的使用。

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">yarn&nbsp;add&nbsp;axios&nbsp;&nbsp;@vueuse/integrations<br></code>
```

### 导入需要的模块和库

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAxios&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'@vueuse/integrations/useAxios'</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;导入VueUse库中的useAxios函数</span><br><span data-darkreader-inline-color="">import</span>&nbsp;axios&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'axios'</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;导入Axios库</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;showToast&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vant'</span>&nbsp;<br></code>
```

### 创建一个Axios实例，设置一些全局配置

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">const</span>&nbsp;instance&nbsp;=&nbsp;axios.create({<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">baseURL</span>:&nbsp;<span data-darkreader-inline-color="">'https://api.example.com'</span>,&nbsp;<span data-darkreader-inline-color="">//&nbsp;替换成你想要的baseURL</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">withCredentials</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,&nbsp;<span data-darkreader-inline-color="">//&nbsp;是否携带凭证，默认为false</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">timeout</span>:&nbsp;<span data-darkreader-inline-color="">5000</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求超时时间，默认为5秒</span><br>})<br></code>
```

### 添加请求拦截器

用于在发送请求之前做一些处理：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">instance.interceptors.request.use(<br>&nbsp;&nbsp;<span>(<span>config</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;在请求发送之前的处理逻辑</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;token&nbsp;=&nbsp;store.state.user.token<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(token)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;每个请求都带上token</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.headers&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...config.headers,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">Authorization</span>:&nbsp;<span data-darkreader-inline-color="">`Bearer&nbsp;<span data-darkreader-inline-color="">${token}</span>`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;config<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;(error)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求错误的处理逻辑</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(error)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(error)<br>&nbsp;&nbsp;}<br>)<br></code>
```

### 添加响应拦截器

用于处理服务器返回的响应：

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">instance.interceptors.response.use(<br>&nbsp;&nbsp;<span>(<span>response</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;res&nbsp;=&nbsp;response.data;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;如果自定义的code不是200，则判断为错误</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(res.code&nbsp;!==&nbsp;<span data-darkreader-inline-color="">200</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showToast(res.msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;401:&nbsp;Token过期;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(res.code&nbsp;===&nbsp;<span data-darkreader-inline-color="">401</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//返回登录页面</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(res.msg&nbsp;||&nbsp;<span data-darkreader-inline-color="">'Error'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;res;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;(error)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">'err'</span>&nbsp;+&nbsp;error);<br>&nbsp;&nbsp;&nbsp;&nbsp;showToast(error.message);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(error.message);<br>&nbsp;&nbsp;},<br>);<br></code>
```

### 导出`useAxiosApi`

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useAxiosApi</span>(<span>url,&nbsp;config</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;useAxios(url,&nbsp;config);<br>}<br></code>
```

### 使用

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&lt;script&nbsp;setup&gt;<br><span data-darkreader-inline-color="">import</span>&nbsp;useAxiosApi&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'@/utils/useAxiosApi'</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;onMounted&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vue'</span><br>onMounted(<span><span>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;fetchData()<br>})<br><span data-darkreader-inline-color="">const</span>&nbsp;fetchData&nbsp;=&nbsp;<span data-darkreader-inline-color="">async</span>&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;config&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">method</span>:&nbsp;<span data-darkreader-inline-color="">'GET'</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求方法，可以是GET、POST等</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;其他请求配置，例如headers、params等</span><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;response&nbsp;=&nbsp;<span data-darkreader-inline-color="">await</span>&nbsp;useAxiosApi(<span data-darkreader-inline-color="">'api/list'</span>,&nbsp;config)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(response)&nbsp;<span data-darkreader-inline-color="">//&nbsp;处理响应数据</span><br>&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">catch</span>&nbsp;(e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(e)<br>&nbsp;&nbsp;}<br>}<br>&lt;<span data-darkreader-inline-color="">/script&gt;<br></span></code>
```

### 配置代码

这里顺便讲一下设置proxy代理配置，在`vite.config.js`文件中

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor="">&nbsp;server:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">proxy</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">'/api'</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">target</span>:&nbsp;<span data-darkreader-inline-color="">'https://api.example.com'</span>,&nbsp;<span data-darkreader-inline-color="">//&nbsp;替换为后端服务的地址</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">changeOrigin</span>:&nbsp;<span data-darkreader-inline-color="">true</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">rewrite</span>:&nbsp;<span>(<span>path</span>)&nbsp;=&gt;</span>&nbsp;path.replace(<span data-darkreader-inline-color="">/^\/api/</span>,&nbsp;<span data-darkreader-inline-color="">''</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br></code>
```

### 完整代码

```
<span data-darkreader-inline-bgcolor=""></span><code data-darkreader-inline-color="" data-darkreader-inline-bgimage="" data-darkreader-inline-bgcolor=""><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;useAxios&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'@vueuse/integrations/useAxios'</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;导入VueUse库中的useAxios函数</span><br><span data-darkreader-inline-color="">import</span>&nbsp;axios&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'axios'</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;导入Axios库</span><br><span data-darkreader-inline-color="">import</span>&nbsp;{&nbsp;showToast&nbsp;}&nbsp;<span data-darkreader-inline-color="">from</span>&nbsp;<span data-darkreader-inline-color="">'vant'</span><br><br><span data-darkreader-inline-color="">//创建一个Axios实例</span><br><span data-darkreader-inline-color="">const</span>&nbsp;instance&nbsp;=&nbsp;axios.create({<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">baseURL</span>:&nbsp;<span data-darkreader-inline-color="">'https://api.example.com'</span>,&nbsp;<span data-darkreader-inline-color="">//&nbsp;替换成你的baseURL</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">withCredentials</span>:&nbsp;<span data-darkreader-inline-color="">false</span>,&nbsp;<span data-darkreader-inline-color="">//&nbsp;是否携带凭证，默认为false</span><br>&nbsp;&nbsp;<span data-darkreader-inline-color="">timeout</span>:&nbsp;<span data-darkreader-inline-color="">5000</span>&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求超时时间，默认为5秒</span><br>})<br><br><span data-darkreader-inline-color="">//添加请求拦截器</span><br>instance.interceptors.request.use(<br>&nbsp;&nbsp;<span>(<span>config</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;在请求发送之前的处理逻辑</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;token&nbsp;=&nbsp;store.state.user.token<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(token)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;每个请求都带上token</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.headers&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...config.headers,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">Authorization</span>:&nbsp;<span data-darkreader-inline-color="">`Bearer&nbsp;<span data-darkreader-inline-color="">${token}</span>`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;config<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;(error)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;请求错误的处理逻辑</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(error)&nbsp;<span data-darkreader-inline-color="">//&nbsp;调试用</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(error)<br>&nbsp;&nbsp;}<br>)<br><br>instance.interceptors.response.use(<br>&nbsp;&nbsp;<span>(<span>response</span>)&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">const</span>&nbsp;res&nbsp;=&nbsp;response.data<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;如果自定义的code不是200，则判断为错误</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(res.code&nbsp;!==&nbsp;<span data-darkreader-inline-color="">200</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showToast(res.msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//&nbsp;401:&nbsp;Token过期;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">if</span>&nbsp;(res.code&nbsp;===&nbsp;<span data-darkreader-inline-color="">401</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">//返回登录页面</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(res.msg&nbsp;||&nbsp;<span data-darkreader-inline-color="">'Error'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span data-darkreader-inline-color="">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;res<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;(error)&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">console</span>.log(<span data-darkreader-inline-color="">'err'</span>&nbsp;+&nbsp;error)<br>&nbsp;&nbsp;&nbsp;&nbsp;showToast(error.message)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;<span data-darkreader-inline-color="">Promise</span>.reject(error.message)<br>&nbsp;&nbsp;}<br>)<br><br><span data-darkreader-inline-color="">//导出</span><br><span data-darkreader-inline-color="">export</span>&nbsp;<span data-darkreader-inline-color="">default</span>&nbsp;<span><span data-darkreader-inline-color="">function</span>&nbsp;<span data-darkreader-inline-color="">useAxiosApi</span>(<span>url,&nbsp;config</span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span data-darkreader-inline-color="">return</span>&nbsp;useAxios(url,&nbsp;config)<br>}<br></code>
```

以上就是今日分享的文章，假期愉快！晚安啦！